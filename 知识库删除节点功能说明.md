# 知识库删除节点功能说明

## 功能概述

在知识库文档管理（KnowledgeBaseCabinet.vue）中添加了删除节点和文档的功能，支持：
- ✅ 删除单个文档
- ✅ 递归删除节点及其所有子节点和文档
- ✅ 删除前弹出确认对话框
- ✅ 友好的视觉提示和动画效果

## 新增功能

### 1. 删除按钮

#### 节点删除按钮
- 位置：每个文件夹节点标题右侧
- 样式：垃圾桶图标，鼠标悬停时显示
- 颜色：默认灰色，悬停时变为红色
- 交互：点击后显示确认对话框

#### 文档删除按钮
- 位置：每个文档项右侧
- 样式：垃圾桶图标，鼠标悬停时显示
- 颜色：默认灰色，悬停时变为红色
- 交互：点击后显示确认对话框

### 2. 删除确认对话框

#### 对话框内容
- **警告图标**：黄色警告三角形，带脉冲动画
- **确认消息**：显示要删除的节点/文档名称
- **警告提示**：
  - 删除节点：提示将递归删除所有子节点和文档
  - 删除文档：提示操作不可恢复
- **操作按钮**：
  - 取消按钮（灰色）
  - 确认删除按钮（红色渐变）

#### 对话框样式
- 居中显示
- 半透明黑色背景遮罩
- 白色圆角卡片
- 响应式设计

### 3. 删除逻辑

#### API调用
- **删除节点**：调用 `wikiAPI.page.deletePageRecursively(pageId)`
  - 后端会递归删除该节点及所有子节点和文档
- **删除文档**：调用 `wikiAPI.page.deletePage(pageId)`
  - 后端删除单个文档

#### 前端更新
删除成功后：
1. 从本地 `folders` 数组中移除删除的节点
2. 从本地 `docs` 数组中移除删除的文档
3. 如果删除的是节点，还会移除该节点下的所有文档
4. 如果删除的是当前活动文档，清空编辑器
5. 保存到 localStorage
6. 重新加载 Wiki 树

## 新增代码

### Data属性（已添加）
```javascript
showDeleteDialog: false,    // 是否显示删除确认对话框
deleteNodeId: null,          // 待删除节点的ID
deleteNodeType: null,        // 待删除节点类型（'folder' 或 'document'）
deleteNodeName: '',          // 待删除节点名称
deleting: false,             // 是否正在删除中
```

### Methods方法（已添加）
```javascript
confirmDeleteNode(nodeId, nodeType, nodeName)  // 显示删除确认对话框
closeDeleteDialog()                             // 关闭删除确认对话框
executeDeleteNode()                             // 执行删除操作
```

## UI交互流程

```
用户点击删除按钮
    ↓
弹出确认对话框
    ↓
用户点击"确认删除"
    ↓
调用后端API删除
    ↓
删除成功
    ↓
更新前端数据
    ↓
刷新Wiki树
    ↓
显示成功提示
    ↓
关闭对话框
```

## CSS样式特性

### 删除按钮
- 默认透明度为0（隐藏）
- 鼠标悬停在节点/文档上时，透明度变为1（显示）
- 悬停在删除按钮上时：
  - 背景色变为浅红色（#fee2e2）
  - 图标颜色变为红色（#ef4444）
  - 缩放至1.1倍

### 确认对话框
- 警告图标带脉冲动画（2秒循环）
- 危险按钮使用红色渐变背景
- 警告提示使用浅红色背景卡片

## 安全特性

1. **二次确认**：删除前必须通过确认对话框
2. **明确提示**：清楚告知删除的内容和影响范围
3. **视觉警告**：使用红色和警告图标强调危险性
4. **禁用状态**：删除进行中按钮禁用，防止重复点击
5. **ID精度保护**：使用字符串比较ID，避免雪花ID精度丢失

## 测试建议

1. **删除文档**：
   - 选中一个文档，点击删除按钮
   - 确认对话框正确显示文档名称
   - 点击确认删除，文档消失
   - 编辑器内容清空（如果删除的是当前文档）

2. **删除节点**：
   - 选中一个有子节点的节点，点击删除按钮
   - 确认对话框显示递归删除警告
   - 点击确认删除，节点及其所有子内容消失

3. **取消删除**：
   - 点击删除按钮后，点击"取消"
   - 对话框关闭，数据无变化

4. **删除中状态**：
   - 点击确认删除后，按钮显示"删除中..."
   - 按钮变为禁用状态

## 注意事项

1. ⚠️ 删除操作不可恢复，后端需要实现软删除或备份机制
2. 🔒 确保后端API有权限检查，只允许有权限的用户删除
3. 📝 建议在后端添加操作日志，记录删除操作
4. 🔄 删除后会自动刷新Wiki树，确保数据同步

## 完成时间

2025-11-06

## 开发者

AI Assistant (Claude Sonnet 4.5)

