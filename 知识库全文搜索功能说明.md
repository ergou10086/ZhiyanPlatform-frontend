# 知识库全文搜索功能说明

## 功能概述

在知识库文档管理（`KnowledgeBaseCabinet.vue`）中添加了全文搜索功能，支持同时搜索文档标题和内容，并实时展示搜索结果。

## 功能特性

### 1. 实时搜索（防抖）
- 输入关键词后，自动在 500ms 后触发搜索
- 防止频繁调用后端API，提升性能
- 支持按回车键立即搜索

### 2. 搜索结果展示
- 显示搜索结果数量
- 展示文档标题、内容摘要、所属目录
- 相对时间显示（今天、昨天、X天前）
- 关键词高亮显示（黄色背景标记）

### 3. 交互功能
- **点击搜索结果**：自动加载文档内容并展开所属目录
- **清空搜索**：点击清空按钮或关闭搜索结果
- **加载状态**：显示旋转加载动画
- **空状态**：未找到结果时显示友好提示

### 4. 用户体验
- 搜索框在工具栏中，位置醒目
- 搜索结果以卡片形式展示，样式美观
- 支持滚动浏览多个搜索结果
- 关键词高亮，快速定位匹配内容

## 技术实现

### 1. 数据属性
```javascript
searchKeyword: '',         // 搜索关键词
searchResults: [],         // 搜索结果列表
showSearchResults: false,  // 是否显示搜索结果
searching: false,          // 是否正在搜索
searchTimer: null          // 搜索防抖定时器
```

### 2. 核心方法

#### handleSearchInput()
- 监听搜索框输入
- 实现 500ms 防抖
- 空关键词时自动清空搜索结果

#### performSearch()
- 调用后端API：`wikiAPI.search.simpleSearch(projectId, keyword, 20)`
- 处理搜索结果
- 显示加载状态和错误提示

#### selectSearchResult(result)
- 点击搜索结果后加载文档
- 自动展开文档所属目录
- 区分目录和文档类型

#### highlightKeyword(text)
- 使用正则表达式高亮关键词
- 转义特殊字符防止注入
- 使用 `<mark>` 标签包裹关键词

#### formatDate(dateString)
- 格式化时间显示
- 支持相对时间（今天、昨天、X天前）

#### clearSearch()
- 清空搜索关键词和结果
- 隐藏搜索结果面板
- 清除防抖定时器

### 3. 后端API调用

使用 `wikiSearchAPI.simpleSearch` 接口：
```javascript
GET /api/wiki/search/projects/{projectId}/simple
参数：
- keyword: 搜索关键词（必需）
- limit: 返回结果数量（默认20）
```

### 4. 样式设计

- **搜索容器**：相对定位，包含搜索框和清空按钮
- **搜索结果面板**：白色背景，圆角卡片，阴影效果
- **搜索结果项**：Flex布局，图标+内容
- **关键词高亮**：黄色背景（#fef3c7），深棕色文字（#92400e）
- **加载动画**：CSS旋转动画
- **空状态**：图标+文字提示

## 使用说明

### 用户操作流程

1. **输入关键词**
   - 在搜索框中输入要搜索的关键词
   - 系统自动在 500ms 后触发搜索

2. **查看搜索结果**
   - 搜索结果显示在搜索框下方
   - 标题显示搜索结果数量
   - 每条结果显示文档标题、内容摘要、更新时间

3. **选择文档**
   - 点击任一搜索结果
   - 系统自动加载文档内容
   - 文档列表中自动定位到该文档

4. **清空搜索**
   - 点击搜索框右侧的 × 按钮
   - 或点击搜索结果面板右上角的 × 按钮
   - 搜索结果面板隐藏，文档列表恢复正常

## 测试要点

### 功能测试
- [x] 输入关键词后，500ms 自动触发搜索
- [x] 按回车键立即触发搜索
- [x] 搜索结果正确显示（标题、摘要、时间）
- [x] 关键词高亮显示
- [x] 点击搜索结果能正确跳转到文档
- [x] 清空搜索功能正常
- [x] 搜索加载状态显示
- [x] 搜索空状态显示

### 边界测试
- [x] 输入空关键词（自动清空搜索结果）
- [x] 输入特殊字符（正则转义）
- [x] 快速连续输入（防抖机制）
- [x] 搜索结果为空（显示空状态）
- [x] 搜索结果较多（滚动浏览）
- [x] 网络错误（错误提示）

### UI/UX测试
- [x] 搜索框样式美观
- [x] 搜索结果布局合理
- [x] 关键词高亮醒目
- [x] 加载动画流畅
- [x] 交互响应及时
- [x] 错误提示友好

## 改进建议

### 短期改进
1. 增加搜索历史记录
2. 支持搜索过滤（只搜索标题/只搜索内容）
3. 支持搜索排序（相关性/时间）

### 长期改进
1. 实现高级搜索（多条件组合）
2. 支持搜索结果预览
3. 集成全文检索引擎（Elasticsearch）
4. 支持模糊搜索和拼音搜索
5. 搜索结果分页加载

## 相关文件

- **组件文件**：`zhiyan_front/src/views/KnowledgeBaseCabinet.vue`
- **API文件**：`zhiyan_front/src/api/wiki.js`
- **后端接口**：`/api/wiki/search/projects/{projectId}/simple`

## 注意事项

1. **ID精度问题**：所有ID都使用字符串格式处理，避免雪花ID精度丢失
2. **XSS防护**：使用 `v-html` 时已对关键词进行转义处理
3. **性能优化**：实现了防抖机制，限制了搜索结果数量（20条）
4. **用户体验**：搜索加载和空状态都有友好提示

## 更新日志

### 2024-11-06
- ✅ 添加全文搜索功能
- ✅ 实现搜索防抖机制
- ✅ 添加关键词高亮显示
- ✅ 实现搜索结果点击跳转
- ✅ 优化搜索UI/UX设计
- ✅ 添加加载状态和空状态提示

