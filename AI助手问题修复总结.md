# AIåŠ©æ‰‹é—®é¢˜ä¿®å¤æ€»ç»“

## ä¿®å¤æ—¥æœŸ
2025-11-06

## ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1: "Failed to fetch" é”™è¯¯ âœ…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
TypeError: Failed to fetch
    at Object.chatStream (coze.js:287)
```

**æ ¹æœ¬åŸå› **ï¼š
Vueå¼€å‘æœåŠ¡å™¨çš„Coze AIä»£ç†é…ç½®ç¼ºå°‘æµå¼å“åº”ï¼ˆSSEï¼‰æ”¯æŒ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
æ›´æ–° `vue.config.js`ï¼Œä¸º `/zhiyan/api/coze` ä»£ç†æ·»åŠ SSEæ”¯æŒé…ç½®ï¼š
- ç¦ç”¨ç¼“å†² (`buffer: false`)
- è®¾ç½®æ— é™è¶…æ—¶ (`timeout: 0`)
- é…ç½®æ­£ç¡®çš„SSEå“åº”å¤´
- æ·»åŠ æµå¼æ•°æ®ç›‘å¬

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `zhiyan_front/vue.config.js`

**éªŒè¯æ­¥éª¤**ï¼š
1. âœ… é‡å¯Vueå¼€å‘æœåŠ¡å™¨ï¼ˆå¿…é¡»ï¼‰
2. âœ… ç¡®è®¤Cozeåç«¯æœåŠ¡è¿è¡Œåœ¨8094ç«¯å£
3. âœ… åœ¨AIåŠ©æ‰‹é¡µé¢å‘é€æ¶ˆæ¯æµ‹è¯•

---

### é—®é¢˜2: "Cannot read properties of undefined (reading 'success')" é”™è¯¯ âœ…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
TypeError: Cannot read properties of undefined (reading 'success')
    at VueComponent.handleFileUpload (KnowledgeBaseAI.vue:727)
```

**æ ¹æœ¬åŸå› **ï¼š
`this.$message` æœªå®šä¹‰ï¼ˆé¡¹ç›®æœªå®‰è£…/æ³¨å†ŒUIåº“ï¼‰ï¼Œä½†ä»£ç ç›´æ¥è°ƒç”¨ `this.$message.success()`

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
åœ¨è°ƒç”¨ `this.$message` ä¹‹å‰æ·»åŠ å­˜åœ¨æ€§æ£€æŸ¥ï¼š

```javascript
// ä¿®å¤å‰ï¼ˆä¼šæŠ¥é”™ï¼‰
this.$message.success(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`)

// ä¿®å¤åï¼ˆå®‰å…¨ï¼‰
if (this.$message) {
  this.$message.success(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`)
} else {
  console.log(`âœ… å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`)
}
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `zhiyan_front/src/views/KnowledgeBaseAI.vue` (handleFileUpload æ–¹æ³•)

**éªŒè¯æ­¥éª¤**ï¼š
1. âœ… ç‚¹å‡»"ä»æœ¬åœ°ä¸Šä¼ æ–‡æ¡£"æŒ‰é’®
2. âœ… é€‰æ‹©æ–‡ä»¶
3. âœ… ç¡®è®¤ä¸å†æŠ¥é”™
4. âœ… åœ¨æ§åˆ¶å°çœ‹åˆ°æˆåŠŸæ—¥å¿—

---

## PowerShellå‘½ä»¤ä¿®å¤

**é—®é¢˜**ï¼š
```
cd zhiyan_front && npm run serve  # âŒ PowerShellä¸æ”¯æŒ &&
```

**ä¿®å¤**ï¼š
```powershell
cd zhiyan_front; npm run serve    # âœ… PowerShellä½¿ç”¨ ; åˆ†éš”å‘½ä»¤
```

æˆ–åˆ†ä¸¤æ­¥æ‰§è¡Œï¼š
```powershell
cd zhiyan_front
npm run serve
```

---

## éªŒè¯æ¸…å•

### 1. ç¯å¢ƒæ£€æŸ¥
- [ ] Vueå¼€å‘æœåŠ¡å™¨å·²é‡å¯å¹¶è¿è¡Œåœ¨ http://localhost:8001
- [ ] Coze AIåç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:8094
- [ ] æµè§ˆå™¨å¼€å‘è€…å·¥å…·å·²æ‰“å¼€ï¼ˆF12ï¼‰

### 2. åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•1ï¼šæµå¼å¯¹è¯
1. [ ] è®¿é—® AIåŠ©æ‰‹é¡µé¢
2. [ ] åœ¨è¾“å…¥æ¡†è¾“å…¥æµ‹è¯•é—®é¢˜ï¼ˆå¦‚"ä½ å¥½"ï¼‰
3. [ ] ç‚¹å‡»å‘é€æŒ‰é’®
4. [ ] **é¢„æœŸç»“æœ**ï¼š
   - âœ… æ¶ˆæ¯æˆåŠŸå‘é€
   - âœ… AIå¼€å§‹æµå¼å›å¤ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
   - âœ… Networkæ ‡ç­¾æ˜¾ç¤º `200 OK`ï¼Œç±»å‹ä¸º `text/event-stream`
   - âœ… Consoleæ˜¾ç¤ºä»£ç†è½¬å‘æ—¥å¿—ï¼š
     ```
     ğŸš€ [Vue Proxy - Coze] è½¬å‘æµå¼è¯·æ±‚: /zhiyan/api/coze/chat/stream?query=...
     ğŸ“¥ [Vue Proxy - Coze] æ”¶åˆ°æµå¼å“åº”ï¼Œé…ç½®æ— ç¼“å†²æ¨¡å¼
     ğŸ“¦ [Vue Proxy - Coze] è½¬å‘æ•°æ®å— #1: xxx bytes
     ```
   - âŒ **ä¸åº”è¯¥çœ‹åˆ°**ï¼š`Failed to fetch` é”™è¯¯

#### æµ‹è¯•2ï¼šæ–‡ä»¶ä¸Šä¼ 
1. [ ] ç‚¹å‡»è¾“å…¥æ¡†å·¦ä¾§çš„æ–‡ä»¶å›¾æ ‡
2. [ ] é€‰æ‹©"ä»æœ¬åœ°ä¸Šä¼ æ–‡æ¡£"
3. [ ] é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶
4. [ ] **é¢„æœŸç»“æœ**ï¼š
   - âœ… æ–‡ä»¶é¢„è§ˆå¡ç‰‡å‡ºç°åœ¨è¾“å…¥æ¡†ä¸Šæ–¹
   - âœ… Consoleæ˜¾ç¤ºï¼š`é€‰æ‹©äº†æœ¬åœ°æ–‡ä»¶: [...]` å’Œ `âœ… å·²é€‰æ‹© N ä¸ªæ–‡ä»¶`
   - âŒ **ä¸åº”è¯¥çœ‹åˆ°**ï¼š`Cannot read properties of undefined` é”™è¯¯

#### æµ‹è¯•3ï¼šå¸¦æ–‡ä»¶çš„å¯¹è¯
1. [ ] ä¸Šä¼ æ–‡ä»¶åï¼Œè¾“å…¥é—®é¢˜
2. [ ] ç‚¹å‡»å‘é€
3. [ ] **é¢„æœŸç»“æœ**ï¼š
   - âœ… ç”¨æˆ·æ¶ˆæ¯æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
   - âœ… AIèƒ½å¤Ÿè¯»å–æ–‡ä»¶å†…å®¹å¹¶å›å¤
   - âœ… æµå¼å“åº”æ­£å¸¸å·¥ä½œ

---

## æµè§ˆå™¨æ§åˆ¶å°é¢„æœŸè¾“å‡º

### æˆåŠŸçš„æµå¼è¯·æ±‚æ—¥å¿—ï¼š
```
[cozeAPI.chatStream] å¼€å§‹æµå¼å¯¹è¯, query: ä½ å¥½, conversationId: null
[cozeAPI.chatStream] è¯·æ±‚URL: /zhiyan/api/coze/chat/stream?query=ä½ å¥½
[cozeAPI.chatStream] Tokenå­˜åœ¨: true
[cozeAPI.chatStream] å“åº”çŠ¶æ€: 200 OK
[cozeAPI.chatStream] å“åº”Content-Type: text/event-stream
[åˆå§‹åŒ–âœ…] æµå¼çŠ¶æ€å·²é‡ç½®
[ç¼“å†²åŒºğŸ“¦] è¿½åŠ å†…å®¹: ä½ 
[æ‰“å­—æœºâœ…] DOMå·²æ¸²æŸ“ï¼Œå¯åŠ¨å®šæ—¶å™¨
[DOMæ›´æ–°âœ…] è¿›åº¦: 1 / 10
...
[æµå¼å®ŒæˆğŸ¬] åç«¯æµå¼å“åº”å·²ç»“æŸ
[å®Œæˆæ¸…ç†âœ…] å†…å®¹å·²ä¿å­˜ï¼Œé•¿åº¦: 100
```

### æˆåŠŸçš„æ–‡ä»¶ä¸Šä¼ æ—¥å¿—ï¼š
```
é€‰æ‹©äº†æœ¬åœ°æ–‡ä»¶: [File]
âœ… å·²é€‰æ‹© 1 ä¸ªæ–‡ä»¶
```

---

## æ•…éšœæ’æŸ¥

### å¦‚æœä»ç„¶å‡ºç° "Failed to fetch"

1. **æ£€æŸ¥VueæœåŠ¡å™¨æ˜¯å¦é‡å¯**
   ```powershell
   # æŸ¥çœ‹è¿›ç¨‹
   Get-Process | Where-Object {$_.ProcessName -like "*node*"}
   ```

2. **æ£€æŸ¥Cozeåç«¯æœåŠ¡**
   ```powershell
   netstat -ano | findstr :8094
   ```
   åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
   ```
   TCP    0.0.0.0:8094    0.0.0.0:0    LISTENING    12345
   ```

3. **æ£€æŸ¥ä»£ç†é…ç½®**
   æ‰“å¼€ `vue.config.js`ï¼Œç¡®è®¤ `/zhiyan/api/coze` é…ç½®ä¸­åŒ…å«ï¼š
   ```javascript
   buffer: false,
   timeout: 0,
   onProxyRes: function (proxyRes, req, res) { ... }
   ```

4. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - Chrome: Ctrl+Shift+Delete
   - æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•

### å¦‚æœä»ç„¶å‡ºç° "$message undefined"

1. **æ£€æŸ¥ä»£ç ä¿®å¤**
   æ‰“å¼€ `KnowledgeBaseAI.vue`ï¼Œæœç´¢ `this.$message`ï¼Œç¡®è®¤æ‰€æœ‰è°ƒç”¨éƒ½æœ‰æ£€æŸ¥ï¼š
   ```javascript
   if (this.$message) {
     this.$message.success(...)
   }
   ```

2. **ï¼ˆå¯é€‰ï¼‰å®‰è£…UIåº“**
   å¦‚æœå¸Œæœ›æ˜¾ç¤ºUIæç¤ºï¼Œå¯ä»¥å®‰è£…Element UIï¼š
   ```bash
   npm install element-ui
   ```
   
   ç„¶ååœ¨ `main.js` ä¸­æ³¨å†Œï¼š
   ```javascript
   import ElementUI from 'element-ui'
   import 'element-ui/lib/theme-chalk/index.css'
   Vue.use(ElementUI)
   ```

---

## ç›¸å…³æ–‡ä»¶

### å·²ä¿®æ”¹
- âœ… `zhiyan_front/vue.config.js` - æ·»åŠ Coze SSEä»£ç†é…ç½®
- âœ… `zhiyan_front/src/views/KnowledgeBaseAI.vue` - ä¿®å¤ $message è°ƒç”¨

### å‚è€ƒæ–‡æ¡£
- ğŸ“„ `zhiyan_front/Cozeæµå¼è¯·æ±‚ä¿®å¤è¯´æ˜.md` - è¯¦ç»†çš„SSEé…ç½®è¯´æ˜
- ğŸ“„ `zhiyan_front/AIåŠ©æ‰‹é—®é¢˜ä¿®å¤æ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## æŠ€æœ¯è¦ç‚¹

### SSE (Server-Sent Events)
- HTTPé•¿è¿æ¥æŠ€æœ¯
- Content-Type: `text/event-stream`
- éœ€è¦chunkedä¼ è¾“ç¼–ç 
- ä¸èƒ½æœ‰Content-Length
- å¿…é¡»ç¦ç”¨ç¼“å†²

### Vue DevServerä»£ç†é™·é˜±
- é»˜è®¤å¯ç”¨ç¼“å†²ï¼ˆä¼šé˜»å¡SSEï¼‰
- é»˜è®¤30ç§’è¶…æ—¶ï¼ˆSSEéœ€è¦æ›´é•¿æ—¶é—´ï¼‰
- éœ€è¦ç‰¹æ®Šé…ç½®æ‰èƒ½æ”¯æŒæµå¼å“åº”

### PowerShell vs Bash
| Bash | PowerShell |
|------|------------|
| `&&` | `;` |
| `cmd1 && cmd2` | `cmd1; cmd2` |

---

## ä¸‹ä¸€æ­¥å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒé…ç½®**
   - ä¿®å¤åéœ€è¦æ›´æ–°ç”Ÿäº§ç¯å¢ƒçš„Nginxé…ç½®
   - ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¹Ÿæ”¯æŒSSEï¼ˆç¦ç”¨ç¼“å†²ã€ä»£ç†è¶…æ—¶ç­‰ï¼‰

2. **æ·»åŠ UIåº“ï¼ˆå¯é€‰ï¼‰**
   - è€ƒè™‘å®‰è£…Element UIæä¾›æ›´å¥½çš„ç”¨æˆ·æç¤º
   - æˆ–å®ç°è‡ªå®šä¹‰çš„è½»é‡çº§æ¶ˆæ¯æç¤ºç»„ä»¶

3. **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ SSEè¿æ¥çŠ¶æ€ç›‘æ§
   - è®°å½•æµå¼å“åº”çš„æ€§èƒ½æŒ‡æ ‡

4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ æ–‡ä»¶ä¸Šä¼ è¿›åº¦æç¤º
   - æ˜¾ç¤ºAIæ€è€ƒä¸­çš„åŠ è½½åŠ¨ç”»
   - ä¼˜åŒ–æ‰“å­—æœºæ•ˆæœçš„é€Ÿåº¦

---

**ä¿®å¤çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**éœ€è¦é‡å¯**ï¼šâœ… æ˜¯ï¼ˆVueå¼€å‘æœåŠ¡å™¨ï¼‰  
**å½±å“èŒƒå›´**ï¼šAIåŠ©æ‰‹æ¨¡å—ï¼ˆKnowledgeBaseAIé¡µé¢ï¼‰

