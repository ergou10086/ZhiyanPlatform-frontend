# é¡¹ç›®æˆå‘˜ç®¡ç†åŠŸèƒ½ - ä¿®æ”¹æ€»ç»“

## ğŸ“… æ›´æ–°æ—¶é—´
2025-10-23

## ğŸ¯ æ›´æ–°ç›®æ ‡
å°†å‰ç«¯çš„"æ·»åŠ æˆå‘˜"å’Œ"é‚€è¯·æˆå‘˜"åŠŸèƒ½ä»æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorageï¼‰å¯¹æ¥åˆ°åç«¯çœŸå®APIã€‚

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### âœ… å‰ç«¯ä¿®æ”¹

#### 1. `zhiyan_front/src/api/project.js`
**ä¿®æ”¹å†…å®¹**: æ·»åŠ é¡¹ç›®æˆå‘˜ç®¡ç†ç›¸å…³çš„APIæ–¹æ³•

**æ–°å¢æ–¹æ³•**:
- `inviteMember(projectId, memberData)` - é‚€è¯·æˆå‘˜åŠ å…¥é¡¹ç›®
- `assignRole(projectId, roleData)` - åˆ†é…è§’è‰²ï¼ˆæ·»åŠ æˆå‘˜å¹¶æŒ‡å®šè§’è‰²ï¼‰
- `getProjectMembers(projectId, page, size)` - è·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨
- `removeMember(projectId, userId)` - ç§»é™¤é¡¹ç›®æˆå‘˜
- `updateMemberRole(projectId, userId, roleData)` - æ›´æ–°æˆå‘˜è§’è‰²

**API è·¯å¾„**:
```javascript
POST   /api/projects/{projectId}/invite          // é‚€è¯·æˆå‘˜
POST   /api/projects/{projectId}/assign          // åˆ†é…è§’è‰²
GET    /api/projects/{projectId}/members         // è·å–æˆå‘˜åˆ—è¡¨
DELETE /api/projects/{projectId}/members/{userId} // ç§»é™¤æˆå‘˜
PUT    /api/projects/{projectId}/members/{userId}/role // æ›´æ–°è§’è‰²
```

---

#### 2. `zhiyan_front/src/views/ProjectDetail.vue`
**ä¿®æ”¹å†…å®¹**: é‡æ„æˆå‘˜ç®¡ç†ç›¸å…³æ–¹æ³•ï¼Œä»localStorageæ“ä½œæ”¹ä¸ºAPIè°ƒç”¨

**ä¿®æ”¹æ–¹æ³•**:

##### `addTeamMember()` - æ·»åŠ æˆå‘˜
- **ä¿®æ”¹å‰**: ä½¿ç”¨ `prompt` è·å–å§“åï¼Œä¿å­˜åˆ° `localStorage`
- **ä¿®æ”¹å**: 
  - ä½¿ç”¨ `prompt` è·å–ç”¨æˆ·ID
  - ä½¿ç”¨ `confirm` é€‰æ‹©è§’è‰²ï¼ˆOWNER/MEMBERï¼‰
  - è°ƒç”¨ `projectAPI.assignRole()` å‘é€åˆ°åç«¯
  - æˆåŠŸåè°ƒç”¨ `loadProjectMembers()` åˆ·æ–°åˆ—è¡¨

##### `inviteMember()` - é‚€è¯·æˆå‘˜
- **ä¿®æ”¹å‰**: ä½¿ç”¨ `prompt` è·å–è§’è‰²ï¼Œåˆ›å»ºé‚€è¯·å ä½ç¬¦
- **ä¿®æ”¹å**:
  - ä½¿ç”¨ `prompt` è·å–ç”¨æˆ·ID
  - ä½¿ç”¨ `confirm` é€‰æ‹©è§’è‰²ï¼ˆOWNER/MEMBERï¼‰
  - è°ƒç”¨ `projectAPI.inviteMember()` å‘é€åˆ°åç«¯
  - æˆåŠŸåè°ƒç”¨ `loadProjectMembers()` åˆ·æ–°åˆ—è¡¨

##### `removeTeamMember(memberId)` - ç§»é™¤æˆå‘˜
- **ä¿®æ”¹å‰**: ä»æ•°ç»„ä¸­è¿‡æ»¤åˆ é™¤ï¼Œä¿å­˜åˆ° `localStorage`
- **ä¿®æ”¹å**:
  - è°ƒç”¨ `projectAPI.removeMember()` å‘é€åˆ°åç«¯
  - æˆåŠŸåè°ƒç”¨ `loadProjectMembers()` åˆ·æ–°åˆ—è¡¨

##### `loadProjectMembers()` - åŠ è½½æˆå‘˜åˆ—è¡¨ï¼ˆæ–°å¢ï¼‰
- **åŠŸèƒ½**: ä»åç«¯APIè·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨
- **è°ƒç”¨æ—¶æœº**: 
  - é¡¹ç›®è¯¦æƒ…é¡µåŠ è½½å®Œæˆæ—¶
  - æ·»åŠ /åˆ é™¤æˆå‘˜æˆåŠŸå
- **æ•°æ®è½¬æ¢**:
  ```javascript
  {
    id: member.userId,
    name: member.userName || member.userNickname || `ç”¨æˆ·${member.userId}`,
    role: member.roleCode === 'OWNER' ? 'é¡¹ç›®æ‹¥æœ‰è€…' : 'æ™®é€šæˆå‘˜',
    avatar: member.userAvatarUrl || null,
    joinedAt: member.joinedAt
  }
  ```

**åœ¨ `loadProject()` æ–¹æ³•ä¸­æ–°å¢**:
```javascript
// å¦‚æœé¡¹ç›®åŠ è½½æˆåŠŸï¼Œä»åç«¯åŠ è½½æˆå‘˜åˆ—è¡¨
if (this.project && this.project.id) {
  this.loadProjectMembers()
}
```

---

### âœ… åç«¯ä¿®æ”¹

#### 3. `ProjectMemberController.java`
**ä¿®æ”¹å†…å®¹**: ä¿®æ­£ `@RequestMapping` è·¯å¾„ï¼Œé¿å…è·¯å¾„é‡å¤

**ä¿®æ”¹å‰**:
```java
@RequestMapping("/api/projects/members")
public class ProjectMemberController {
    @PostMapping("/projects/{projectId}/invite")  // âŒ ç»“æœ: /api/projects/members/projects/{id}/invite
}
```

**ä¿®æ”¹å**:
```java
@RequestMapping("/api")
public class ProjectMemberController {
    @PostMapping("/projects/{projectId}/invite")  // âœ… ç»“æœ: /api/projects/{id}/invite
}
```

---

#### 4. `ProjectRoleController.java`
**ä¿®æ”¹å†…å®¹**: ä¿®æ­£ `@RequestMapping` è·¯å¾„ï¼Œä¿æŒä¸€è‡´æ€§

**ä¿®æ”¹å‰**:
```java
@RequestMapping("/api/projects/roles")
public class ProjectRoleController {
    @PostMapping("/projects/{projectId}/assign")  // âŒ ç»“æœ: /api/projects/roles/projects/{id}/assign
}
```

**ä¿®æ”¹å**:
```java
@RequestMapping("/api")
public class ProjectRoleController {
    @PostMapping("/projects/{projectId}/assign")  // âœ… ç»“æœ: /api/projects/{id}/assign
}
```

---

## ğŸ”„ æ•°æ®æµç¨‹

### æ·»åŠ æˆå‘˜æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"æ·»åŠ æˆå‘˜" 
  â†’ è¾“å…¥ç”¨æˆ·ID 
  â†’ é€‰æ‹©è§’è‰²(OWNER/MEMBER)
  â†’ å‰ç«¯è°ƒç”¨ projectAPI.assignRole()
  â†’ è¯·æ±‚å‘é€åˆ° POST /api/projects/{id}/assign
  â†’ åç«¯ ProjectRoleController.assignRoleToUser()
  â†’ ProjectMemberService.addMemberWithValidation()
  â†’ éªŒè¯ç”¨æˆ·å­˜åœ¨ï¼ˆè°ƒç”¨ AuthServiceClientï¼‰
  â†’ ä¿å­˜åˆ° project_members è¡¨
  â†’ è¿”å›æˆåŠŸå“åº”
  â†’ å‰ç«¯åˆ·æ–°æˆå‘˜åˆ—è¡¨
  â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
```

### é‚€è¯·æˆå‘˜æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"é‚€è¯·æˆå‘˜"
  â†’ è¾“å…¥ç”¨æˆ·ID
  â†’ é€‰æ‹©è§’è‰²(OWNER/MEMBER)
  â†’ å‰ç«¯è°ƒç”¨ projectAPI.inviteMember()
  â†’ è¯·æ±‚å‘é€åˆ° POST /api/projects/{id}/invite
  â†’ åç«¯ ProjectMemberController.inviteMember()
  â†’ ProjectMemberService.inviteMember()
  â†’ ä¿å­˜åˆ° project_members è¡¨
  â†’ è¿”å›æˆåŠŸå“åº”
  â†’ å‰ç«¯åˆ·æ–°æˆå‘˜åˆ—è¡¨
  â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
```

### åŠ è½½æˆå‘˜åˆ—è¡¨æµç¨‹
```
é¡¹ç›®è¯¦æƒ…é¡µåŠ è½½å®Œæˆ
  â†’ è‡ªåŠ¨è°ƒç”¨ loadProjectMembers()
  â†’ è¯·æ±‚ GET /api/projects/{id}/members
  â†’ åç«¯ ProjectMemberController.getProjectMembers()
  â†’ ä» project_members è¡¨æŸ¥è¯¢
  â†’ è¿”å›æˆå‘˜åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
  â†’ å‰ç«¯è½¬æ¢æ•°æ®æ ¼å¼
  â†’ æ¸²æŸ“æˆå‘˜å¡ç‰‡
```

### ç§»é™¤æˆå‘˜æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»æˆå‘˜å¡ç‰‡å³ä¸Šè§’"Ã—"
  â†’ ç¡®è®¤ç§»é™¤
  â†’ å‰ç«¯è°ƒç”¨ projectAPI.removeMember()
  â†’ è¯·æ±‚ DELETE /api/projects/{id}/members/{userId}
  â†’ åç«¯ ProjectMemberController.removeMember()
  â†’ ProjectMemberService.removeMember()
  â†’ ä» project_members è¡¨åˆ é™¤
  â†’ è¿”å›æˆåŠŸå“åº”
  â†’ å‰ç«¯åˆ·æ–°æˆå‘˜åˆ—è¡¨
  â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
```

---

## ğŸ¨ UI äº¤äº’å˜åŒ–

### ä¿®æ”¹å‰
- âœ— ä½¿ç”¨ç®€å•çš„ `prompt` è¾“å…¥æ¡†
- âœ— æ•°æ®åªä¿å­˜åœ¨ `localStorage`
- âœ— åˆ·æ–°é¡µé¢åå¯èƒ½ä¸¢å¤±æ•°æ®
- âœ— æ²¡æœ‰çœŸå®çš„ç”¨æˆ·éªŒè¯

### ä¿®æ”¹å
- âœ“ ä½¿ç”¨ `prompt` + `confirm` ç»„åˆè¾“å…¥
- âœ“ æ•°æ®ä¿å­˜åˆ°åç«¯æ•°æ®åº“
- âœ“ æ•°æ®æŒä¹…åŒ–ï¼Œä¸ä¼šä¸¢å¤±
- âœ“ åç«¯éªŒè¯ç”¨æˆ·å­˜åœ¨æ€§
- âœ“ è‡ªåŠ¨åˆ·æ–°æˆå‘˜åˆ—è¡¨
- âœ“ å®æ—¶åŒæ­¥åˆ°å…¶ä»–ç”¨æˆ·

---

## ğŸ“Š API å¯¹ç…§è¡¨

| åŠŸèƒ½ | å‰ç«¯æ–¹æ³• | è¯·æ±‚ç±»å‹ | APIè·¯å¾„ | åç«¯æ§åˆ¶å™¨æ–¹æ³• |
|------|---------|---------|---------|--------------|
| é‚€è¯·æˆå‘˜ | `inviteMember()` | POST | `/api/projects/{id}/invite` | `ProjectMemberController.inviteMember()` |
| åˆ†é…è§’è‰² | `assignRole()` | POST | `/api/projects/{id}/assign` | `ProjectRoleController.assignRoleToUser()` |
| è·å–æˆå‘˜åˆ—è¡¨ | `getProjectMembers()` | GET | `/api/projects/{id}/members` | `ProjectMemberController.getProjectMembers()` |
| ç§»é™¤æˆå‘˜ | `removeMember()` | DELETE | `/api/projects/{id}/members/{userId}` | `ProjectMemberController.removeMember()` |

---

## âš ï¸ é‡è¦è¯´æ˜

### 1. ä¸¤ä¸ªæ·»åŠ æˆå‘˜æ¥å£çš„åŒºåˆ«

#### `inviteMember` (é‚€è¯·æˆå‘˜)
- **è·¯å¾„**: `/api/projects/{id}/invite`
- **å‚æ•°**: `{ userId, role }`
- **ç‰¹ç‚¹**: é¡¹ç›®è´Ÿè´£äººç›´æ¥æ·»åŠ ï¼Œæ— éœ€å¯¹æ–¹åŒæ„
- **ç”¨é€”**: å¿«é€Ÿæ·»åŠ æˆå‘˜

#### `assignRole` (åˆ†é…è§’è‰²)
- **è·¯å¾„**: `/api/projects/{id}/assign`
- **å‚æ•°**: `{ userId, roleCode }`
- **ç‰¹ç‚¹**: éœ€è¦æˆå‘˜ç®¡ç†æƒé™ï¼Œä¼šéªŒè¯ç”¨æˆ·å­˜åœ¨
- **ç”¨é€”**: æ­£å¼çš„è§’è‰²åˆ†é…

### 2. ç”¨æˆ·éªŒè¯
- `assignRole` ä¼šè°ƒç”¨ `AuthServiceClient` éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
- `inviteMember` ç›´æ¥æ·»åŠ ï¼Œé€‚åˆå†…éƒ¨ç³»ç»Ÿè°ƒç”¨

### 3. æƒé™è¦æ±‚
- æ·»åŠ æˆå‘˜: éœ€è¦æ˜¯é¡¹ç›® OWNER
- ç§»é™¤æˆå‘˜: éœ€è¦æ˜¯é¡¹ç›® OWNER
- æŸ¥çœ‹æˆå‘˜: æ‰€æœ‰é¡¹ç›®æˆå‘˜

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. UI ä½“éªŒå¾…ä¼˜åŒ–
- å½“å‰ä½¿ç”¨ `prompt` å’Œ `alert`ï¼Œç”¨æˆ·ä½“éªŒä¸€èˆ¬
- å»ºè®®åç»­æ”¹ä¸ºæ¨¡æ€æ¡†ï¼ˆModalï¼‰+ è¡¨å•

### 2. ç”¨æˆ·æœç´¢åŠŸèƒ½ç¼ºå¤±
- å½“å‰éœ€è¦æ‰‹åŠ¨è¾“å…¥ç”¨æˆ·ID
- å»ºè®®æ·»åŠ ç”¨æˆ·æœç´¢ä¸‹æ‹‰æ¡†

### 3. æ‰¹é‡æ“ä½œä¸æ”¯æŒ
- åªèƒ½ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªæˆå‘˜
- å»ºè®®åç»­æ”¯æŒæ‰¹é‡æ·»åŠ 

---

## âœ… æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯•æ·»åŠ æˆå‘˜åŠŸèƒ½
   - æµ‹è¯•é‚€è¯·æˆå‘˜åŠŸèƒ½
   - æµ‹è¯•ç§»é™¤æˆå‘˜åŠŸèƒ½
   - æµ‹è¯•æˆå‘˜åˆ—è¡¨åŠ è½½

2. **æƒé™æµ‹è¯•**
   - æµ‹è¯•éOWNERç”¨æˆ·ä¸èƒ½æ·»åŠ æˆå‘˜
   - æµ‹è¯•éOWNERç”¨æˆ·ä¸èƒ½ç§»é™¤æˆå‘˜
   - æµ‹è¯•æ‰€æœ‰æˆå‘˜éƒ½èƒ½æŸ¥çœ‹æˆå‘˜åˆ—è¡¨

3. **å¼‚å¸¸æµ‹è¯•**
   - æµ‹è¯•è¾“å…¥ä¸å­˜åœ¨çš„ç”¨æˆ·ID
   - æµ‹è¯•æ·»åŠ å·²å­˜åœ¨çš„æˆå‘˜
   - æµ‹è¯•ç§»é™¤é¡¹ç›®åˆ›å»ºè€…
   - æµ‹è¯•åç«¯æœåŠ¡æ–­å¼€æƒ…å†µ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `é‚€è¯·æˆå‘˜åŠŸèƒ½-æµ‹è¯•æŒ‡å—.md` - è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤å’Œé—®é¢˜æ’æŸ¥
- `zhiyan_front/src/api/project.js` - å‰ç«¯APIå°è£…
- `ProjectMemberController.java` - åç«¯æˆå‘˜ç®¡ç†æ§åˆ¶å™¨
- `ProjectRoleController.java` - åç«¯è§’è‰²ç®¡ç†æ§åˆ¶å™¨

---

**ä¿®æ”¹å®Œæˆï¼** âœ¨

ç°åœ¨å¯ä»¥é€šè¿‡å‰ç«¯UIç›´æ¥ç®¡ç†é¡¹ç›®æˆå‘˜ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šåŒæ­¥åˆ°æ•°æ®åº“ã€‚

