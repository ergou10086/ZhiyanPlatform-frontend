{"version":3,"file":"js/82.90628a8d.js","mappings":"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","sources":["webpack://zhiyan-front/./src/api/task.js"],"sourcesContent":["import axios from 'axios'\r\nimport config from '@/config'\r\n\r\n// 创建axios实例 - 使用Vue代理，不指定baseURL\r\nconst api = axios.create({\r\n  baseURL: '', // 使用相对路径，通过Vue代理转发\r\n  timeout: config.api.timeout,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n    'Accept': 'application/json'\r\n  },\r\n  withCredentials: true\r\n})\r\n\r\n// 请求拦截器\r\napi.interceptors.request.use(\r\n  config => {\r\n    // 从localStorage获取token\r\n    const token = localStorage.getItem('access_token')\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`\r\n    }\r\n    \r\n    console.log('任务API请求:', config.method?.toUpperCase(), config.url)\r\n    console.log('请求数据:', config.data)\r\n    \r\n    return config\r\n  },\r\n  error => {\r\n    console.error('请求拦截器错误:', error)\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// 响应拦截器\r\napi.interceptors.response.use(\r\n  response => {\r\n    console.log('任务API响应:', response.status, response.data)\r\n    // 后端返回的response.data就是R对象，包含code、msg、data字段\r\n    // 直接返回response.data，这样前端就能访问到R对象的完整结构\r\n    return response.data\r\n  },\r\n  error => {\r\n    console.error('任务API错误:', error)\r\n    \r\n    if (error.response) {\r\n      const { status, data } = error.response\r\n      console.error('服务器错误:', status, data)\r\n      \r\n      if (status === 401) {\r\n        // token过期，跳转到登录页\r\n        localStorage.removeItem('access_token')\r\n        localStorage.removeItem('refresh_token')\r\n        localStorage.removeItem('user_info')\r\n        window.location.href = '/login'\r\n      }\r\n      \r\n      return Promise.reject(data || error)\r\n    } else if (error.request) {\r\n      console.error('网络错误:', error.request)\r\n      return Promise.reject(new Error('网络连接失败，请检查后端服务'))\r\n    } else {\r\n      console.error('其他错误:', error.message)\r\n      return Promise.reject(error)\r\n    }\r\n  }\r\n)\r\n\r\n// 任务相关API\r\nexport const taskAPI = {\r\n  /**\r\n   * 创建任务\r\n   * @param {Object} taskData - 任务数据\r\n   * @param {Number} taskData.projectId - 项目ID (必需)\r\n   * @param {String} taskData.title - 任务标题 (必需)\r\n   * @param {String} taskData.description - 任务描述\r\n   * @param {Array} taskData.assigneeIds - 执行者ID列表\r\n   * @param {String} taskData.priority - 优先级 (HIGH/MEDIUM/LOW)\r\n   * @param {String} taskData.dueDate - 截止日期 (YYYY-MM-DD)\r\n   * @param {Number} taskData.worktime - 预估工时\r\n   */\r\n  createTask(taskData) {\r\n    console.log('[taskAPI.createTask] 创建任务, 数据:', taskData)\r\n    return api.post('/zhiyan/api/projects/tasks', taskData)\r\n  },\r\n\r\n  /**\r\n   * 批量创建任务\r\n   * @param {Number} projectId - 项目ID\r\n   * @param {Array} tasks - 任务列表\r\n   */\r\n  async createTasksBatch(projectId, tasks) {\r\n    console.log('[taskAPI.createTasksBatch] 批量创建任务, 项目ID:', projectId, '任务数量:', tasks.length)\r\n    \r\n    const results = []\r\n    const errors = []\r\n    \r\n    for (let i = 0; i < tasks.length; i++) {\r\n      const task = tasks[i]\r\n      try {\r\n        const result = await this.createTask({\r\n          projectId: projectId,\r\n          title: task.title,\r\n          description: task.description,\r\n          assigneeIds: task.assignee_id || [],\r\n          priority: task.priority_value || 'MEDIUM',\r\n          dueDate: task.dueDate || task.due_date || null,\r\n          worktime: task.worktime || null\r\n        })\r\n        \r\n        console.log(`任务 ${i + 1}/${tasks.length} 创建成功:`, result)\r\n        results.push(result)\r\n      } catch (error) {\r\n        console.error(`任务 ${i + 1}/${tasks.length} 创建失败:`, error)\r\n        errors.push({\r\n          task: task,\r\n          error: error\r\n        })\r\n      }\r\n    }\r\n    \r\n    return {\r\n      success: results.length,\r\n      failed: errors.length,\r\n      total: tasks.length,\r\n      results: results,\r\n      errors: errors\r\n    }\r\n  },\r\n\r\n  /**\r\n   * 更新任务\r\n   * @param {Number} taskId - 任务ID\r\n   * @param {Object} taskData - 任务数据\r\n   */\r\n  updateTask(taskId, taskData) {\r\n    console.log('[taskAPI.updateTask] 更新任务, ID:', taskId, '数据:', taskData)\r\n    return api.put(`/zhiyan/api/projects/tasks/${taskId}`, taskData)\r\n  },\r\n\r\n  /**\r\n   * 删除任务\r\n   * @param {Number} taskId - 任务ID\r\n   */\r\n  deleteTask(taskId) {\r\n    console.log('[taskAPI.deleteTask] 删除任务, ID:', taskId)\r\n    return api.delete(`/zhiyan/api/projects/tasks/${taskId}`)\r\n  },\r\n\r\n  /**\r\n   * 获取任务详情\r\n   * @param {Number} taskId - 任务ID\r\n   */\r\n  getTaskDetail(taskId) {\r\n    console.log('[taskAPI.getTaskDetail] 获取任务详情, ID:', taskId)\r\n    return api.get(`/zhiyan/api/projects/tasks/${taskId}`)\r\n  },\r\n\r\n  /**\r\n   * 获取项目任务看板\r\n   * @param {Number} projectId - 项目ID\r\n   */\r\n  getTaskBoard(projectId) {\r\n    console.log('[taskAPI.getTaskBoard] 获取任务看板, 项目ID:', projectId)\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}/board`)\r\n  },\r\n\r\n  /**\r\n   * 获取项目任务列表\r\n   * @param {Number} projectId - 项目ID\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  getProjectTasks(projectId, page = 0, size = 20) {\r\n    console.log('[taskAPI.getProjectTasks] 获取项目任务列表, 项目ID:', projectId)\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}`, {\r\n      params: { page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 更新任务状态\r\n   * @param {Number} taskId - 任务ID\r\n   * @param {String} status - 任务状态\r\n   */\r\n  updateTaskStatus(taskId, status) {\r\n    console.log('[taskAPI.updateTaskStatus] 更新任务状态, ID:', taskId, '状态:', status)\r\n    return api.patch(`/zhiyan/api/projects/tasks/${taskId}/status`, { status })\r\n  },\r\n\r\n  /**\r\n   * 分配任务\r\n   * @param {Number} taskId - 任务ID\r\n   * @param {Array} assigneeIds - 执行者ID列表\r\n   */\r\n  assignTask(taskId, assigneeIds) {\r\n    console.log('[taskAPI.assignTask] 分配任务, ID:', taskId, '执行者:', assigneeIds)\r\n    return api.put(`/zhiyan/api/projects/tasks/${taskId}/assign`, assigneeIds)\r\n  },\r\n\r\n  /**\r\n   * 接取任务\r\n   * @param {Number} taskId - 任务ID\r\n   */\r\n  claimTask(taskId) {\r\n    console.log('[taskAPI.claimTask] 接取任务, ID:', taskId)\r\n    return api.post(`/zhiyan/api/projects/tasks/${taskId}/claim`)\r\n  },\r\n\r\n  /**\r\n   * 获取我的任务\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  getMyAssignedTasks(page = 0, size = 20) {\r\n    console.log('[taskAPI.getMyAssignedTasks] 获取我的任务')\r\n    return api.get('/zhiyan/api/projects/tasks/my-assigned', {\r\n      params: { page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 获取我创建的任务\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  getMyCreatedTasks(page = 0, size = 20) {\r\n    console.log('[taskAPI.getMyCreatedTasks] 获取我创建的任务')\r\n    return api.get('/zhiyan/api/projects/tasks/my-created', {\r\n      params: { page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 搜索任务\r\n   * @param {Number} projectId - 项目ID\r\n   * @param {String} keyword - 搜索关键词\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  searchTasks(projectId, keyword, page = 0, size = 20) {\r\n    console.log('[taskAPI.searchTasks] 搜索任务, 关键词:', keyword)\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}/search`, {\r\n      params: { keyword, page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 获取即将到期的任务\r\n   * @param {Number} projectId - 项目ID\r\n   * @param {Number} days - 未来天数\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  getUpcomingTasks(projectId, days = 7, page = 0, size = 20) {\r\n    console.log('[taskAPI.getUpcomingTasks] 获取即将到期的任务')\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}/upcoming`, {\r\n      params: { days, page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 获取已逾期的任务\r\n   * @param {Number} projectId - 项目ID\r\n   * @param {Number} page - 页码\r\n   * @param {Number} size - 每页数量\r\n   */\r\n  getOverdueTasks(projectId, page = 0, size = 20) {\r\n    console.log('[taskAPI.getOverdueTasks] 获取已逾期的任务')\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}/overdue`, {\r\n      params: { page, size }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * 统计项目任务数量\r\n   * @param {Number} projectId - 项目ID\r\n   */\r\n  countProjectTasks(projectId) {\r\n    console.log('[taskAPI.countProjectTasks] 统计项目任务')\r\n    return api.get(`/zhiyan/api/projects/tasks/projects/${projectId}/count`)\r\n  }\r\n}\r\n\r\nexport default api\r\n\r\n"],"names":["api","baseURL","timeout","headers","withCredentials","interceptors","request","use","config","token","localStorage","getItem","Authorization","console","log","method","toUpperCase","url","data","error","Promise","reject","response","status","removeItem","window","location","href","Error","message","taskAPI","createTask","taskData","post","createTasksBatch","projectId","tasks","length","results","errors","i","task","result","this","title","description","assigneeIds","assignee_id","priority","priority_value","dueDate","due_date","worktime","push","success","failed","total","updateTask","taskId","put","deleteTask","delete","getTaskDetail","get","getTaskBoard","getProjectTasks","page","size","params","updateTaskStatus","patch","assignTask","claimTask","getMyAssignedTasks","getMyCreatedTasks","searchTasks","keyword","getUpcomingTasks","days","getOverdueTasks","countProjectTasks"],"sourceRoot":""}