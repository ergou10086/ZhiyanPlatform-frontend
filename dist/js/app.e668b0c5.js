(function(){"use strict";var t={303:function(t,e,s){s.d(e,{z_:function(){return i}});const a={api:{baseURL:"https://your-production-api.com",timeout:6e4,endpoints:{auth:"https://your-production-api.com",knowledge:"https://your-production-api.com",project:"https://your-production-api.com"}},minio:{baseURL:"http://10.7.10.98:9000",bucket:"zhiyan"},app:{name:"æ™ºç ”å¹³å°",version:"1.0.0"},storage:{tokenKey:"access_token",refreshTokenKey:"refresh_token",rememberMeKey:"remember_me_token",userInfoKey:"user_info"}},i=(a.api.baseURL,a.minio.baseURL);a.minio.bucket,a.api.endpoints.auth,a.api.endpoints.knowledge,a.api.endpoints.project;e.Ay=a},487:function(t,e,s){t.exports=s.p+"img/logo.8fc8f8e4.jpg"},698:function(t,e,s){s.d(e,{projectAPI:function(){return n}});var a=s(505),i=s.n(a),o=s(303);const r=i().create({baseURL:"",timeout:o.Ay.api.timeout,withCredentials:!0});r.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e?(t.headers.Authorization=`Bearer ${e}`,console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] å·²é™„åŠ  Authorization header")):console.warn("[APIè¯·æ±‚æ‹¦æˆªå™¨]  è­¦å‘Šï¼šaccess_token ä¸ºç©º"),t.data instanceof FormData?(t.headers["Content-Type"]=void 0,console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] FormData æ£€æµ‹åˆ°ï¼Œå·²æ¸…ç©º Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®"),console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] å½“å‰è¯·æ±‚å¤´:",t.headers)):t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] é¡¹ç›®APIè¯·æ±‚:",t.method?.toUpperCase(),t.url),console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] è¯·æ±‚æ•°æ®ç±»å‹:",t.data instanceof FormData?"FormData":typeof t.data),console.log("[APIè¯·æ±‚æ‹¦æˆªå™¨] æœ€ç»ˆè¯·æ±‚å¤´:",t.headers),t},t=>(console.error("[APIè¯·æ±‚æ‹¦æˆªå™¨] é”™è¯¯:",t),Promise.reject(t))),r.interceptors.response.use(t=>(console.log("é¡¹ç›®APIå“åº”:",t.status,t.data),t.data),t=>{if(console.error("é¡¹ç›®APIé”™è¯¯:",t),t.response){const{status:e,data:s}=t.response;return console.error("æœåŠ¡å™¨é”™è¯¯:",e,s),401===e&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),403===e&&(console.error("[APIå“åº”æ‹¦æˆªå™¨] âŒ 403 Forbidden - è®¤è¯å¤±è´¥"),console.error("[APIå“åº”æ‹¦æˆªå™¨] æ¸…é™¤æ‰€æœ‰è®¤è¯ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),Promise.reject(s||t)}return t.request?(console.error("ç½‘ç»œé”™è¯¯:",t.request),Promise.reject(new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"))):(console.error("å…¶ä»–é”™è¯¯:",t.message),Promise.reject(t))});const n={createProject(t){return console.log("[projectAPI.createProject] åˆ›å»ºé¡¹ç›®, æ•°æ®:",t),r.post("/zhiyan/api/projects",t)},updateProject(t,e){return console.log("[projectAPI.updateProject] æ›´æ–°é¡¹ç›®, ID:",t,"æ•°æ®:",e),r.put(`/zhiyan/api/projects/${t}`,e)},deleteProject(t){return console.log("[projectAPI.deleteProject] åˆ é™¤é¡¹ç›®, ID:",t),r.delete(`/zhiyan/api/projects/${t}`)},getProjectById(t){return console.log("[projectAPI.getProjectById] è·å–é¡¹ç›®è¯¦æƒ…, ID:",t),r.get(`/zhiyan/api/projects/${t}`)},getMyCreatedProjects(t=0,e=10){return console.log("[projectAPI.getMyCreatedProjects] è·å–æˆ‘åˆ›å»ºçš„é¡¹ç›®"),r.get("/zhiyan/api/projects/my-created",{params:{page:t,size:e},timeout:6e4})},getMyProjects(t=0,e=10){return console.log("[projectAPI.getMyProjects] è·å–æˆ‘å‚ä¸çš„é¡¹ç›®"),r.get("/zhiyan/api/projects/my-projects",{params:{page:t,size:e},timeout:6e4})},getPublicActiveProjects(t=0,e=10){return console.log("[projectAPI.getPublicActiveProjects] è·å–å…¬å¼€é¡¹ç›®"),r.get("/zhiyan/api/projects/public/active",{params:{page:t,size:e},timeout:6e4})},searchProjects(t,e=0,s=10){return console.log("[projectAPI.searchProjects] æœç´¢é¡¹ç›®, å…³é”®è¯:",t),r.get("/zhiyan/api/projects/search",{params:{keyword:t,page:e,size:s}})},updateProjectStatus(t,e){return console.log("[projectAPI.updateProjectStatus] æ›´æ–°é¡¹ç›®çŠ¶æ€, ID:",t,"çŠ¶æ€:",e),r.patch(`/zhiyan/api/projects/${t}/status`,{status:e})},archiveProject(t){return console.log("[projectAPI.archiveProject] å½’æ¡£é¡¹ç›®, ID:",t),r.post(`/zhiyan/api/projects/${t}/archive`)},countMyCreatedProjects(){return console.log("[projectAPI.countMyCreatedProjects] ç»Ÿè®¡æˆ‘åˆ›å»ºçš„é¡¹ç›®"),r.get("/zhiyan/api/projects/count/my-created")},countMyParticipatedProjects(){return console.log("[projectAPI.countMyParticipatedProjects] ç»Ÿè®¡æˆ‘å‚ä¸çš„é¡¹ç›®"),r.get("/zhiyan/api/projects/count/my-participated")},uploadProjectImage(t,e=null){console.log("[projectAPI.uploadProjectImage] ä¸Šä¼ é¡¹ç›®å›¾ç‰‡, projectId:",e);const s=new FormData;return s.append("file",t),e&&s.append("projectId",e),r.post("/zhiyan/api/projects/upload-image",s)},deleteProjectImage(t){return console.log("[projectAPI.deleteProjectImage] åˆ é™¤é¡¹ç›®å›¾ç‰‡:",t),r.delete("/zhiyan/api/projects/delete-image",{params:{imageUrl:t}})},inviteMember(t,e){return console.log("[projectAPI.inviteMember] é‚€è¯·æˆå‘˜, é¡¹ç›®ID:",t,"æ•°æ®:",e),r.post(`/zhiyan/api/projects/${t}/invite`,e)},assignRole(t,e){return console.log("[projectAPI.assignRole] åˆ†é…è§’è‰², é¡¹ç›®ID:",t,"æ•°æ®:",e),r.post(`/zhiyan/api/projects/${t}/assign`,e)},removeMember(t,e){return console.log("[projectAPI.removeMember] ç§»é™¤æˆå‘˜, é¡¹ç›®ID:",t,"ç”¨æˆ·ID:",e),r.delete(`/zhiyan/api/projects/${t}/members/${e}`)},getProjectMembers(t,e=0,s=20){return console.log("[projectAPI.getProjectMembers] è·å–é¡¹ç›®æˆå‘˜, é¡¹ç›®ID:",t),r.get(`/zhiyan/api/projects/${t}/members`,{params:{page:e,size:s},timeout:6e4})},searchUsers(t,e=0,s=10){return console.log("[projectAPI.searchUsers] æœç´¢ç”¨æˆ·, å…³é”®è¯:",t,"é¡µç :",e,"æ¯é¡µ:",s),r.get("/zhiyan/api/users/search",{params:{keyword:t,page:e,size:s}})}}},718:function(t,e,s){var a=s(471),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view"),t.isAuthPage?t._e():e("GlobalUserProfile",{attrs:{floating:!0}})],1)},o=[],r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"global-user-profile",class:{floating:t.floating}},[e("div",{staticClass:"user-profile",on:{click:t.toggleUserMenu}},[e("div",{staticClass:"user-avatar"},[t.globalUserInfo.avatar?e("img",{attrs:{src:t.globalUserInfo.avatar,alt:"ç”¨æˆ·å¤´åƒ"}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("span",{staticClass:"username"},[t._v(t._s(t.globalUserInfo.nickname||"æ¸¸å®¢"))]),e("svg",{class:{rotate:t.userMenuOpen},attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.userMenuOpen?e("div",{staticClass:"user-menu"},[e("div",{staticClass:"menu-item",on:{click:t.goToProfile}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ä¸ªäººä¿¡æ¯ ")]),t.isLoggedIn?t._e():e("div",{staticClass:"menu-item",on:{click:t.goToLogin}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M15 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("polyline",{attrs:{points:"10,17 15,12 10,7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("line",{attrs:{x1:"15",y1:"12",x2:"3",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç™»å½•è´¦å· ")]),t.isLoggedIn?e("div",{staticClass:"menu-item",on:{click:t.logout}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("polyline",{attrs:{points:"16,17 21,12 16,7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("line",{attrs:{x1:"21",y1:"12",x2:"9",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" é€€å‡ºç™»å½• ")]):t._e()]):t._e(),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e()])},n=[],l=s(303);function c(t){if(!t||"string"!==typeof t)return null;if(t.startsWith("http://")||t.startsWith("https://"))return t.includes("localhost")?(console.warn("æ£€æµ‹åˆ°æ— æ•ˆURL:",t,"- å°†è¿”å›nullä½¿ç”¨é»˜è®¤å›¾ç‰‡"),null):t;if(t.startsWith("/")&&(t=t.substring(1)),t.startsWith("zhiyan/")){const e=l.z_||"http://10.7.10.98:9000";return`${e}/${t}`}if(!t.includes("/")){const e=l.z_||"http://10.7.10.98:9000";return`${e}/zhiyan/project-covers/${t}`}const e=l.z_||"http://10.7.10.98:9000";return`${e}/${t}`}function d(t,e="zhiyan"){if(!t||"string"!==typeof t)return null;if(t.startsWith("http://")||t.startsWith("https://"))return t.includes("localhost")?(console.warn("æ£€æµ‹åˆ°åŒ…å«localhostçš„æ— æ•ˆURL:",t),null):t;if(t.startsWith("/")&&(t=t.substring(1)),t.startsWith(`${e}/`)){const e=l.z_||"http://10.7.10.98:9000";return`${e}/${t}`}const s=l.z_||"http://10.7.10.98:9000";return`${s}/${e}/${t}`}function h(t){if(!t)return null;if("string"===typeof t){if(t.startsWith("{"))try{const e=JSON.parse(t);return e.minio_url||e.minioUrl||e.cdn_url||e.cdnUrl||null}catch(e){return console.warn("è§£æå¤´åƒJSONå¤±è´¥:",t),d(t,"zhiyan")}return d(t,"zhiyan")}if("object"===typeof t){const e=t.minio_url||t.minioUrl||t.cdn_url||t.cdnUrl;return e?d(e,"zhiyan"):null}return null}function p(t){if(!t)return null;const e={...t};let s=t.avatar||t.avatarUrl||"";if(s&&"string"===typeof s&&s.startsWith("{"))try{const t=JSON.parse(s);s=t.minio_url||t.minioUrl||t.cdn_url||t.cdnUrl||""}catch(a){console.warn("Failed to parse avatar JSON:",s)}return s=h(s)||"",e.avatar=s,e.avatarUrl=s,e.nickname=t.nickname||t.name||"",console.log("ğŸ”„ è§„èŒƒåŒ–ç”¨æˆ·ä¿¡æ¯:",{"åŸå§‹avatar":t.avatar||t.avatarUrl,"è§„èŒƒåŒ–å":s,nickname:e.nickname,hasAvatar:!!s}),e}function u(t){const{accessToken:e,refreshToken:s,rememberMeToken:a,userInfo:i}=t;if(e&&localStorage.setItem("access_token",e),s&&localStorage.setItem("refresh_token",s),a&&localStorage.setItem("remember_me_token",a),i){const t=p(i);localStorage.setItem("user_info",JSON.stringify(t))}}function m(){const t=localStorage.getItem("user_info");return t?JSON.parse(t):null}function g(){return localStorage.getItem("access_token")}function v(){const t=g(),e=m();return!(!t||!e)}function C(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("remember_me_token"),localStorage.removeItem("user_info"),localStorage.removeItem("userAvatar"),localStorage.removeItem("globalUserInfo"),Object.keys(localStorage).forEach(t=>{t.startsWith("userData_")&&localStorage.removeItem(t)})}function w(t){return t&&t.msg?t.msg:t&&t.message?t.message:"string"===typeof t?t:"æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•"}function f(t){const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(t)}function k(t){const e={isValid:!0,message:""};return t?t.length<6?(e.isValid=!1,e.message="å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½"):t.length>16&&(e.isValid=!1,e.message="å¯†ç é•¿åº¦ä¸èƒ½è¶…è¿‡16ä½"):(e.isValid=!1,e.message="å¯†ç ä¸èƒ½ä¸ºç©º"),e}var y={name:"GlobalUserProfile",props:{floating:{type:Boolean,default:!1}},data(){return{userMenuOpen:!1,isLoggedIn:!1,globalUserInfo:{nickname:"æ¸¸å®¢",avatar:""},showToast:!1,toastMessage:""}},mounted(){this.loadGlobalUserInfo(),document.addEventListener("click",this.handleClickOutside),window.addEventListener("storage",this.handleStorageChange),this.$root.$on("userInfoUpdated",this.loadGlobalUserInfo),this.$eventBus.on(this.$EventTypes.USER_AVATAR_UPDATED,this.handleAvatarUpdated)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside),window.removeEventListener("storage",this.handleStorageChange),this.$root.$off("userInfoUpdated",this.loadGlobalUserInfo),this.$eventBus.off(this.$EventTypes.USER_AVATAR_UPDATED,this.handleAvatarUpdated)},methods:{loadGlobalUserInfo(){const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info");if(this.isLoggedIn=!(!t||!e),this.isLoggedIn&&e)try{const t=JSON.parse(e),s=t.avatar||t.avatarUrl||"";this.globalUserInfo={nickname:t.nickname||t.name||"ç”¨æˆ·",avatar:s},console.log("GlobalUserProfileåŠ è½½ç”¨æˆ·ä¿¡æ¯:",{nickname:this.globalUserInfo.nickname,avatar:this.globalUserInfo.avatar,hasAvatar:!!this.globalUserInfo.avatar,avatarLength:this.globalUserInfo.avatar.length})}catch(s){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s),this.isLoggedIn=!1,this.globalUserInfo={nickname:"æ¸¸å®¢",avatar:""}}else this.isLoggedIn=!1,this.globalUserInfo={nickname:"æ¸¸å®¢",avatar:""}},handleStorageChange(t){"user_info"===t.key&&this.loadGlobalUserInfo()},handleAvatarUpdated({userId:t,avatarUrl:e}){const s=localStorage.getItem("user_info");if(s)try{const a=JSON.parse(s),i=a.id||a.userId;String(i)===String(t)&&(this.$set(this.globalUserInfo,"avatar",e),console.log("âœ… GlobalUserProfileå¤´åƒå·²æ›´æ–°"))}catch(a){console.error("å¤„ç†å¤´åƒæ›´æ–°äº‹ä»¶å¤±è´¥:",a)}},handleClickOutside(t){t.target.closest(".user-profile")||t.target.closest(".user-menu")||(this.userMenuOpen=!1)},toggleUserMenu(){this.userMenuOpen=!this.userMenuOpen},goToProfile(){this.userMenuOpen=!1,"/profile"!==this.$route.path&&this.$router.push("/profile")},goToLogin(){this.userMenuOpen=!1,this.$router.push("/login")},logout(){this.userMenuOpen=!1,C(),this.showSuccessToast("é€€å‡ºç™»å½•æˆåŠŸï¼"),setTimeout(()=>{this.$router.push("/login")},1e3)},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)}}},b=y,_=s(656),I=(0,_.A)(b,r,n,!1,null,"3dd94630",null),F=I.exports,S={name:"App",components:{GlobalUserProfile:F},computed:{isAuthPage(){const t=["/login","/register","/forgot-password"];return t.includes(this.$route.path)}}},D=S,j=(0,_.A)(D,i,o,!1,null,null,null),T=j.exports,P=s(173),M=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("div",{staticClass:"brand-corner"},[t._v("æ™ºç ”")]),e("div",{staticClass:"login-left"},[e("div",{staticClass:"logo-section"},[e("div",{staticClass:"logo-placeholder",class:{animated:t.animateLogo}},[e("img",{staticClass:"logo-img",attrs:{src:s(487),alt:"Logo"}})]),e("h1",{staticClass:"system-title",class:{animated:t.animateLogo}},[t._v("é«˜æ ¡ç§‘ç ”å›¢é˜Ÿåä½œä¸æˆæœç®¡ç†å¹³å°")]),e("p",{staticClass:"system-subtitle",class:{animated:t.animateLogo}},[t._v("University Research Team Collaboration and Achievement Management Platform")])])]),e("div",{staticClass:"login-right"},[e("div",{staticClass:"login-box"},[t._m(0),e("form",{staticClass:"login-form",on:{submit:function(e){return e.preventDefault(),t.handleLogin.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"email"}},[t._v("ç”µå­é‚®ç®±")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.email,expression:"loginForm.email"}],attrs:{type:"email",id:"email",placeholder:"è¯·è¾“å…¥é‚®ç®±åœ°å€",required:""},domProps:{value:t.loginForm.email},on:{input:function(e){e.target.composing||t.$set(t.loginForm,"email",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"password"}},[t._v("å¯†ç ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.password,expression:"loginForm.password"}],attrs:{type:"password",id:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",required:""},domProps:{value:t.loginForm.password},on:{input:function(e){e.target.composing||t.$set(t.loginForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-options"},[e("label",{staticClass:"checkbox-option"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.loginForm.rememberMe,expression:"loginForm.rememberMe"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.loginForm.rememberMe)?t._i(t.loginForm.rememberMe,null)>-1:t.loginForm.rememberMe},on:{change:function(e){var s=t.loginForm.rememberMe,a=e.target,i=!!a.checked;if(Array.isArray(s)){var o=null,r=t._i(s,o);a.checked?r<0&&t.$set(t.loginForm,"rememberMe",s.concat([o])):r>-1&&t.$set(t.loginForm,"rememberMe",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.loginForm,"rememberMe",i)}}}),e("span",[t._v("è®°ä½æˆ‘")])]),e("a",{staticClass:"forgot-password",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.goToForgotPassword.apply(null,arguments)}}},[t._v(" å¿˜è®°å¯†ç ï¼Ÿ ")])]),e("button",{staticClass:"login-btn",attrs:{type:"submit",disabled:t.loading}},[t._v(" "+t._s(t.loading?"ç™»å½•ä¸­...":"ç™»å½•")+" ")]),e("div",{staticClass:"register-link"},[e("span",[t._v("è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ")]),e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.goToRegister.apply(null,arguments)}}},[t._v("ç«‹å³æ³¨å†Œ")])])])])]),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e()])},x=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-header"},[e("h2",{staticClass:"login-title"},[t._v("æ¬¢è¿å›æ¥")]),e("p",{staticClass:"login-subtitle"},[t._v("è¯·ç™»å½•æ‚¨çš„è´¦æˆ·")])])}],A=s(505),N=s.n(A);const $=N().create({baseURL:l.Ay.api.baseURL,timeout:l.Ay.api.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});$.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers.Authorization=`Bearer ${e}`),t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),console.log("APIè¯·æ±‚:",t.method?.toUpperCase(),t.url),console.log("è¯·æ±‚å¤´:",t.headers),console.log("è¯·æ±‚æ•°æ®:",t.data),console.log("è¯·æ±‚æ•°æ®ç±»å‹:",typeof t.data),t},t=>(console.error("è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:",t),Promise.reject(t))),$.interceptors.response.use(t=>(console.log("APIå“åº”:",t.status,t.data),t.data),t=>{if(console.error("APIé”™è¯¯è¯¦æƒ…:",t),console.error("é”™è¯¯ç±»å‹:",t.name),console.error("é”™è¯¯æ¶ˆæ¯:",t.message),console.error("å®Œæ•´é”™è¯¯å¯¹è±¡:",t),t.response){const{status:e,data:s}=t.response;return console.error("æœåŠ¡å™¨é”™è¯¯:",e,s),401===e&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),Promise.reject(s||t)}return t.request?(console.error("ç½‘ç»œé”™è¯¯è¯¦æƒ…:",t.request),console.error("è¯·æ±‚é…ç½®:",t.config),Promise.reject(new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆç«¯å£8091ï¼‰"))):(console.error("å…¶ä»–é”™è¯¯:",t.message),Promise.reject(t))});const L={sendVerificationCode(t){return $.post("/zhiyan/auth/send-verfcode",t)},register(t){return $.post("/zhiyan/auth/register",t)},login(t){return $.post("/zhiyan/auth/login",t)},autoLoginCheck(){return $.get("/zhiyan/auth/auto-login-check")},clearRememberMe(){return $.post("/zhiyan/auth/clear-remember-me")},verifyCode(t,e,s){return $.post("/zhiyan/auth/verify-code",null,{params:{email:t,code:e,type:s}})},checkEmail(t){return $.get(`/zhiyan/auth/check-email?email=${encodeURIComponent(t)}`)},refreshToken(t){return $.post("/zhiyan/auth/refresh",{refreshToken:t})},validateToken(t){return $.get("/zhiyan/auth/validate",{headers:{Authorization:`Bearer ${t}`}})},forgotPassword(t){return $.post("/zhiyan/auth/forgot-password",{email:t})},resetPassword(t){return $.post("/zhiyan/auth/reset-password",t)},sendResetPasswordCode(t){return $.post("/zhiyan/auth/forgot-password",{email:t})},logout(t){return $.post("/zhiyan/auth/logout",null,{headers:{Authorization:`Bearer ${t}`}})},searchUserByName(t){return $.get("/zhiyan/users/name",{params:{name:t}})},getUserById(t){return $.get(`/zhiyan/users/${t}`)},searchUsers(t,e=0,s=10){return console.log("[authAPI.searchUsers] æœç´¢ç”¨æˆ·, å…³é”®è¯:",t,"é¡µç :",e,"æ¯é¡µ:",s),$.get("/zhiyan/users/search",{params:{keyword:t,page:e,size:s}})}};var E={name:"Login",components:{},data(){return{loading:!1,submitLocked:!1,userAvatar:null,loginForm:{email:"",password:"",rememberMe:!1},showToast:!1,toastMessage:"",animateLogo:!1}},mounted(){const t=localStorage.getItem("authPagesAnimated");t||(this.animateLogo=!0,localStorage.setItem("authPagesAnimated","true"))},watch:{"loginForm.email":{handler(t){t?this.loadUserAvatarByEmail(t):this.userAvatar=null},immediate:!1}},mounted(){this.userAvatar=null},methods:{loadUserAvatar(){const t=localStorage.getItem("userAvatar");t&&(this.userAvatar=t)},loadUserAvatarByEmail(t){this.simulateLoadUserByEmail(t)},simulateLoadUserByEmail(t){const e=localStorage.getItem("userData_"+t);if(e){const t=JSON.parse(e);this.userAvatar=t.avatar||null}else this.userAvatar=null},setUserAvatar(t){this.userAvatar=t,localStorage.setItem("userAvatar",t)},async handleLogin(){if(!this.submitLocked)if(this.submitLocked=!0,setTimeout(()=>{this.submitLocked=!1},1e3),this.loginForm.email)if(this.loginForm.password)if(f(this.loginForm.email)){this.loading=!0;try{const t=await L.login({email:this.loginForm.email,password:this.loginForm.password,rememberMe:this.loginForm.rememberMe});if(200===t.code&&t.data){const e={accessToken:t.data.accessToken,refreshToken:t.data.refreshToken,rememberMeToken:t.data.rememberMeToken,userInfo:t.data.user};console.log("ç™»å½•æˆåŠŸï¼Œä¿å­˜æ•°æ®:",e),u(e);const s=localStorage.getItem("access_token"),a=localStorage.getItem("user_info");console.log("æ•°æ®ä¿å­˜éªŒè¯:",{token:!!s,userInfo:!!a,tokenValue:s,userInfoValue:a}),this.showSuccessToast("ç™»å½•æˆåŠŸï¼"),this.$root.$emit("userInfoUpdated"),setTimeout(()=>{this.$router.replace("/home")},1e3)}else alert(t.msg||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ")}catch(t){console.error("ç™»å½•å¤±è´¥:",t);const e=w(t);alert(e)}finally{this.loading=!1}}else alert("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");else alert("è¯·è¾“å…¥å¯†ç ");else alert("è¯·è¾“å…¥é‚®ç®±åœ°å€")},goToRegister(){this.$router.push("/register")},goToForgotPassword(){this.$router.push("/forgot-password")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)}}},U=E,O=(0,_.A)(U,M,x,!1,null,null,null),z=O.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register-container"},[e("div",{staticClass:"brand-corner"},[t._v("æ™ºç ”")]),e("div",{staticClass:"register-left"},[e("div",{staticClass:"logo-section"},[e("div",{staticClass:"logo-placeholder",class:{animated:t.animateLogo}},[e("img",{staticClass:"logo-img",attrs:{src:s(487),alt:"Logo"}})]),e("h1",{staticClass:"system-title",class:{animated:t.animateLogo}},[t._v("é«˜æ ¡ç§‘ç ”å›¢é˜Ÿåä½œä¸æˆæœç®¡ç†å¹³å°")]),e("p",{staticClass:"system-subtitle",class:{animated:t.animateLogo}},[t._v("University Research Team Collaboration and Achievement Management Platform")])])]),e("div",{staticClass:"register-right"},[e("div",{staticClass:"register-box"},[e("div",{staticClass:"register-header"},[e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›ç™»å½•"},on:{click:t.goToLogin}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("è¿”å›ç™»å½•")])]),e("h2",{staticClass:"register-title"},[t._v("åˆ›å»ºè´¦æˆ·")]),e("p",{staticClass:"register-subtitle"},[t._v("å¡«å†™ä¿¡æ¯ä»¥åˆ›å»ºæ‚¨çš„è´¦æˆ·")])]),e("form",{staticClass:"register-form",on:{submit:function(e){return e.preventDefault(),t.handleRegister.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"email"}},[t._v("ç”µå­é‚®ç®±")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.email,expression:"registerForm.email"}],attrs:{type:"email",id:"email",placeholder:"è¯·è¾“å…¥é‚®ç®±åœ°å€",required:""},domProps:{value:t.registerForm.email},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"email",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"code"}},[t._v("éªŒè¯ç ")]),e("div",{staticClass:"code-input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.code,expression:"registerForm.code"}],staticClass:"code-input",attrs:{type:"text",id:"code",placeholder:"è¯·è¾“å…¥6ä½éªŒè¯ç ",maxlength:"6",pattern:"[0-9]{6}",required:""},domProps:{value:t.registerForm.code},on:{input:[function(e){e.target.composing||t.$set(t.registerForm,"code",e.target.value)},t.formatCodeInput]}}),e("button",{staticClass:"send-code-btn",attrs:{type:"button",disabled:t.loading||t.countdown>0},on:{click:t.sendCode}},[t._v(" "+t._s(t.countdown>0?`${t.countdown}såé‡å‘`:"å‘é€éªŒè¯ç ")+" ")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"password"}},[t._v("å¯†ç è®¾ç½®(6-16ä½)")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.password,expression:"registerForm.password"}],attrs:{type:"password",id:"password",placeholder:"è¯·è¾“å…¥å¯†ç ",required:"",minlength:"6",maxlength:"16"},domProps:{value:t.registerForm.password},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"password",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"confirmPassword"}},[t._v("ç¡®è®¤å¯†ç ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.confirmPassword,expression:"registerForm.confirmPassword"}],attrs:{type:"password",id:"confirmPassword",placeholder:"è¯·å†æ¬¡è¾“å…¥å¯†ç ",required:""},domProps:{value:t.registerForm.confirmPassword},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"confirmPassword",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"name"}},[t._v("æ˜µç§°")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.name,expression:"registerForm.name"}],attrs:{type:"text",id:"name",placeholder:"è¯·è¾“å…¥æ˜µç§°",required:""},domProps:{value:t.registerForm.name},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"name",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"organization"}},[t._v("æ‰€å±æœºæ„æˆ–å­¦æ ¡")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.organization,expression:"registerForm.organization"}],attrs:{type:"text",id:"organization",placeholder:"è¯·è¾“å…¥æ‰€å±æœºæ„æˆ–å­¦æ ¡"},domProps:{value:t.registerForm.organization},on:{input:function(e){e.target.composing||t.$set(t.registerForm,"organization",e.target.value)}}})]),e("div",{staticClass:"form-group agreement-group"},[e("label",{staticClass:"agreement"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.registerForm.agreement,expression:"registerForm.agreement"}],attrs:{type:"checkbox",required:""},domProps:{checked:Array.isArray(t.registerForm.agreement)?t._i(t.registerForm.agreement,null)>-1:t.registerForm.agreement},on:{change:function(e){var s=t.registerForm.agreement,a=e.target,i=!!a.checked;if(Array.isArray(s)){var o=null,r=t._i(s,o);a.checked?r<0&&t.$set(t.registerForm,"agreement",s.concat([o])):r>-1&&t.$set(t.registerForm,"agreement",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.registerForm,"agreement",i)}}}),t._m(0)])]),e("button",{staticClass:"register-btn",attrs:{type:"submit",disabled:t.loading}},[t._v(" "+t._s(t.loading?"æ³¨å†Œä¸­...":"ç«‹å³æ³¨å†Œ")+" ")])])])]),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e(),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[t._m(1),e("div",{staticClass:"modal-body"},[e("p",[t._v(t._s(t.modalMessage))])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-confirm",on:{click:t.closeModal}},[t._v("ç¡®å®š")])])])]):t._e()])},V=[function(){var t=this,e=t._self._c;return e("span",[t._v("æˆ‘å·²é˜…è¯»å¹¶åŒæ„"),e("a",{staticClass:"agreement-link",attrs:{href:"#"}},[t._v("ã€Šéšç§æ”¿ç­–ã€‹")]),t._v("å’Œ"),e("a",{staticClass:"agreement-link",attrs:{href:"#"}},[t._v("ã€ŠæœåŠ¡åè®®ã€‹")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal-header"},[e("h3",[t._v("æç¤º")])])}],H={name:"Register",components:{},data(){return{loading:!1,countdown:0,submitLocked:!1,registerForm:{email:"",code:"",password:"",confirmPassword:"",name:"",organization:"",agreement:!1},showToast:!1,toastMessage:"",showModal:!1,modalMessage:"",animateLogo:!1}},mounted(){const t=localStorage.getItem("authPagesAnimated");t||(this.animateLogo=!0,localStorage.setItem("authPagesAnimated","true"))},methods:{async sendCode(){if(this.registerForm.email)if(f(this.registerForm.email)){this.loading=!0;try{const t=await L.sendVerificationCode({email:this.registerForm.email,type:"REGISTER"});200===t.code?(this.showSuccessToast("éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶ï¼ˆæµ‹è¯•æ¨¡å¼ä¸‹éªŒè¯ç ä¼šæ˜¾ç¤ºåœ¨åç«¯æ§åˆ¶å°ï¼‰"),this.startCountdown()):t.msg&&t.msg.includes("è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ")?this.showErrorModal("è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–é‚®ç®±æˆ–ç›´æ¥ç™»å½•"):this.showErrorModal(t.msg||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}catch(t){console.error("å‘é€éªŒè¯ç å¤±è´¥:",t);const e=w(t);e.includes("å·²è¢«æ³¨å†Œ")||e.includes("å·²å­˜åœ¨")||e.includes("å·²æ³¨å†Œ")||e.includes("exists")||e.includes("registered")?this.showErrorModal("è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–é‚®ç®±æˆ–ç›´æ¥ç™»å½•"):this.showErrorModal(e)}finally{this.loading=!1}}else this.showErrorModal("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");else this.showErrorModal("è¯·å…ˆè¾“å…¥é‚®ç®±åœ°å€")},async handleRegister(){if(console.log("=== å¼€å§‹å¤„ç†æ³¨å†Œ ==="),console.log("è¡¨å•æ•°æ®:",this.registerForm),this.submitLocked)return void console.log("æäº¤è¢«é”å®šï¼Œè·³è¿‡");if(this.submitLocked=!0,setTimeout(()=>{this.submitLocked=!1},1e3),console.log("å¼€å§‹è¡¨å•éªŒè¯..."),!this.registerForm.email)return console.log("é‚®ç®±ä¸ºç©ºï¼Œåœæ­¢å¤„ç†"),void this.showErrorModal("è¯·è¾“å…¥é‚®ç®±åœ°å€");if(!this.registerForm.code)return console.log("éªŒè¯ç ä¸ºç©ºï¼Œåœæ­¢å¤„ç†"),void this.showErrorModal("è¯·è¾“å…¥éªŒè¯ç ");if(!this.registerForm.password)return console.log("å¯†ç ä¸ºç©ºï¼Œåœæ­¢å¤„ç†"),void this.showErrorModal("è¯·è¾“å…¥å¯†ç ");if(!this.registerForm.name)return console.log("æ˜µç§°ä¸ºç©ºï¼Œåœæ­¢å¤„ç†"),void this.showErrorModal("è¯·è¾“å…¥æ˜µç§°");if(!f(this.registerForm.email))return void this.showErrorModal("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");if(this.registerForm.password!==this.registerForm.confirmPassword)return void this.showErrorModal("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");const t=k(this.registerForm.password);if(t.isValid)if(this.registerForm.agreement)if(/^\d{6}$/.test(this.registerForm.code)){this.loading=!0;try{console.log("æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²è¢«æ³¨å†Œ:",this.registerForm.email);const t=await L.checkEmail(this.registerForm.email);if(console.log("é‚®ç®±æ£€æŸ¥å“åº”:",t),200===t.code&&!1===t.data)return void this.showErrorModal("è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–é‚®ç®±æˆ–ç›´æ¥ç™»å½•");const s={email:this.registerForm.email,verificationCode:this.registerForm.code,password:this.registerForm.password,confirmPassword:this.registerForm.confirmPassword,name:this.registerForm.name,institution:this.registerForm.organization||""};let a;console.log("å‡†å¤‡å‘é€æ³¨å†Œè¯·æ±‚ï¼Œæ•°æ®:",s),console.log("æ•°æ®ç±»å‹:",typeof s),console.log("æ•°æ®JSON:",JSON.stringify(s)),console.log("å¼€å§‹è°ƒç”¨æ³¨å†ŒAPI..."),console.log("æ³¨å†Œæ•°æ®è¯¦æƒ…:",{email:s.email,verificationCode:s.verificationCode,password:s.password?"***å·²è®¾ç½®***":"æœªè®¾ç½®",confirmPassword:s.confirmPassword?"***å·²è®¾ç½®***":"æœªè®¾ç½®",name:s.name,institution:s.institution});try{a=await L.register(s),console.log("æ³¨å†ŒAPIå“åº”:",a),console.log("å“åº”çŠ¶æ€ç :",a.code),console.log("å“åº”æ¶ˆæ¯:",a.msg),console.log("å“åº”æ•°æ®:",a.data)}catch(e){throw console.error("æ³¨å†ŒAPIè°ƒç”¨å¤±è´¥:",e),console.error("é”™è¯¯è¯¦æƒ…:",e.response),console.error("é”™è¯¯çŠ¶æ€ç :",e.response?.status),console.error("é”™è¯¯æ•°æ®:",e.response?.data),e}if(200===a.code){if(a.data&&a.data.accessToken){const t={accessToken:a.data.accessToken,refreshToken:a.data.refreshToken,rememberMeToken:a.data.rememberMeToken,userInfo:{id:a.data.userId,email:a.data.email,name:a.data.name,title:a.data.title,institution:a.data.institution}};u(t),this.showSuccessToast("æ³¨å†ŒæˆåŠŸï¼å·²è‡ªåŠ¨ç™»å½•"),this.$root.$emit("userInfoUpdated"),setTimeout(()=>{this.$router.push("/home")},1e3)}else this.showSuccessToast("æ³¨å†ŒæˆåŠŸï¼è¯·ä½¿ç”¨æ‚¨çš„è´¦å·ç™»å½•"),setTimeout(()=>{this.$router.push("/login")},1e3);this.registerForm={email:"",code:"",password:"",confirmPassword:"",name:"",organization:"",agreement:!1}}else this.showErrorModal(a.msg||"æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•")}catch(e){console.error("æ³¨å†Œå¤±è´¥:",e);const t=w(e);this.showErrorModal(t)}finally{this.loading=!1}}else this.showErrorModal("è¯·è¾“å…¥6ä½æ•°å­—éªŒè¯ç ");else this.showErrorModal("è¯·åŒæ„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–");else this.showErrorModal(t.message)},startCountdown(){this.countdown=60;const t=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(t)},1e3)},formatCodeInput(t){let e=t.target.value.replace(/[^0-9]/g,"");e.length>6&&(e=e.substring(0,6)),this.registerForm.code=e,t.target.value=e},goToLogin(){this.$router.push("/login")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)},showErrorModal(t){this.modalMessage=t,this.showModal=!0},closeModal(){this.showModal=!1,this.modalMessage=""}}},R=H,W=(0,_.A)(R,B,V,!1,null,null,null),J=W.exports,q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forgot-password-container"},[e("div",{staticClass:"brand-corner"},[t._v("æ™ºç ”")]),e("div",{staticClass:"forgot-password-left"},[e("div",{staticClass:"logo-section"},[e("div",{staticClass:"logo-placeholder",class:{animated:t.animateLogo}},[e("img",{staticClass:"logo-img",attrs:{src:s(487),alt:"Logo"}})]),e("h1",{staticClass:"system-title",class:{animated:t.animateLogo}},[t._v("é«˜æ ¡ç§‘ç ”å›¢é˜Ÿåä½œä¸æˆæœç®¡ç†å¹³å°")]),e("p",{staticClass:"system-subtitle",class:{animated:t.animateLogo}},[t._v("University Research Team Collaboration and Achievement Management Platform")])])]),e("div",{staticClass:"forgot-password-right"},[e("div",{staticClass:"forgot-password-box"},[e("div",{staticClass:"forgot-password-header"},[e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›ç™»å½•"},on:{click:t.goToLogin}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("è¿”å›ç™»å½•")])]),e("h2",{staticClass:"forgot-password-title"},[t._v("é‡ç½®å¯†ç ")]),e("p",{staticClass:"forgot-password-subtitle"},[t._v("é€šè¿‡é‚®ç®±éªŒè¯é‡ç½®æ‚¨çš„å¯†ç ")])]),e("form",{staticClass:"forgot-password-form",on:{submit:function(e){return e.preventDefault(),t.handleResetPassword.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"email"}},[t._v("ç”µå­é‚®ç®±")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.resetForm.email,expression:"resetForm.email"}],attrs:{type:"email",id:"email",placeholder:"è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€",required:""},domProps:{value:t.resetForm.email},on:{input:function(e){e.target.composing||t.$set(t.resetForm,"email",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"code"}},[t._v("éªŒè¯ç ")]),e("div",{staticClass:"code-input-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.resetForm.code,expression:"resetForm.code"}],staticClass:"code-input",attrs:{type:"text",id:"code",placeholder:"è¯·è¾“å…¥6ä½éªŒè¯ç ",maxlength:"6",pattern:"[0-9]{6}",required:""},domProps:{value:t.resetForm.code},on:{input:[function(e){e.target.composing||t.$set(t.resetForm,"code",e.target.value)},t.formatCodeInput]}}),e("button",{staticClass:"send-code-btn",attrs:{type:"button",disabled:t.loading||t.countdown>0},on:{click:t.sendCode}},[t._v(" "+t._s(t.countdown>0?`${t.countdown}såé‡å‘`:"å‘é€éªŒè¯ç ")+" ")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"newPassword"}},[t._v("æ–°å¯†ç ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.resetForm.newPassword,expression:"resetForm.newPassword"}],attrs:{type:"password",id:"newPassword",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ",required:"",minlength:"6"},domProps:{value:t.resetForm.newPassword},on:{input:function(e){e.target.composing||t.$set(t.resetForm,"newPassword",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"confirmPassword"}},[t._v("ç¡®è®¤å¯†ç ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.resetForm.confirmPassword,expression:"resetForm.confirmPassword"}],attrs:{type:"password",id:"confirmPassword",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",required:""},domProps:{value:t.resetForm.confirmPassword},on:{input:function(e){e.target.composing||t.$set(t.resetForm,"confirmPassword",e.target.value)}}})]),e("button",{staticClass:"complete-btn",attrs:{type:"submit",disabled:t.loading}},[t._v(" "+t._s(t.loading?"é‡ç½®ä¸­...":"é‡ç½®å¯†ç ")+" ")])])])]),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e()])},G=[],K={name:"ForgotPassword",components:{},data(){return{loading:!1,countdown:0,submitLocked:!1,resetForm:{email:"",code:"",newPassword:"",confirmPassword:""},showToast:!1,toastMessage:"",animateLogo:!1}},mounted(){const t=localStorage.getItem("authPagesAnimated");t||(this.animateLogo=!0,localStorage.setItem("authPagesAnimated","true"))},methods:{async sendCode(){if(this.resetForm.email)if(f(this.resetForm.email)){this.loading=!0;try{const t=await L.sendVerificationCode({email:this.resetForm.email,type:"RESET_PASSWORD"});200===t.code?(alert("éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶ï¼ˆæµ‹è¯•æ¨¡å¼ä¸‹éªŒè¯ç ä¼šæ˜¾ç¤ºåœ¨åç«¯æ§åˆ¶å°ï¼‰"),this.startCountdown()):alert(t.msg||"å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}catch(t){console.error("å‘é€éªŒè¯ç å¤±è´¥:",t);const e=w(t);alert(e)}finally{this.loading=!1}}else alert("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");else alert("è¯·å…ˆè¾“å…¥é‚®ç®±åœ°å€")},async handleResetPassword(){if(this.submitLocked)return;if(this.submitLocked=!0,setTimeout(()=>{this.submitLocked=!1},1e3),!this.resetForm.email)return void alert("è¯·è¾“å…¥é‚®ç®±åœ°å€");if(!this.resetForm.code)return void alert("è¯·è¾“å…¥éªŒè¯ç ");if(!/^\d{6}$/.test(this.resetForm.code))return void alert("è¯·è¾“å…¥6ä½æ•°å­—éªŒè¯ç ");if(!this.resetForm.newPassword)return void alert("è¯·è¾“å…¥æ–°å¯†ç ");if(!f(this.resetForm.email))return void alert("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼");if(this.resetForm.newPassword!==this.resetForm.confirmPassword)return void alert("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");const t=k(this.resetForm.newPassword);if(t.isValid){this.loading=!0;try{const t=await L.resetPassword({email:this.resetForm.email,verificationCode:this.resetForm.code,newPassword:this.resetForm.newPassword,confirmPassword:this.resetForm.confirmPassword});200===t.code?(this.showSuccessToast("å¯†ç é‡ç½®æˆåŠŸï¼è¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•"),setTimeout(()=>{this.$router.push("/login")},1e3)):alert(t.msg||"å¯†ç é‡ç½®å¤±è´¥ï¼Œè¯·é‡è¯•")}catch(e){console.error("å¯†ç é‡ç½®å¤±è´¥:",e);const t=w(e);alert(t)}finally{this.loading=!1}}else alert(t.message)},startCountdown(){this.countdown=60;const t=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(t)},1e3)},formatCodeInput(t){let e=t.target.value.replace(/[^0-9]/g,"");e.length>6&&(e=e.substring(0,6)),this.resetForm.code=e,t.target.value=e},goToLogin(){this.$router.push("/login")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)}}},Z=K,Y=(0,_.A)(Z,q,G,!1,null,null,null),Q=Y.exports,X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container",class:{"dark-mode":t.isDarkMode}},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("é¦–é¡µ")])]),e("div",{staticClass:"header-right"},[e("button",{staticClass:"theme-toggle-btn",attrs:{title:t.isDarkMode?"åˆ‡æ¢åˆ°ç™½å¤©æ¨¡å¼":"åˆ‡æ¢åˆ°é»‘å¤œæ¨¡å¼"},on:{click:t.toggleTheme}},[t.isDarkMode?e("svg",{staticClass:"theme-icon moon-icon",attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]):e("svg",{staticClass:"theme-icon sun-icon",attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("circle",{attrs:{cx:"12",cy:"12",r:"4",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M12 2V4M12 20V22M4.93 4.93L6.34 6.34M17.66 17.66L19.07 19.07M2 12H4M20 12H22M4.93 19.07L6.34 17.66M17.66 6.34L19.07 4.93",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])])])]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"quick-actions"},[e("div",{staticClass:"section-card"},[e("h2",{staticClass:"section-title"},[t._v("å¿«æ·æ“ä½œ")]),e("div",{staticClass:"action-cards"},[e("div",{staticClass:"action-card",on:{click:t.handleNewProject}},[e("div",{staticClass:"card-icon"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"card-label"},[t._v("æ–°å»ºé¡¹ç›®")])]),e("div",{staticClass:"action-card",on:{click:t.handleProjectSquare}},[e("div",{staticClass:"card-icon"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"8.5",cy:"7.5",r:"2.5",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M20 8V6C20 4.93913 19.5786 3.92172 18.8284 3.17157C18.0783 2.42143 17.0609 2 16 2H14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"card-label"},[t._v("é¡¹ç›®å¹¿åœº")])]),e("div",{staticClass:"action-card",on:{click:t.handleKnowledgeBase}},[e("div",{staticClass:"card-icon"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 3H21V21H3V3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9 9H15V15H9V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"card-label"},[t._v("çŸ¥è¯†åº“")])]),e("div",{staticClass:"action-card",on:{click:t.handleAIAssistant}},[e("div",{staticClass:"card-icon"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M14 2V8H20",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M16 13H8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M16 17H8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M10 9H8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"card-label"},[t._v("AIå®éªŒåˆ†æåŠ©æ‰‹")])])])])]),e("div",{staticClass:"three-column-row"},[t._m(0),e("div",{staticClass:"my-projects"},[e("div",{staticClass:"section-card"},[e("h2",{staticClass:"section-title"},[t._v("æˆ‘å‚ä¸çš„é¡¹ç›®")]),t.isLoadingProjects?e("div",{staticClass:"loading-projects"},[e("p",[t._v("æ­£åœ¨åŠ è½½é¡¹ç›®...")])]):e("div",{staticClass:"project-list"},[t._l(t.myProjects,function(s){return e("div",{key:s.id,staticClass:"project-card",on:{click:function(e){return t.goToProjectDetail(s.id)}}},[e("div",{staticClass:"project-icon blue-icon"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 3H5C3.89543 3 3 3.89543 3 5V9C3 10.1046 3.89543 11 5 11H9C10.1046 11 11 10.1046 11 9V5C11 3.89543 10.1046 3 9 3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M19 3H15C13.8954 3 13 3.89543 13 5V9C13 10.1046 13.8954 11 15 11H19C20.1046 11 21 10.1046 21 9V5C21 3.89543 20.1046 3 19 3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9 13H5C3.89543 13 3 13.8954 3 15V19C3 20.1046 3.89543 21 5 21H9C10.1046 21 11 20.1046 11 19V15C11 13.8954 10.1046 13 9 13Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M19 13H15C13.8954 13 13 13.8954 13 15V19C13 20.1046 13.8954 21 15 21H19C20.1046 21 21 20.1046 21 19V15C21 13.8954 20.1046 13 19 13Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("div",{staticClass:"project-content"},[e("h3",{staticClass:"project-title"},[t._v(t._s(s.title))]),e("p",{staticClass:"project-description"},[t._v(t._s(s.description))]),e("div",{staticClass:"project-meta"},[e("span",{class:["status-badge",`status-${s.status}`]},[t._v(t._s(t.getStatusText(s.status)))]),e("span",{staticClass:"progress-text"},[t._v(t._s(s.progress)+"% å®Œæˆ")])])])])}),0===t.myProjects.length?e("div",{staticClass:"no-projects"},[e("p",[t._v("æš‚æ— å‚ä¸çš„é¡¹ç›®")])]):t._e()],2)])]),e("div",{staticClass:"right-sidebar-column"},[e("RightSidebar",{attrs:{isDarkMode:t.isDarkMode}})],1)])]),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("éœ€è¦ç™»å½•")]),e("button",{staticClass:"modal-close",on:{click:t.closeModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("p",[t._v(t._s(t.modalMessage))])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"modal-btn modal-btn-cancel",on:{click:t.closeModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"modal-btn modal-btn-confirm",on:{click:t.goToLogin}},[t._v("å»ç™»å½•")])])])]):t._e()],1)},tt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"work-items"},[e("div",{staticClass:"section-card"},[e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("å·¥ä½œé¡¹")])]),e("div",{staticClass:"work-item-list"},[e("div",{staticClass:"work-item high-priority"},[e("div",{staticClass:"priority-bar"}),e("div",{staticClass:"item-content"},[e("h3",{staticClass:"item-title"},[t._v("æ™ºèƒ½æ¨èç³»ç»Ÿä¼˜åŒ–")]),e("p",{staticClass:"item-description"},[t._v("é‡æ„æ¨èç®—æ³•æ¨¡å—,æå‡å‡†ç¡®ç‡")]),e("div",{staticClass:"item-meta"},[e("span",{staticClass:"priority"},[t._v("é«˜ä¼˜å…ˆçº§")]),e("span",{staticClass:"deadline"},[t._v("æˆªæ­¢:2023-06-15")])])])]),e("div",{staticClass:"work-item medium-priority"},[e("div",{staticClass:"priority-bar"}),e("div",{staticClass:"item-content"},[e("h3",{staticClass:"item-title"},[t._v("ç”¨æˆ·ç•Œé¢æ”¹ç‰ˆ")]),e("p",{staticClass:"item-description"},[t._v("é‡æ–°è®¾è®¡ç”¨æˆ·äº¤äº’æµç¨‹")]),e("div",{staticClass:"item-meta"},[e("span",{staticClass:"priority"},[t._v("ä¸­ä¼˜å…ˆçº§")]),e("span",{staticClass:"deadline"},[t._v("æˆªæ­¢:2023-06-20")])])])]),e("div",{staticClass:"work-item low-priority"},[e("div",{staticClass:"priority-bar"}),e("div",{staticClass:"item-content"},[e("h3",{staticClass:"item-title"},[t._v("æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–")]),e("p",{staticClass:"item-description"},[t._v("ä¼˜åŒ–æŸ¥è¯¢ç´¢å¼•,æå‡å“åº”é€Ÿåº¦")]),e("div",{staticClass:"item-meta"},[e("span",{staticClass:"priority"},[t._v("ä½ä¼˜å…ˆçº§")]),e("span",{staticClass:"deadline"},[t._v("æˆªæ­¢:2023-06-30")])])])])])])])}],et=function(){var t=this,e=t._self._c;return t.isOpen?e("div",{staticClass:"sidebar-overlay",on:{click:t.closeSidebar}},[e("div",{staticClass:"sidebar",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"sidebar-header"},[e("h2",{staticClass:"sidebar-title"},[t._v("æ™ºç ”")]),e("button",{staticClass:"close-btn",on:{click:t.closeSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("nav",{staticClass:"sidebar-nav"},[e("div",{staticClass:"nav-item",class:{active:"/home"===t.currentRoute},on:{click:function(e){return t.navigateTo("/home")}}},[e("div",{staticClass:"nav-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9 22V12H15V22",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"nav-text"},[t._v("é¦–é¡µ")])]),e("div",{staticClass:"nav-item",class:{active:"/project-square"===t.currentRoute},on:{click:function(e){return t.navigateTo("/project-square")}}},[e("div",{staticClass:"nav-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("rect",{attrs:{x:"3",y:"3",width:"7",height:"7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("rect",{attrs:{x:"14",y:"3",width:"7",height:"7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("rect",{attrs:{x:"14",y:"14",width:"7",height:"7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("rect",{attrs:{x:"3",y:"14",width:"7",height:"7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"nav-text"},[t._v("é¡¹ç›®å¹¿åœº")])]),e("div",{staticClass:"nav-item",class:{active:t.currentRoute.startsWith("/knowledge-base")},on:{click:function(e){return t.navigateTo("/knowledge-base")}}},[e("div",{staticClass:"nav-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9.5 2C8.11929 2 7 3.11929 7 4.5C7 5.88071 8.11929 7 9.5 7H14.5C15.8807 7 17 5.88071 17 4.5C17 3.11929 15.8807 2 14.5 2H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9.5 9C8.11929 9 7 10.1193 7 11.5C7 12.8807 8.11929 14 9.5 14H14.5C15.8807 14 17 12.8807 17 11.5C17 10.1193 15.8807 9 14.5 9H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9.5 16C8.11929 16 7 17.1193 7 18.5C7 19.8807 8.11929 21 9.5 21H14.5C15.8807 21 17 19.8807 17 18.5C17 17.1193 15.8807 16 14.5 16H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"nav-text"},[t._v("çŸ¥è¯†åº“")])]),e("div",{staticClass:"nav-item",class:{active:"/ai-assistant"===t.currentRoute},on:{click:function(e){return t.navigateTo("/ai-assistant")}}},[e("div",{staticClass:"nav-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9.5 2C8.11929 2 7 3.11929 7 4.5C7 5.88071 8.11929 7 9.5 7H14.5C15.8807 7 17 5.88071 17 4.5C17 3.11929 15.8807 2 14.5 2H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9.5 9C8.11929 9 7 10.1193 7 11.5C7 12.8807 8.11929 14 9.5 14H14.5C15.8807 14 17 12.8807 17 11.5C17 10.1193 15.8807 9 14.5 9H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9.5 16C8.11929 16 7 17.1193 7 18.5C7 19.8807 8.11929 21 9.5 21H14.5C15.8807 21 17 19.8807 17 18.5C17 17.1193 15.8807 16 14.5 16H9.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"nav-text"},[t._v("AI å®éªŒåˆ†æåŠ©æ‰‹")])])])]),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("éœ€è¦ç™»å½•")]),e("button",{staticClass:"modal-close",on:{click:t.closeModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("p",[t._v(t._s(t.modalMessage))])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"modal-btn modal-btn-cancel",on:{click:t.closeModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"modal-btn modal-btn-confirm",on:{click:t.goToLogin}},[t._v("å»ç™»å½•")])])])]):t._e()]):t._e()},st=[],at={name:"Sidebar",props:{isOpen:{type:Boolean,default:!1}},data(){return{showModal:!1,modalMessage:""}},computed:{currentRoute(){return this.$route.path}},methods:{closeSidebar(){this.$emit("close")},navigateTo(t){if(this.$route.path===t||"/knowledge-base"===t&&this.$route.path.startsWith("/knowledge-base"))return void this.closeSidebar();const e=["/knowledge-base","/ai-assistant","/project-create"];if(e.includes(t)){const e=localStorage.getItem("access_token"),s=localStorage.getItem("user_info"),a=!(!e||!s);if(!a)return this.showLoginModal(this.getLoginMessage(t)),void this.closeSidebar()}this.$router.push(t),this.closeSidebar()},showLoginModal(t){this.modalMessage=t,this.showModal=!0},closeModal(){this.showModal=!1,this.modalMessage=""},goToLogin(){this.$router.push("/login")},getLoginMessage(t){const e={"/knowledge-base":"è¯·å…ˆç™»å½•æ‰èƒ½è®¿é—®çŸ¥è¯†åº“","/ai-assistant":"è¯·å…ˆç™»å½•æ‰èƒ½è®¿é—®AIåŠ©æ‰‹","/project-create":"è¯·å…ˆç™»å½•æ‰èƒ½åˆ›å»ºé¡¹ç›®"};return e[t]||"è¯·å…ˆç™»å½•æ‰èƒ½è®¿é—®æ­¤åŠŸèƒ½"}}},it=at,ot=(0,_.A)(it,et,st,!1,null,"b41096d0",null),rt=ot.exports,nt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"right-sidebar",class:{"dark-mode":t.isDarkMode}},[t._m(0),e("div",{staticClass:"calendar-widget"},[e("div",{staticClass:"calendar"},[e("div",{staticClass:"calendar-header"},[e("button",{staticClass:"nav-btn",on:{click:t.previousMonth}},[t._v("â€¹")]),e("span",{staticClass:"month-year"},[t._v(t._s(t.currentMonth))]),e("button",{staticClass:"nav-btn",on:{click:t.nextMonth}},[t._v("â€º")])]),e("div",{staticClass:"calendar-grid"},[t._m(1),e("div",{staticClass:"calendar-days"},t._l(t.calendarDays,function(s,a){return e("div",{key:a,staticClass:"day",class:{"current-month":s.isCurrentMonth,today:s.isToday,selected:t.selectedDate&&s.date&&t.selectedDate.toDateString()===s.date.toDateString()},on:{click:function(e){return t.selectDate(s)}}},[t._v(" "+t._s(s.day)+" ")])}),0)])])]),e("div",{staticClass:"task-alert-widget",class:{urgent:t.urgentTasks.length>0}},[e("h3",{staticClass:"widget-title"},[t._v("ä»»åŠ¡æé†’")]),e("div",{staticClass:"task-alert-content"},[t.urgentTasks.length>0?e("div",{staticClass:"alert-message urgent"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("div",{staticClass:"alert-text"},[e("p",{staticClass:"alert-title"},[t._v("æœ‰ "),e("strong",[t._v(t._s(t.urgentTasks.length))]),t._v(" ä¸ªä»»åŠ¡å³å°†æˆªæ­¢")]),e("p",{staticClass:"alert-subtitle"},[t._v("è¯·åœ¨ä¸‰å¤©å†…å®Œæˆ")])])]):e("div",{staticClass:"alert-message safe"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._m(2)])])])])},lt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"calendar-header"},[e("h3",{staticClass:"widget-title"},[t._v("æˆ‘çš„å·¥ä½œæ—¥å†")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"weekdays"},[e("span",[t._v("æ—¥")]),e("span",[t._v("ä¸€")]),e("span",[t._v("äºŒ")]),e("span",[t._v("ä¸‰")]),e("span",[t._v("å››")]),e("span",[t._v("äº”")]),e("span",[t._v("å…­")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"alert-text"},[e("p",{staticClass:"alert-title"},[t._v("å¾ˆæ£’ï¼")]),e("p",{staticClass:"alert-subtitle"},[t._v("æ²¡æœ‰å³å°†æˆªæ­¢çš„ä»»åŠ¡")])])}],ct={name:"RightSidebar",props:{isDarkMode:{type:Boolean,default:!1}},data(){return{currentDate:new Date,selectedDate:null}},computed:{currentMonth(){const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth()+1;return`${t}å¹´${e}æœˆ`},calendarDays(){const t=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),s=new Date(t,e,1),a=new Date(t,e+1,0),i=s.getDay(),o=new Date(t,e,0),r=o.getDate(),n=[];for(let c=i-1;c>=0;c--)n.push({day:r-c,isCurrentMonth:!1,isToday:!1});for(let c=1;c<=a.getDate();c++){const s=new Date(t,e,c),a=new Date;n.push({day:c,isCurrentMonth:!0,isToday:s.toDateString()===a.toDateString(),date:s})}const l=42-n.length;for(let c=1;c<=l;c++)n.push({day:c,isCurrentMonth:!1,isToday:!1});return n},urgentTasks(){const t=new Date,e=new Date(t);return e.setDate(t.getDate()+3),[{title:"æ™ºèƒ½æ¨èç³»ç»Ÿä¼˜åŒ–",deadline:"2023-06-15"}].filter(s=>{const a=new Date(s.deadline);return a<=e&&a>=t})}},mounted(){},methods:{previousMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,1)},nextMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,1)},selectDate(t){t.isCurrentMonth&&(this.selectedDate=t.date,console.log("é€‰æ‹©æ—¥æœŸ:",t.date))}}},dt=ct,ht=(0,_.A)(dt,nt,lt,!1,null,"adef7e6c",null),pt=ht.exports,ut=s(698),mt={name:"Home",components:{Sidebar:rt,RightSidebar:pt},data(){return{sidebarOpen:!1,userMenuOpen:!1,userAvatar:null,globalUserInfo:{nickname:"å¼ ä¼Ÿ",avatar:""},showModal:!1,modalMessage:"",myProjects:[],isLoadingProjects:!1,isDarkMode:!1,isTransitioning:!1}},mounted(){this.loadUserAvatar(),this.loadGlobalUserInfo(),this.loadMyProjects(),this.loadTheme(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},methods:{loadUserAvatar(){const t=localStorage.getItem("userAvatar");t&&(this.userAvatar=t)},loadGlobalUserInfo(){const t=localStorage.getItem("globalUserInfo");t&&(this.globalUserInfo=JSON.parse(t))},setUserAvatar(t){this.userAvatar=t,localStorage.setItem("userAvatar",t)},handleClickOutside(t){t.target.closest(".user-profile")||t.target.closest(".user-menu")||(this.userMenuOpen=!1)},toggleUserMenu(){console.log("ç‚¹å‡»ç”¨æˆ·èœå•ï¼Œå½“å‰çŠ¶æ€:",this.userMenuOpen),this.userMenuOpen=!this.userMenuOpen,console.log("åˆ‡æ¢åçŠ¶æ€:",this.userMenuOpen)},goToProfile(){console.log("è·³è½¬åˆ°ä¸ªäººä¿¡æ¯é¡µé¢"),this.userMenuOpen=!1,this.$router.push("/profile")},async logout(){console.log("é€€å‡ºç™»å½•"),this.userMenuOpen=!1;try{const t=localStorage.getItem("access_token");t&&(await L.logout(t),console.log("åç«¯ç™»å‡ºæˆåŠŸ"))}catch(t){console.error("åç«¯ç™»å‡ºå¤±è´¥:",t)}this.clearAuthData(),console.log("å‰ç«¯æ•°æ®å·²æ¸…é™¤"),alert("é€€å‡ºç™»å½•æˆåŠŸï¼"),setTimeout(()=>{console.log("å‡†å¤‡è·³è½¬åˆ°ç™»å½•é¡µé¢"),window.location.href="/login"},100)},clearAuthData(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("remember_me_token"),localStorage.removeItem("user_info"),localStorage.removeItem("userAvatar"),localStorage.removeItem("globalUserInfo"),this.userAvatar=null,this.globalUserInfo={nickname:"",avatar:""}},toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},loadTheme(){const t=localStorage.getItem("theme");"dark"===t?(this.isDarkMode=!0,document.documentElement.classList.add("dark-mode")):(this.isDarkMode=!1,document.documentElement.classList.remove("dark-mode"))},toggleTheme(t){if(this.isTransitioning)return;const e=t.currentTarget.getBoundingClientRect(),s=e.left+e.width/2,a=e.top+e.height/2,i=(Math.sqrt(Math.pow(window.innerWidth,2)+Math.pow(window.innerHeight,2)),document.createElement("div"));i.className="theme-transition-circle",i.style.left=s+"px",i.style.top=a+"px",document.body.appendChild(i),this.isTransitioning=!0,requestAnimationFrame(()=>{const t=!this.isDarkMode;requestAnimationFrame(()=>{i.classList.add(t?"expand-dark":"expand-light")}),setTimeout(()=>{this.isDarkMode=!this.isDarkMode,localStorage.setItem("theme",this.isDarkMode?"dark":"light"),this.isDarkMode?document.documentElement.classList.add("dark-mode"):document.documentElement.classList.remove("dark-mode")},425),setTimeout(()=>{i.parentNode&&i.remove(),this.isTransitioning=!1},900)})},handleNewProject(){console.log("æ–°å»ºé¡¹ç›®");const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);s?this.$router.push({path:"/project-create",query:{from:"home"}}):this.showLoginModal("è¯·å…ˆç™»å½•æ‰èƒ½åˆ›å»ºé¡¹ç›®")},handleProjectSquare(){console.log("é¡¹ç›®å¹¿åœº"),this.$router.push("/project-square")},handleKnowledgeBase(){console.log("çŸ¥è¯†åº“");const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);s?this.$router.push("/knowledge-base"):this.showLoginModal("è¯·å…ˆç™»å½•æ‰èƒ½è®¿é—®çŸ¥è¯†åº“")},handleAIAssistant(){console.log("AIå®éªŒåˆ†æåŠ©æ‰‹");const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);s?this.$router.push("/ai-assistant"):this.showLoginModal("è¯·å…ˆç™»å½•æ‰èƒ½è®¿é—®AIåŠ©æ‰‹")},showLoginModal(t){this.modalMessage=t,this.showModal=!0},closeModal(){this.showModal=!1,this.modalMessage=""},goToLogin(){this.$router.push("/login")},async loadMyProjects(){const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);if(!s)return console.log("ç”¨æˆ·æœªç™»å½•ï¼Œä¸åŠ è½½é¡¹ç›®æ•°æ®"),void(this.myProjects=this.getDefaultProjects());this.isLoadingProjects=!0;try{console.log("å¼€å§‹åŠ è½½æˆ‘å‚ä¸çš„é¡¹ç›®...");const t=await ut.projectAPI.getMyProjects(0,5);console.log("æˆ‘å‚ä¸çš„é¡¹ç›®APIå“åº”:",t);let e=[];Array.isArray(t)?e=t:t&&t.data&&(Array.isArray(t.data)?e=t.data:Array.isArray(t.data.content)?e=t.data.content:Array.isArray(t.data.list)?e=t.data.list:Array.isArray(t.data.records)&&(e=t.data.records)),e.length>0?(this.myProjects=e.map(t=>({id:t.id||t.projectId||t.project_id,title:t.title||t.name||t.projectName||"æœªå‘½åé¡¹ç›®",description:t.description||t.desc||"",status:this.mapStatus(t.status),progress:this.calculateProgress(t.status)})),console.log("æˆåŠŸåŠ è½½é¡¹ç›®:",this.myProjects)):(console.log("æœªè·å–åˆ°é¡¹ç›®æ•°æ®ï¼Œä½¿ç”¨ç¤ºä¾‹æ•°æ®"),this.myProjects=this.getDefaultProjects())}catch(a){console.error("åŠ è½½é¡¹ç›®å¤±è´¥:",a),this.myProjects=this.getDefaultProjects()}finally{this.isLoadingProjects=!1}},getDefaultProjects(){return[{id:1,title:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",description:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",status:"in-progress",progress:65},{id:2,title:"å¤šæ¨¡æ€åŒ»å­¦å½±åƒæ•°æ®å¹³å°",description:"å¤šæ¨¡æ€åŒ»å­¦å½±åƒæ•°æ®å¹³å°",status:"in-progress",progress:45},{id:3,title:"æ°”å€™å˜åŒ–é¢„æµ‹æ¨¡å‹ç ”ç©¶",description:"æ°”å€™å˜åŒ–é¢„æµ‹æ¨¡å‹ç ”ç©¶",status:"completed",progress:100}]},mapStatus(t){const e={ACTIVE:"in-progress",COMPLETED:"completed",PAUSED:"in-progress",ARCHIVED:"completed","è¿›è¡Œä¸­":"in-progress","å·²å®Œæˆ":"completed","å·²æš‚åœ":"in-progress"};return e[t]||"in-progress"},calculateProgress(t){return"completed"===t||"Completed"===t||"å·²å®Œæˆ"===t?100:"ACTIVE"===t||"Paused"===t||"è¿›è¡Œä¸­"===t?50:0},getStatusText(t){const e={"in-progress":"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ",pending:"å¾…å¼€å§‹",paused:"å·²æš‚åœ"};return e[t]||"è¿›è¡Œä¸­"},goToProjectDetail(t){console.log("è·³è½¬åˆ°é¡¹ç›®è¯¦æƒ…:",t),this.$router.push(`/project-detail/${t}`)}}},gt=mt,vt=(0,_.A)(gt,X,tt,!1,null,null,null),Ct=vt.exports,wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"project-square-container"},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",attrs:{"aria-label":"open sidebar"},on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›é¦–é¡µ"},on:{click:t.goToHome}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("é¡¹ç›®å¹¿åœº")])])]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"toolbar"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"search-input",attrs:{type:"text",placeholder:"æœç´¢é¡¹ç›®åç§°"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),e("div",{staticClass:"toolbar-actions"},[e("div",{staticClass:"dropdown",on:{click:function(e){return e.stopPropagation(),t.toggleStatusDropdown.apply(null,arguments)}}},[e("button",{staticClass:"btn secondary"},[e("span",[t._v("é¡¹ç›®çŠ¶æ€")]),e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.statusOpen?e("ul",{staticClass:"dropdown-menu"},[e("li",{staticClass:"dropdown-item",class:{active:""===t.selectedStatus},on:{click:function(e){return t.selectStatus("")}}},[t._v("å…¨éƒ¨")]),e("li",{staticClass:"dropdown-item",class:{active:"è¿›è¡Œä¸­"===t.selectedStatus},on:{click:function(e){return t.selectStatus("è¿›è¡Œä¸­")}}},[t._v("è¿›è¡Œä¸­")]),e("li",{staticClass:"dropdown-item",class:{active:"å·²å®Œæˆ"===t.selectedStatus},on:{click:function(e){return t.selectStatus("å·²å®Œæˆ")}}},[t._v("å·²å®Œæˆ")]),e("li",{staticClass:"dropdown-item",class:{active:"ç¨³å¥ä¸­"===t.selectedStatus},on:{click:function(e){return t.selectStatus("ç¨³å¥ä¸­")}}},[t._v("ç¨³å¥ä¸­")])]):t._e()]),e("button",{staticClass:"btn",on:{click:t.resetFilters}},[t._v("é‡ç½®ç­›é€‰")]),e("button",{staticClass:"btn primary",on:{click:t.createNewProject}},[t._v("æ–°å»ºé¡¹ç›®")])])]),e("div",{staticClass:"content-wrapper"},[t.isLoading?e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loading-spinner"}),e("p",{staticClass:"loading-text"},[t._v("æ­£åœ¨åŠ è½½é¡¹ç›®æ•°æ®...")])]):0===t.projects.length?e("div",{staticClass:"empty-state"},[e("svg",{attrs:{width:"120",height:"120",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2L3 14H12L11 22L21 10H12L13 2Z",stroke:"#ccc","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("h3",{staticClass:"empty-title"},[t._v("æš‚æ— å…¬å¼€é¡¹ç›®")]),e("p",{staticClass:"empty-description"},[t._v("ç›®å‰è¿˜æ²¡æœ‰å…¬å¼€çš„é¡¹ç›®ï¼Œå¿«å»åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›®å§ï¼")]),e("button",{staticClass:"btn primary",on:{click:t.createNewProject}},[t._v("æ–°å»ºé¡¹ç›®")])]):e("div",{staticClass:"grid"},t._l(t.paginatedProjects,function(s,a){return e("div",{key:s.id,staticClass:"card",on:{click:function(e){return t.viewProjectDetail(s)}}},[e("div",{staticClass:"card-media",class:"gradient-"+(s.id%6+1)},[s.image?e("img",{staticClass:"project-image",attrs:{src:s.image,alt:s.title},on:{error:function(e){return t.handleImageError(e,s)}}}):e("span",{staticClass:"placeholder-text"},[t._v(t._s(s.title))])]),e("div",{staticClass:"card-body"},[e("div",{staticClass:"card-title-row"},[e("h3",{staticClass:"card-title"},[t._v(t._s(s.title))]),e("div",{staticClass:"badge-group"},["PUBLIC"===s.visibility?e("span",{staticClass:"visibility-badge visibility-public",attrs:{title:"å…¬å¼€é¡¹ç›®"}},[e("svg",{attrs:{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"12",r:"3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e(),e("span",{staticClass:"status-badge",class:t.statusClass(s.status)},[t._v(t._s(s.status))])])]),e("ul",{staticClass:"meta-list"},[e("li",[e("span",{staticClass:"meta-label"},[t._v("åˆ›å»ºè€…ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(s.creatorName||"æœªçŸ¥ç”¨æˆ·"))])]),e("li",[e("span",{staticClass:"meta-label"},[t._v("å›¢é˜Ÿè§„æ¨¡ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.getTeamSize(s))+"äºº")])]),s.startDate&&s.endDate?e("li",[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®å‘¨æœŸï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.formatDateRange(s.startDate,s.endDate)))])]):t._e(),s.tags&&s.tags.length>0?e("li",[e("span",{staticClass:"meta-label"},[t._v("æ ‡ç­¾ï¼š")]),e("span",{staticClass:"meta-value"},t._l(s.tags,function(a,i){return e("span",{key:i,staticClass:"tag-item"},[t._v(" "+t._s(a)+t._s(i<s.tags.length-1?"ã€":"")+" ")])}),0)]):t._e()])])])}),0),e("div",{staticClass:"pagination"},[e("button",{staticClass:"pager",attrs:{disabled:1===t.currentPage},on:{click:t.goPrev}},[t._v("â—€")]),t._l(t.totalPages,function(s){return e("button",{key:s,staticClass:"page-num",class:{active:s===t.currentPage},on:{click:function(e){return t.goPage(s)}}},[t._v(t._s(s))])}),e("button",{staticClass:"pager",attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.goNext}},[t._v("â–¶")])],2)])]),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("éœ€è¦ç™»å½•")]),e("button",{staticClass:"modal-close",on:{click:t.closeModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("p",[t._v(t._s(t.modalMessage))])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"modal-btn modal-btn-cancel",on:{click:t.closeModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"modal-btn modal-btn-confirm",on:{click:t.goToLogin}},[t._v("å»ç™»å½•")])])])]):t._e(),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e()],1)},ft=[],kt={name:"ProjectSquare",components:{Sidebar:rt},data(){return{sidebarOpen:!1,searchText:"",selectedStatus:"",statusOpen:!1,currentPage:1,pageSize:8,projects:[],showModal:!1,modalMessage:"",isLoading:!0,showToast:!1,toastMessage:""}},computed:{categories(){const t=new Set(this.projects.map(t=>t.category));return Array.from(t)},filteredProjects(){const t=this.searchText.trim().toLowerCase();return this.projects.filter(e=>{const s=!t||e.title.toLowerCase().includes(t),a=!this.selectedStatus||e.status===this.selectedStatus,i="PUBLIC"===e.visibility;return s&&a&&i})},totalPages(){return Math.max(1,Math.ceil(this.filteredProjects.length/this.pageSize))},paginatedProjects(){const t=(this.currentPage-1)*this.pageSize,e=this.filteredProjects.slice(t,t+this.pageSize);return console.log("å½“å‰é¡µ:",this.currentPage,"æ¯é¡µå¤§å°:",this.pageSize,"è¿‡æ»¤åé¡¹ç›®æ•°:",this.filteredProjects.length,"å½“å‰é¡µé¡¹ç›®æ•°:",e.length),e}},mounted(){this.cleanupOldImageUrls();const t=localStorage.getItem("projectSquare_shouldRestorePage");"true"===t?(this.restorePageNumber(),localStorage.removeItem("projectSquare_shouldRestorePage")):(this.currentPage=1,localStorage.removeItem("projectSquare_page")),this.loadProjects(),document.addEventListener("click",this.handleClickOutside)},activated(){console.log("é¡µé¢è¢«æ¿€æ´»ï¼Œé‡æ–°åŠ è½½é¡¹ç›®æ•°æ®");const t=localStorage.getItem("projectSquare_shouldRestorePage");"true"===t?(this.restorePageNumber(),localStorage.removeItem("projectSquare_shouldRestorePage")):(this.currentPage=1,localStorage.removeItem("projectSquare_page")),this.loadProjects()},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},methods:{cleanupOldImageUrls(){try{const t=localStorage.getItem("projects");if(!t)return;const e=JSON.parse(t);let s=!1;const a=e.some(t=>{const e=t.image||t.imageUrl;return e&&(e.includes("localhost:9000")||e.includes("localhost"))});if(a){console.log("ğŸ§¹ æ£€æµ‹åˆ°æ—§çš„å›¾ç‰‡ URLï¼Œæ­£åœ¨æ¸…ç†...");const t=e.map(t=>{let e=t.imageUrl||t.image;return e&&e.includes("localhost")&&(console.log(`æ¸…ç†é¡¹ç›® ${t.id} (${t.name||t.title}) çš„å›¾ç‰‡ URL:`,e),e=null,s=!0),{...t,image:e,imageUrl:e}});s&&(localStorage.setItem("projects",JSON.stringify(t)),console.log("âœ… å·²æ¸…ç†åŒ…å«é”™è¯¯ URL çš„é¡¹ç›®æ•°æ®"))}}catch(t){console.error("æ¸…ç†æ—§æ•°æ®å¤±è´¥:",t)}},toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},goToHome(){this.$router.push("/home")},handleClickOutside(t){t.target.closest(".dropdown")||(this.statusOpen=!1)},async loadProjects(){this.isLoading=!0;try{console.log("====== å¼€å§‹åŠ è½½é¡¹ç›®å¹¿åœºæ•°æ® ======");const{projectAPI:t}=await Promise.resolve().then(s.bind(s,698));console.log("è°ƒç”¨åç«¯APIè·å–å…¬å¼€æ´»è·ƒé¡¹ç›®...");const e=await t.getPublicActiveProjects(0,100);if(console.log("APIå“åº”:",e),console.log("å“åº”code:",e?.code),console.log("å“åº”dataç±»å‹:",typeof e?.data),e&&200===e.code){console.log("æˆåŠŸè·å–å…¬å¼€é¡¹ç›®æ•°æ®");let s=[];e.data&&e.data.content?(s=e.data.content,console.log("ä»Pageå¯¹è±¡è·å–é¡¹ç›®åˆ—è¡¨ï¼Œæ•°é‡:",s.length)):Array.isArray(e.data)?(s=e.data,console.log("ç›´æ¥è·å–é¡¹ç›®æ•°ç»„ï¼Œæ•°é‡:",s.length)):(console.warn("æœªçŸ¥çš„æ•°æ®æ ¼å¼:",e.data),s=[]);const a=localStorage.getItem("projects"),i=a?JSON.parse(a):[];this.projects=s.map(t=>{const e=i.find(e=>String(e.id)===String(t.id));let s=t.imageUrl||e&&e.imageUrl||null;return s=c(s),console.log(`é¡¹ç›® ${t.id} å›¾ç‰‡URLå¤„ç†:`,{backend:t.imageUrl,local:e?.imageUrl,normalized:s}),console.log("é¡¹ç›®æˆå‘˜å­—æ®µæ£€æŸ¥:",t.id,{memberCount:t.memberCount,teamMemberCount:t.teamMemberCount,membersCount:t.membersCount,participantCount:t.participantCount,participantsCount:t.participantsCount,memberNum:t.memberNum,membersNum:t.membersNum,memberSize:t.memberSize,membersSize:t.membersSize,userCount:t.userCount,usersCount:t.usersCount,teamSize:t.teamSize,teamMembersLen:Array.isArray(t.teamMembers)?t.teamMembers.length:void 0,membersLen:Array.isArray(t.members)?t.members.length:void 0}),{id:t.id,name:t.name,title:t.name,description:t.description||"æš‚æ— æè¿°",status:this.getStatusDisplay(t.status),visibility:t.visibility,teamSize:this.getNumericMemberCount(t)||1,dataAssets:t.description||"æš‚æ— æè¿°",direction:t.description||"æš‚æ— æè¿°",aiCore:"å¾…å®š",category:t.category||"å…¶ä»–",tags:t.tags||[],image:s,imageUrl:s,startDate:t.startDate,endDate:t.endDate,start_date:t.startDate,end_date:t.endDate,created_by:t.creatorId,creatorId:t.creatorId,creatorName:t.creatorName||"ç¥ç§˜ç”¨æˆ·",createdAt:t.createdAt,updatedAt:t.updatedAt,tasks:e?.tasks||[],teamMembers:t.teamMembers||t.members||t.participants||t.users||t.userList||e?.teamMembers||[],inviteSlots:e?.inviteSlots||[]}}).filter(t=>"PUBLIC"===t.visibility||(console.warn("è¿‡æ»¤æ‰éå…¬å¼€é¡¹ç›®:",t.id,t.name,"å¯è§æ€§:",t.visibility),!1)),console.log("è½¬æ¢åçš„é¡¹ç›®æ•°é‡:",this.projects.length),this.projects.length>0&&(console.log("é¡¹ç›®æ•°æ®ç¤ºä¾‹:",this.projects[0]),console.log("æ‰€æœ‰é¡¹ç›®çš„çŠ¶æ€:",this.projects.map(t=>({id:t.id,name:t.name,status:t.status,visibility:t.visibility,imageUrl:t.imageUrl})))),console.log("å¼€å§‹å¹¶è¡Œè·å–æ‰€æœ‰é¡¹ç›®çš„æˆå‘˜æ•°é‡...");const o=this.projects.map(async e=>{try{const a=await t.getProjectMembers(e.id,0,1e3);let i=0;a&&200===a.code&&(a.data&&a.data.content?(i=a.data.content.length,this.$set(e,"teamMembers",a.data.content)):Array.isArray(a.data)&&(i=a.data.length,this.$set(e,"teamMembers",a.data)));const o=i>0?i:1;this.$set(e,"memberCount",o);try{localStorage.setItem(`project_member_count_${e.id}`,String(o)),console.log(`âœ… å·²æ›´æ–°é¡¹ç›® ${e.id} çš„æˆå‘˜æ•°é‡:`,o,"ç¼“å­˜å·²å†™å…¥")}catch(s){console.warn(`å†™å…¥é¡¹ç›® ${e.id} æˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:`,s)}return console.log(`é¡¹ç›® ${e.id} (${e.name}) æˆå‘˜æ•°é‡:`,o),{projectId:e.id,memberCount:o}}catch(a){console.warn(`è·å–é¡¹ç›® ${e.id} æˆå‘˜æ•°é‡å¤±è´¥:`,a);try{const t=localStorage.getItem(`project_member_count_${e.id}`),s=t?parseInt(t,10):NaN;if(!isNaN(s)&&s>0)return this.$set(e,"memberCount",s),{projectId:e.id,memberCount:s}}catch(s){console.warn("è¯»å–ç¼“å­˜å¤±è´¥:",s)}return this.$set(e,"memberCount",1),{projectId:e.id,memberCount:1}}}),r=await Promise.all(o);console.log("æ‰€æœ‰é¡¹ç›®çš„æˆå‘˜æ•°é‡è·å–å®Œæˆ:",r),this.$forceUpdate(),console.log("âœ… å·²å®Œæˆå›¢é˜Ÿè§„æ¨¡æ•°æ®æ›´æ–°ï¼Œå·²è§¦å‘è§†å›¾åˆ·æ–°"),localStorage.setItem("projects",JSON.stringify(this.projects)),console.log("====== é¡¹ç›®åŠ è½½å®Œæˆï¼Œæ˜¾ç¤º",this.projects.length,"ä¸ªå…¬å¼€é¡¹ç›® ======")}else console.error("è·å–å…¬å¼€é¡¹ç›®å¤±è´¥ï¼Œcode:",e?.code,"msg:",e?.msg),this.loadProjectsFromLocalStorage()}catch(t){console.error("====== åŠ è½½é¡¹ç›®å¤±è´¥ ======"),console.error("é”™è¯¯ç±»å‹:",t.constructor.name),console.error("é”™è¯¯ä¿¡æ¯:",t.message),console.error("é”™è¯¯è¯¦æƒ…:",t),this.loadProjectsFromLocalStorage()}finally{this.isLoading=!1}},loadProjectsFromLocalStorage(){console.log("ä»localStorageåŠ è½½é¡¹ç›®æ•°æ®...");const t=localStorage.getItem("projects");if(t){const e=JSON.parse(t);this.projects=e.filter(t=>"PUBLIC"===t.visibility||(console.warn("ä»localStorageè¿‡æ»¤æ‰éå…¬å¼€é¡¹ç›®:",t.id,t.name||t.title,"å¯è§æ€§:",t.visibility),!1)).map(t=>{const e=c(t.image||t.imageUrl);return{...t,status:this.getStatusDisplay(t.status),image:e,imageUrl:e}}),console.log("ä»localStorageåŠ è½½çš„é¡¹ç›®æ•°é‡:",e.length,"è¿‡æ»¤åé¡¹ç›®æ•°é‡:",this.projects.length),console.log("localStorageä¸­æ‰€æœ‰é¡¹ç›®çš„çŠ¶æ€:",e.map(t=>({id:t.id,title:t.title||t.name,status:t.status,visibility:t.visibility})))}else console.log("localStorageä¸­æ²¡æœ‰é¡¹ç›®æ•°æ®ï¼Œä½¿ç”¨ç©ºæ•°ç»„"),this.projects=[]},getStatusDisplay(t){const e={PLANNING:"è§„åˆ’ä¸­",ONGOING:"è¿›è¡Œä¸­",COMPLETED:"å·²å®Œæˆ",ARCHIVED:"å·²å½’æ¡£",IN_PROGRESS:"è¿›è¡Œä¸­",PAUSED:"å·²æš‚åœ",CANCELLED:"å·²å–æ¶ˆ",DONE:"å·²å®Œæˆ",STEADY:"ç¨³å¥ä¸­"};return e[t]||t||"è¿›è¡Œä¸­"},getNumericMemberCount(t){const e=["memberCount","teamMemberCount","membersCount","participantCount","participantsCount","memberNum","membersNum","memberSize","membersSize","userCount","usersCount","teamSize"];for(const s of e)if(t&&void 0!==t[s]&&null!==t[s]){const e="string"===typeof t[s]?parseInt(t[s],10):t[s];if(!isNaN(e)&&e>0)return e}},statusClass(t){return"è¿›è¡Œä¸­"===t?"ongoing":"å·²å®Œæˆ"===t?"done":"steady"},getTeamSize(t){try{const e=localStorage.getItem(`project_member_count_${t.id}`),s=e?parseInt(e,10):NaN;if(!isNaN(s)&&s>0)return t.memberCount!==s&&this.$set(t,"memberCount",s),s}catch(s){console.warn("è¯»å–ç¼“å­˜å¤±è´¥:",s)}if(void 0!==t.memberCount&&null!==t.memberCount){const e="number"===typeof t.memberCount?t.memberCount:parseInt(t.memberCount,10);if(!isNaN(e)&&e>0)return e}const e=t.teamMemberCount||t.membersCount||t.participantCount||t.participantsCount||t.memberNum||t.membersNum||t.teamSize;if("number"===typeof e&&!isNaN(e)&&e>0)return e;if(Array.isArray(t.teamMembers)&&t.teamMembers.length>0)return t.teamMembers.length;if(Array.isArray(t.members)&&t.members.length>0)return t.members.length;if(Array.isArray(t.participants)&&t.participants.length>0)return t.participants.length;if(Array.isArray(t.users)&&t.users.length>0)return t.users.length;if(Array.isArray(t.userList)&&t.userList.length>0)return t.userList.length;try{const e=localStorage.getItem(`project_member_count_${t.id}`),s=e?parseInt(e,10):NaN;if(!isNaN(s)&&s>0)return s}catch(s){}return 1},formatDateRange(t,e){if(!t||!e)return"";const s=new Date(t),a=new Date(e),i=t=>{const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${a}`};return`${i(s)} è‡³ ${i(a)}`},toggleStatusDropdown(){this.statusOpen=!this.statusOpen},selectStatus(t){this.selectedStatus=t,this.statusOpen=!1,this.currentPage=1,localStorage.removeItem("projectSquare_page")},resetFilters(){this.searchText="",this.selectedStatus="",this.currentPage=1,localStorage.removeItem("projectSquare_page")},handleImageError(t,e){console.warn(`é¡¹ç›®å›¾ç‰‡åŠ è½½å¤±è´¥: ${e.title}, URL:`,e.image),t.target.style.display="none",this.$set(e,"image",null)},createNewProject(){const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);s?this.$router.push({path:"/project-create",query:{from:"project-square"}}):this.showLoginModal("è¯·å…ˆç™»å½•æ‰èƒ½åˆ›å»ºé¡¹ç›®")},goPrev(){this.currentPage>1&&(this.currentPage--,this.savePageNumber())},goNext(){this.currentPage<this.totalPages&&(this.currentPage++,this.savePageNumber())},goPage(t){this.currentPage=t,this.savePageNumber()},viewProjectDetail(t){const e=localStorage.getItem("access_token"),s=localStorage.getItem("user_info"),a=!(!e||!s);a?(this.savePageNumber(),localStorage.setItem("projectSquare_shouldRestorePage","true"),this.$router.push(`/project-detail/${t.id}`)):this.showLoginModal("è¯·å…ˆç™»å½•æ‰èƒ½æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…")},savePageNumber(){try{localStorage.setItem("projectSquare_page",String(this.currentPage)),console.log("ä¿å­˜é¡µç :",this.currentPage)}catch(t){console.error("ä¿å­˜é¡µç å¤±è´¥:",t)}},restorePageNumber(){try{const t=localStorage.getItem("projectSquare_page");if(t){const e=parseInt(t,10);!isNaN(e)&&e>0&&(this.currentPage=e,console.log("æ¢å¤é¡µç :",this.currentPage))}}catch(t){console.error("æ¢å¤é¡µç å¤±è´¥:",t)}},showLoginModal(t){this.modalMessage=t,this.showModal=!0},closeModal(){this.showModal=!1,this.modalMessage=""},goToLogin(){this.$router.push("/login")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)}}},yt=kt,bt=(0,_.A)(yt,wt,ft,!1,null,"65a4a7ce",null),_t=bt.exports,It=function(){var t=this,e=t._self._c;return e("div",{staticClass:"project-create-container"},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",attrs:{"aria-label":"open sidebar"},on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"back-btn",attrs:{title:"home"===t.fromPage?"è¿”å›é¦–é¡µ":"è¿”å›é¡¹ç›®å¹¿åœº"},on:{click:t.goBack}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("åˆ›å»ºé¡¹ç›®")])]),e("div",{staticClass:"header-right"},[e("div",{staticClass:"user-profile"},[e("div",{staticClass:"user-avatar"},[t.userAvatar?e("img",{attrs:{src:t.userAvatar,alt:"ç”¨æˆ·å¤´åƒ"}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])])])]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"form-section"},[e("div",{staticClass:"form-group"},[e("h3",{staticClass:"section-title"},[t._v("é¡¹ç›®åŸºæœ¬ä¿¡æ¯")]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®åç§°")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.projectName,expression:"formData.projectName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°"},domProps:{value:t.formData.projectName},on:{input:function(e){e.target.composing||t.$set(t.formData,"projectName",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®ç®€ä»‹")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.projectDescription,expression:"formData.projectDescription"}],staticClass:"form-textarea",attrs:{placeholder:"è¯·ç®€è¦ä»‹ç»æ‚¨çš„é¡¹ç›®ç›®æ ‡å’Œé¢„æœŸæˆæœ",rows:"4"},domProps:{value:t.formData.projectDescription},on:{input:function(e){e.target.composing||t.$set(t.formData,"projectDescription",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®å›¾ç‰‡")]),e("div",{staticClass:"image-upload-container"},[e("div",{staticClass:"image-upload-area",class:{"has-image":t.projectImage},on:{click:t.triggerImageUpload}},[t.projectImage?e("div",{staticClass:"image-preview"},[e("img",{attrs:{src:t.projectImage,alt:"é¡¹ç›®å›¾ç‰‡é¢„è§ˆ"}}),e("button",{staticClass:"remove-image",attrs:{title:"åˆ é™¤å›¾ç‰‡"},on:{click:function(e){return e.stopPropagation(),t.removeImage.apply(null,arguments)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):e("div",{staticClass:"upload-placeholder"},[e("svg",{attrs:{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M12 3V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("p",{staticClass:"upload-text"},[t._v("ç‚¹å‡»ä¸Šä¼ é¡¹ç›®å›¾ç‰‡")]),e("p",{staticClass:"upload-hint"},[t._v("æ”¯æŒ JPGã€PNG æ ¼å¼")])])]),e("input",{ref:"imageInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",id:"imageInput"},on:{change:t.handleImageUpload}})])]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®å¯è§æ€§")]),e("div",{staticClass:"visibility-options"},[e("div",{staticClass:"visibility-option",class:{active:"PUBLIC"===t.formData.visibility},on:{click:function(e){t.formData.visibility="PUBLIC"}}},[e("div",{staticClass:"option-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"12",r:"3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t._m(0)]),e("div",{staticClass:"visibility-option",class:{active:"PRIVATE"===t.formData.visibility},on:{click:function(e){t.formData.visibility="PRIVATE"}}},[e("div",{staticClass:"option-icon"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("rect",{attrs:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t._m(1)])])]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®å‘¨æœŸ")]),e("div",{staticClass:"date-range"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.startDate,expression:"formData.startDate"}],staticClass:"form-input date-input",attrs:{type:"date"},domProps:{value:t.formData.startDate},on:{change:t.validateStartDate,input:function(e){e.target.composing||t.$set(t.formData,"startDate",e.target.value)}}}),e("span",{staticClass:"date-separator"},[t._v("-")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.endDate,expression:"formData.endDate"}],staticClass:"form-input date-input",attrs:{type:"date",min:t.today},domProps:{value:t.formData.endDate},on:{change:t.validateEndDate,input:function(e){e.target.composing||t.$set(t.formData,"endDate",e.target.value)}}})]),t.dateError?e("div",{staticClass:"error-message"},[t._v(t._s(t.dateError))]):t._e()]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("è‡ªå®šä¹‰æ ‡ç­¾")]),e("div",{staticClass:"tag-input-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.newTag,expression:"newTag"}],staticClass:"form-input tag-input",attrs:{type:"text",placeholder:"è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ ï¼ˆå¯é€‰ï¼‰"},domProps:{value:t.newTag},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag.apply(null,arguments)},input:function(e){e.target.composing||(t.newTag=e.target.value)}}}),e("button",{staticClass:"add-tag-btn",attrs:{type:"button"},on:{click:t.addTag}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),t.formData.tags.length>0?e("div",{staticClass:"tags-display"},t._l(t.formData.tags,function(s,a){return e("span",{key:a,staticClass:"tag"},[t._v(" "+t._s(s)+" "),e("button",{staticClass:"tag-remove",on:{click:function(e){return t.removeTag(a)}}},[t._v("Ã—")])])}),0):t._e()])])]),e("div",{staticClass:"preview-section"},[e("h3",{staticClass:"preview-title"},[t._v("å®æ—¶é¢„è§ˆ")]),e("div",{staticClass:"preview-content"},[e("div",{staticClass:"preview-item"},[e("label",{staticClass:"preview-label"},[t._v("é¡¹ç›®åç§°")]),e("div",{staticClass:"preview-value"},[t._v(t._s(t.formData.projectName||"é¡¹ç›®åç§°"))])]),e("div",{staticClass:"preview-item"},[e("label",{staticClass:"preview-label"},[t._v("é¡¹ç›®ç®€ä»‹")]),e("div",{staticClass:"preview-value"},[t._v(t._s(t.formData.projectDescription||"é¡¹ç›®ç®€ä»‹å°†åœ¨æ­¤æ˜¾ç¤º"))])]),e("div",{staticClass:"preview-item"},[e("label",{staticClass:"preview-label"},[t._v("é¡¹ç›®å¯è§æ€§")]),e("div",{staticClass:"preview-value"},["PUBLIC"===t.formData.visibility?e("span",{staticClass:"visibility-badge visibility-public"},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"12",r:"3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" å…¬å¼€ ")]):e("span",{staticClass:"visibility-badge visibility-private"},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("rect",{attrs:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç§æœ‰ ")])])]),e("div",{staticClass:"preview-item"},[e("label",{staticClass:"preview-label"},[t._v("è‡ªå®šä¹‰æ ‡ç­¾")]),e("div",{staticClass:"preview-tags"},[0===t.formData.tags.length?e("span",{staticClass:"preview-placeholder"},[t._v("æ ‡ç­¾å°†åœ¨æ­¤æ˜¾ç¤º")]):t._l(t.formData.tags,function(s,a){return e("span",{key:a,staticClass:"preview-tag"},[t._v(t._s(s))])})],2)]),e("div",{staticClass:"preview-item"},[e("label",{staticClass:"preview-label"},[t._v("é¡¹ç›®å‘¨æœŸ")]),e("div",{staticClass:"preview-value"},[t.getProjectPeriod()?e("div",[t._v(t._s(t.getProjectPeriod()))]):t.dateError?e("div",{staticClass:"preview-error"},[t._v(t._s(t.dateError))]):e("div",{staticClass:"preview-placeholder"},[t._v("é¡¹ç›®å‘¨æœŸ: æœªè®¾ç½®")])])])])])]),e("div",{staticClass:"footer-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.saveDraft}},[t._v(" ä¿å­˜è‰ç¨¿ ")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:t.isSubmitting},on:{click:t.publishProject}},[t._v(" "+t._s(t.isSubmitting?"å‘å¸ƒä¸­...":"å‘å¸ƒé¡¹ç›®")+" ")])]),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e(),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("æç¤º")]),e("button",{staticClass:"modal-close",on:{click:t.closeModal}},[t._v("Ã—")])]),e("div",{staticClass:"modal-body"},[t._v(" "+t._s(t.modalMessage)+" ")]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"modal-btn modal-btn-confirm",on:{click:t.closeModal}},[t._v("ç¡®å®š")])])])]):t._e(),t.showCropModal?e("div",{staticClass:"crop-modal-overlay"},[e("div",{staticClass:"crop-modal-content",on:{click:function(t){t.stopPropagation()}}},[t._m(2),e("div",{staticClass:"crop-modal-body"},[e("div",{staticClass:"crop-container"},[e("canvas",{ref:"cropCanvas",staticClass:"crop-canvas"}),e("div",{ref:"cropOverlay",staticClass:"crop-overlay"},[e("div",{ref:"cropSelection",staticClass:"crop-selection"},[e("div",{staticClass:"resize-handle resize-handle-nw",attrs:{"data-handle":"nw"}}),e("div",{staticClass:"resize-handle resize-handle-ne",attrs:{"data-handle":"ne"}}),e("div",{staticClass:"resize-handle resize-handle-sw",attrs:{"data-handle":"sw"}}),e("div",{staticClass:"resize-handle resize-handle-se",attrs:{"data-handle":"se"}})])])])]),e("div",{staticClass:"crop-modal-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeCropModal}},[t._v("é‡æ–°é€‰æ‹©å›¾ç‰‡")]),e("button",{staticClass:"btn-confirm",on:{click:t.applyCrop}},[t._v("å®Œæˆè£åˆ‡")])])])]):t._e()],1)},Ft=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"option-content"},[e("div",{staticClass:"option-title"},[t._v("å…¬å¼€")]),e("div",{staticClass:"option-desc"},[t._v("é¡¹ç›®å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"option-content"},[e("div",{staticClass:"option-title"},[t._v("ç§æœ‰")]),e("div",{staticClass:"option-desc"},[t._v("é¡¹ç›®ä»…å¯¹æˆå‘˜å¯è§")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"crop-modal-header"},[e("h3",[t._v("è£åˆ‡é¡¹ç›®å›¾ç‰‡")]),e("p",{staticClass:"crop-hint"},[t._v("è¯·æ‹–æ‹½é€‰æ‹©è£åˆ‡åŒºåŸŸï¼Œç¡®ä¿æ¯”ä¾‹ä¸é¡¹ç›®å¹¿åœºæ˜¾ç¤ºä¸€è‡´")])])}],St={name:"ProjectCreate",components:{Sidebar:rt},data(){return{sidebarOpen:!1,isSubmitting:!1,userAvatar:null,newTag:"",fromPage:"",projectImage:null,dateError:"",formData:{projectName:"",projectDescription:"",visibility:"PRIVATE",startDate:"",endDate:"",tags:[]},showToast:!1,toastMessage:"",showModal:!1,modalMessage:"",showCropModal:!1,originalImage:null,originalImageData:null,cropData:{x:0,y:0,width:0,height:0}}},computed:{today(){const t=new Date;return t.toISOString().split("T")[0]}},mounted(){this.loadUserAvatar(),this.detectFromPage()},methods:{toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},detectFromPage(){const t=document.referrer;this.$route.path;t.includes("/project-square")||"project-square"===this.$route.query.from?this.fromPage="project-square":t.includes("/home")||"home"===this.$route.query.from?this.fromPage="home":this.fromPage="project-square"},goBack(){"home"===this.fromPage?this.$router.push("/home"):this.$router.push("/project-square")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)},showErrorModal(t){this.modalMessage=t,this.showModal=!0},closeModal(){this.showModal=!1,this.modalMessage=""},triggerImageUpload(){const t=document.getElementById("imageInput");t?t.click():this.$refs.imageInput?this.$refs.imageInput.click():console.error("æ— æ³•æ‰¾åˆ°æ–‡ä»¶è¾“å…¥å…ƒç´ ")},handleImageUpload(t){const e=t.target.files[0];if(e){if(!e.type.startsWith("image/"))return void this.showErrorModal("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶");if(e.size>5242880)return void this.showErrorModal("å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB");const t=new FileReader;t.onload=t=>{this.originalImageData=t.target.result,this.showCropModal=!0,this.$nextTick(()=>{this.initCropCanvas()})},t.readAsDataURL(e)}},removeImage(){this.projectImage=null,this.$refs.imageInput.value=""},closeCropModal(){this.$refs.imageInput.value="",this.showCropModal=!1,this.originalImage=null,this.originalImageData=null},initCropCanvas(){const t=this.$refs.cropCanvas,e=t.getContext("2d"),s=new Image;s.onload=()=>{const a=600,i=400;let{width:o,height:r}=s;if(o>a||r>i){const t=Math.min(a/o,i/r);o*=t,r*=t}t.width=o,t.height=r,t.style.width=o+"px",t.style.height=r+"px",e.drawImage(s,0,0,o,r),this.originalImage=s;const n=16/9,l=Math.min(.8*o,r*n*.8),c=l/n;this.cropData={x:(o-l)/2,y:(r-c)/2,width:l,height:c},this.updateCropSelection(),this.setupCropInteraction()},s.src=this.originalImageData},updateCropSelection(){const t=this.$refs.cropSelection;t&&(t.style.left=this.cropData.x+"px",t.style.top=this.cropData.y+"px",t.style.width=this.cropData.width+"px",t.style.height=this.cropData.height+"px")},setupCropInteraction(){const t=this.$refs.cropSelection,e=this.$refs.cropOverlay,s=this.$refs.cropCanvas;if(!t||!e||!s)return;let a=!1,i=!1,o=null,r=0,n=0,l=0,c=0,d=0,h=0;const p=16/9,u=t=>{t.target.classList.contains("resize-handle")?(i=!0,o=t.target.dataset.handle):a=!0;const e=s.getBoundingClientRect();r=t.clientX-e.left,n=t.clientY-e.top,l=this.cropData.x,c=this.cropData.y,d=this.cropData.width,h=this.cropData.height},m=t=>{if(!a&&!i)return;const e=s.getBoundingClientRect(),u=t.clientX-e.left,m=t.clientY-e.top,g=u-r,v=m-n;if(a){const t=Math.max(0,Math.min(s.width-this.cropData.width,l+g)),e=Math.max(0,Math.min(s.height-this.cropData.height,c+v));this.cropData.x=t,this.cropData.y=e}else if(i){let t=d,e=h,a=l,i=c;"se"===o?(t=Math.max(50,Math.min(s.width-l,d+g)),e=t/p,c+e>s.height&&(e=s.height-c,t=e*p)):"sw"===o?(t=Math.max(50,Math.min(l+d,d-g)),e=t/p,a=l+d-t,a<0&&(a=0,t=l+d,e=t/p)):"ne"===o?(t=Math.max(50,Math.min(s.width-l,d+g)),e=t/p,i=c+h-e,i<0&&(i=0,e=c+h,t=e*p)):"nw"===o&&(t=Math.max(50,Math.min(l+d,d-g)),e=t/p,a=l+d-t,i=c+h-e,a<0&&(a=0,t=l+d,e=t/p,i=c+h-e),i<0&&(i=0,e=c+h,t=e*p,a=l+d-t)),this.cropData.x=a,this.cropData.y=i,this.cropData.width=t,this.cropData.height=e}this.updateCropSelection()},g=()=>{a=!1,i=!1,o=null};t.addEventListener("mousedown",u),document.addEventListener("mousemove",m),document.addEventListener("mouseup",g),this.$once("hook:beforeDestroy",()=>{t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",g)})},applyCrop(){if(!this.originalImage)return;const t=document.createElement("canvas"),e=t.getContext("2d"),s=16/9,a=400,i=a/s;t.width=a,t.height=i;const o=this.cropData.x/this.$refs.cropCanvas.width*this.originalImage.width,r=this.cropData.y/this.$refs.cropCanvas.height*this.originalImage.height,n=this.cropData.width/this.$refs.cropCanvas.width*this.originalImage.width,l=this.cropData.height/this.$refs.cropCanvas.height*this.originalImage.height;e.drawImage(this.originalImage,o,r,n,l,0,0,a,i),this.projectImage=t.toDataURL("image/jpeg",.9),this.closeCropModal()},loadUserAvatar(){const t=localStorage.getItem("userAvatar");t&&(this.userAvatar=t)},getCurrentUserId(){const t=localStorage.getItem("user_info");if(t)try{const e=JSON.parse(t);return e.id||null}catch(e){return console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),null}return null},getCurrentUserName(){const t=localStorage.getItem("user_info");if(t)try{const e=JSON.parse(t);return e.name||e.nickname||"ç”¨æˆ·"}catch(e){return console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),"ç”¨æˆ·"}return"ç”¨æˆ·"},getStatusDisplay(t){const e={PLANNING:"è§„åˆ’ä¸­",ONGOING:"è¿›è¡Œä¸­",COMPLETED:"å·²å®Œæˆ",ARCHIVED:"å·²å½’æ¡£",IN_PROGRESS:"è¿›è¡Œä¸­",PAUSED:"å·²æš‚åœ",CANCELLED:"å·²å–æ¶ˆ"};return e[t]||t||"è¿›è¡Œä¸­"},getPriorityValue(t){const e={"é«˜":"HIGH","ä¸­":"MEDIUM","ä½":"LOW"};return e[t]||"MEDIUM"},getPriorityDisplay(t){const e={HIGH:"é«˜",MEDIUM:"ä¸­",LOW:"ä½"};return e[t]||"ä¸­"},addTag(){this.newTag.trim()&&!this.formData.tags.includes(this.newTag.trim())&&(this.formData.tags.push(this.newTag.trim()),this.newTag="")},removeTag(t){this.formData.tags.splice(t,1)},addPosition(){this.formData.positions.push({id:Date.now(),name:"",description:"",requirements:"",count:1,skills:"",status:"OPEN",created_at:(new Date).toISOString()})},removePosition(t){this.formData.positions.splice(t,1)},getProjectPeriod(){return this.formData.startDate&&this.formData.endDate?`${this.formData.startDate} - ${this.formData.endDate}`:null},validateStartDate(){return this.dateError="",!(this.formData.startDate&&this.formData.endDate&&new Date(this.formData.startDate)>new Date(this.formData.endDate))||(this.dateError="é¡¹ç›®å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ",!1)},validateEndDate(){return this.dateError="",this.formData.startDate&&this.formData.endDate&&new Date(this.formData.startDate)>new Date(this.formData.endDate)?(this.dateError="é¡¹ç›®ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºå¼€å§‹æ—¥æœŸ",!1):!(this.formData.endDate&&new Date(this.formData.endDate)<new Date(this.today))||(this.dateError="é¡¹ç›®ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©",!1)},async saveDraft(){try{await new Promise(t=>setTimeout(t,1e3)),alert("è‰ç¨¿ä¿å­˜æˆåŠŸï¼")}catch(t){console.error("ä¿å­˜è‰ç¨¿å¤±è´¥:",t),alert("ä¿å­˜è‰ç¨¿å¤±è´¥ï¼Œè¯·é‡è¯•")}},async createProjectAPI(t){try{const a=localStorage.getItem("access_token");if(!a)throw new Error("ç”¨æˆ·æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•");if(console.log("è°ƒç”¨åˆ›å»ºé¡¹ç›®APIï¼Œtoken:",a?"å·²è·å–":"æœªè·å–"),console.log("Tokenå†…å®¹:",a.substring(0,50)+"..."),!a.startsWith("eyJ"))throw new Error("Tokenæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ç™»å½•");try{const t=JSON.parse(atob(a.split(".")[1])),e=Math.floor(Date.now()/1e3);if(t.exp&&t.exp<e)throw new Error("Tokenå·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");console.log("Tokenç”¨æˆ·ä¿¡æ¯:",t)}catch(e){console.warn("Tokenè§£æå¤±è´¥:",e.message)}console.log("æµ‹è¯•Tokenæœ‰æ•ˆæ€§...");const{projectAPI:i}=await Promise.resolve().then(s.bind(s,698));console.log("ä½¿ç”¨é¡¹ç›®APIæ¨¡å—åˆ›å»ºé¡¹ç›®...");const o=await i.createProject(t);if(console.log("projectAPI.createProjectè¿”å›ç»“æœ:",o),console.log("è¿”å›ç»“æœç±»å‹:",typeof o),console.log("è¿”å›ç»“æœæ˜¯å¦ä¸ºnull:",null===o),console.log("è¿”å›ç»“æœæ˜¯å¦ä¸ºundefined:",void 0===o),o&&(console.log("è¿”å›ç»“æœcode:",o.code),console.log("è¿”å›ç»“æœmsg:",o.msg),console.log("è¿”å›ç»“æœdata:",o.data)),!o)throw new Error("APIè¿”å›ç©ºç»“æœ");if(200!==o.code)throw new Error(o.msg||"é¡¹ç›®åˆ›å»ºå¤±è´¥");return o}catch(a){throw console.error("åˆ›å»ºé¡¹ç›®APIè°ƒç”¨å¤±è´¥:",a),a}},async publishProject(){if(!this.isSubmitting){this.isSubmitting=!0;try{if(!this.formData.projectName||""===this.formData.projectName.trim())return alert("è¯·è¾“å…¥é¡¹ç›®åç§°"),void(this.isSubmitting=!1);if(!this.formData.startDate)return alert("è¯·é€‰æ‹©é¡¹ç›®å¼€å§‹æ—¥æœŸ"),void(this.isSubmitting=!1);if(!this.formData.endDate)return alert("è¯·é€‰æ‹©é¡¹ç›®ç»“æŸæ—¥æœŸ"),void(this.isSubmitting=!1);if(new Date(this.formData.startDate)>=new Date(this.formData.endDate))return alert("é¡¹ç›®ç»“æŸæ—¥æœŸå¿…é¡»æ™šäºå¼€å§‹æ—¥æœŸ"),void(this.isSubmitting=!1);if(new Date(this.formData.endDate)<new Date(this.today))return alert("é¡¹ç›®ç»“æŸæ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©"),void(this.isSubmitting=!1);console.log("è¡¨å•æ•°æ®:",this.formData);let i="https://via.placeholder.com/400x225?text=Project+Image";if(this.projectImage&&this.projectImage.startsWith("data:image")){console.log("æ£€æµ‹åˆ°base64å›¾ç‰‡ï¼Œå…ˆä¸Šä¼ åˆ°MinIO...");try{const t=await this.dataURLtoBlob(this.projectImage),e=new File([t],"project-image.jpg",{type:"image/jpeg"}),{projectAPI:a}=await Promise.resolve().then(s.bind(s,698)),o=await a.uploadProjectImage(e,null);console.log("å›¾ç‰‡ä¸Šä¼ å“åº”:",o),o&&200===o.code&&o.data&&o.data.imageUrl?(i=o.data.imageUrl,console.log("âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒURL:",i)):console.warn("âš ï¸ å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡")}catch(t){console.error("âŒ ä¸Šä¼ å›¾ç‰‡åˆ°MinIOå¤±è´¥:",t)}}const o={name:this.formData.projectName,description:this.formData.projectDescription,visibility:this.formData.visibility,imageUrl:i,startDate:this.formData.startDate,endDate:this.formData.endDate};console.log("å‘é€åˆ°åç«¯çš„é¡¹ç›®æ•°æ®:",o);const r=await this.createProjectAPI(o);if(console.log("createProjectAPIè¿”å›çš„å®Œæ•´å“åº”:",r),console.log("å“åº”ç±»å‹:",typeof r),console.log("å“åº”code:",r?.code),console.log("å“åº”msg:",r?.msg),console.log("å“åº”data:",r?.data),!r)throw new Error("APIè¿”å›ç©ºå“åº”");if(200!==r.code)throw new Error(r.msg||"é¡¹ç›®åˆ›å»ºå¤±è´¥");if(!r.data)throw new Error("APIè¿”å›æ•°æ®ä¸ºç©º");console.log("åç«¯è¿”å›çš„é¡¹ç›®æ•°æ®:",r.data),console.log("åç«¯è¿”å›çš„é¡¹ç›®ID:",r.data.id,"ç±»å‹:",typeof r.data.id);const n={...r.data,id:r.data.id,title:r.data.name,status:this.getStatusDisplay(r.data.status),teamSize:1,dataAssets:this.formData.projectDescription||"æš‚æ— æè¿°",direction:this.formData.projectDescription||"æš‚æ— æè¿°",aiCore:"å¾…å®š",category:"å…¶ä»–",tags:this.formData.tags,image:this.projectImage,tasks:[],teamMembers:[{id:1,user_id:1,name:this.getCurrentUserName(),project_role:"LEADER",role:"é¡¹ç›®è´Ÿè´£äºº",avatar:null,joined_at:(new Date).toISOString()}],inviteSlots:[]};console.log("æ–°é¡¹ç›®æ•°æ®:",n),console.log("é¡¹ç›®å‘¨æœŸæ•°æ®:",this.formData.startDate,this.formData.endDate);let l=[];try{const t=localStorage.getItem("projects");t&&(l=JSON.parse(t))}catch(e){console.error("è§£æç°æœ‰é¡¹ç›®æ•°æ®å¤±è´¥:",e),l=[]}l.unshift(n);try{localStorage.setItem("projects",JSON.stringify(l)),console.log("é¡¹ç›®æ•°æ®å·²ä¿å­˜åˆ°localStorage")}catch(a){throw console.error("ä¿å­˜åˆ°localStorageå¤±è´¥:",a),new Error("æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨ç©ºé—´")}this.showSuccessToast("é¡¹ç›®å‘å¸ƒæˆåŠŸï¼"),setTimeout(()=>{this.$router.push("/project-square")},1e3)}catch(t){console.error("å‘å¸ƒé¡¹ç›®å¤±è´¥:",t),console.error("é”™è¯¯å¯¹è±¡:",t),console.error("é”™è¯¯è¯¦æƒ…:",t.message),console.error("é”™è¯¯ä»£ç :",t.code),console.error("é”™è¯¯æ•°æ®:",t.data),console.error("è¡¨å•æ•°æ®:",this.formData),console.error("é¡¹ç›®å›¾ç‰‡:",this.projectImage);let e="å‘å¸ƒé¡¹ç›®å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚";t.message&&(e+=`\né”™è¯¯ä¿¡æ¯: ${t.message}`),t.code&&(e+=`\né”™è¯¯ä»£ç : ${t.code}`),this.showErrorModal(e)}finally{this.isSubmitting=!1}}},async dataURLtoBlob(t){return new Promise((e,s)=>{try{const s=t.split(","),a=s[0].match(/:(.*?);/)[1],i=atob(s[1]);let o=i.length;const r=new Uint8Array(o);while(o--)r[o]=i.charCodeAt(o);e(new Blob([r],{type:a}))}catch(a){s(a)}})}}},Dt=St,jt=(0,_.A)(Dt,It,Ft,!1,null,"3f1d68c4",null),Tt=jt.exports,Pt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"knowledge-base-container"},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",attrs:{"aria-label":"open sidebar"},on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›é¦–é¡µ"},on:{click:t.goToHome}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("çŸ¥è¯†åº“")])])]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"page-header"},[t._m(0),e("div",{staticClass:"page-subtitle"},[e("svg",{staticClass:"subtitle-icon",attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z",fill:"currentColor"}})]),e("span",[t._v("ç®¡ç†æ‚¨å‚ä¸çš„é¡¹ç›®çŸ¥è¯†æ–‡æ¡£ï¼Œéšæ—¶éšåœ°åä½œå…±äº«")])])]),e("div",{staticClass:"toolbar"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"search-input",attrs:{type:"text",placeholder:"æœç´¢é¡¹ç›®åç§°"},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),e("div",{staticClass:"toolbar-actions"},[e("div",{staticClass:"dropdown",on:{click:function(e){return e.stopPropagation(),t.toggleStatusDropdown.apply(null,arguments)}}},[e("button",{staticClass:"btn secondary"},[e("span",[t._v("é¡¹ç›®çŠ¶æ€")]),e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.statusOpen?e("ul",{staticClass:"dropdown-menu"},[e("li",{staticClass:"dropdown-item",class:{active:""===t.selectedStatus},on:{click:function(e){return t.selectStatus("")}}},[t._v("å…¨éƒ¨")]),e("li",{staticClass:"dropdown-item",class:{active:"è¿›è¡Œä¸­"===t.selectedStatus},on:{click:function(e){return t.selectStatus("è¿›è¡Œä¸­")}}},[t._v("è¿›è¡Œä¸­")]),e("li",{staticClass:"dropdown-item",class:{active:"ç¨³å¥ä¸­"===t.selectedStatus},on:{click:function(e){return t.selectStatus("ç¨³å¥ä¸­")}}},[t._v("ç¨³å¥ä¸­")]),e("li",{staticClass:"dropdown-item",class:{active:"å·²å®Œæˆ"===t.selectedStatus},on:{click:function(e){return t.selectStatus("å·²å®Œæˆ")}}},[t._v("å·²å®Œæˆ")])]):t._e()]),e("button",{staticClass:"btn",on:{click:t.resetFilters}},[t._v("é‡ç½®ç­›é€‰")])])]),e("div",{staticClass:"content-wrapper"},[e("div",{staticClass:"grid"},t._l(t.paginatedProjects,function(s,a){return e("div",{key:s.id,staticClass:"card",on:{click:function(e){return t.viewProjectKnowledge(s)}}},[e("div",{staticClass:"card-media",class:"gradient-"+(s.id%6+1)},[s.image?e("img",{staticClass:"project-image",attrs:{src:s.image,alt:s.title}}):e("div",{staticClass:"no-image-placeholder"},[e("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M12 3V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"card-body"},[e("div",{staticClass:"card-title-row"},[e("h3",{staticClass:"card-title"},[t._v(t._s(s.title))]),e("span",{staticClass:"status-badge",class:t.statusClass(s.status)},[t._v(t._s(s.status))])]),e("ul",{staticClass:"meta-list"},[e("li",[e("span",{staticClass:"meta-label"},[t._v("å›¢é˜Ÿè§„æ¨¡ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.getTeamSizeDisplay(s))+"äºº")])]),s.startDate&&s.endDate?e("li",[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®å‘¨æœŸï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.formatDateRange(s.startDate,s.endDate)))])]):s.period?e("li",[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®å‘¨æœŸï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(s.period))])]):t._e(),s.tags&&s.tags.length>0?e("li",[e("span",{staticClass:"meta-label"},[t._v("æ ‡ç­¾ï¼š")]),e("span",{staticClass:"meta-value"},t._l(s.tags,function(a,i){return e("span",{key:i,staticClass:"tag-item"},[t._v(" "+t._s(a)+t._s(i<s.tags.length-1?"ã€":"")+" ")])}),0)]):t._e()])])])}),0),e("div",{staticClass:"pagination"},[e("button",{staticClass:"pager",attrs:{disabled:1===t.currentPage},on:{click:t.goPrev}},[t._v("â—€")]),t._l(t.totalPages,function(s){return e("button",{key:s,staticClass:"page-num",class:{active:s===t.currentPage},on:{click:function(e){return t.goPage(s)}}},[t._v(t._s(s))])}),e("button",{staticClass:"pager",attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.goNext}},[t._v("â–¶")])],2)])])],1)},Mt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-title"},[e("span",{staticClass:"title-text"},[t._v("æˆ‘çš„çŸ¥è¯†åº“")]),e("div",{staticClass:"title-decoration"})])}],xt={name:"KnowledgeBase",components:{Sidebar:rt},data(){return{sidebarOpen:!1,joinedProjects:[],searchText:"",selectedStatus:"",statusOpen:!1,currentPage:1,pageSize:8}},computed:{filteredProjects(){const t=this.searchText.trim().toLowerCase();return this.joinedProjects.filter(e=>{const s=!t||e.title.toLowerCase().includes(t),a=!this.selectedStatus||e.status===this.selectedStatus;return s&&a})},totalPages(){return Math.max(1,Math.ceil(this.filteredProjects.length/this.pageSize))},paginatedProjects(){const t=(this.currentPage-1)*this.pageSize,e=this.filteredProjects.slice(t,t+this.pageSize);return console.log("å½“å‰é¡µ:",this.currentPage,"æ¯é¡µå¤§å°:",this.pageSize,"è¿‡æ»¤åé¡¹ç›®æ•°:",this.filteredProjects.length,"å½“å‰é¡µé¡¹ç›®æ•°:",e.length),e}},mounted(){this.loadUserProjects(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},methods:{async loadUserProjects(){const t=JSON.parse(localStorage.getItem("projects")||"[]"),e=[{id:101,title:"å¤šæ¨¡æ€åŒ»å­¦å½±åƒæ•°æ®å¹³å°",category:"åŒ»ç–—å¥åº·",status:"ç¨³å¥ä¸­",teamSize:8,startDate:"2025-01-15",endDate:"2025-12-31",tags:["åŒ»å­¦å½±åƒ","æ·±åº¦å­¦ä¹ ","è‚¿ç˜¤æ£€æµ‹"],isJoined:!0},{id:102,title:"æ°”å€™å˜åŒ–é¢„æµ‹æ¨¡å‹ç ”ç©¶",category:"ç¯å¢ƒæ°”å€™",status:"è¿›è¡Œä¸­",teamSize:12,startDate:"2025-02-01",endDate:"2025-11-30",tags:["æ°”å€™å˜åŒ–","LSTM","æ—¶åºé¢„æµ‹"],isJoined:!0},{id:103,title:"åŸºå› ç»„æ•°æ®åˆ†æå¹³å°",category:"ç”Ÿç‰©ä¿¡æ¯",status:"è¿›è¡Œä¸­",teamSize:6,startDate:"2025-01-01",endDate:"2025-10-31",tags:["åŸºå› ç»„","å›¾ç¥ç»ç½‘ç»œ","ç”Ÿç‰©ä¿¡æ¯"],isJoined:!0}],s=t.map(t=>({...t,status:t.status||"è¿›è¡Œä¸­",teamSize:this.getTeamSize(t),startDate:t.startDate||t.createdAt,endDate:t.endDate||t.updatedAt,tags:t.tags||[],isJoined:!0}));this.joinedProjects=[...s,...e],console.log("å¼€å§‹ä¸ºçŸ¥è¯†åº“é¡¹ç›®è·å–çœŸå®å›¢é˜Ÿæˆå‘˜æ•°é‡...");const a=this.joinedProjects.map(async t=>{if(t.id)try{const e=await this.getTeamSize(t.id);this.$set(t,"memberCount",e),this.$set(t,"teamSize",e),console.log(`âœ… é¡¹ç›® ${t.id} (${t.title}) å›¢é˜Ÿè§„æ¨¡:`,e)}catch(e){console.warn(`è·å–é¡¹ç›® ${t.id} æˆå‘˜æ•°é‡å¤±è´¥:`,e)}else console.warn("é¡¹ç›®ç¼ºå°‘IDï¼Œè·³è¿‡:",t)});await Promise.all(a),console.log("æ‰€æœ‰é¡¹ç›®çš„æˆå‘˜æ•°é‡è·å–å®Œæˆ"),this.$forceUpdate(),console.log("ç”¨æˆ·åˆ›å»ºçš„é¡¹ç›®æ•°é‡:",s.length),console.log("é»˜è®¤å‚ä¸é¡¹ç›®æ•°é‡:",e.length),console.log("çŸ¥è¯†åº“æ€»é¡¹ç›®æ•°é‡:",this.joinedProjects.length),console.log("çŸ¥è¯†åº“é¡¹ç›®åˆ—è¡¨:",this.joinedProjects)},getTeamSizeDisplay(t){if(t.memberCount)return t.memberCount;if(t.teamSize)return t.teamSize;try{const e=localStorage.getItem(`project_member_count_${t.id}`),s=e?parseInt(e,10):NaN;if(!isNaN(s)&&s>0)return s}catch(e){}return 1},async getTeamSize(t){const e="object"===typeof t?t.id:t,s="object"===typeof t?t:null;if(!e){if(s){if(s.teamSize)return s.teamSize;if(s.memberCount)return s.memberCount;if(s.team&&Array.isArray(s.team))return s.team.length}return 1}try{const t=localStorage.getItem(`project_member_count_${e}`),s=t?parseInt(t,10):NaN;if(!isNaN(s)&&s>0)return console.log(`ä»ç¼“å­˜è¯»å–é¡¹ç›® ${e} çš„å›¢é˜Ÿæˆå‘˜æ•°é‡:`,s),s}catch(a){console.warn("è¯»å–å›¢é˜Ÿæˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:",a)}try{console.log("ä»APIè·å–é¡¹ç›®",e,"çš„å›¢é˜Ÿæˆå‘˜æ•°é‡");const t=await ut.projectAPI.getProjectMembers(e,0,1e3);if(t&&200===t.code){let s=0;if(t.data&&t.data.content?s=t.data.content.length:Array.isArray(t.data)&&(s=t.data.length),s>0)try{localStorage.setItem(`project_member_count_${e}`,String(s)),console.log(`âœ… å·²ç¼“å­˜é¡¹ç›® ${e} çš„å›¢é˜Ÿæˆå‘˜æ•°é‡:`,s)}catch(a){console.warn("å†™å…¥æˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:",a?.message||a)}return s>0?s:1}}catch(i){console.warn(`è·å–é¡¹ç›® ${e} æˆå‘˜æ•°é‡å¤±è´¥:`,i)}if(s){if(s.memberCount)return s.memberCount;if(s.teamSize)return s.teamSize;if(s.team&&Array.isArray(s.team))return s.team.length}return 1},formatDateRange(t,e){if(!t||!e)return"æœªè®¾ç½®";const s=new Date(t).toLocaleDateString("zh-CN"),a=new Date(e).toLocaleDateString("zh-CN");return`${s} è‡³ ${a}`},statusClass(t){const e={"è¿›è¡Œä¸­":"status-active","ç¨³å¥ä¸­":"status-stable","å·²å®Œæˆ":"status-completed","æš‚åœ":"status-paused","è®¡åˆ’ä¸­":"status-planned"};return e[t]||"status-default"},toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},goToHome(){this.$router.push("/home")},viewProjectKnowledge(t){this.$router.push(`/project-knowledge/${t.id}`)},statusClass(t){const e={"ç¨³å¥ä¸­":"stable","è¿›è¡Œä¸­":"progress","å·²å®Œæˆ":"completed",ONGOING:"progress",COMPLETED:"completed"};return e[t]||"stable"},handleClickOutside(t){t.target.closest(".dropdown")||(this.statusOpen=!1)},toggleStatusDropdown(){this.statusOpen=!this.statusOpen},selectStatus(t){this.selectedStatus=t,this.statusOpen=!1,this.currentPage=1},resetFilters(){this.searchText="",this.selectedStatus="",this.currentPage=1},goPrev(){this.currentPage>1&&this.currentPage--},goNext(){this.currentPage<this.totalPages&&this.currentPage++},goPage(t){this.currentPage=t}}},At=xt,Nt=(0,_.A)(At,Pt,Mt,!1,null,null,null),$t=Nt.exports,Lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"catalog-view"},[e("div",{staticClass:"page-header"},[e("div",{staticClass:"header-content"},[e("div",{staticClass:"header-title-section"},[t._m(0),e("p",{staticClass:"page-subtitle"},[e("svg",{staticClass:"subtitle-icon",attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("circle",{attrs:{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M12 16V12M12 8H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})]),t._v(" åœ¨è¿™é‡Œæ‚¨å¯ä»¥ä¸Šä¼ å„ç±»æ–°çš„ç ”ç©¶æˆæœï¼Œå¹¶æŸ¥çœ‹å·²æœ‰çš„æˆæœæ¡£æ¡ˆ ")])]),e("button",{staticClass:"archive-toggle-btn",on:{click:function(e){t.showArchivePanel=!t.showArchivePanel}}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 2H5C3.9 2 3 2.9 3 4V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2ZM5 4H8V9H5V4ZM10 4H13V9H10V4ZM8 11V20H5V11H8ZM10 11V20H13V11H10ZM19 20H15V11H19V20ZM15 9V4H19V9H15Z",fill:"currentColor"}})]),e("span",[t._v("å·²æœ‰æˆæœæ¡£æ¡ˆ")])])])]),e("div",{staticClass:"section-card add-achievement-section"},[e("div",{staticClass:"section-title small"},[t._v("æ·»åŠ æ–°æˆæœ")]),e("div",{staticClass:"add-grid"},[e("div",{staticClass:"add-card"},[t._m(1),e("div",{staticClass:"add-desc"},[t._v("ä¸Šä¼ å­¦æœ¯è®ºæ–‡æˆæœ")]),e("button",{staticClass:"add-btn",on:{click:function(e){return t.uploadFile("è®ºæ–‡")}}},[t._v("ä¸Šä¼ è®ºæ–‡")])]),e("div",{staticClass:"add-card"},[t._m(2),e("div",{staticClass:"add-desc"},[t._v("è®°å½•ä¸“åˆ©ä¿¡æ¯")]),e("button",{staticClass:"add-btn",on:{click:function(e){return t.uploadFile("ä¸“åˆ©")}}},[t._v("ä¸Šä¼ ä¸“åˆ©")])]),e("div",{staticClass:"add-card"},[t._m(3),e("div",{staticClass:"add-desc"},[t._v("ä¸Šä¼ ç ”ç©¶æ•°æ®é›†")]),e("button",{staticClass:"add-btn",on:{click:function(e){return t.uploadFile("æ•°æ®é›†")}}},[t._v("ä¸Šä¼ æ•°æ®é›†")])]),e("div",{staticClass:"add-card"},[t._m(4),e("div",{staticClass:"add-desc"},[t._v("å­˜å‚¨å·²è®­ç»ƒæ¨¡å‹")]),e("button",{staticClass:"add-btn",on:{click:function(e){return t.uploadFile("æ¨¡å‹æ–‡ä»¶")}}},[t._v("ä¸Šä¼ æ¨¡å‹")])]),e("div",{staticClass:"add-card"},[t._m(5),e("div",{staticClass:"add-desc"},[t._v("ä¸Šä¼ å®éªŒæŠ¥å‘Šæ–‡æ¡£")]),e("button",{staticClass:"add-btn",on:{click:function(e){return t.uploadFile("å®éªŒæŠ¥å‘Š")}}},[t._v("ä¸Šä¼ æŠ¥å‘Š")])]),e("div",{staticClass:"add-card"},[t._m(6),e("div",{staticClass:"add-desc"},[t._v("åˆ›å»ºè‡ªå®šä¹‰æˆæœç±»å‹")]),e("button",{staticClass:"add-btn",on:{click:t.createCustomType}},[t._v("æ–°å»ºç±»å‹")])])])]),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",multiple:"",accept:t.showViewDialog?"*":t.fileAccept},on:{change:t.handleFileSelect}}),t.showUploadDialog?e("div",{staticClass:"upload-dialog-overlay",on:{click:t.closeUploadDialog}},[e("div",{staticClass:"upload-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("div",{staticClass:"dialog-title-section"},[e("span",{staticClass:"file-type-badge",class:t.getTypeClass(t.currentFileType)},[t._v(t._s(t.currentFileType))]),e("h3",[t._v(t._s(t.isAddingToExisting?"æ·»åŠ æ–‡ä»¶åˆ°ç°æœ‰æˆæœ":"ä¸Šä¼ "+t.currentFileType))])]),e("button",{staticClass:"close-btn",on:{click:t.closeUploadDialog}},[t._v("Ã—")])]),e("div",{staticClass:"dialog-content"},[t.isAddingToExisting?t._e():e("div",{staticClass:"form-group"},[e("label",[t._v("æˆæœåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.name,expression:"achievementForm.name"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æˆæœåç§°"},domProps:{value:t.achievementForm.name},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"name",e.target.value)}}})]),t.isAddingToExisting?e("div",{staticClass:"form-group"},[e("div",{staticClass:"existing-achievement-info"},[e("span",{staticClass:"info-label"},[t._v("æ­£åœ¨ä¸ºæˆæœæ·»åŠ æ–‡ä»¶ï¼š")]),e("span",{staticClass:"achievement-name"},[t._v(t._s(t.getTargetAchievementName()))])])]):t._e(),e("div",{staticClass:"form-group"},[e("label",[t._v("æˆæœè¯¦ç»†æè¿°ï¼š")]),e("div",{staticClass:"description-fields"},["è®ºæ–‡"===t.currentFileType?[e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("ä½œè€…ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.paperAuthors,expression:"achievementForm.paperAuthors"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä½œè€…ï¼ˆå¯å¤šäººï¼Œç”¨é€—å·åˆ†éš”ï¼‰"},domProps:{value:t.achievementForm.paperAuthors},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"paperAuthors",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("è®ºæ–‡æ ‡é¢˜ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.paperTitle,expression:"achievementForm.paperTitle"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥è®ºæ–‡æ ‡é¢˜"},domProps:{value:t.achievementForm.paperTitle},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"paperTitle",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æœŸåˆŠåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.journalName,expression:"achievementForm.journalName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸåˆŠåç§°"},domProps:{value:t.achievementForm.journalName},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"journalName",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("å‘è¡¨å¹´ä»½ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.publishYear,expression:"achievementForm.publishYear"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘è¡¨å¹´ä»½"},domProps:{value:t.achievementForm.publishYear},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"publishYear",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("å·å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.volume,expression:"achievementForm.volume"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥å·å·"},domProps:{value:t.achievementForm.volume},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"volume",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æœŸå·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.issue,expression:"achievementForm.issue"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸå·"},domProps:{value:t.achievementForm.issue},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"issue",e.target.value)}}})])]:"ä¸“åˆ©"===t.currentFileType?[e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("ä¸“åˆ©å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.patentNumber,expression:"achievementForm.patentNumber"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å·"},domProps:{value:t.achievementForm.patentNumber},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"patentNumber",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("ä¸“åˆ©ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.patentType,expression:"achievementForm.patentType"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©ç±»å‹"},domProps:{value:t.achievementForm.patentType},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"patentType",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("ä¸“åˆ©åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.patentName,expression:"achievementForm.patentName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å"},domProps:{value:t.achievementForm.patentName},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"patentName",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("å‘æ˜äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.inventors,expression:"achievementForm.inventors"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘æ˜äººï¼ˆå¯å¤šäººï¼Œç”¨é€—å·åˆ†éš”ï¼‰"},domProps:{value:t.achievementForm.inventors},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"inventors",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("ç”³è¯·äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.applicants,expression:"achievementForm.applicants"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç”³è¯·äººï¼ˆå•ä½æˆ–ä¸ªäººï¼‰"},domProps:{value:t.achievementForm.applicants},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"applicants",e.target.value)}}})])]:"æ•°æ®é›†"===t.currentFileType?[e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ•°æ®é›†ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.datasetVersion,expression:"achievementForm.datasetVersion"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†ç‰ˆæœ¬ï¼ˆå¦‚ï¼šv1.0ï¼‰"},domProps:{value:t.achievementForm.datasetVersion},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"datasetVersion",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ•°æ®é›†åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.datasetName,expression:"achievementForm.datasetName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†å"},domProps:{value:t.achievementForm.datasetName},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"datasetName",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ•°æ®æ ¼å¼ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.datasetFormat,expression:"achievementForm.datasetFormat"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†æ ¼å¼ï¼ˆå¦‚ï¼šCSV, JSON, XMLï¼‰"},domProps:{value:t.achievementForm.datasetFormat},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"datasetFormat",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ•°æ®è§„æ¨¡ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.datasetSize,expression:"achievementForm.datasetSize"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†è§„æ¨¡ï¼ˆå¦‚ï¼š10ä¸‡æ¡è®°å½•ï¼‰"},domProps:{value:t.achievementForm.datasetSize},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"datasetSize",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ•°æ®æ¥æºï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.datasetSource,expression:"achievementForm.datasetSource"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†æ¥æºï¼ˆå¦‚ï¼šå…¬å¼€æ•°æ®é›†ã€è‡ªå»ºæ•°æ®é›†ï¼‰"},domProps:{value:t.achievementForm.datasetSource},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"datasetSource",e.target.value)}}})])]:"æ¨¡å‹æ–‡ä»¶"===t.currentFileType?[e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ¨¡å‹æ¡†æ¶ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.modelFramework,expression:"achievementForm.modelFramework"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹æ¡†æ¶ï¼ˆå¦‚ï¼šTensorFlow, PyTorch, Kerasï¼‰"},domProps:{value:t.achievementForm.modelFramework},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"modelFramework",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ¨¡å‹åç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.modelName,expression:"achievementForm.modelName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},domProps:{value:t.achievementForm.modelName},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"modelName",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ¨¡å‹ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.modelVersion,expression:"achievementForm.modelVersion"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç‰ˆæœ¬ï¼ˆå¦‚ï¼šv1.0, v2.1ï¼‰"},domProps:{value:t.achievementForm.modelVersion},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"modelVersion",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æ¨¡å‹ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.modelType,expression:"achievementForm.modelType"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç±»å‹ï¼ˆå¦‚ï¼šCNN, RNN, Transformerï¼‰"},domProps:{value:t.achievementForm.modelType},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"modelType",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("è¶…å‚æ•°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.hyperparameters,expression:"achievementForm.hyperparameters"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥è¶…å‚æ•°ï¼ˆå¦‚ï¼šlearning_rate=0.001, batch_size=32ï¼‰"},domProps:{value:t.achievementForm.hyperparameters},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"hyperparameters",e.target.value)}}})])]:"å®éªŒæŠ¥å‘Š"===t.currentFileType?[e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æŠ¥å‘Šç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.reportType,expression:"achievementForm.reportType"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šç±»å‹ï¼ˆå¦‚ï¼šå®éªŒæŠ¥å‘Šã€é˜¶æ®µæ€§æŠ¥å‘Šã€æ€»ç»“æŠ¥å‘Šï¼‰"},domProps:{value:t.achievementForm.reportType},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"reportType",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æŠ¥å‘Šåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.reportName,expression:"achievementForm.reportName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šåç§°"},domProps:{value:t.achievementForm.reportName},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"reportName",e.target.value)}}})]),e("div",{staticClass:"description-row"},[e("div",{staticClass:"description-label"},[t._v("æŠ¥å‘Šæ—¥æœŸï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.achievementForm.reportDate,expression:"achievementForm.reportDate"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.achievementForm.reportDate},on:{input:function(e){e.target.composing||t.$set(t.achievementForm,"reportDate",e.target.value)}}})])]:t._e()],2)]),e("div",{staticClass:"form-group"},[e("label",[t._v("ä¸Šä¼ æ–‡ä»¶ï¼š")]),e("div",{staticClass:"file-upload-area"},[t.achievementForm.files.length>0?e("div",{staticClass:"uploaded-files"},t._l(t.achievementForm.files,function(s,a){return e("div",{key:a,staticClass:"file-item"},[e("div",{staticClass:"file-info"},[e("span",{staticClass:"file-icon"},[t._v("ğŸ“„")]),e("span",{staticClass:"file-name"},[t._v(t._s(s.name))]),e("span",{staticClass:"file-size"},[t._v("("+t._s(t.formatFileSize(s.size))+")")])]),e("button",{staticClass:"remove-file-btn",attrs:{title:"åˆ é™¤æ–‡ä»¶"},on:{click:function(e){return t.removeFile(a)}}},[t._v(" Ã— ")])])}),0):t._e(),e("div",{staticClass:"upload-zone",on:{click:t.triggerFileSelect}},[e("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M12 3V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("p",[t._v("ç‚¹å‡»æ·»åŠ æ–‡ä»¶")]),e("p",{staticClass:"upload-hint"},[t._v("æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ")])])])]),e("div",{staticClass:"dialog-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.closeUploadDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:!t.isAddingToExisting&&!t.achievementForm.name.trim()||0===t.achievementForm.files.length},on:{click:t.confirmUpload}},[t._v(" ç¡®è®¤ä¸Šä¼  ")])])])])]):t._e(),t.showCustomDialog?e("div",{staticClass:"upload-dialog-overlay",on:{click:t.closeCustomDialog}},[e("div",{staticClass:"upload-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("div",{staticClass:"dialog-title-section"},[e("span",{staticClass:"file-type-badge doc"},[t._v(t._s(t.customUploadForm.typeName||"è‡ªå®šä¹‰"))]),e("h3",[t._v("åˆ›å»ºè‡ªå®šä¹‰ç±»å‹å¹¶ä¸Šä¼ ")])]),e("button",{staticClass:"close-btn",on:{click:t.closeCustomDialog}},[t._v("Ã—")])]),e("div",{staticClass:"dialog-content"},[e("div",{staticClass:"form-group"},[e("label",[t._v("ç±»å‹åç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.customUploadForm.typeName,expression:"customUploadForm.typeName"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç±»å‹åç§°"},domProps:{value:t.customUploadForm.typeName},on:{input:function(e){e.target.composing||t.$set(t.customUploadForm,"typeName",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("æˆæœåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.customUploadForm.name,expression:"customUploadForm.name"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥æˆæœåç§°"},domProps:{value:t.customUploadForm.name},on:{input:function(e){e.target.composing||t.$set(t.customUploadForm,"name",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("æˆæœè¯¦ç»†æè¿°ï¼š")]),e("div",{staticClass:"description-fields"},[t._l(t.customUploadForm.descriptions,function(s,a){return e("div",{key:a,staticClass:"description-field"},[e("div",{staticClass:"description-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:s.leftField,expression:"desc.leftField"}],staticClass:"form-input form-input-small",attrs:{type:"text",placeholder:""},domProps:{value:s.leftField},on:{input:function(e){e.target.composing||t.$set(s,"leftField",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:s.rightField,expression:"desc.rightField"}],staticClass:"form-input form-input-large",attrs:{type:"text",placeholder:""},domProps:{value:s.rightField},on:{input:function(e){e.target.composing||t.$set(s,"rightField",e.target.value)}}}),t.customUploadForm.descriptions.length>1?e("button",{staticClass:"remove-desc-btn",attrs:{title:"åˆ é™¤æ­¤è¡Œ"},on:{click:function(e){return t.removeCustomDescription(a)}}},[t._v(" Ã— ")]):t._e()])])}),e("button",{staticClass:"add-desc-btn",on:{click:t.addCustomDescription}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" æ·»åŠ æè¿° ")])],2)]),e("div",{staticClass:"form-group"},[e("label",[t._v("ä¸Šä¼ æ–‡ä»¶ï¼š")]),e("div",{staticClass:"file-upload-area"},[t.customUploadForm.files.length>0?e("div",{staticClass:"uploaded-files"},t._l(t.customUploadForm.files,function(s,a){return e("div",{key:a,staticClass:"file-item"},[e("div",{staticClass:"file-info"},[e("span",{staticClass:"file-icon"},[t._v("ğŸ“„")]),e("span",{staticClass:"file-name"},[t._v(t._s(s.name))]),e("span",{staticClass:"file-size"},[t._v("("+t._s(t.formatFileSize(s.size))+")")])]),e("button",{staticClass:"remove-file-btn",attrs:{title:"åˆ é™¤æ–‡ä»¶"},on:{click:function(e){return t.removeCustomFile(a)}}},[t._v(" Ã— ")])])}),0):t._e(),e("div",{staticClass:"upload-zone",on:{click:t.triggerCustomFileSelect}},[e("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M12 3V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("p",[t._v("ç‚¹å‡»æ·»åŠ æ–‡ä»¶")]),e("p",{staticClass:"upload-hint"},[t._v("æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ")])])])]),e("div",{staticClass:"dialog-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.closeCustomDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:!t.customUploadForm.typeName.trim()||!t.customUploadForm.name.trim()||0===t.customUploadForm.files.length},on:{click:t.confirmCustomType}},[t._v(" ç¡®è®¤åˆ›å»º ")])])])])]):t._e(),t.showViewDialog?e("div",{staticClass:"file-view-overlay",on:{click:t.closeViewDialog}},[e("div",{staticClass:"file-view-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"file-view-header"},[e("div",{staticClass:"file-info"},[e("div",{staticClass:"achievement-badge",class:t.viewingFile?.typeCls},[e("span",{staticClass:"achievement-icon"},[t._v(t._s(t.getFileIcon(t.viewingFile?.name||"")))])]),e("div",{staticClass:"achievement-info"},[e("h3",[t._v(t._s(t.viewingFile?.name))]),t.viewingFile?.fileCount&&t.viewingFile.fileCount>1?e("div",{staticClass:"file-count-info"},[e("span",{staticClass:"count-icon"},[t._v("ğŸ“")]),t._v(" åŒ…å« "+t._s(t.viewingFile.fileCount)+" ä¸ªæ–‡ä»¶ ")]):t._e()])]),e("button",{staticClass:"close-btn",on:{click:t.closeViewDialog}},[e("svg",{attrs:{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"file-view-content"},[t.viewingFile?.files&&t.viewingFile.files.length>1?e("div",{staticClass:"multi-file-content"},[e("div",{staticClass:"file-list"},t._l(t.viewingFile.files,function(s,a){return e("div",{key:s.id||a,staticClass:"file-item",class:{active:t.selectedFileIndex===a},on:{click:function(e){return t.selectFile(a)}}},[e("div",{staticClass:"file-item-info"},[e("div",{staticClass:"file-icon-wrapper"},[e("span",{staticClass:"file-icon"},[t._v(t._s(t.getFileIcon(s.name)))])]),e("div",{staticClass:"file-details"},[e("div",{staticClass:"file-name",attrs:{title:s.name}},[t._v(t._s(s.name||s.originalFileName||"æœªçŸ¥æ–‡ä»¶"))]),e("div",{staticClass:"file-meta"},[e("span",{staticClass:"file-size"},[t._v(t._s(t.formatFileSize(s.size)))]),e("span",{staticClass:"file-separator"},[t._v("â€¢")]),e("span",{staticClass:"file-type"},[t._v(t._s(t.getFileTypeDisplay(s.type)))])])])]),e("div",{staticClass:"file-actions"},[e("button",{staticClass:"action-btn download-btn",attrs:{title:"ä¸‹è½½"},on:{click:function(e){return e.stopPropagation(),t.downloadSingleFile(s)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M17 8L12 3L7 8",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M12 3V15",stroke:"currentColor","stroke-width":"2"}})])]),e("button",{staticClass:"action-btn delete-btn",attrs:{title:"åˆ é™¤"},on:{click:function(e){return e.stopPropagation(),t.deleteSingleFile(s,a)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2"}})])])])])}),0),t.viewingFile?e("div",{staticClass:"achievement-description"},[e("div",{staticClass:"description-header"},[e("div",{staticClass:"detail-label"},[t._v("æˆæœè¯¦ç»†æè¿°ï¼š")]),t.isEditingDescription?e("div",{staticClass:"edit-actions"},[e("button",{staticClass:"save-btn",on:{click:t.saveDescriptionChanges}},[t._v("ä¿å­˜")]),e("button",{staticClass:"cancel-btn",on:{click:t.cancelEditMode}},[t._v("å–æ¶ˆ")])]):e("button",{staticClass:"edit-btn",on:{click:t.toggleEditMode}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç¼–è¾‘ ")])]),t.isEditingDescription?e("div",{staticClass:"description-edit-form"},[e("div",{staticClass:"edit-fields"},["è®ºæ–‡"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("ä½œè€…ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.paperAuthors,expression:"editForm.paperAuthors"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä½œè€…"},domProps:{value:t.editForm.paperAuthors},on:{input:function(e){e.target.composing||t.$set(t.editForm,"paperAuthors",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("è®ºæ–‡æ ‡é¢˜ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.paperTitle,expression:"editForm.paperTitle"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥è®ºæ–‡æ ‡é¢˜"},domProps:{value:t.editForm.paperTitle},on:{input:function(e){e.target.composing||t.$set(t.editForm,"paperTitle",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æœŸåˆŠåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.journalName,expression:"editForm.journalName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸåˆŠåç§°"},domProps:{value:t.editForm.journalName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"journalName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å‘è¡¨å¹´ä»½ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.publishYear,expression:"editForm.publishYear"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘è¡¨å¹´ä»½"},domProps:{value:t.editForm.publishYear},on:{input:function(e){e.target.composing||t.$set(t.editForm,"publishYear",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å·å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.volume,expression:"editForm.volume"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å·å·"},domProps:{value:t.editForm.volume},on:{input:function(e){e.target.composing||t.$set(t.editForm,"volume",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æœŸå·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.issue,expression:"editForm.issue"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸå·"},domProps:{value:t.editForm.issue},on:{input:function(e){e.target.composing||t.$set(t.editForm,"issue",e.target.value)}}})])]:"ä¸“åˆ©"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentNumber,expression:"editForm.patentNumber"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å·"},domProps:{value:t.editForm.patentNumber},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentNumber",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentType,expression:"editForm.patentType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©ç±»å‹"},domProps:{value:t.editForm.patentType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentName,expression:"editForm.patentName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å"},domProps:{value:t.editForm.patentName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å‘æ˜äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.inventors,expression:"editForm.inventors"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘æ˜äºº"},domProps:{value:t.editForm.inventors},on:{input:function(e){e.target.composing||t.$set(t.editForm,"inventors",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ç”³è¯·äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.applicants,expression:"editForm.applicants"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç”³è¯·äºº"},domProps:{value:t.editForm.applicants},on:{input:function(e){e.target.composing||t.$set(t.editForm,"applicants",e.target.value)}}})])]:"æ•°æ®é›†"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®é›†ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetVersion,expression:"editForm.datasetVersion"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†ç‰ˆæœ¬"},domProps:{value:t.editForm.datasetVersion},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetVersion",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®é›†åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetName,expression:"editForm.datasetName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†å"},domProps:{value:t.editForm.datasetName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®æ ¼å¼ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetFormat,expression:"editForm.datasetFormat"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®æ ¼å¼"},domProps:{value:t.editForm.datasetFormat},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetFormat",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®è§„æ¨¡ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetSize,expression:"editForm.datasetSize"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®è§„æ¨¡"},domProps:{value:t.editForm.datasetSize},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetSize",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®æ¥æºï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetSource,expression:"editForm.datasetSource"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®æ¥æº"},domProps:{value:t.editForm.datasetSource},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetSource",e.target.value)}}})])]:"æ¨¡å‹æ–‡ä»¶"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹æ¡†æ¶ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelFramework,expression:"editForm.modelFramework"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹æ¡†æ¶"},domProps:{value:t.editForm.modelFramework},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelFramework",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹åç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelName,expression:"editForm.modelName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},domProps:{value:t.editForm.modelName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelVersion,expression:"editForm.modelVersion"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç‰ˆæœ¬"},domProps:{value:t.editForm.modelVersion},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelVersion",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelType,expression:"editForm.modelType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç±»å‹"},domProps:{value:t.editForm.modelType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("è¶…å‚æ•°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.hyperparameters,expression:"editForm.hyperparameters"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥è¶…å‚æ•°"},domProps:{value:t.editForm.hyperparameters},on:{input:function(e){e.target.composing||t.$set(t.editForm,"hyperparameters",e.target.value)}}})])]:"å®éªŒæŠ¥å‘Š"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportType,expression:"editForm.reportType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šç±»å‹"},domProps:{value:t.editForm.reportType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportName,expression:"editForm.reportName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šåç§°"},domProps:{value:t.editForm.reportName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šæ—¥æœŸï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportDate,expression:"editForm.reportDate"}],attrs:{type:"date"},domProps:{value:t.editForm.reportDate},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportDate",e.target.value)}}})])]:t._e()],2)]):e("div",{staticClass:"description-content"},["è®ºæ–‡"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä½œè€…ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.paperAuthors||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("è®ºæ–‡æ ‡é¢˜ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.paperTitle||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æœŸåˆŠåç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.journalName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å‘è¡¨å¹´ä»½ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.publishYear||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å·å·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.volume||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æœŸå·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.issue||"æœªå¡«å†™"))])])]):"ä¸“åˆ©"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©å·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentNumber||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©ç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©åï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å‘æ˜äººï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.inventors||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ç”³è¯·äººï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.applicants||"æœªå¡«å†™"))])])]):"æ•°æ®é›†"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®é›†ç‰ˆæœ¬ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetVersion||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®é›†åï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®æ ¼å¼ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetFormat||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®è§„æ¨¡ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetSize||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®æ¥æºï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetSource||"æœªå¡«å†™"))])])]):"æ¨¡å‹æ–‡ä»¶"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹æ¡†æ¶ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelFramework||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹åç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹ç‰ˆæœ¬ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelVersion||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹ç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("è¶…å‚æ•°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.hyperparameters||"æœªå¡«å†™"))])])]):"å®éªŒæŠ¥å‘Š"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šåç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šæ—¥æœŸï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportDate||"æœªå¡«å†™"))])])]):t._e()])]):t._e()]):e("div",["text"===t.fileContentType?e("div",{staticClass:"text-content"},[e("div",{staticClass:"content-header"},[e("h4",[t._v("æ–‡æ¡£å†…å®¹")]),e("div",{staticClass:"content-actions"},[t.isEditingContent?e("div",{staticClass:"content-edit-actions"},[e("button",{staticClass:"save-content-btn",attrs:{disabled:!t.hasContentChanges},on:{click:t.saveContentChanges}},[t._v("ä¿å­˜")]),e("button",{staticClass:"cancel-content-btn",on:{click:t.cancelContentEdit}},[t._v("å–æ¶ˆ")])]):e("button",{staticClass:"edit-content-btn",on:{click:t.toggleContentEdit}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç¼–è¾‘ ")])])]),e("div",{staticClass:"content-body"},[t.isEditingContent?e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editableContent,expression:"editableContent"}],staticClass:"content-editor",attrs:{placeholder:"è¯·è¾“å…¥æ–‡æ¡£å†…å®¹..."},domProps:{value:t.editableContent},on:{input:[function(e){e.target.composing||(t.editableContent=e.target.value)},t.markContentChanged]}}):e("pre",{staticClass:"content-display"},[t._v(t._s(t.fileContent))])])]):"image"===t.fileContentType?e("div",{staticClass:"image-content"},[e("img",{attrs:{src:t.fileContent,alt:t.viewingFile?.name}})]):"pdf"===t.fileContentType?e("div",{staticClass:"pdf-content"},[e("iframe",{attrs:{src:t.fileContent,width:"100%",height:"500px"}})]):"info"===t.fileContentType?e("div",{staticClass:"info-content"},[e("div",{staticClass:"file-details"},[e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-label"},[t._v("æ–‡ä»¶åï¼š")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.fileContent.name))])]),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-label"},[t._v("æ–‡ä»¶ç±»å‹ï¼š")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.fileContent.type))])]),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-label"},[t._v("ä¸Šä¼ è€…ï¼š")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.fileContent.uploader))])]),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-label"},[t._v("ä¸Šä¼ æ—¶é—´ï¼š")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.fileContent.time))])]),e("div",{staticClass:"detail-item"},[e("span",{staticClass:"detail-label"},[t._v("æ–‡ä»¶å¤§å°ï¼š")]),e("span",{staticClass:"detail-value"},[t._v(t._s(t.fileContent.size))])]),t.viewingFile?e("div",{staticClass:"achievement-description"},[e("div",{staticClass:"description-header"},[e("div",{staticClass:"detail-label"},[t._v("æˆæœè¯¦ç»†æè¿°ï¼š")]),t.isEditingDescription?e("div",{staticClass:"edit-actions"},[e("button",{staticClass:"save-btn",on:{click:t.saveDescriptionChanges}},[t._v("ä¿å­˜")]),e("button",{staticClass:"cancel-btn",on:{click:t.cancelEditMode}},[t._v("å–æ¶ˆ")])]):e("button",{staticClass:"edit-btn",on:{click:t.toggleEditMode}},[t._v("ç¼–è¾‘")])]),t.isEditingDescription?e("div",{staticClass:"description-edit-form"},[e("div",{staticClass:"edit-fields"},["è®ºæ–‡"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("ä½œè€…ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.paperAuthors,expression:"editForm.paperAuthors"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä½œè€…"},domProps:{value:t.editForm.paperAuthors},on:{input:function(e){e.target.composing||t.$set(t.editForm,"paperAuthors",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("è®ºæ–‡æ ‡é¢˜ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.paperTitle,expression:"editForm.paperTitle"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥è®ºæ–‡æ ‡é¢˜"},domProps:{value:t.editForm.paperTitle},on:{input:function(e){e.target.composing||t.$set(t.editForm,"paperTitle",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æœŸåˆŠåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.journalName,expression:"editForm.journalName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸåˆŠåç§°"},domProps:{value:t.editForm.journalName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"journalName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å‘è¡¨å¹´ä»½ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.publishYear,expression:"editForm.publishYear"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘è¡¨å¹´ä»½"},domProps:{value:t.editForm.publishYear},on:{input:function(e){e.target.composing||t.$set(t.editForm,"publishYear",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å·å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.volume,expression:"editForm.volume"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å·å·"},domProps:{value:t.editForm.volume},on:{input:function(e){e.target.composing||t.$set(t.editForm,"volume",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æœŸå·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.issue,expression:"editForm.issue"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æœŸå·"},domProps:{value:t.editForm.issue},on:{input:function(e){e.target.composing||t.$set(t.editForm,"issue",e.target.value)}}})])]:"ä¸“åˆ©"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©å·ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentNumber,expression:"editForm.patentNumber"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å·"},domProps:{value:t.editForm.patentNumber},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentNumber",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentType,expression:"editForm.patentType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©ç±»å‹"},domProps:{value:t.editForm.patentType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ä¸“åˆ©åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.patentName,expression:"editForm.patentName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä¸“åˆ©å"},domProps:{value:t.editForm.patentName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"patentName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("å‘æ˜äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.inventors,expression:"editForm.inventors"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥å‘æ˜äºº"},domProps:{value:t.editForm.inventors},on:{input:function(e){e.target.composing||t.$set(t.editForm,"inventors",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("ç”³è¯·äººï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.applicants,expression:"editForm.applicants"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç”³è¯·äºº"},domProps:{value:t.editForm.applicants},on:{input:function(e){e.target.composing||t.$set(t.editForm,"applicants",e.target.value)}}})])]:"æ•°æ®é›†"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®é›†ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetVersion,expression:"editForm.datasetVersion"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†ç‰ˆæœ¬"},domProps:{value:t.editForm.datasetVersion},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetVersion",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®é›†åï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetName,expression:"editForm.datasetName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®é›†å"},domProps:{value:t.editForm.datasetName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®æ ¼å¼ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetFormat,expression:"editForm.datasetFormat"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®æ ¼å¼"},domProps:{value:t.editForm.datasetFormat},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetFormat",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®è§„æ¨¡ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetSize,expression:"editForm.datasetSize"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®è§„æ¨¡"},domProps:{value:t.editForm.datasetSize},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetSize",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ•°æ®æ¥æºï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.datasetSource,expression:"editForm.datasetSource"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ•°æ®æ¥æº"},domProps:{value:t.editForm.datasetSource},on:{input:function(e){e.target.composing||t.$set(t.editForm,"datasetSource",e.target.value)}}})])]:"æ¨¡å‹æ–‡ä»¶"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹æ¡†æ¶ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelFramework,expression:"editForm.modelFramework"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹æ¡†æ¶"},domProps:{value:t.editForm.modelFramework},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelFramework",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹åç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelName,expression:"editForm.modelName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹åç§°"},domProps:{value:t.editForm.modelName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹ç‰ˆæœ¬ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelVersion,expression:"editForm.modelVersion"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç‰ˆæœ¬"},domProps:{value:t.editForm.modelVersion},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelVersion",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æ¨¡å‹ç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.modelType,expression:"editForm.modelType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ¨¡å‹ç±»å‹"},domProps:{value:t.editForm.modelType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"modelType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("è¶…å‚æ•°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.hyperparameters,expression:"editForm.hyperparameters"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥è¶…å‚æ•°"},domProps:{value:t.editForm.hyperparameters},on:{input:function(e){e.target.composing||t.$set(t.editForm,"hyperparameters",e.target.value)}}})])]:"å®éªŒæŠ¥å‘Š"===t.viewingFile.type?[e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šç±»å‹ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportType,expression:"editForm.reportType"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šç±»å‹"},domProps:{value:t.editForm.reportType},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportType",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šåç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportName,expression:"editForm.reportName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æŠ¥å‘Šåç§°"},domProps:{value:t.editForm.reportName},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportName",e.target.value)}}})]),e("div",{staticClass:"edit-field"},[e("label",[t._v("æŠ¥å‘Šæ—¥æœŸï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editForm.reportDate,expression:"editForm.reportDate"}],attrs:{type:"date"},domProps:{value:t.editForm.reportDate},on:{input:function(e){e.target.composing||t.$set(t.editForm,"reportDate",e.target.value)}}})])]:t._e()],2)]):e("div",{staticClass:"description-content"},["è®ºæ–‡"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä½œè€…ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.paperAuthors||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("è®ºæ–‡æ ‡é¢˜ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.paperTitle||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æœŸåˆŠåç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.journalName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å‘è¡¨å¹´ä»½ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.publishYear||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å·å·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.volume||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æœŸå·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.issue||"æœªå¡«å†™"))])])]):"ä¸“åˆ©"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©å·ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentNumber||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©ç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ä¸“åˆ©åï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.patentName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("å‘æ˜äººï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.inventors||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("ç”³è¯·äººï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.applicants||"æœªå¡«å†™"))])])]):"æ•°æ®é›†"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®é›†ç‰ˆæœ¬ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetVersion||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®é›†åï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®æ ¼å¼ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetFormat||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®è§„æ¨¡ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetSize||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ•°æ®æ¥æºï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.datasetSource||"æœªå¡«å†™"))])])]):"æ¨¡å‹æ–‡ä»¶"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹æ¡†æ¶ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelFramework||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹åç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹ç‰ˆæœ¬ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelVersion||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æ¨¡å‹ç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.modelType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("è¶…å‚æ•°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.hyperparameters||"æœªå¡«å†™"))])])]):"å®éªŒæŠ¥å‘Š"===t.viewingFile.type?e("div",{staticClass:"description-fields"},[e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šç±»å‹ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportType||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šåç§°ï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportName||"æœªå¡«å†™"))])]),e("div",{staticClass:"description-item"},[e("span",{staticClass:"desc-label"},[t._v("æŠ¥å‘Šæ—¥æœŸï¼š")]),e("span",{staticClass:"desc-value"},[t._v(t._s(t.viewingFile.reportDate||"æœªå¡«å†™"))])])]):t._e()])]):t._e()]),t._m(7)]):t._e()])]),e("div",{staticClass:"file-view-footer"},[e("div",{staticClass:"footer-left"},[e("button",{staticClass:"add-file-btn",on:{click:t.showAddFileDialog}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" æ·»åŠ æ–‡ä»¶åˆ°æ­¤æˆæœ ")]),e("div",{staticClass:"status-selector"},[e("label",[t._v("æˆæœçŠ¶æ€ï¼š")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.viewingFile.status,expression:"viewingFile.status"}],staticClass:"status-select",on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.viewingFile,"status",e.target.multiple?s:s[0])},t.handleStatusChange]}},[e("option",{attrs:{value:"draft"}},[t._v("è‰ç¨¿")]),e("option",{attrs:{value:"under_review"}},[t._v("å®¡æ ¸ä¸­")]),e("option",{attrs:{value:"published"}},[t._v("å·²å‘å¸ƒ")]),e("option",{attrs:{value:"obsolete"}},[t._v("å·²å½’æ¡£")])])])]),e("div",{staticClass:"footer-right"},[e("button",{staticClass:"btn secondary",on:{click:t.closeViewDialog}},[t._v("å…³é—­")]),t.viewingFile?.files&&t.viewingFile.files.length>1?e("button",{staticClass:"btn primary",on:{click:function(e){return t.downloadAllFiles(t.viewingFile)}}},[t._v("ä¸‹è½½å…¨éƒ¨")]):e("button",{staticClass:"btn primary",on:{click:function(e){return t.downloadFile(t.viewingFile)}}},[t._v("ä¸‹è½½")])])])])]):t._e(),t.showArchivePanel?e("div",{staticClass:"archive-overlay",on:{click:function(e){t.showArchivePanel=!1}}}):t._e(),e("div",{staticClass:"archive-slide-panel notranslate",class:{open:t.showArchivePanel},attrs:{translate:"no"}},[e("div",{staticClass:"panel-header"},[e("div",{staticClass:"panel-title"},[t._v("å·²æœ‰æˆæœæ¡£æ¡ˆ")]),e("button",{staticClass:"panel-close-btn",on:{click:function(e){t.showArchivePanel=!1}}},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"panel-content"},[e("div",{staticClass:"search-section"},[e("div",{staticClass:"search-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"search-input",attrs:{type:"text",placeholder:"æœç´¢æˆæœåç§°ã€ç±»å‹æˆ–ä¸Šä¼ è€…..."},domProps:{value:t.searchText},on:{input:[function(e){e.target.composing||(t.searchText=e.target.value)},t.onSearchInput]}}),e("div",{staticClass:"search-icon"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.searchText?e("button",{staticClass:"clear-search-btn",attrs:{title:"æ¸…é™¤æœç´¢"},on:{click:t.clearSearch}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e()]),t.searchText?e("div",{staticClass:"search-results-info"},[t._v(" æ‰¾åˆ° "+t._s(t.filteredFiles.length)+" ä¸ªç»“æœ ")]):t._e()]),e("div",{staticClass:"table-wrap"},[e("table",{staticClass:"doc-table"},[t._m(8),e("tbody",t._l(t.paginatedFiles,function(s){return e("tr",{key:s.id},[e("td",{staticClass:"filename"},[e("span",{staticClass:"file-dot",class:s.typeCls}),e("div",{staticClass:"file-info"},[e("div",{staticClass:"file-name"},[t._v(t._s(s.name))]),s.fileCount&&s.fileCount>1?e("div",{staticClass:"file-count"},[t._v("åŒ…å« "+t._s(s.fileCount)+" ä¸ªæ–‡ä»¶")]):t._e()])]),e("td",[t._v(t._s(s.type))]),e("td",[t._v(t._s(s.uploader))]),e("td",[t._v(t._s(s.time))]),e("td",{staticClass:"ops"},[e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.viewFile(s)}}},[t._v("æŸ¥çœ‹")]),s.files&&s.files.length>1?e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.downloadAllFiles(s)}}},[t._v("ä¸‹è½½å…¨éƒ¨")]):e("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.downloadFile(s)}}},[t._v("ä¸‹è½½")]),e("a",{staticClass:"delete-link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.deleteFile(s)}}},[t._v("åˆ é™¤")])])])}),0)])]),e("div",{staticClass:"pagination line"},[e("span",{staticClass:"pager-text"},[t._v(t._s(t.paginationInfo))]),e("div",{staticClass:"pager-group"},[e("button",{staticClass:"pager small",attrs:{disabled:1===t.currentPage},on:{click:function(e){return t.goToPage(t.currentPage-1)}}},[t._v("ä¸Šä¸€é¡µ")]),t._l(t.visiblePages,function(s){return e("button",{key:s,staticClass:"page-num small",class:{active:s===t.currentPage},on:{click:function(e){return t.goToPage(s)}}},[t._v(t._s(s))])}),e("button",{staticClass:"pager small",attrs:{disabled:t.currentPage===t.totalPages},on:{click:function(e){return t.goToPage(t.currentPage+1)}}},[t._v("ä¸‹ä¸€é¡µ")])],2)])])])])},Et=[function(){var t=this,e=t._self._c;return e("h1",{staticClass:"page-title"},[e("span",{staticClass:"title-text"},[t._v("æˆæœç›®å½•ç®¡ç†")]),e("div",{staticClass:"title-decoration"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-blue"}),e("span",{staticClass:"add-name"},[t._v("è®ºæ–‡")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-orange"}),e("span",{staticClass:"add-name"},[t._v("ä¸“åˆ©")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-green"}),e("span",{staticClass:"add-name"},[t._v("æ•°æ®é›†")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-purple"}),e("span",{staticClass:"add-name"},[t._v("æ¨¡å‹æ–‡ä»¶")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-yellow"}),e("span",{staticClass:"add-name"},[t._v("å®éªŒæŠ¥å‘Š")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-head"},[e("span",{staticClass:"dot dot-pink"}),e("span",{staticClass:"add-name"},[t._v("è‡ªå®šä¹‰é¡¹ç›®")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"file-preview-notice"},[e("p",[t._v("æ­¤æ–‡ä»¶ç±»å‹æš‚ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆï¼Œæ‚¨å¯ä»¥ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¸‹è½½åˆ°æœ¬åœ°æŸ¥çœ‹ã€‚")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("æˆæœå")]),e("th",[t._v("ç±»å‹")]),e("th",[t._v("ä¸Šä¼ è€…")]),e("th",[t._v("ä¸Šä¼ æ—¶é—´")]),e("th",[t._v("æ“ä½œ")])])])}];const Ut={USER_AVATAR_UPDATED:"user:avatar:updated",USER_PROFILE_UPDATED:"user:profile:updated",USER_NICKNAME_UPDATED:"user:nickname:updated",PROJECT_CREATED:"project:created",PROJECT_UPDATED:"project:updated",PROJECT_DELETED:"project:deleted",PROJECT_MEMBER_ADDED:"project:member:added",PROJECT_MEMBER_REMOVED:"project:member:removed",TASK_CREATED:"task:created",TASK_UPDATED:"task:updated",TASK_DELETED:"task:deleted",KNOWLEDGE_CREATED:"knowledge:created",KNOWLEDGE_UPDATED:"knowledge:updated",KNOWLEDGE_DELETED:"knowledge:deleted",ARCHIVE_PANEL_TOGGLE:"archive:panel:toggle",WIKI_PAGE_CREATED:"wiki:page:created",WIKI_PAGE_UPDATED:"wiki:page:updated",WIKI_PAGE_DELETED:"wiki:page:deleted"};class Ot{constructor(){this.listeners=new Map,this.debounceTimers=new Map}on(t,e,s={}){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push({handler:e,debounce:s.debounce||0})}off(t,e){if(!this.listeners.has(t))return;const s=this.listeners.get(t),a=s.findIndex(t=>t.handler===e);a>-1&&s.splice(a,1)}emit(t,e){if(!this.listeners.has(t))return;const s=this.listeners.get(t);s.forEach(({handler:s,debounce:a})=>{if(a>0){const i=`${t}_${s.name||"anonymous"}`;this.debounceTimers.has(i)&&clearTimeout(this.debounceTimers.get(i));const o=setTimeout(()=>{s(e),this.debounceTimers.delete(i)},a);this.debounceTimers.set(i,o)}else s(e)})}clear(){this.listeners.clear(),this.debounceTimers.forEach(t=>clearTimeout(t)),this.debounceTimers.clear()}}const zt=new Ot;var Bt={install(t){t.prototype.$eventBus=zt,t.prototype.$EventTypes=Ut}};function Vt(t){if(0===t)return"0 Bytes";const e=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,a)).toFixed(2))+" "+s[a]}function Ht(t){const e=t||"unknown",s=Rt(e).toLowerCase(),a={pdf:"ğŸ“„",doc:"ğŸ“",docx:"ğŸ“",xls:"ğŸ“Š",xlsx:"ğŸ“Š",ppt:"ğŸ“½ï¸",pptx:"ğŸ“½ï¸",txt:"ğŸ“„",md:"ğŸ“",jpg:"ğŸ–¼ï¸",jpeg:"ğŸ–¼ï¸",png:"ğŸ–¼ï¸",gif:"ğŸ–¼ï¸",svg:"ğŸ–¼ï¸",mp4:"ğŸ¥",avi:"ğŸ¥",mov:"ğŸ¥",mp3:"ğŸµ",wav:"ğŸµ",zip:"ğŸ“¦",rar:"ğŸ“¦","7z":"ğŸ“¦",pkl:"ğŸ¤–",h5:"ğŸ¤–",pt:"ğŸ¤–",pth:"ğŸ¤–",onnx:"ğŸ¤–",csv:"ğŸ“Š",json:"ğŸ“‹",xml:"ğŸ“‹",py:"ğŸ",js:"ğŸ“œ",html:"ğŸŒ",css:"ğŸ¨"};return a[s]||"ğŸ“„"}function Rt(t){return t.split(".").pop()||""}function Wt(t){const e={pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",md:"text/markdown",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",mp4:"video/mp4",avi:"video/avi",mov:"video/quicktime",mp3:"audio/mpeg",wav:"audio/wav",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",csv:"text/csv",json:"application/json",xml:"text/xml",html:"text/html",css:"text/css",py:"text/x-python",js:"application/javascript"};return e[t.toLowerCase()]||"application/octet-stream"}function Jt(t){const e={"application/pdf":"PDFæ–‡æ¡£","application/msword":"Wordæ–‡æ¡£","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Wordæ–‡æ¡£","application/vnd.ms-excel":"Excelè¡¨æ ¼","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excelè¡¨æ ¼","application/vnd.ms-powerpoint":"PowerPointæ¼”ç¤º","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPointæ¼”ç¤º","text/plain":"æ–‡æœ¬æ–‡ä»¶","text/markdown":"Markdownæ–‡æ¡£","image/jpeg":"JPEGå›¾ç‰‡","image/png":"PNGå›¾ç‰‡","image/gif":"GIFå›¾ç‰‡","image/svg+xml":"SVGå›¾ç‰‡","video/mp4":"MP4è§†é¢‘","video/avi":"AVIè§†é¢‘","video/quicktime":"MOVè§†é¢‘","audio/mpeg":"MP3éŸ³é¢‘","audio/wav":"WAVéŸ³é¢‘","application/zip":"ZIPå‹ç¼©åŒ…","application/x-rar-compressed":"RARå‹ç¼©åŒ…","application/x-7z-compressed":"7Zå‹ç¼©åŒ…","text/csv":"CSVæ•°æ®","application/json":"JSONæ•°æ®","text/xml":"XMLæ•°æ®","text/html":"HTMLæ–‡ä»¶","text/css":"CSSæ ·å¼","application/x-python-code":"Pythonè„šæœ¬"};return e[t]||"æœªçŸ¥ç±»å‹"}function qt(t){const e={"è®ºæ–‡":"doc","ä¸“åˆ©":"patent","æ•°æ®é›†":"dataset","æ¨¡å‹æ–‡ä»¶":"model","å®éªŒæŠ¥å‘Š":"report"};return e[t]||"doc"}function Gt(t){const e={"è®ºæ–‡":".pdf,.doc,.docx","ä¸“åˆ©":".doc,.docx,.pdf","æ•°æ®é›†":".csv,.xlsx,.json,.txt","æ¨¡å‹æ–‡ä»¶":".pkl,.h5,.pt,.pth,.onnx","å®éªŒæŠ¥å‘Š":".pdf,.doc,.docx"};return e[t]||"*"}function Kt(t,e){const s=(new Date).toLocaleString("zh-CN"),a=`æ–‡ä»¶ä¿¡æ¯\n================\næ–‡ä»¶å: ${t}\nç±»å‹: ${e||"æœªçŸ¥"}\nåˆ›å»ºæ—¶é—´: ${s}\n\næ³¨æ„: æ­¤æ–‡ä»¶ä¸ºå ä½æ–‡ä»¶ï¼ŒåŸå§‹æ–‡ä»¶æ•°æ®å·²ä¸¢å¤±ã€‚\nè¯·é‡æ–°ä¸Šä¼ è¯¥æ–‡ä»¶ä»¥è·å¾—å®Œæ•´å†…å®¹ã€‚\n\nå¦‚éœ€æ¢å¤åŸå§‹æ–‡ä»¶ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜æˆ–é‡æ–°ä¸Šä¼ ã€‚`;return a}function Zt(t,e,s){try{const a=t.map(t=>{if(t.files&&Array.isArray(t.files)){const e=t.files.map(t=>{const e={...t};return t.fileBuffer&&t.fileBuffer instanceof ArrayBuffer&&(e.fileBuffer=Array.from(new Uint8Array(t.fileBuffer))),delete e.file,e});return{...t,files:e}}return t}),i={uploadedFiles:a,currentPage:e},o=s?`knowledgeBaseCatalog_${s}`:"knowledgeBaseCatalog";localStorage.setItem(o,JSON.stringify(i)),console.log(`æˆæœç›®å½•æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ (é¡¹ç›®ID: ${s})`)}catch(a){console.error("ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:",a)}}function Yt(t){try{const e=t?`knowledgeBaseCatalog_${t}`:"knowledgeBaseCatalog",s=localStorage.getItem(e);if(s){const e=JSON.parse(s);if(e.uploadedFiles&&Array.isArray(e.uploadedFiles)){const s=e.uploadedFiles.map(t=>{if(t.files&&Array.isArray(t.files)){const e=t.files.map(t=>{const e={...t};if(t.fileBuffer&&Array.isArray(t.fileBuffer)){const s=new Uint8Array(t.fileBuffer);e.fileBuffer=s.buffer}return e});return{...t,files:e}}return t});return console.log(`æˆæœç›®å½•æ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½ (é¡¹ç›®ID: ${t})`),{uploadedFiles:s,currentPage:e.currentPage||1}}}return null}catch(e){return console.error("ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¤±è´¥:",e),null}}function Qt(t){try{let e=null;if(t.fileBuffer)e=t.fileBuffer,console.log("ä½¿ç”¨ ArrayBuffer ä¸‹è½½æ–‡ä»¶:",t.name,"ArrayBuffer é•¿åº¦:",t.fileBuffer.byteLength);else{if(!(t.file&&t.file instanceof File)){console.warn("æ–‡ä»¶æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ›å»ºå ä½æ–‡ä»¶:",t);const e=t.name||t.originalFileName||"ä¸‹è½½æ–‡ä»¶",s=Rt(e),a=Kt(e,t.type),i=new Blob([a],{type:t.type||Wt(s)||"text/plain"}),o=URL.createObjectURL(i),r=document.createElement("a");return r.href=o,r.download=e,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),void alert(`æ–‡ä»¶"${e}"çš„åŸå§‹æ•°æ®å·²ä¸¢å¤±ï¼Œå·²ä¸‹è½½å ä½æ–‡ä»¶ã€‚è¯·é‡æ–°ä¸Šä¼ è¯¥æ–‡ä»¶ä»¥è·å¾—å®Œæ•´å†…å®¹ã€‚`)}e=t.file,console.log("ä½¿ç”¨ File å¯¹è±¡ä¸‹è½½æ–‡ä»¶:",t.name)}if(!e)return console.error("æ–‡ä»¶æ•°æ®æ— æ•ˆ:",t),void alert("æ–‡ä»¶æ•°æ®æ— æ•ˆï¼Œæ— æ³•ä¸‹è½½");const s=new Blob([e],{type:t.type||"application/octet-stream"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=t.name||t.originalFileName||"ä¸‹è½½æ–‡ä»¶",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),console.log("æ–‡ä»¶ä¸‹è½½æˆåŠŸ:",t.name)}catch(e){console.error("ä¸‹è½½æ–‡ä»¶æ—¶å‡ºé”™:",e),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}}function Xt(t){try{if(!t.files||0===t.files.length)return void alert("æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶");console.log("å¼€å§‹ä¸‹è½½å…¨éƒ¨æ–‡ä»¶ï¼Œå…±",t.files.length,"ä¸ªæ–‡ä»¶"),t.files.forEach((t,e)=>{setTimeout(()=>{try{Qt(t)}catch(e){console.error(`ä¸‹è½½æ–‡ä»¶ ${t.name} å¤±è´¥:`,e)}},800*e)}),alert(`å¼€å§‹ä¸‹è½½ ${t.files.length} ä¸ªæ–‡ä»¶ï¼Œè¯·ç¨å€™...`)}catch(e){console.error("æ‰¹é‡ä¸‹è½½æ—¶å‡ºé”™:",e),alert("æ‰¹é‡ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}}function te(t){try{if(t.files&&t.files.length>1)return void Xt(t);const e=t.files&&1===t.files.length?t.files[0]:t;Qt(e)}catch(e){console.error("ä¸‹è½½æ–‡ä»¶æ—¶å‡ºé”™:",e),alert("ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•")}}function ee(t,e){if(t.file){const s=new FileReader;s.onload=t=>{e(t.target.result)},s.readAsText(t.file,"UTF-8")}else{const s=`æ–‡ä»¶åï¼š${t.name}\nç±»å‹ï¼š${t.type}\nä¸Šä¼ è€…ï¼š${t.uploader}\nä¸Šä¼ æ—¶é—´ï¼š${t.time}\n\nè¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶å†…å®¹ã€‚\nå®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ–‡ä»¶çš„çœŸå®å†…å®¹ã€‚`;e(s)}}function se(t,e){if(t.file){const s=new FileReader;s.onload=t=>{e(t.target.result)},s.readAsDataURL(t.file)}else{const t="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzY2NjY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWbvueJh+WKoOi9veWksei0pTwvdGV4dD48L3N2Zz4=";e(t)}}function ae(t,e){const s=t.file?URL.createObjectURL(t.file):"#";e(s)}function ie(t){return{name:t.name,type:t.type,uploader:t.uploader,time:t.time,size:t.file?Vt(t.file.size):"æœªçŸ¥å¤§å°"}}const oe=N().create({baseURL:"",timeout:l.Ay.api.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});oe.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers.Authorization=`Bearer ${e}`),t.data instanceof FormData?(delete t.headers["Content-Type"],console.log("çŸ¥è¯†åº“APIè¯·æ±‚ (FormData):",t.method?.toUpperCase(),t.url),console.log("FormData åŒ…å«",t.data.getAll("files")?.length||0,"ä¸ªæ–‡ä»¶")):(console.log("çŸ¥è¯†åº“APIè¯·æ±‚:",t.method?.toUpperCase(),t.url),console.log("è¯·æ±‚æ•°æ®:",t.data)),t},t=>(console.error("è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:",t),Promise.reject(t))),oe.interceptors.response.use(t=>(console.log("çŸ¥è¯†åº“APIå“åº”:",t.status,t.data),t.data),t=>{if(console.error("çŸ¥è¯†åº“APIé”™è¯¯:",t),t.response){const{status:e,data:s}=t.response;return console.error("æœåŠ¡å™¨é”™è¯¯:",e,s),401===e&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),Promise.reject(s||t)}return t.request?(console.error("ç½‘ç»œé”™è¯¯:",t.request),Promise.reject(new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"))):(console.error("å…¶ä»–é”™è¯¯:",t.message),Promise.reject(t))});const re={"è®ºæ–‡":"paper","ä¸“åˆ©":"patent","æ•°æ®é›†":"dataset","ç®—æ³•æ¨¡å‹":"model","æ¨¡å‹æ–‡ä»¶":"model","æŠ¥å‘Š":"report","å®éªŒæŠ¥å‘Š":"report"},ne={paper:"è®ºæ–‡",patent:"ä¸“åˆ©",dataset:"æ•°æ®é›†",model:"æ¨¡å‹æ–‡ä»¶",report:"å®éªŒæŠ¥å‘Š",custom:"è‡ªå®šä¹‰æˆæœ"},le={draft:"è‰ç¨¿",under_review:"å®¡æ ¸ä¸­",published:"å·²å‘å¸ƒ",obsolete:"å·²å½’æ¡£"},ce={draft:"status-draft",under_review:"status-review",published:"status-published",obsolete:"status-obsolete"},de={createAchievement(t){return console.log("[knowledgeAPI.createAchievement] åˆ›å»ºæˆæœ, æ•°æ®:",t),re[t.type]&&(t.type=re[t.type]),oe.post("/zhiyan/achievement/create",t)},getProjectAchievements(t,e=0,s=20){return console.log("[knowledgeAPI.getProjectAchievements] è·å–é¡¹ç›®æˆæœåˆ—è¡¨, é¡¹ç›®ID:",t),oe.get(`/zhiyan/achievement/search/project/${t}`,{params:{page:e,size:s,sortBy:"createdAt",sortOrder:"DESC"}})},updateAchievementStatus(t,e){return console.log("[knowledgeAPI.updateAchievementStatus] æ›´æ–°æˆæœçŠ¶æ€, ID:",t,"çŠ¶æ€:",e),oe.patch(`/zhiyan/achievement/${t}/status`,null,{params:{status:e}})},getAchievementDetail(t){return console.log("[knowledgeAPI.getAchievementDetail] è·å–æˆæœè¯¦æƒ…, ID:",t),oe.get(`/zhiyan/achievement/${t}`)},deleteAchievement(t){return console.log("[knowledgeAPI.deleteAchievement] åˆ é™¤æˆæœ, ID:",t),oe.delete(`/zhiyan/achievement/${t}`)},searchAchievements(t,e=0,s=20){return console.log("[knowledgeAPI.searchAchievements] æœç´¢æˆæœ, å…³é”®è¯:",t),oe.get("/zhiyan/achievement/search/search",{params:{keyword:t,page:e,size:s}})},queryAchievements(t){return console.log("[knowledgeAPI.queryAchievements] ç»„åˆæŸ¥è¯¢æˆæœ, æŸ¥è¯¢æ¡ä»¶:",t),oe.post("/zhiyan/achievement/search/query",t)},uploadFile(t,e){console.log("[knowledgeAPI.uploadFile] ä¸Šä¼ å•ä¸ªæ–‡ä»¶, achievementId:",e,"fileName:",t?.name);const s=new FormData;return s.append("file",t),s.append("achievementId",e),oe.post("/zhiyan/achievement/file/upload",s)},uploadFilesBatch(t,e){console.log("[knowledgeAPI.uploadFilesBatch] æ‰¹é‡ä¸Šä¼ æ–‡ä»¶, achievementId:",e,"fileCount:",t?.length);const s=new FormData;return t.forEach(t=>{s.append("files",t)}),s.append("achievementId",e),oe.post("/zhiyan/achievement/file/upload/batch",s)},getAchievementFiles(t){return console.log("[knowledgeAPI.getAchievementFiles] è·å–æˆæœæ–‡ä»¶åˆ—è¡¨, achievementId:",t),oe.get(`/zhiyan/achievement/file/${t}/files`)},deleteFile(t){return console.log("[knowledgeAPI.deleteFile] åˆ é™¤æ–‡ä»¶, fileId:",t),oe.delete(`/zhiyan/achievement/file/${t}`)},getFileDownloadUrl(t,e=3600){return console.log("[knowledgeAPI.getFileDownloadUrl] è·å–æ–‡ä»¶ä¸‹è½½URL, fileId:",t),oe.get(`/zhiyan/achievement/file/${t}/download-url`,{params:{expirySeconds:e}})},updateDetailFields(t,e){return console.log("[knowledgeAPI.updateDetailFields] æ›´æ–°æˆæœè¯¦æƒ…å­—æ®µ, achievementId:",t,"fields:",e),oe.patch(`/zhiyan/achievement/detail/${t}/fields`,e)}};function he(t,e,s){const a={projectId:e,title:t.name,type:re[s]||"custom",status:"draft"},i={};return"è®ºæ–‡"===s?(t.paperAuthors&&(i.authors=t.paperAuthors.split(",").map(t=>t.trim())),t.paperTitle&&(i.title=t.paperTitle),t.journalName&&(i.journal=t.journalName),t.publishYear&&(i.publishYear=parseInt(t.publishYear)||null),t.volume&&(i.volume=t.volume),t.issue&&(i.issue=t.issue)):"ä¸“åˆ©"===s?(t.patentNumber&&(i.patentNo=t.patentNumber),t.patentType&&(i.patentType=t.patentType),t.patentName&&(i.patentName=t.patentName),t.inventors&&(i.inventors=t.inventors.split(",").map(t=>t.trim())),t.applicants&&(i.applicants=t.applicants)):"æ•°æ®é›†"===s?(t.datasetVersion&&(i.version=t.datasetVersion),t.datasetName&&(i.datasetName=t.datasetName),t.datasetFormat&&(i.format=t.datasetFormat),t.datasetSize&&(i.size=t.datasetSize),t.datasetSource&&(i.source=t.datasetSource)):"æ¨¡å‹æ–‡ä»¶"===s?(t.modelFramework&&(i.framework=t.modelFramework),t.modelName&&(i.modelName=t.modelName),t.modelVersion&&(i.version=t.modelVersion),t.modelType&&(i.modelType=t.modelType),t.hyperparameters&&(i.hyperparameters=t.hyperparameters)):"å®éªŒæŠ¥å‘Š"===s&&(t.reportType&&(i.reportType=t.reportType),t.reportName&&(i.reportName=t.reportName),t.reportDate&&(i.reportDate=t.reportDate)),Object.keys(i).length>0&&(a.detailData=i),a}function pe(t){let e=null;e=t.creatorName&&"string"===typeof t.creatorName&&""!==t.creatorName.trim()?t.creatorName:t.creator||t.uploader||t.username||t.userName,(!e||"æœªçŸ¥ç”¨æˆ·"===e||"string"===typeof e&&e.trim&&""===e.trim())&&(t.creatorUser&&"object"===typeof t.creatorUser?e=t.creatorUser.name||t.creatorUser.username||t.creatorUser.nickname:t.createdByUser&&"object"===typeof t.createdByUser?e=t.createdByUser.name||t.createdByUser.username||t.createdByUser.nickname:t.creatorInfo&&"object"===typeof t.creatorInfo&&(e=t.creatorInfo.name||t.creatorInfo.username||t.creatorInfo.nickname)),(!e||"æœªçŸ¥ç”¨æˆ·"===e||"string"===typeof e&&""===e.trim())&&(e="æœªçŸ¥ç”¨æˆ·"),e||(e="æœªçŸ¥ç”¨æˆ·");const s={id:t.id,name:t.title,type:ne[t.type]||t.type,typeCls:qt(ne[t.type]||t.type),uploader:e,creatorId:t.creatorId,time:ue(t.createdAt),fileCount:t.fileCount||0,files:[]};if(t.detailData){const e=t.detailData;"paper"===t.type?(s.paperAuthors=Array.isArray(e.authors)?e.authors.join(", "):e.authors,s.paperTitle=e.title,s.journalName=e.journal,s.publishYear=e.publishYear,s.volume=e.volume,s.issue=e.issue):"patent"===t.type?(s.patentNumber=e.patentNo,s.patentType=e.patentType,s.patentName=e.patentName,s.inventors=Array.isArray(e.inventors)?e.inventors.join(", "):e.inventors,s.applicants=e.applicants):"dataset"===t.type?(s.datasetVersion=e.version,s.datasetName=e.datasetName,s.datasetFormat=e.format,s.datasetSize=e.size,s.datasetSource=e.source):"model"===t.type?(s.modelFramework=e.framework,s.modelName=e.modelName,s.modelVersion=e.version,s.modelType=e.modelType,s.hyperparameters=e.hyperparameters):"report"===t.type&&(s.reportType=e.reportType,s.reportName=e.reportName,s.reportDate=e.reportDate)}return s}function ue(t){if(!t)return"";try{const e=new Date(t);return e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return t}}function me(t,e){const s={};return"è®ºæ–‡"===e?(t.paperAuthors&&(s.authors=t.paperAuthors.split(",").map(t=>t.trim())),t.paperTitle&&(s.title=t.paperTitle),t.journalName&&(s.journal=t.journalName),t.publishYear&&(s.publishYear=parseInt(t.publishYear)||null),t.volume&&(s.volume=t.volume),t.issue&&(s.issue=t.issue)):"ä¸“åˆ©"===e?(t.patentNumber&&(s.patentNo=t.patentNumber),t.patentType&&(s.patentType=t.patentType),t.patentName&&(s.patentName=t.patentName),t.inventors&&(s.inventors=t.inventors.split(",").map(t=>t.trim())),t.applicants&&(s.applicants=t.applicants)):"æ•°æ®é›†"===e?(t.datasetVersion&&(s.version=t.datasetVersion),t.datasetName&&(s.datasetName=t.datasetName),t.datasetFormat&&(s.format=t.datasetFormat),t.datasetSize&&(s.size=t.datasetSize),t.datasetSource&&(s.source=t.datasetSource)):"æ¨¡å‹æ–‡ä»¶"===e?(t.modelFramework&&(s.framework=t.modelFramework),t.modelName&&(s.modelName=t.modelName),t.modelVersion&&(s.version=t.modelVersion),t.modelType&&(s.modelType=t.modelType),t.hyperparameters&&(s.hyperparameters=t.hyperparameters)):"å®éªŒæŠ¥å‘Š"===e&&(t.reportType&&(s.reportType=t.reportType),t.reportName&&(s.reportName=t.reportName),t.reportDate&&(s.reportDate=t.reportDate)),s}var ge={name:"KnowledgeBaseCatalog",props:{archiveRows:{type:Array,default:()=>[]},projectId:{type:[String,Number],default:null}},data(){return{showUploadDialog:!1,showCustomDialog:!1,currentFileType:"",selectedFile:null,fileAccept:"",customTypeName:"",customTypeDesc:"",uploadedFiles:[],showArchivePanel:!1,currentPage:1,pageSize:5,totalItems:0,searchText:"",searchResults:[],isSearching:!1,searchDebounceTimer:null,isAddingToExisting:!1,targetAchievementId:null,showViewDialog:!1,viewingFile:null,fileContent:"",fileContentType:"text",selectedFileIndex:null,isEditingDescription:!1,isEditingContent:!1,editableContent:"",hasContentChanges:!1,editForm:{paperAuthors:"",paperTitle:"",journalName:"",publishYear:"",volume:"",issue:"",patentNumber:"",patentType:"",patentName:"",inventors:"",applicants:"",datasetVersion:"",datasetName:"",datasetFormat:"",datasetSize:"",datasetSource:"",modelFramework:"",modelName:"",modelVersion:"",modelType:"",hyperparameters:"",reportType:"",reportName:"",reportDate:""},achievementForm:{name:"",descriptions:[{content:""}],files:[]},customUploadForm:{typeName:"",name:"",descriptions:[{content:""}],files:[]}}},computed:{allFiles(){return this.uploadedFiles.length>0?this.uploadedFiles:this.archiveRows},filteredFiles(){return this.isSearching&&this.searchText.trim()?this.searchResults:this.allFiles},paginatedFiles(){const t=(this.currentPage-1)*this.pageSize,e=t+this.pageSize;return this.filteredFiles.slice(t,e)},totalPages(){return Math.ceil(this.filteredFiles.length/this.pageSize)},paginationInfo(){const t=(this.currentPage-1)*this.pageSize+1,e=Math.min(this.currentPage*this.pageSize,this.filteredFiles.length);return`æ˜¾ç¤ºç¬¬ ${t} åˆ° ${e} é¡¹ï¼Œå…± ${this.filteredFiles.length} é¡¹`},visiblePages(){const t=[],e=3;let s=Math.max(1,this.currentPage-Math.floor(e/2)),a=Math.min(this.totalPages,s+e-1);a-s+1<e&&(s=Math.max(1,a-e+1));for(let i=s;i<=a;i++)t.push(i);return t}},async mounted(){await this.loadAchievements();const t=Yt(this.projectId);t&&t.currentPage&&(this.currentPage=t.currentPage)},watch:{showArchivePanel(t){zt.emit(Ut.ARCHIVE_PANEL_TOGGLE,t)}},beforeDestroy(){Zt(this.uploadedFiles,this.currentPage,this.projectId),this.searchDebounceTimer&&(clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null)},methods:{async loadAchievements(){if(this.projectId)try{console.log("åŠ è½½æˆæœåˆ—è¡¨, projectId:",this.projectId);const t=await de.getProjectAchievements(this.projectId,0,50);if(console.log("æˆæœåˆ—è¡¨åŠ è½½æˆåŠŸ:",t),t&&200===t.code&&t.data){const e=t.data.content||[];e.length>0&&(console.log("ğŸ“‹ åŸå§‹æˆæœDTOç¤ºä¾‹ï¼ˆç¬¬ä¸€ä¸ªï¼‰:",e[0]),console.log("ğŸ“‹ DTOæ‰€æœ‰å­—æ®µ:",Object.keys(e[0])),console.log("ğŸ“‹ ä¸Šä¼ è€…ç›¸å…³å­—æ®µ:",{creatorName:e[0].creatorName,creator:e[0].creator,createdBy:e[0].createdBy,uploader:e[0].uploader,username:e[0].username,userName:e[0].userName,creatorInfo:e[0].creatorInfo,creatorUser:e[0].creatorUser,createdByUser:e[0].createdByUser})),this.uploadedFiles=e.map(t=>pe(t)),await this.fetchMissingCreatorNames(),console.log("è½¬æ¢åçš„æˆæœåˆ—è¡¨:",this.uploadedFiles)}else console.warn("æˆæœåˆ—è¡¨å“åº”æ ¼å¼å¼‚å¸¸:",t),this.uploadedFiles=[]}catch(t){console.error("åŠ è½½æˆæœåˆ—è¡¨å¤±è´¥:",t),this.uploadedFiles=[]}else console.warn("projectIdä¸ºç©ºï¼Œæ— æ³•åŠ è½½æˆæœåˆ—è¡¨")},async fetchMissingCreatorNames(){const t=this.uploadedFiles.filter(t=>(!t.uploader||"æœªçŸ¥ç”¨æˆ·"===t.uploader)&&t.creatorId);if(0===t.length)return void console.log("ğŸ” æ²¡æœ‰éœ€è¦è·å–ä¸Šä¼ è€…å§“åçš„æˆæœ");if(!this.projectId)return void console.warn("âš ï¸ projectIdä¸ºç©ºï¼Œæ— æ³•è·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨");console.log(`ğŸ” éœ€è¦è·å– ${t.length} ä¸ªä¸Šä¼ è€…å§“å`),console.log("ğŸ” éœ€è¦è·å–çš„æˆæœåˆ—è¡¨:",t.map(t=>({id:t.id,name:t.name,creatorId:t.creatorId,uploader:t.uploader})));const e=[...new Set(t.map(t=>String(t.creatorId)))];console.log("ğŸ” å”¯ä¸€çš„creatorIdåˆ—è¡¨:",e);const s=new Map;try{console.log(`ğŸ“¡ å¼€å§‹è·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨: projectId=${this.projectId}`);const t=await ut.projectAPI.getProjectMembers(this.projectId,0,1e3);if(console.log("ğŸ“¡ é¡¹ç›®æˆå‘˜åˆ—è¡¨APIå“åº”:",t),t&&200===t.code){let e=[];t.data&&t.data.content?e=t.data.content:Array.isArray(t.data)&&(e=t.data),console.log(`ğŸ“‹ è·å–åˆ° ${e.length} ä¸ªé¡¹ç›®æˆå‘˜`),e.forEach(t=>{const e=String(t.userId||t.id),a=t.username||t.name||t.nickname;a&&""!==a.trim()&&(s.set(e,a),console.log(`âœ… æ·»åŠ æˆå‘˜æ˜ å°„: ID=${e}, å§“å="${a}"`))}),console.log("ğŸ“‹ æˆå‘˜æ˜ å°„è¡¨:",Array.from(s.entries()))}else console.warn("âš ï¸ è·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨å¤±è´¥:",t)}catch(i){console.error("âŒ è·å–é¡¹ç›®æˆå‘˜åˆ—è¡¨å¼‚å¸¸:",i)}if(0===s.size)return void console.warn("âš ï¸ æ— æ³•è·å–é¡¹ç›®æˆå‘˜ä¿¡æ¯ï¼Œæ— æ³•è§£æä¸Šä¼ è€…å§“å");let a=0;for(let o=0;o<this.uploadedFiles.length;o++){const t=this.uploadedFiles[o],e=String(t.creatorId);if(t.uploader&&"æœªçŸ¥ç”¨æˆ·"!==t.uploader||!s.has(e))t.uploader&&"æœªçŸ¥ç”¨æˆ·"!==t.uploader||!t.creatorId||console.warn(`âš ï¸ æœªåœ¨æˆå‘˜åˆ—è¡¨ä¸­æ‰¾åˆ°creatorId: ${e}, æˆæœ: ${t.name}`);else{const i=s.get(e),r={...t,uploader:i};this.$set(this.uploadedFiles,o,r),a++,console.log(`âœ…âœ…âœ… [${o+1}] æ›´æ–°æˆæœä¸Šä¼ è€…: "${t.name}" (ID: ${t.id}) -> "${i}" (creatorId: ${e})`)}}console.log(`âœ… æ‰€æœ‰ä¸Šä¼ è€…å§“åè·å–å®Œæˆï¼Œå…±æ›´æ–° ${a} æ¡è®°å½•`),console.log("ğŸ“‹ æ›´æ–°åçš„uploadedFiles:",this.uploadedFiles.map(t=>({id:t.id,name:t.name,uploader:t.uploader,creatorId:t.creatorId}))),await this.$nextTick(),this.$forceUpdate()},uploadFile(t){this.currentFileType=t,this.fileAccept=Gt(t),this.resetAchievementForm(),this.showUploadDialog=!0},async handleFileSelect(t){const e=Array.from(t.target.files);e.length>0&&(console.log("æ–‡ä»¶é€‰æ‹©äº‹ä»¶:",{filesCount:e.length,isAddingToExisting:this.isAddingToExisting,showViewDialog:this.showViewDialog,viewingFile:this.viewingFile?this.viewingFile.id:null}),this.isAddingToExisting&&this.targetAchievementId?(console.log("ä¸ºç°æœ‰æˆæœæ·»åŠ æ–‡ä»¶ï¼Œç›´æ¥å¤„ç†"),await this.addFilesToExistingAchievement(e)):this.showCustomDialog?e.forEach(t=>{this.customUploadForm.files.push({name:t.name,size:t.size,type:t.type,file:t})}):this.showUploadDialog&&e.forEach(t=>{this.achievementForm.files.push({name:t.name,size:t.size,type:t.type,file:t})}),this.$refs.fileInput.value="")},triggerFileSelect(){this.$refs.fileInput.click()},removeFile(t){this.achievementForm.files.splice(t,1)},resetAchievementForm(){this.achievementForm={name:"",paperAuthors:"",paperTitle:"",journalName:"",publishYear:"",volume:"",issue:"",patentNumber:"",patentType:"",patentName:"",inventors:"",applicants:"",datasetVersion:"",datasetName:"",datasetFormat:"",datasetSize:"",datasetSource:"",modelFramework:"",modelName:"",modelVersion:"",modelType:"",hyperparameters:"",reportType:"",reportName:"",reportDate:"",files:[]}},async confirmUpload(){if((this.isAddingToExisting||this.achievementForm.name.trim())&&this.achievementForm.files.length>0)try{if(this.isAddingToExisting&&this.targetAchievementId){console.log("ä¸ºç°æœ‰æˆæœæ·»åŠ æ–‡ä»¶, achievementId:",this.targetAchievementId);const t=this.achievementForm.files.map(t=>t.file),e=await de.uploadFilesBatch(t,this.targetAchievementId);return console.log("æ‰¹é‡ä¸Šä¼ æ–‡ä»¶æˆåŠŸ:",e),await this.loadAchievements(),this.resetAchievementForm(),this.isAddingToExisting=!1,this.targetAchievementId=null,this.showUploadDialog=!1,void alert(`å·²æˆåŠŸæ·»åŠ ${t.length}ä¸ªæ–‡ä»¶åˆ°æˆæœä¸­ï¼`)}console.log("åˆ›å»ºæ–°æˆæœ, projectId:",this.projectId);const t=he(this.achievementForm,this.projectId,this.currentFileType);console.log("åˆ›å»ºæˆæœDTO:",t);const e=await de.createAchievement(t);if(console.log("åˆ›å»ºæˆæœå“åº”:",e),200!==e.code||!e.data)throw new Error(e.msg||"åˆ›å»ºæˆæœå¤±è´¥");const s=e.data,a=s.id,i=this.achievementForm.files.map(t=>t.file);console.log("å‡†å¤‡æ‰¹é‡ä¸Šä¼ æ–‡ä»¶, æ•°é‡:",i.length);const o=await de.uploadFilesBatch(i,a);console.log("æ‰¹é‡ä¸Šä¼ æ–‡ä»¶æˆåŠŸ:",o),await this.loadAchievements(),this.resetAchievementForm(),this.isAddingToExisting=!1,this.targetAchievementId=null,this.showUploadDialog=!1,this.goToLastPage(),alert(`æˆæœ"${this.achievementForm.name}"åˆ›å»ºæˆåŠŸï¼å·²ä¸Šä¼ ${i.length}ä¸ªæ–‡ä»¶ã€‚`)}catch(t){console.error("ä¸Šä¼ å¤±è´¥:",t),alert("ä¸Šä¼ å¤±è´¥: "+(t.message||"è¯·é‡è¯•"))}},goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)},goToLastPage(){this.currentPage=this.totalPages},onSearchInput(){this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),this.searchText.trim()?this.searchDebounceTimer=setTimeout(()=>{this.performSearch()},500):this.clearSearch()},async performSearch(){if(this.searchText.trim()&&this.projectId)try{console.log("æ‰§è¡Œæœç´¢, å…³é”®è¯:",this.searchText),this.isSearching=!0;const t=await de.searchAchievements(this.searchText,0,50);if(console.log("æœç´¢å“åº”:",t),t&&200===t.code&&t.data){const e=t.data.content||[];this.searchResults=e.map(t=>pe(t)),console.log("æœç´¢ç»“æœ:",this.searchResults),this.currentPage=1}else console.warn("æœç´¢å“åº”æ ¼å¼å¼‚å¸¸:",t),this.searchResults=[]}catch(t){console.error("æœç´¢å¤±è´¥:",t),this.searchResults=[],alert("æœç´¢å¤±è´¥: "+(t.message||"è¯·é‡è¯•"))}},clearSearch(){this.searchText="",this.searchResults=[],this.isSearching=!1,this.currentPage=1,this.searchDebounceTimer&&(clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null)},getTargetAchievementName(){if(this.targetAchievementId){const t=this.uploadedFiles.find(t=>t.id===this.targetAchievementId);return t?t.name:"æœªçŸ¥æˆæœ"}return"æœªçŸ¥æˆæœ"},closeUploadDialog(){this.showUploadDialog=!1,this.resetAchievementForm(),this.isAddingToExisting=!1,this.targetAchievementId=null,this.$refs.fileInput.value=""},createCustomType(){this.resetCustomForm(),this.showCustomDialog=!0},triggerCustomFileSelect(){this.$refs.fileInput.click()},removeCustomFile(t){this.customUploadForm.files.splice(t,1)},addCustomDescription(){this.customUploadForm.descriptions.push({leftField:"",rightField:""})},removeCustomDescription(t){this.customUploadForm.descriptions.length>1&&this.customUploadForm.descriptions.splice(t,1)},resetCustomForm(){this.customUploadForm={typeName:"",name:"",descriptions:[{leftField:"",rightField:""}],files:[]}},async confirmCustomType(){if(this.customUploadForm.typeName.trim()&&this.customUploadForm.name.trim()&&this.customUploadForm.files.length>0)try{const t=this.customUploadForm.typeName.trim(),e=await Promise.all(this.customUploadForm.files.map(async(e,s)=>{const a=await e.file.arrayBuffer(),i=e.name,o=Rt(i);return{id:Date.now()+s,name:this.customUploadForm.name+(this.customUploadForm.files.length>1?`_${s+1}`:"")+o,type:e.type,uploader:"å½“å‰ç”¨æˆ·",time:(new Date).toLocaleString("zh-CN"),typeCls:this.getTypeClass(t),fileBuffer:a,file:e.file,descriptions:this.customUploadForm.descriptions.filter(t=>t.leftField.trim()||t.rightField.trim()).map(t=>`${t.leftField||""} | ${t.rightField||""}`),originalFileName:i,size:e.size}})),s={id:Date.now(),name:this.customUploadForm.name,type:t,uploader:"å½“å‰ç”¨æˆ·",time:(new Date).toLocaleString("zh-CN"),typeCls:"doc",files:e,fileCount:this.customUploadForm.files.length,descriptions:this.customUploadForm.descriptions.filter(t=>t.leftField.trim()||t.rightField.trim()).map(t=>`${t.leftField||""} | ${t.rightField||""}`)};this.uploadedFiles.push(s),this.$emit("file-uploaded",s),this.resetCustomForm(),this.showCustomDialog=!1,this.goToLastPage(),Zt(this.uploadedFiles,this.currentPage,this.projectId),alert(`è‡ªå®šä¹‰ç±»å‹"${t}"çš„æˆæœå·²ä¸Šä¼ ï¼å·²æ·»åŠ ${this.customUploadForm.files.length}ä¸ªæ–‡ä»¶åˆ°æˆæœæ¡£æ¡ˆä¸­ã€‚`)}catch(t){console.error("è‡ªå®šä¹‰ç±»å‹æ–‡ä»¶ä¸Šä¼ å¤±è´¥:",t),alert("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}},closeCustomDialog(){this.showCustomDialog=!1,this.resetCustomForm(),this.$refs.fileInput.value=""},viewFile(t){this.viewingFile=t,this.loadFileContent(t),this.showViewDialog=!0},loadFileContent(t){const e=Rt(t.name).toLowerCase();["txt","md","json","csv","log"].includes(e)?(this.fileContentType="text",ee(t,t=>{this.fileContent=t})):["jpg","jpeg","png","gif","bmp","webp"].includes(e)?(this.fileContentType="image",se(t,t=>{this.fileContent=t})):"pdf"===e?(this.fileContentType="pdf",ae(t,t=>{this.fileContent=t})):(this.fileContentType="info",this.fileContent=ie(t))},closeViewDialog(){this.showViewDialog=!1,this.viewingFile=null,this.fileContent="",this.fileContentType="text",this.selectedFileIndex=null,this.isEditingDescription=!1,this.isEditingContent=!1,this.editableContent="",this.hasContentChanges=!1,this.resetEditForm()},toggleEditMode(){this.isEditingDescription=!0,this.initEditForm()},toggleContentEdit(){this.isEditingContent=!0,this.editableContent=this.fileContent,this.hasContentChanges=!1},markContentChanged(){this.hasContentChanges=this.editableContent!==this.fileContent},saveContentChanges(){this.hasContentChanges&&(this.fileContent=this.editableContent,this.hasContentChanges=!1,this.isEditingContent=!1,this.updateFileContentInStorage(),alert("æ–‡æ¡£å†…å®¹å·²ä¿å­˜ï¼"))},cancelContentEdit(){this.hasContentChanges?confirm("æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦å–æ¶ˆç¼–è¾‘å—ï¼Ÿ")&&(this.isEditingContent=!1,this.editableContent="",this.hasContentChanges=!1):(this.isEditingContent=!1,this.editableContent="",this.hasContentChanges=!1)},initEditForm(){this.viewingFile&&("è®ºæ–‡"===this.viewingFile.type?(this.editForm.paperAuthors=this.viewingFile.paperAuthors||"",this.editForm.paperTitle=this.viewingFile.paperTitle||"",this.editForm.journalName=this.viewingFile.journalName||"",this.editForm.publishYear=this.viewingFile.publishYear||"",this.editForm.volume=this.viewingFile.volume||"",this.editForm.issue=this.viewingFile.issue||""):"ä¸“åˆ©"===this.viewingFile.type?(this.editForm.patentNumber=this.viewingFile.patentNumber||"",this.editForm.patentType=this.viewingFile.patentType||"",this.editForm.patentName=this.viewingFile.patentName||"",this.editForm.inventors=this.viewingFile.inventors||"",this.editForm.applicants=this.viewingFile.applicants||""):"æ•°æ®é›†"===this.viewingFile.type?(this.editForm.datasetVersion=this.viewingFile.datasetVersion||"",this.editForm.datasetName=this.viewingFile.datasetName||"",this.editForm.datasetFormat=this.viewingFile.datasetFormat||"",this.editForm.datasetSize=this.viewingFile.datasetSize||"",this.editForm.datasetSource=this.viewingFile.datasetSource||""):"æ¨¡å‹æ–‡ä»¶"===this.viewingFile.type?(this.editForm.modelFramework=this.viewingFile.modelFramework||"",this.editForm.modelName=this.viewingFile.modelName||"",this.editForm.modelVersion=this.viewingFile.modelVersion||"",this.editForm.modelType=this.viewingFile.modelType||"",this.editForm.hyperparameters=this.viewingFile.hyperparameters||""):"å®éªŒæŠ¥å‘Š"===this.viewingFile.type&&(this.editForm.reportType=this.viewingFile.reportType||"",this.editForm.reportName=this.viewingFile.reportName||"",this.editForm.reportDate=this.viewingFile.reportDate||""))},resetEditForm(){this.editForm={paperAuthors:"",paperTitle:"",journalName:"",publishYear:"",volume:"",issue:"",patentNumber:"",patentType:"",patentName:"",inventors:"",applicants:"",datasetVersion:"",datasetName:"",datasetFormat:"",datasetSize:"",datasetSource:"",modelFramework:"",modelName:"",modelVersion:"",modelType:"",hyperparameters:"",reportType:"",reportName:"",reportDate:""}},async saveDescriptionChanges(){if(this.viewingFile)try{console.log("ä¿å­˜æˆæœè¯¦æƒ…ä¿®æ”¹, ID:",this.viewingFile.id,"ç±»å‹:",this.viewingFile.type);const t=me(this.editForm,this.viewingFile.type);console.log("å­—æ®µæ›´æ–°å¯¹è±¡:",t);const e=await de.updateDetailFields(this.viewingFile.id,t);if(console.log("æ›´æ–°æˆæœè¯¦æƒ…å“åº”:",e),!e||200!==e.code)throw new Error(e.msg||"æ›´æ–°å¤±è´¥");{"è®ºæ–‡"===this.viewingFile.type?(this.viewingFile.paperAuthors=this.editForm.paperAuthors,this.viewingFile.paperTitle=this.editForm.paperTitle,this.viewingFile.journalName=this.editForm.journalName,this.viewingFile.publishYear=this.editForm.publishYear,this.viewingFile.volume=this.editForm.volume,this.viewingFile.issue=this.editForm.issue):"ä¸“åˆ©"===this.viewingFile.type?(this.viewingFile.patentNumber=this.editForm.patentNumber,this.viewingFile.patentType=this.editForm.patentType,this.viewingFile.patentName=this.editForm.patentName,this.viewingFile.inventors=this.editForm.inventors,this.viewingFile.applicants=this.editForm.applicants):"æ•°æ®é›†"===this.viewingFile.type?(this.viewingFile.datasetVersion=this.editForm.datasetVersion,this.viewingFile.datasetName=this.editForm.datasetName,this.viewingFile.datasetFormat=this.editForm.datasetFormat,this.viewingFile.datasetSize=this.editForm.datasetSize,this.viewingFile.datasetSource=this.editForm.datasetSource):"æ¨¡å‹æ–‡ä»¶"===this.viewingFile.type?(this.viewingFile.modelFramework=this.editForm.modelFramework,this.viewingFile.modelName=this.editForm.modelName,this.viewingFile.modelVersion=this.editForm.modelVersion,this.viewingFile.modelType=this.editForm.modelType,this.viewingFile.hyperparameters=this.editForm.hyperparameters):"å®éªŒæŠ¥å‘Š"===this.viewingFile.type&&(this.viewingFile.reportType=this.editForm.reportType,this.viewingFile.reportName=this.editForm.reportName,this.viewingFile.reportDate=this.editForm.reportDate);const t=this.uploadedFiles.findIndex(t=>t.id===this.viewingFile.id);-1!==t&&this.$set(this.uploadedFiles,t,{...this.viewingFile}),this.$emit("file-edited",this.viewingFile),this.isEditingDescription=!1,alert("æˆæœè¯¦ç»†æè¿°å·²æ›´æ–°")}}catch(t){console.error("ä¿å­˜æˆæœè¯¦æƒ…å¤±è´¥:",t),alert("ä¿å­˜å¤±è´¥: "+(t.message||"è¯·é‡è¯•"))}},cancelEditMode(){this.isEditingDescription=!1,this.resetEditForm()},showAddFileDialog(){this.isAddingToExisting=!0,this.targetAchievementId=this.viewingFile.id,console.log("å‡†å¤‡ä¸ºç°æœ‰æˆæœæ·»åŠ æ–‡ä»¶:",{achievementId:this.viewingFile.id,achievementName:this.viewingFile.name,isAddingToExisting:this.isAddingToExisting}),this.$refs.fileInput.click()},async addFilesToExistingAchievement(t){try{console.log("ä¸ºç°æœ‰æˆæœæ·»åŠ æ–‡ä»¶:",{achievementId:this.viewingFile.id,achievementName:this.viewingFile.name,filesCount:t.length});const e=await Promise.all(t.map(async(t,e)=>{const s=await t.arrayBuffer();return{id:Date.now()+e,name:t.name,originalFileName:t.name,size:t.size,type:t.type,fileBuffer:s,file:t}})),s=this.uploadedFiles.findIndex(t=>t.id===this.viewingFile.id);console.log("æŸ¥æ‰¾ç›®æ ‡æˆæœç´¢å¼•:",{targetIndex:s,targetId:this.viewingFile.id}),-1!==s?(this.uploadedFiles[s].files.push(...e),this.uploadedFiles[s].fileCount=this.uploadedFiles[s].files.length,this.uploadedFiles[s].time=(new Date).toLocaleString("zh-CN"),this.viewingFile=this.uploadedFiles[s],this.$emit("file-edited",this.uploadedFiles[s]),Zt(this.uploadedFiles,this.currentPage,this.projectId),this.isAddingToExisting=!1,this.targetAchievementId=null,alert(`å·²æˆåŠŸæ·»åŠ ${t.length}ä¸ªæ–‡ä»¶åˆ°æˆæœ"${this.uploadedFiles[s].name}"ä¸­ï¼`)):(console.error("æœªæ‰¾åˆ°ç›®æ ‡æˆæœ:",this.viewingFile.id),alert("æ·»åŠ æ–‡ä»¶å¤±è´¥ï¼šæœªæ‰¾åˆ°ç›®æ ‡æˆæœ"),this.isAddingToExisting=!1,this.targetAchievementId=null)}catch(e){console.error("æ·»åŠ æ–‡ä»¶åˆ°ç°æœ‰æˆæœå¤±è´¥:",e),alert("æ·»åŠ æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•"),this.isAddingToExisting=!1,this.targetAchievementId=null}},async deleteFile(t){if(confirm(`ç¡®å®šè¦åˆ é™¤æˆæœ"${t.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`))try{console.log("åˆ é™¤æˆæœ, ID:",t.id);const e=await de.deleteAchievement(t.id);if(console.log("åˆ é™¤æˆæœå“åº”:",e),!e||200!==e.code)throw new Error(e.msg||"åˆ é™¤å¤±è´¥");{const e=this.uploadedFiles.findIndex(e=>e.id===t.id);if(-1!==e&&this.uploadedFiles.splice(e,1),this.isSearching){const e=this.searchResults.findIndex(e=>e.id===t.id);-1!==e&&this.searchResults.splice(e,1)}this.$emit("file-deleted",t),0===this.paginatedFiles.length&&this.currentPage>1&&(this.currentPage=this.currentPage-1),alert("æˆæœåˆ é™¤æˆåŠŸï¼")}}catch(e){console.error("åˆ é™¤æˆæœå¤±è´¥:",e),alert("åˆ é™¤å¤±è´¥: "+(e.message||"è¯·é‡è¯•"))}},selectFile(t){this.selectedFileIndex=t},viewSingleFile(t){try{console.log("æŸ¥çœ‹æ–‡ä»¶è¯¦æƒ…:",t),console.log("æ–‡ä»¶é¢„è§ˆåŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ç›´æ¥ä¸‹è½½æŸ¥çœ‹")}catch(e){console.error("æŸ¥çœ‹æ–‡ä»¶æ—¶å‡ºé”™:",e),alert("æ— æ³•é¢„è§ˆæ­¤æ–‡ä»¶ï¼Œè¯·ä¸‹è½½åæŸ¥çœ‹")}},getAchievementDescription(t){return!!t&&(t.paperAuthors||t.paperTitle||t.journalName||t.publishYear||t.volume||t.issue||t.patentNumber||t.patentType||t.patentName||t.inventors||t.applicants||t.datasetVersion||t.datasetName||t.datasetFormat||t.datasetSize||t.datasetSource||t.modelFramework||t.modelName||t.modelVersion||t.modelType||t.hyperparameters||t.reportType||t.reportName||t.reportDate||t.paperName||t.paperId||t.patentName||t.patentId||t.datasetName||t.datasetId||t.modelName||t.modelId||t.reportName||t.reportId||t.descriptions&&t.descriptions.length>0)},deleteSingleFile(t,e){const s=t.name||t.originalFileName||"æœªçŸ¥æ–‡ä»¶";confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶"${s}"å—ï¼Ÿ`)&&(this.viewingFile.files.splice(e,1),this.viewingFile.fileCount=this.viewingFile.files.length,0===this.viewingFile.files.length?(this.deleteFile(this.viewingFile),this.closeViewDialog()):(this.selectedFileIndex===e?this.selectedFileIndex=Math.max(0,e-1):this.selectedFileIndex>e&&(this.selectedFileIndex=this.selectedFileIndex-1),Zt(this.uploadedFiles,this.currentPage,this.projectId),alert("æ–‡ä»¶åˆ é™¤æˆåŠŸï¼")))},downloadFile(t){te(t)},getTypeClass(t){return qt(t)},getFileIcon(t){return Ht(t)},getFileTypeDisplay(t){return Jt(t)},formatFileSize(t){return Vt(t)},async handleStatusChange(){if(this.viewingFile&&this.viewingFile.id)try{console.log("æ›´æ–°æˆæœçŠ¶æ€:",{achievementId:this.viewingFile.id,newStatus:this.viewingFile.status});const t=await de.updateAchievementStatus(this.viewingFile.id,this.viewingFile.status);if(console.log("çŠ¶æ€æ›´æ–°å“åº”:",t),!t||200!==t.code)throw new Error(t.msg||"çŠ¶æ€æ›´æ–°å¤±è´¥");{const t=this.uploadedFiles.findIndex(t=>t.id===this.viewingFile.id);if(-1!==t&&(this.uploadedFiles[t].status=this.viewingFile.status),this.isSearching){const t=this.searchResults.findIndex(t=>t.id===this.viewingFile.id);-1!==t&&(this.searchResults[t].status=this.viewingFile.status)}alert("æˆæœçŠ¶æ€å·²æ›´æ–°ä¸ºï¼š"+le[this.viewingFile.status])}}catch(t){console.error("æ›´æ–°æˆæœçŠ¶æ€å¤±è´¥:",t),alert("çŠ¶æ€æ›´æ–°å¤±è´¥: "+(t.message||"è¯·é‡è¯•"));const e=this.uploadedFiles.find(t=>t.id===this.viewingFile.id);e&&(this.viewingFile.status=e.status)}},async fetchAchievementDetail(t){try{console.log("è·å–æˆæœè¯¦æƒ…:",t);const e=await de.getAchievementDetail(t);if(console.log("æˆæœè¯¦æƒ…å“åº”:",e),e&&200===e.code&&e.data)return pe(e.data);throw new Error(e.msg||"è·å–è¯¦æƒ…å¤±è´¥")}catch(e){return console.error("è·å–æˆæœè¯¦æƒ…å¤±è´¥:",e),alert("è·å–è¯¦æƒ…å¤±è´¥: "+(e.message||"è¯·é‡è¯•")),null}},getStatusDisplay(t){return le[t]||t},getStatusClass(t){return ce[t]||""}}},ve=ge,Ce=(0,_.A)(ve,Lt,Et,!1,null,"604895a6",null),we=Ce.exports,fe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cabinet-view"},[e("div",{staticClass:"cabinet-layout",class:{"sidebar-collapsed":t.sidebarCollapsed}},[e("div",{staticClass:"list-pane",class:{collapsed:t.sidebarCollapsed}},[e("div",{staticClass:"toolbar"},[t.sidebarCollapsed?t._e():e("div",{staticClass:"toolbar-buttons"},[e("button",{staticClass:"btn primary small",on:{click:t.createNewDocument}},[t._v("+ æ–°å»ºæ–‡æ¡£")]),e("button",{staticClass:"btn secondary small",on:{click:t.createNewFolder}},[t._v("+ æ–°å»ºæ–‡ä»¶å¤¹")])]),t.sidebarCollapsed?t._e():e("input",{staticClass:"search",attrs:{type:"text",placeholder:"æœç´¢æ–‡æ¡£"}})]),t._l(t.folders,function(s){return t.sidebarCollapsed?t._e():e("div",{key:s.id,staticClass:"folder-section"},[e("div",{staticClass:"group-title",on:{click:function(e){return t.toggleFolder(s.id)}}},[e("span",[t._v(t._s(s.name))]),e("svg",{class:{"folder-icon":!0,expanded:s.expanded},attrs:{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),s.expanded?e("ul",{staticClass:"doc-list"},t._l(t.getDocsInFolder(s.id),function(s){return e("li",{key:s.id,class:{active:s.id===t.activeId},on:{click:function(e){t.activeId=s.id}}},[t._v(t._s(s.title))])}),0):t._e()])}),e("button",{staticClass:"collapse-btn",attrs:{title:t.sidebarCollapsed?"å±•å¼€ä¾§è¾¹æ ":"æŠ˜å ä¾§è¾¹æ "},on:{click:t.toggleSidebar}},[e("svg",{class:{rotated:t.sidebarCollapsed},attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])],2),e("div",{staticClass:"editor-pane",class:{expanded:t.sidebarCollapsed}},[e("div",{staticClass:"doc-meta"},[e("div",{staticClass:"doc-title"},[t._v(t._s(t.activeDoc.title))]),e("div",{staticClass:"doc-updated"},[t._v("æ›´æ–°æ—¥æœŸï¼š"+t._s(t.activeDoc.updated))])]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.activeDocContent,expression:"activeDocContent"}],staticClass:"editor",class:{readonly:!t.isEditing},attrs:{readonly:!t.isEditing},domProps:{value:t.activeDocContent},on:{input:[function(e){e.target.composing||(t.activeDocContent=e.target.value)},t.updateContent]}}),e("div",{staticClass:"editor-footer"},[e("button",{staticClass:"btn"},[t._v("ç‰ˆæœ¬å†å²")]),e("button",{staticClass:"btn"},[t._v("å·®å¼‚å¯¹æ¯”")]),e("div",{staticClass:"flex-spacer"}),t.isEditing?t._e():e("button",{staticClass:"btn secondary",on:{click:t.toggleEditMode}},[t._v(" ç¼–è¾‘ ")]),t.isEditing?e("button",{staticClass:"btn secondary",on:{click:t.cancelEdit}},[t._v(" å–æ¶ˆ ")]):t._e(),e("button",{staticClass:"btn primary",attrs:{disabled:!t.isEditing||!t.hasUnsavedChanges},on:{click:t.saveDocument}},[t._v(" "+t._s(t.isEditing&&t.hasUnsavedChanges?"ä¿å­˜*":"å·²ä¿å­˜")+" ")])])])]),t.showNewDocDialog?e("div",{staticClass:"upload-dialog-overlay",on:{click:t.closeNewDocDialog}},[e("div",{staticClass:"upload-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("h3",[t._v("æ–°å»ºæ–‡æ¡£")]),e("button",{staticClass:"close-btn",on:{click:t.closeNewDocDialog}},[t._v("Ã—")])]),e("div",{staticClass:"dialog-content"},[e("div",{staticClass:"form-group"},[e("label",[t._v("æ–‡æ¡£æ ‡é¢˜ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newDocTitle,expression:"newDocTitle"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜"},domProps:{value:t.newDocTitle},on:{input:function(e){e.target.composing||(t.newDocTitle=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("æ–‡æ¡£åˆ†ç±»ï¼š")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newDocCategory,expression:"newDocCategory"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.newDocCategory=e.target.multiple?s:s[0]}}},t._l(t.folders,function(s){return e("option",{key:s.id,domProps:{value:s.name}},[t._v(t._s(s.name))])}),0)]),e("div",{staticClass:"form-group"},[e("label",[t._v("æ–‡æ¡£å†…å®¹ï¼š")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.newDocContent,expression:"newDocContent"}],attrs:{placeholder:"è¯·è¾“å…¥æ–‡æ¡£å†…å®¹",rows:"10"},domProps:{value:t.newDocContent},on:{input:function(e){e.target.composing||(t.newDocContent=e.target.value)}}})]),e("div",{staticClass:"dialog-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.closeNewDocDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:!t.newDocTitle},on:{click:t.confirmNewDoc}},[t._v("ç¡®è®¤åˆ›å»º")])])])])]):t._e(),t.showNewFolderDialog?e("div",{staticClass:"upload-dialog-overlay",on:{click:t.closeNewFolderDialog}},[e("div",{staticClass:"upload-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("h3",[t._v("æ–°å»ºæ–‡ä»¶å¤¹")]),e("button",{staticClass:"close-btn",on:{click:t.closeNewFolderDialog}},[t._v("Ã—")])]),e("div",{staticClass:"dialog-content"},[e("div",{staticClass:"form-group"},[e("label",[t._v("æ–‡ä»¶å¤¹åç§°ï¼š")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newFolderName,expression:"newFolderName"}],attrs:{type:"text",placeholder:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°"},domProps:{value:t.newFolderName},on:{input:function(e){e.target.composing||(t.newFolderName=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("æ–‡ä»¶å¤¹æè¿°ï¼š")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.newFolderDescription,expression:"newFolderDescription"}],attrs:{placeholder:"è¯·è¾“å…¥æ–‡ä»¶å¤¹æè¿°ï¼ˆå¯é€‰ï¼‰",rows:"3"},domProps:{value:t.newFolderDescription},on:{input:function(e){e.target.composing||(t.newFolderDescription=e.target.value)}}})]),e("div",{staticClass:"dialog-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.closeNewFolderDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:!t.newFolderName},on:{click:t.confirmNewFolder}},[t._v("ç¡®è®¤åˆ›å»º")])])])])]):t._e()])},ke=[],ye={name:"KnowledgeBaseCabinet",props:{projectId:{type:[String,Number],default:null}},data(){return{activeId:1,showNewDocDialog:!1,showNewFolderDialog:!1,newDocTitle:"",newDocCategory:"",newDocContent:"",newFolderName:"",newFolderDescription:"",hasUnsavedChanges:!1,autoSaveTimer:null,isEditing:!1,sidebarCollapsed:!1,folders:[{id:1,name:"é¡¹ç›®ç®¡ç†è§„èŒƒ",description:"é¡¹ç›®ç®¡ç†å’Œè§„èŒƒç›¸å…³æ–‡æ¡£",expanded:!0},{id:2,name:"ä¼šè®®çºªè¦",description:"ä¼šè®®è®°å½•å’Œçºªè¦",expanded:!0},{id:3,name:"åŸ¹è®­èµ„æ–™",description:"åŸ¹è®­å’Œå­¦ä¹ èµ„æ–™",expanded:!0}],docs:[{id:1,title:"é¡¹ç›®ç®¡ç†è§„èŒƒ v2.1",updated:"2023å¹´11æœˆ15æ—¥",content:"é¡¹ç›®ç®¡ç†è§„èŒƒ v2.1\næ›´æ–°æ—¥æœŸï¼š2023å¹´11æœˆ15æ—¥\n1. é¡¹ç›®å¯åŠ¨é˜¶æ®µ...\n(æ­¤å¤„ä¸ºç¤ºä¾‹å†…å®¹ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®æ–‡æ¡£å†…å®¹ã€‚)"},{id:2,title:"é¡¹ç›®ç®¡ç†è§„èŒƒ v2.0",updated:"2023å¹´10æœˆ15æ—¥",content:"é¡¹ç›®ç®¡ç†è§„èŒƒ v2.0\næ›´æ–°æ—¥æœŸï¼š2023å¹´10æœˆ15æ—¥\n1. é¡¹ç›®å¯åŠ¨é˜¶æ®µ...\n(æ­¤å¤„ä¸ºç¤ºä¾‹å†…å®¹ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®æ–‡æ¡£å†…å®¹ã€‚)"},{id:3,title:"é¡¹ç›®ç®¡ç†è§„èŒƒ v1.9",updated:"2023å¹´09æœˆ15æ—¥",content:"é¡¹ç›®ç®¡ç†è§„èŒƒ v1.9\næ›´æ–°æ—¥æœŸï¼š2023å¹´09æœˆ15æ—¥\n1. é¡¹ç›®å¯åŠ¨é˜¶æ®µ...\n(æ­¤å¤„ä¸ºç¤ºä¾‹å†…å®¹ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®æ–‡æ¡£å†…å®¹ã€‚)"}]}},computed:{activeDoc(){return this.docs.find(t=>t.id===this.activeId)||this.docs[0]},activeDocContent:{get(){return this.activeDoc?this.activeDoc.content:""},set(t){this.activeDoc&&(this.activeDoc.content=t)}}},mounted(){this.loadFromLocalStorage(),window.addEventListener("beforeunload",this.handleBeforeUnload)},beforeDestroy(){this.hasUnsavedChanges&&this.saveDocument(),this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),window.removeEventListener("beforeunload",this.handleBeforeUnload)},methods:{createNewDocument(){this.showNewDocDialog=!0,this.newDocCategory=this.folders[0]?.name||""},closeNewDocDialog(){this.showNewDocDialog=!1,this.newDocTitle="",this.newDocCategory="",this.newDocContent=""},createNewFolder(){this.showNewFolderDialog=!0,this.newFolderName="",this.newFolderDescription=""},closeNewFolderDialog(){this.showNewFolderDialog=!1,this.newFolderName="",this.newFolderDescription=""},confirmNewFolder(){if(!this.newFolderName.trim())return;const t={id:Date.now(),name:this.newFolderName.trim(),description:this.newFolderDescription.trim(),expanded:!0};this.folders.push(t),this.saveToLocalStorage(),this.closeNewFolderDialog()},toggleFolder(t){const e=this.folders.find(e=>e.id===t);e&&(e.expanded=!e.expanded,this.saveToLocalStorage())},toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},getDocsInFolder(t){return this.docs.filter(e=>e.folderId===t)},toggleEditMode(){this.isEditing=!0,this.activeDocContent!==this.activeDoc.content&&(this.hasUnsavedChanges=!0)},cancelEdit(){this.hasUnsavedChanges?confirm("æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦å–æ¶ˆç¼–è¾‘å—ï¼Ÿ")&&(this.isEditing=!1,this.hasUnsavedChanges=!1,this.loadCurrentDocContent()):(this.isEditing=!1,this.hasUnsavedChanges=!1)},loadCurrentDocContent(){const t=this.docs.find(t=>t.id===this.activeId);t&&(this.activeDocContent=t.content)},confirmNewDoc(){if(this.newDocTitle){const t=this.folders.find(t=>t.name===this.newDocCategory),e={id:Date.now(),title:this.newDocTitle,updated:(new Date).toLocaleString("zh-CN"),content:this.newDocContent||"æ–°å»ºæ–‡æ¡£å†…å®¹...",folderId:t?.id||null};this.docs.unshift(e),this.activeId=e.id,this.closeNewDocDialog(),this.saveToLocalStorage(),this.$emit("document-created",e),alert("æ–‡æ¡£åˆ›å»ºæˆåŠŸï¼å·²è‡ªåŠ¨ä¿å­˜ã€‚")}},updateContent(){this.isEditing&&(this.hasUnsavedChanges=!0,this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{this.autoSave()},3e3))},saveDocument(){this.activeDoc&&(this.activeDoc.content=this.activeDocContent,this.activeDoc.updated=(new Date).toLocaleString("zh-CN"),this.saveToLocalStorage(),this.hasUnsavedChanges=!1,this.isEditing=!1,this.$emit("document-saved",this.activeDoc),alert("æ–‡æ¡£ä¿å­˜æˆåŠŸï¼"))},autoSave(){this.activeDoc&&this.hasUnsavedChanges&&(this.activeDoc.updated=(new Date).toLocaleString("zh-CN"),this.saveToLocalStorage(),this.hasUnsavedChanges=!1,this.$emit("document-auto-saved",this.activeDoc),console.log("æ–‡æ¡£å·²è‡ªåŠ¨ä¿å­˜"))},saveToLocalStorage(){try{const t={docs:this.docs,folders:this.folders,activeId:this.activeId,hasUnsavedChanges:this.hasUnsavedChanges},e=this.projectId?`knowledgeBaseDocs_${this.projectId}`:"knowledgeBaseDocs";localStorage.setItem(e,JSON.stringify(t)),console.log(`çŸ¥è¯†æŸœæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ (é¡¹ç›®ID: ${this.projectId})`)}catch(t){console.error("ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:",t)}},loadFromLocalStorage(){try{const t=this.projectId?`knowledgeBaseDocs_${this.projectId}`:"knowledgeBaseDocs",e=localStorage.getItem(t);if(e){const t=JSON.parse(e);t.docs&&Array.isArray(t.docs)&&t.docs.length>0&&(this.docs=t.docs,console.log(`çŸ¥è¯†æŸœæ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½ (é¡¹ç›®ID: ${this.projectId})`)),t.folders&&Array.isArray(t.folders)&&t.folders.length>0&&(this.folders=t.folders,console.log(`æ–‡ä»¶å¤¹æ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½ (é¡¹ç›®ID: ${this.projectId})`)),t.activeId&&(this.activeId=t.activeId),void 0!==t.hasUnsavedChanges&&(this.hasUnsavedChanges=t.hasUnsavedChanges)}}catch(t){console.error("ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¤±è´¥:",t)}},handleBeforeUnload(t){if(this.hasUnsavedChanges)return t.preventDefault(),t.returnValue="æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ","æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ"}}},be=ye,_e=(0,_.A)(be,fe,ke,!1,null,"5ba98c20",null),Ie=_e.exports,Fe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai-view"},[e("div",{staticClass:"page-header"},[t._m(0),e("p",{staticClass:"page-subtitle"},[e("svg",{staticClass:"subtitle-icon",attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 2L2 7L12 12L22 7L12 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M2 17L12 22L22 17M2 12L12 17L22 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" æ™ºèƒ½é—®ç­”ä¸å†…å®¹ç”ŸæˆæœåŠ¡ï¼ŒåŠ©åŠ›æ‚¨çš„ç ”ç©¶å·¥ä½œ ")])]),e("div",{staticClass:"chat-card"},[e("div",{ref:"chatWindow",staticClass:"chat-window"},[e("div",{staticClass:"bubble left"},[t._v(" æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨ç”Ÿæˆæ–‡æ¡£ç»“æ„æçº²ã€å…³é”®è¯æ‘˜è¦ï¼Œä¹Ÿå¯ä»¥ç»“åˆçŸ¥è¯†åº“å›ç­”é—®é¢˜ã€‚è¯·é—®æ‚¨æœ‰ä»€ä¹ˆè¦ååŠ©çš„å—ï¼Ÿ ")]),t._l(t.messages,function(s){return e("div",{key:s.id,staticClass:"bubble",class:s.type},[t._v(" "+t._s(s.content)+" ")])})],2),e("div",{staticClass:"composer"},[e("div",{staticClass:"file-menu-wrapper"},[e("button",{staticClass:"file-select-btn",attrs:{disabled:t.isSending,title:"é€‰æ‹©æ–‡ä»¶",type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toggleFileMenu.apply(null,arguments)}}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V9L13 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M13 2V9H20",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M8 13H16M8 17H12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.showFileMenu?e("div",{staticClass:"file-dropdown-menu"},[e("div",{staticClass:"dropdown-item",on:{click:t.openFileDialogFromArchive}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9 22V12H15V22",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("ä»æˆæœæ¡£æ¡ˆæ‰“å¼€æ–‡ä»¶")])]),e("div",{staticClass:"dropdown-item",on:{click:t.openFileUpload}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M7 10L12 15L17 10M12 15V3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("ä»æœ¬åœ°ä¸Šä¼ æ–‡æ¡£")])])]):t._e()]),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.handleFileUpload}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputMessage,expression:"inputMessage"}],staticClass:"composer-input",attrs:{type:"text",placeholder:"è¾“å…¥æ‚¨çš„é—®é¢˜...",disabled:t.isSending},domProps:{value:t.inputMessage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.inputMessage=e.target.value)}}}),e("button",{staticClass:"send-btn",attrs:{disabled:!t.inputMessage.trim()||t.isSending},on:{click:t.sendMessage}},[t.isSending?e("div",{staticClass:"loading-spinner"}):e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M22 2L11 13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M22 2L15 22L11 13L2 9L22 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),t.showFileDialog?e("div",{staticClass:"file-dialog-overlay",on:{click:t.closeFileDialog}},[e("div",{staticClass:"file-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"file-dialog-header"},[e("div",{staticClass:"header-content"},[e("h3",[t._v("é€‰æ‹©æˆæœç›®å½•æ–‡ä»¶")]),t.selectedFiles.length>0?e("p",{staticClass:"header-subtitle"},[t._v("å·²é€‰æ‹© "+t._s(t.selectedFiles.length)+" é¡¹")]):t._e()]),e("button",{staticClass:"close-btn",on:{click:t.closeFileDialog}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"file-dialog-body"},[t.loadingFiles?e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loading-spinner-large"}),e("p",{staticClass:"loading-text"},[t._v("æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...")])]):0===t.files.length?e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[e("svg",{attrs:{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V9L13 2Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M13 2V9H20",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-text"},[t._v("æˆæœç›®å½•ä¸­æš‚æ— æ–‡ä»¶")])]):e("div",{staticClass:"file-list-container"},[e("div",{staticClass:"file-list"},t._l(t.files,function(s){return e("div",{key:s.id,staticClass:"file-card",class:{selected:t.selectedFiles.includes(s.id)},on:{click:function(e){return t.toggleFileSelection(s.id)}}},[e("div",{staticClass:"file-card-content"},[e("div",{staticClass:"file-card-main"},[e("div",{staticClass:"file-name-wrapper"},[e("div",{staticClass:"file-name"},[t._v(t._s(s.name||s.title||"æœªå‘½åæ–‡ä»¶"))]),e("div",{staticClass:"file-badge-group"},[e("span",{staticClass:"file-type-badge"},[t._v(t._s(s.type||"æœªçŸ¥ç±»å‹"))]),s.fileCount?e("span",{staticClass:"file-count-badge"},[t._v(t._s(s.fileCount)+"ä¸ªæ–‡ä»¶")]):t._e()])])]),e("div",{staticClass:"file-select-indicator",class:{active:t.selectedFiles.includes(s.id)}},[e("div",{staticClass:"checkmark-circle"},[t.selectedFiles.includes(s.id)?e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})]):t._e()])])])])}),0)])]),e("div",{staticClass:"file-dialog-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeFileDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn-confirm",class:{disabled:0===t.selectedFiles.length},attrs:{disabled:0===t.selectedFiles.length},on:{click:t.confirmFileSelection}},[e("span",[t._v("ç¡®è®¤é€‰æ‹©")]),t.selectedFiles.length>0?e("span",{staticClass:"selected-count"},[t._v(t._s(t.selectedFiles.length))]):t._e()])])])]):t._e()])])},Se=[function(){var t=this,e=t._self._c;return e("h1",{staticClass:"page-title"},[e("span",{staticClass:"title-text"},[t._v("AIèµ‹èƒ½åŠ©æ‰‹")]),e("div",{staticClass:"title-decoration"})])}];const De=N().create({baseURL:"",timeout:3e5,headers:{"Content-Type":"application/json",Accept:"text/event-stream, application/json"},withCredentials:!0});function je(t,e){t.accumulated||(t.accumulated="");let s=e;if(e.startsWith("data: ")?s=e.substring(6):e.startsWith("data:")&&(s=e.substring(5)),!s.trim())return null;if(t.accumulated){const e=s.trim(),a=t.accumulated.trim();a.startsWith("{")||a.startsWith("[")||!e.includes(":")||(t.accumulated="{"+(t.accumulated?"\n":"")+t.accumulated),e.startsWith("}")||e.startsWith("]")||a.endsWith(",")||t.accumulated.endsWith("\n")||t.accumulated.endsWith(" ")||t.accumulated.endsWith("{")||t.accumulated.endsWith("[")||(t.accumulated+="\n")}else{const e=s.trim();!e.includes(":")||e.startsWith("{")||e.startsWith("[")||e.startsWith("}")||e.startsWith("]")||(t.accumulated="{\n")}const a=s.trim();if(a.startsWith("{")||a.startsWith("["))if(t.accumulated.trim()){const e=t.accumulated.trim();try{const a=JSON.parse(e);return t.accumulated=s,a}catch(i){console.warn("[cozeAPI] ä¸¢å¼ƒæ— æ³•è§£æçš„ç¼“å†²åŒºå†…å®¹:",e.substring(0,100)),t.accumulated=s}}else t.accumulated=s;else t.accumulated+=s;try{let e=t.accumulated.trim();if(e.startsWith("{")&&!e.endsWith("}")){const t=(e.match(/\{/g)||[]).length,s=(e.match(/\}/g)||[]).length;if(t>s)return null}if(e.startsWith("[")&&!e.endsWith("]")){const t=(e.match(/\[/g)||[]).length,s=(e.match(/\]/g)||[]).length;if(t>s)return null}const s=JSON.parse(e);return t.accumulated="",s}catch(i){const e=t.accumulated.trim();if(!e.startsWith("{")&&!e.startsWith("[")){if(e.includes(":")||"}"===e||"]"===e){if(t.accumulated.length>1e5){console.error("[cozeAPI] JSON ç¼“å†²åŒºè¿‡å¤§ï¼ˆ>100KBï¼‰ï¼Œå¯èƒ½æ ¼å¼é”™è¯¯ï¼Œæ¸…ç©ºç¼“å†²åŒº");const e=t.accumulated;return t.accumulated="",{error:!0,rawData:e.substring(0,200)}}return null}return console.warn("[cozeAPI] æ£€æµ‹åˆ°æ— æ•ˆçš„ JSON ç‰‡æ®µ:",e.substring(0,100)),t.accumulated="",{error:!0,rawData:e.substring(0,200)}}if(t.accumulated.length>1e5){console.error("[cozeAPI] JSON ç¼“å†²åŒºè¿‡å¤§ï¼ˆ>100KBï¼‰ï¼Œå¯èƒ½æ ¼å¼é”™è¯¯ï¼Œæ¸…ç©ºç¼“å†²åŒº");const e=t.accumulated;return t.accumulated="",{error:!0,rawData:e.substring(0,200)}}return null}}De.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers.Authorization=`Bearer ${e}`),t.data instanceof FormData?(delete t.headers["Content-Type"],console.log("Coze APIè¯·æ±‚ (FormData):",t.method?.toUpperCase(),t.url)):console.log("Coze APIè¯·æ±‚:",t.method?.toUpperCase(),t.url),t},t=>(console.error("è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:",t),Promise.reject(t))),De.interceptors.response.use(t=>(console.log("Coze APIå“åº”:",t.status,t.data),t.data),t=>{if(console.error("Coze APIé”™è¯¯:",t),t.response){const{status:e,data:s}=t.response;return console.error("æœåŠ¡å™¨é”™è¯¯:",e,s),401===e&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),Promise.reject(s||t)}return t.request?(console.error("ç½‘ç»œé”™è¯¯:",t.request),Promise.reject(new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡"))):(console.error("å…¶ä»–é”™è¯¯:",t.message),Promise.reject(t))});const Te={chatStream(t,e=null,s=null,a,i,o){console.log("[cozeAPI.chatStream] å¼€å§‹æµå¼å¯¹è¯, query:",t,"conversationId:",e);const r=localStorage.getItem("access_token");if(!r){const t=new Error("æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•");return console.error("[cozeAPI.chatStream] è®¤è¯å¤±è´¥:",t.message),i&&i(t),Promise.reject(t)}let n="/zhiyan/api/coze/chat/stream";const l=new URLSearchParams;l.append("query",t),e&&l.append("conversationId",e),n+="?"+l.toString();let c=null;return c=s&&Object.keys(s).length>0?JSON.stringify(s):"{}",console.log("[cozeAPI.chatStream] è¯·æ±‚URL:",n),console.log("[cozeAPI.chatStream] Tokenå­˜åœ¨:",!!r),fetch(n,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"},body:c,credentials:"include"}).then(t=>{if(console.log("[cozeAPI.chatStream] å“åº”çŠ¶æ€:",t.status,t.statusText),401===t.status||403===t.status){const e=new Error("è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•");throw console.error("[cozeAPI.chatStream] è®¤è¯å¤±è´¥:",t.status),i&&i(e),e}const e=t.headers.get("content-type");if(console.log("[cozeAPI.chatStream] å“åº”Content-Type:",e),console.log("[cozeAPI.chatStream] å“åº”URL:",t.url),!e||!e.includes("text/event-stream"))return console.warn("[cozeAPI.chatStream] å“åº”ç±»å‹ä¸æ˜¯SSE:",e),t.text().then(s=>{if(console.error("[cozeAPI.chatStream] éSSEå“åº”å†…å®¹ï¼ˆå‰500å­—ç¬¦ï¼‰:",s.substring(0,500)),e&&e.includes("text/html")){const t=new Error(`æœåŠ¡å™¨è¿”å›äº†HTMLé¡µé¢ï¼Œå¯èƒ½æ˜¯è®¤è¯å¤±è´¥æˆ–è¯·æ±‚è¢«æ‹¦æˆªã€‚å“åº”å†…å®¹: ${s.substring(0,200)}`);throw console.error("[cozeAPI.chatStream] HTMLå“åº”ï¼Œå¯èƒ½æ˜¯è®¤è¯é—®é¢˜æˆ–è·¯å¾„é”™è¯¯"),i&&i(t),t}const a=new Error(`æœåŠ¡å™¨é”™è¯¯: ${t.status} - ${s.substring(0,200)}`);throw i&&i(a),a});if(!t.ok){const e=new Error(`HTTP error! status: ${t.status}`);throw console.error("[cozeAPI.chatStream] HTTPé”™è¯¯:",t.status),i&&i(e),e}const s=t.body.getReader(),r=new TextDecoder;let n="";const l={accumulated:""},c=()=>{s.read().then(({done:t,value:e})=>{if(t){if(n.trim()){console.log("[cozeAPI.chatStream] æµç»“æŸï¼Œå¤„ç†å‰©ä½™ç¼“å†²åŒº:",n);const t=n.split("\n");for(const e of t)if(e.startsWith("data:")||e.trim().startsWith("data:")){const t=je(l,e);t&&!t.error&&a&&a(t)}else if(e.startsWith("event: ")||e.trim().startsWith("event:")){const t=e.includes(":")?e.substring(e.indexOf(":")+1).trim():e.trim();console.log("[cozeAPI.chatStream] æµç»“æŸæ—¶çš„äº‹ä»¶ç±»å‹:",t)}}if(l.accumulated.trim()){console.warn("[cozeAPI.chatStream] æµç»“æŸï¼Œä½†ä»æœ‰æœªè§£æçš„ JSON æ•°æ®:",l.accumulated);try{const t=JSON.parse(l.accumulated);a&&a(t)}catch(d){console.error("[cozeAPI.chatStream] æ— æ³•è§£æå‰©ä½™çš„ JSON æ•°æ®:",d,"åŸå§‹æ•°æ®:",l.accumulated)}l.accumulated=""}return void(o&&o())}n+=r.decode(e,{stream:!0});const s=n.split("\n");n=s.pop()||"";for(const o of s)if(o.trim()&&console.log("[cozeAPI.chatStream] æ”¶åˆ°SSEè¡Œ:",o.substring(0,100)),o.startsWith("data:")||o.trim().startsWith("data:")){let t=o.substring(o.indexOf("data:")+5).trim();if(!t){console.log("[cozeAPI.chatStream] è·³è¿‡ç©º data: è¡Œ");continue}console.log("[cozeAPI.chatStream] å‡†å¤‡è§£æ JSON:",t.substring(0,100));try{const e=JSON.parse(t);console.log("[cozeAPI.chatStream] âœ… JSON è§£ææˆåŠŸ, event:",e.event,", content:",e.content?.substring(0,20)),a?(console.log("[cozeAPI.chatStream] è°ƒç”¨ onMessage å›è°ƒ"),a(e)):console.warn("[cozeAPI.chatStream] âš  onMessage å›è°ƒä¸å­˜åœ¨")}catch(d){console.warn("[cozeAPI.chatStream] âŒ JSON è§£æå¤±è´¥:",d.message,", å°è¯•ç´¯ç§¯:",t.substring(0,50));const e=je(l,o);e&&(e.error?(console.error("[cozeAPI.chatStream] JSON è§£æé”™è¯¯:",e.rawData),i&&i(new Error("JSON è§£æå¤±è´¥: "+e.rawData.substring(0,100)))):(console.log("[cozeAPI.chatStream] âœ… ç¼“å†²åŒºè§£ææˆåŠŸ, event:",e.event),a&&a(e)))}}else if(o.startsWith("event: ")||o.trim().startsWith("event:")){const t=o.includes(":")?o.substring(o.indexOf(":")+1).trim():o.trim();console.log("[cozeAPI.chatStream] SSEäº‹ä»¶ç±»å‹:",t)}else o.trim()&&!o.startsWith(":")&&console.warn("[cozeAPI.chatStream] æ£€æµ‹åˆ°æœªè¯†åˆ«çš„SSEè¡Œ:",o.substring(0,100));c()}).catch(t=>{console.error("[cozeAPI.chatStream] è¯»å–SSEæµå¤±è´¥:",t),i&&i(t)})};return c(),{close:()=>{s.cancel()}}}).catch(t=>{throw console.error("å‘èµ·SSEè¯·æ±‚å¤±è´¥:",t),i&&i(t),t})},chatStreamWithFiles(t,e=null,s=null,a=null,i=null,o,r,n){console.log("[cozeAPI.chatStreamWithFiles] å¼€å§‹å¸¦æ–‡ä»¶çš„æµå¼å¯¹è¯",{query:t,conversationId:e,localFilesCount:s?s.length:0,knowledgeFileIdsCount:a?a.length:0});const l=localStorage.getItem("access_token");if(!l){const t=new Error("æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•");return console.error("[cozeAPI.chatStreamWithFiles] è®¤è¯å¤±è´¥:",t.message),r&&r(t),Promise.reject(t)}const c=new FormData;c.append("query",t),e&&c.append("conversationId",e),s&&s.length>0&&s.forEach(t=>{c.append("localFiles",t)}),a&&a.length>0&&a.forEach(t=>{c.append("knowledgeFileIds",t.toString())}),i&&Object.keys(i).length>0&&c.append("customVariables",JSON.stringify(i));const d="/zhiyan/api/coze/chat/stream-with-files";return console.log("[cozeAPI.chatStreamWithFiles] è¯·æ±‚URL:",d),console.log("[cozeAPI.chatStreamWithFiles] Tokenå­˜åœ¨:",!!l),fetch(d,{method:"POST",headers:{Authorization:`Bearer ${l}`,Accept:"text/event-stream","Cache-Control":"no-cache"},body:c,credentials:"include"}).then(t=>{if(console.log("[cozeAPI.chatStreamWithFiles] å“åº”çŠ¶æ€:",t.status,t.statusText),401===t.status||403===t.status){const e=new Error("è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•");throw console.error("[cozeAPI.chatStreamWithFiles] è®¤è¯å¤±è´¥:",t.status),r&&r(e),e}const e=t.headers.get("content-type");if((!e||!e.includes("text/event-stream"))&&(console.warn("[cozeAPI.chatStreamWithFiles] å“åº”ç±»å‹ä¸æ˜¯SSE:",e),200!==t.status))return t.text().then(e=>{console.error("[cozeAPI.chatStreamWithFiles] é”™è¯¯å“åº”å†…å®¹:",e);const s=new Error(`æœåŠ¡å™¨é”™è¯¯: ${t.status} - ${e}`);throw r&&r(s),s});if(!t.ok){const e=new Error(`HTTP error! status: ${t.status}`);throw console.error("[cozeAPI.chatStreamWithFiles] HTTPé”™è¯¯:",t.status),r&&r(e),e}const s=t.body.getReader(),a=new TextDecoder;let i="";const l={accumulated:""},c=()=>{s.read().then(({done:t,value:e})=>{if(t){if(i.trim()){console.log("[cozeAPI.chatStreamWithFiles] æµç»“æŸï¼Œå¤„ç†å‰©ä½™ç¼“å†²åŒº:",i);const t=i.split("\n");for(const e of t)if(e.startsWith("data:")||e.trim().startsWith("data:")){const t=je(l,e);t&&!t.error&&o&&o(t)}else if(e.startsWith("event: ")||e.trim().startsWith("event:")){const t=e.includes(":")?e.substring(e.indexOf(":")+1).trim():e.trim();console.log("[cozeAPI.chatStreamWithFiles] æµç»“æŸæ—¶çš„äº‹ä»¶ç±»å‹:",t)}}if(l.accumulated.trim()){console.warn("[cozeAPI.chatStreamWithFiles] æµç»“æŸï¼Œä½†ä»æœ‰æœªè§£æçš„ JSON æ•°æ®:",l.accumulated);try{const t=JSON.parse(l.accumulated);o&&o(t)}catch(d){console.error("[cozeAPI.chatStreamWithFiles] æ— æ³•è§£æå‰©ä½™çš„ JSON æ•°æ®:",d,"åŸå§‹æ•°æ®:",l.accumulated)}l.accumulated=""}return void(n&&n())}i+=a.decode(e,{stream:!0});const s=i.split("\n");i=s.pop()||"";for(const a of s)if(a.startsWith("data:")||a.trim().startsWith("data:")){let t=a.substring(a.indexOf("data:")+5).trim();if(!t)continue;try{const e=JSON.parse(t);o&&o(e)}catch(d){console.warn("[cozeAPI.chatStreamWithFiles] JSON è§£æå¤±è´¥ï¼Œå°è¯•ç´¯ç§¯:",t.substring(0,50));const e=je(l,a);e&&(e.error?(console.error("[cozeAPI.chatStreamWithFiles] JSON è§£æé”™è¯¯:",e.rawData),r&&r(new Error("JSON è§£æå¤±è´¥: "+e.rawData.substring(0,100)))):o&&o(e))}}else if(a.startsWith("event: ")||a.trim().startsWith("event:")){const t=a.includes(":")?a.substring(a.indexOf(":")+1).trim():a.trim();console.log("[cozeAPI.chatStreamWithFiles] SSEäº‹ä»¶ç±»å‹:",t)}else a.trim()&&!a.startsWith(":")&&console.warn("[cozeAPI.chatStreamWithFiles] æ£€æµ‹åˆ°æœªè¯†åˆ«çš„SSEè¡Œ:",a.substring(0,100));c()}).catch(t=>{console.error("[cozeAPI.chatStreamWithFiles] è¯»å–SSEæµå¤±è´¥:",t),r&&r(t)})};return c(),{close:()=>{s.cancel()}}}).catch(t=>{throw console.error("[cozeAPI.chatStreamWithFiles] å‘èµ·SSEè¯·æ±‚å¤±è´¥:",t),r&&r(t),t})},uploadFile(t){console.log("[cozeAPI.uploadFile] ä¸Šä¼ æ–‡ä»¶, fileName:",t?.name);const e=new FormData;return e.append("file",t),De.post("/zhiyan/api/coze/files/upload",e)},uploadFiles(t){console.log("[cozeAPI.uploadFiles] æ‰¹é‡ä¸Šä¼ æ–‡ä»¶, fileCount:",t?.length);const e=new FormData;return t.forEach(t=>{e.append("files",t)}),De.post("/zhiyan/api/coze/files/upload/batch",e)},getFileDetail(t){return console.log("[cozeAPI.getFileDetail] æŸ¥è¯¢æ–‡ä»¶è¯¦æƒ…, fileId:",t),De.get(`/zhiyan/api/coze/files/${t}`)},getChatDetail(t,e){return console.log("[cozeAPI.getChatDetail] æŸ¥è¯¢å¯¹è¯è¯¦æƒ…",{conversationId:t,chatId:e}),De.get("/zhiyan/api/coze/chat/detail",{params:{conversationId:t,chatId:e}})}};var Pe={name:"KnowledgeBaseAI",props:{projectId:{type:[String,Number],default:null}},data(){return{inputMessage:"",isSending:!1,messages:[],showFileDialog:!1,showFileMenu:!1,files:[],loadingFiles:!1,selectedFiles:[],selectedLocalFiles:[],selectedKnowledgeFileIds:[],conversationId:null,currentStreamController:null}},mounted(){this.loadMessagesFromStorage(),this.loadConversationId(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){this.currentStreamController&&(this.currentStreamController.close(),this.currentStreamController=null),this.saveMessagesToStorage(),this.saveConversationId(),document.removeEventListener("click",this.handleClickOutside)},methods:{async sendMessage(){if(!this.inputMessage.trim()||this.isSending)return;const t={id:Date.now(),type:"right",content:this.inputMessage.trim()};if(this.selectedLocalFiles.length>0||this.selectedKnowledgeFileIds.length>0){const e=[];if(this.selectedLocalFiles.length>0&&e.push(`æœ¬åœ°æ–‡ä»¶: ${this.selectedLocalFiles.map(t=>t.name).join(", ")}`),this.selectedKnowledgeFileIds.length>0){const t=this.files.filter(t=>this.selectedKnowledgeFileIds.includes(t.id)).map(t=>t.name||t.title||"æœªå‘½åæ–‡ä»¶");e.push(`çŸ¥è¯†åº“æ–‡ä»¶: ${t.join(", ")}`)}t.content+="\n\n["+e.join(" | ")+"]"}this.messages.push(t);const e=this.inputMessage.trim();this.inputMessage="",this.isSending=!0;const s=Date.now()+1,a={id:s,type:"left",content:""};this.messages.push(a),this.saveMessagesToStorage(),this.$nextTick(()=>{this.scrollToBottom()});try{const t=this.selectedLocalFiles.length>0?this.selectedLocalFiles:null,s=this.selectedKnowledgeFileIds.length>0?this.selectedKnowledgeFileIds.map(t=>{const e="string"===typeof t?parseInt(t,10):t;return isNaN(e)?null:e}).filter(t=>null!==t):null;this.selectedLocalFiles=[],this.selectedKnowledgeFileIds=[],this.currentStreamController=t||s?await Te.chatStreamWithFiles(e,this.conversationId,t,s,null,t=>{this.handleStreamMessage(t,a)},t=>{this.handleStreamError(t,a)},()=>{this.handleStreamComplete(a)}):await Te.chatStream(e,this.conversationId,null,t=>{this.handleStreamMessage(t,a)},t=>{this.handleStreamError(t,a)},()=>{this.handleStreamComplete(a)})}catch(i){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",i),a.content="æŠ±æ­‰ï¼Œå‘é€æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼š"+(i.message||"æœªçŸ¥é”™è¯¯"),this.isSending=!1,this.saveMessagesToStorage()}},handleStreamMessage(t,e){console.log("æ”¶åˆ°æµå¼æ¶ˆæ¯:",t);const s=t.event;if((t.conversationId||t.conversation_id)&&(this.conversationId=t.conversationId||t.conversation_id,this.saveConversationId()),"conversation.chat.created"===s)console.log("å¯¹è¯å·²åˆ›å»º, conversationId:",this.conversationId);else if("conversation.message.delta"===s){const s=t.content;s&&"assistant"===t.role&&(e.content+=s,this.$nextTick(()=>{this.scrollToBottom()}))}else"conversation.message.completed"===s?(console.log("æ¶ˆæ¯å·²å®Œæˆ"),t.content&&"assistant"===t.role&&t.content&&!e.content&&(e.content=t.content),this.saveMessagesToStorage()):"conversation.chat.completed"===s?console.log("å¯¹è¯å·²å®Œæˆ"):"conversation.chat.failed"===s?(console.error("å¯¹è¯å¤±è´¥:",t.errorMessage||t.error_message),e.content=e.content||"æŠ±æ­‰ï¼ŒAIå¯¹è¯å¤±è´¥ï¼š"+(t.errorMessage||t.error_message||"æœªçŸ¥é”™è¯¯"),this.isSending=!1,this.currentStreamController=null,this.saveMessagesToStorage()):"done"===s?console.log("æµå¼å“åº”ç»“æŸ"):"error"===s&&(console.error("æµå¼å“åº”é”™è¯¯:",t.errorMessage||t.error_message),e.content=e.content||"æŠ±æ­‰ï¼ŒAIå“åº”æ—¶å‘ç”Ÿé”™è¯¯ï¼š"+(t.errorMessage||t.error_message||"æœªçŸ¥é”™è¯¯"),this.isSending=!1,this.currentStreamController=null,this.saveMessagesToStorage());"conversation.message.delta"===s&&this.saveMessagesToStorage()},handleStreamError(t,e){console.error("æµå¼å“åº”é”™è¯¯:",t),e.content=e.content||"æŠ±æ­‰ï¼ŒAIå“åº”æ—¶å‘ç”Ÿé”™è¯¯ï¼š"+(t.message||"æœªçŸ¥é”™è¯¯"),this.isSending=!1,this.currentStreamController=null,this.saveMessagesToStorage()},handleStreamComplete(t){console.log("æµå¼å“åº”å®Œæˆ"),this.isSending=!1,this.currentStreamController=null,t.content&&""!==t.content.trim()||(t.content="æŠ±æ­‰ï¼ŒAIæ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚"),this.saveMessagesToStorage(),this.$nextTick(()=>{this.scrollToBottom()})},scrollToBottom(){this.$refs.chatWindow&&(this.$refs.chatWindow.scrollTop=this.$refs.chatWindow.scrollHeight)},saveMessagesToStorage(){try{const t=this.projectId?`aiChatMessages_${this.projectId}`:"aiChatMessages";localStorage.setItem(t,JSON.stringify(this.messages)),console.log(`AIå¯¹è¯æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ (é¡¹ç›®ID: ${this.projectId})`)}catch(t){console.error("ä¿å­˜æ¶ˆæ¯å¤±è´¥:",t)}},saveConversationId(){try{const t=this.projectId?`aiConversationId_${this.projectId}`:"aiConversationId";this.conversationId&&(localStorage.setItem(t,this.conversationId),console.log(`å¯¹è¯IDå·²ä¿å­˜: ${this.conversationId}`))}catch(t){console.error("ä¿å­˜å¯¹è¯IDå¤±è´¥:",t)}},loadConversationId(){try{const t=this.projectId?`aiConversationId_${this.projectId}`:"aiConversationId",e=localStorage.getItem(t);e&&(this.conversationId=e,console.log(`å¯¹è¯IDå·²åŠ è½½: ${this.conversationId}`))}catch(t){console.error("åŠ è½½å¯¹è¯IDå¤±è´¥:",t)}},loadMessagesFromStorage(){try{const t=this.projectId?`aiChatMessages_${this.projectId}`:"aiChatMessages",e=localStorage.getItem(t);e?(this.messages=JSON.parse(e),console.log(`AIå¯¹è¯æ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½ (é¡¹ç›®ID: ${this.projectId})`)):this.initializeProjectMessages()}catch(t){console.error("åŠ è½½æ¶ˆæ¯å¤±è´¥:",t)}},initializeProjectMessages(){if(!this.projectId)return;const t=this.getProjectSpecificMessages(this.projectId);t.length>0&&(this.messages=t,this.saveMessagesToStorage(),console.log(`å·²åˆå§‹åŒ–é¡¹ç›® ${this.projectId} çš„AIå¯¹è¯ç¤ºä¾‹`))},getProjectSpecificMessages(t){const e={1:[{id:Date.now()-1e3,type:"left",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯åŒ»å­¦å½±åƒAIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†æCTã€MRIç­‰åŒ»å­¦å½±åƒæ•°æ®ï¼Œç”Ÿæˆè¯Šæ–­æŠ¥å‘Šï¼Œä¼˜åŒ–å›¾åƒå¤„ç†ç®—æ³•ã€‚è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"},{id:Date.now()-500,type:"right",content:"è¯·å¸®æˆ‘åˆ†æä¸€ä¸‹è¿™ä¸ªè‚ºéƒ¨CTå½±åƒçš„å¼‚å¸¸åŒºåŸŸ"},{id:Date.now()-200,type:"left",content:"æˆ‘å·²ç»åˆ†æäº†æ‚¨æä¾›çš„è‚ºéƒ¨CTå½±åƒã€‚æ£€æµ‹åˆ°ä»¥ä¸‹å¼‚å¸¸åŒºåŸŸï¼š\n\n1. å³è‚ºä¸Šå¶å‘ç°ä¸€ä¸ªçº¦2.3cmçš„ç»“èŠ‚\n2. ç»“èŠ‚è¾¹ç¼˜ä¸è§„åˆ™ï¼Œå»ºè®®è¿›ä¸€æ­¥æ£€æŸ¥\n3. å»ºè®®è¿›è¡ŒPET-CTæ‰«æä»¥ç¡®å®šæ€§è´¨\n\néœ€è¦æˆ‘ç”Ÿæˆè¯¦ç»†çš„è¯Šæ–­æŠ¥å‘Šå—ï¼Ÿ"}],2:[{id:Date.now()-1e3,type:"left",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯æ°”å€™é¢„æµ‹AIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†ææ°”è±¡æ•°æ®ï¼Œæ„å»ºé¢„æµ‹æ¨¡å‹ï¼Œç”Ÿæˆæ°”å€™æŠ¥å‘Šã€‚è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"},{id:Date.now()-500,type:"right",content:"è¯·å¸®æˆ‘é¢„æµ‹ä¸‹ä¸ªæœˆçš„æ°”æ¸©è¶‹åŠ¿"},{id:Date.now()-200,type:"left",content:"åŸºäºå½“å‰çš„æ°”è±¡æ•°æ®å’Œå†å²æ¨¡å¼ï¼Œæˆ‘é¢„æµ‹ä¸‹ä¸ªæœˆæ°”æ¸©è¶‹åŠ¿å¦‚ä¸‹ï¼š\n\n1. å¹³å‡æ°”æ¸©å°†æ¯”å»å¹´åŒæœŸé«˜1.2Â°C\n2. æœ€é«˜æ°”æ¸©é¢„è®¡åœ¨28-32Â°Cä¹‹é—´\n3. é™é›¨æ¦‚ç‡ä¸º35%ï¼Œä¸»è¦é›†ä¸­åœ¨æœˆä¸­\n4. å»ºè®®å…³æ³¨æç«¯å¤©æ°”é¢„è­¦\n\néœ€è¦æˆ‘ç”Ÿæˆè¯¦ç»†çš„æ°”å€™åˆ†ææŠ¥å‘Šå—ï¼Ÿ"}],3:[{id:Date.now()-1e3,type:"left",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯åŸºå› ç»„åˆ†æAIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®æ‚¨åˆ†æåŸºå› åºåˆ—ï¼Œè¯†åˆ«å˜å¼‚ä½ç‚¹ï¼Œé¢„æµ‹è›‹ç™½è´¨åŠŸèƒ½ã€‚è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ"},{id:Date.now()-500,type:"right",content:"è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªåŸºå› åºåˆ—çš„å˜å¼‚æƒ…å†µ"},{id:Date.now()-200,type:"left",content:"æˆ‘å·²ç»åˆ†æäº†æ‚¨æä¾›çš„åŸºå› åºåˆ—ï¼Œå‘ç°ä»¥ä¸‹å˜å¼‚ï¼š\n\n1. æ£€æµ‹åˆ°3ä¸ªSNPä½ç‚¹\n2. å…¶ä¸­1ä¸ªä¸ºéåŒä¹‰çªå˜ï¼Œå¯èƒ½å½±å“è›‹ç™½è´¨åŠŸèƒ½\n3. å˜å¼‚é¢‘ç‡åœ¨äººç¾¤ä¸­ä¸º0.15\n4. å»ºè®®è¿›è¡ŒåŠŸèƒ½éªŒè¯å®éªŒ\n\néœ€è¦æˆ‘ç”Ÿæˆè¯¦ç»†çš„å˜å¼‚åˆ†ææŠ¥å‘Šå—ï¼Ÿ"}]};return e[t]||[]},toggleFileMenu(){this.showFileMenu=!this.showFileMenu},async openFileDialogFromArchive(){this.showFileMenu=!1,this.showFileDialog=!0,this.selectedFiles=[],0===this.files.length&&this.projectId&&await this.loadFiles()},openFileUpload(){this.showFileMenu=!1,this.$refs.fileInput.click()},handleFileUpload(t){const e=Array.from(t.target.files);if(e.length>0){console.log("é€‰æ‹©äº†æœ¬åœ°æ–‡ä»¶:",e),this.selectedLocalFiles=e;const t=e.map(t=>t.name).join("ã€"),s=`[å·²é€‰æ‹©æœ¬åœ°æ–‡ä»¶: ${t}]`;this.inputMessage=this.inputMessage.trim()?`${this.inputMessage}\n\n${s}`:s}this.$refs.fileInput.value=""},closeFileDialog(){this.showFileDialog=!1,this.selectedFiles=[]},clearConversation(){confirm("ç¡®å®šè¦æ¸…é™¤å½“å‰å¯¹è¯å†å²å—ï¼Ÿ")&&(this.messages=[],this.conversationId=null,this.selectedLocalFiles=[],this.selectedKnowledgeFileIds=[],this.saveMessagesToStorage(),this.saveConversationId(),this.currentStreamController&&(this.currentStreamController.close(),this.currentStreamController=null),this.isSending=!1)},async loadFiles(){if(this.projectId){this.loadingFiles=!0;try{const t=await de.getProjectAchievements(this.projectId,0,1e3);console.log("è·å–æˆæœåˆ—è¡¨å“åº”:",t),t&&200===t.code&&t.data?(Array.isArray(t.data)?this.files=t.data:t.data.content&&Array.isArray(t.data.content)?this.files=t.data.content:this.files=[],console.log("åŠ è½½æˆæœæ–‡ä»¶åˆ—è¡¨æˆåŠŸï¼Œæ•°é‡:",this.files.length)):(this.files=[],console.warn("è·å–æˆæœåˆ—è¡¨å¤±è´¥:",t))}catch(t){console.error("åŠ è½½æˆæœæ–‡ä»¶åˆ—è¡¨å¤±è´¥:",t),this.files=[]}finally{this.loadingFiles=!1}}else console.warn("é¡¹ç›®IDä¸å­˜åœ¨ï¼Œæ— æ³•åŠ è½½æ–‡ä»¶åˆ—è¡¨")},toggleFileSelection(t){const e=this.selectedFiles.indexOf(t);e>-1?this.selectedFiles.splice(e,1):this.selectedFiles.push(t)},async confirmFileSelection(){if(0===this.selectedFiles.length)return;const t=this.files.filter(t=>this.selectedFiles.includes(t.id)),e=[],s=[];try{for(const o of t)try{const t=await de.getAchievementDetail(o.id);if(t&&200===t.code&&t.data){const a=t.data.files||[];if(a.forEach(t=>{if(t.id){const s="string"===typeof t.id?parseInt(t.id,10):t.id;isNaN(s)||e.push(s)}}),a.length>0){const t=a.map(t=>t.fileName||"æœªå‘½åæ–‡ä»¶").join(", ");s.push(`${o.title||o.name||"æˆæœ"}: ${t}`)}else s.push(`${o.title||o.name||"æˆæœ"}: æ— æ–‡ä»¶`)}}catch(a){console.error(`è·å–æˆæœ ${o.id} çš„æ–‡ä»¶åˆ—è¡¨å¤±è´¥:`,a),s.push(`${o.title||o.name||"æˆæœ"}: è·å–æ–‡ä»¶å¤±è´¥`)}this.selectedKnowledgeFileIds=e;const i=`[å·²é€‰æ‹©çŸ¥è¯†åº“æ–‡ä»¶: ${s.join(" | ")}]`;this.inputMessage=this.inputMessage.trim()?`${this.inputMessage}\n\n${i}`:i,console.log("é€‰ä¸­çš„çŸ¥è¯†åº“æ–‡ä»¶ID:",this.selectedKnowledgeFileIds),console.log("é€‰ä¸­çš„æˆæœ:",t)}catch(a){console.error("ç¡®è®¤æ–‡ä»¶é€‰æ‹©å¤±è´¥:",a),this.$message&&this.$message.error("è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡è¯•")}this.closeFileDialog()},handleClickOutside(t){this.showFileMenu&&!t.target.closest(".file-menu-wrapper")&&(this.showFileMenu=!1)}}},Me=Pe,xe=(0,_.A)(Me,Fe,Se,!1,null,null,null),Ae=xe.exports,Ne=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ai-assistant-container"},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›é¦–é¡µ"},on:{click:t.goToHome}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("AI å®éªŒåˆ†æåŠ©æ‰‹")])]),e("div",{staticClass:"header-right"},[e("button",{staticClass:"sync-status-btn",attrs:{title:"åŒæ­¥ä»»åŠ¡çŠ¶æ€"},on:{click:t.syncTaskStatusChanges}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M23 4V10H17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M20.49 15A9 9 0 1 1 5.64 5.64L23 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])]),e("div",{staticClass:"main-content"},[e("h1",{staticClass:"page-main-title"},[t._v("AI å®éªŒåˆ†æåŠ©æ‰‹")]),e("div",{staticClass:"ai-chat-section"},[e("div",{staticClass:"chat-header"},[e("div",{staticClass:"ai-dialog-title"},[t._v("AIå¯¹è¯æ¡†")]),e("button",{staticClass:"view-history-btn",attrs:{title:"æŸ¥çœ‹èŠå¤©è®°å½•"},on:{click:t.viewChatHistory}},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 8V12L15 15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}}),e("path",{attrs:{d:"M3 12H7M17 12H21M12 3V7M12 17V21",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}})]),e("span",[t._v("æŸ¥çœ‹è®°å½•")])])]),e("div",{staticClass:"chat-container"},t._l(t.chatMessages,function(s){return e("div",{key:s.id,class:"ai"===s.type?"ai-message":"user-message"},[e("div",{class:"ai"===s.type?"message-bubble":"user-bubble"},[t._v(" "+t._s(s.content)+" ")])])}),0),e("div",{staticClass:"user-input-area"},[e("div",{staticClass:"file-menu-wrapper"},[e("button",{staticClass:"file-select-btn",attrs:{disabled:t.isSending,title:"é€‰æ‹©æ–‡ä»¶",type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.toggleFileMenu.apply(null,arguments)}}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V9L13 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M13 2V9H20",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M8 13H16M8 17H12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.showFileMenu?e("div",{staticClass:"file-dropdown-menu"},[e("div",{staticClass:"dropdown-item",on:{click:t.openFileDialogFromArchive}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M9 22V12H15V22",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("ä»æˆæœæ¡£æ¡ˆæ‰“å¼€æ–‡ä»¶")])]),e("div",{staticClass:"dropdown-item",on:{click:t.openFileUpload}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M7 10L12 15L17 10M12 15V3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("ä»æœ¬åœ°ä¸Šä¼ æ–‡æ¡£")])])]):t._e()]),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.handleFileUpload}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.userMessage,expression:"userMessage"}],attrs:{type:"text",placeholder:"è¾“å…¥æ‚¨çš„é—®é¢˜...",disabled:t.isSending},domProps:{value:t.userMessage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.userMessage=e.target.value)}}}),e("button",{staticClass:"send-btn",attrs:{disabled:!t.userMessage.trim()||t.isSending},on:{click:t.sendMessage}},[t._v("å‘é€")])])])]),t.showChatHistoryModal?e("div",{staticClass:"chat-history-modal-overlay",on:{click:t.closeChatHistoryModal}},[e("div",{staticClass:"chat-history-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("èŠå¤©è®°å½•")]),e("button",{staticClass:"close-btn",on:{click:t.closeChatHistoryModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[0===t.chatSessions.length?e("div",{staticClass:"empty-state"},[e("p",[t._v("æš‚æ— èŠå¤©è®°å½•")])]):e("div",{staticClass:"chat-sessions-list"},t._l(t.chatSessions,function(s){return e("div",{key:s.id,staticClass:"chat-session-item",class:{active:s.id===t.currentChatSessionId},on:{click:function(e){return t.loadChatSession(s.id)}}},[e("div",{staticClass:"session-info"},[e("div",{staticClass:"session-title"},[t._v(t._s(s.title||`èŠå¤©è®°å½• ${s.id}`))]),e("div",{staticClass:"session-meta"},[e("span",{staticClass:"session-date"},[t._v(t._s(t.formatDate(s.updatedAt)))]),e("span",{staticClass:"session-count"},[t._v(t._s(s.messageCount)+" æ¡æ¶ˆæ¯")])])]),e("button",{staticClass:"delete-session-btn",attrs:{title:"åˆ é™¤è®°å½•"},on:{click:function(e){return e.stopPropagation(),t.deleteChatSession(s.id)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])}),0)]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-primary",on:{click:t.createNewChatSession}},[t._v("æ–°å»ºèŠå¤©")])])])]):t._e(),t.showProjectSelectDialog?e("div",{staticClass:"file-dialog-overlay ai-view",on:{click:t.closeProjectSelectDialog}},[e("div",{staticClass:"file-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"file-dialog-header"},[t._m(0),e("button",{staticClass:"close-btn",on:{click:t.closeProjectSelectDialog}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"file-dialog-body"},[0===t.availableProjects.length?e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[e("svg",{attrs:{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-text"},[t._v("æš‚æ— é¡¹ç›®")])]):e("div",{staticClass:"file-list-container"},[e("div",{staticClass:"file-list"},t._l(t.availableProjects,function(s){return e("div",{key:s.id,staticClass:"file-card",class:{selected:t.selectedProjectForFiles&&t.selectedProjectForFiles.id===s.id},on:{click:function(e){return t.selectProjectForFiles(s)}}},[e("div",{staticClass:"file-card-content"},[e("div",{staticClass:"file-card-main"},[e("div",{staticClass:"file-name-wrapper"},[e("div",{staticClass:"file-name"},[t._v(t._s(s.title||s.name||"æœªå‘½åé¡¹ç›®"))]),e("div",{staticClass:"file-badge-group"},[s.description?e("span",{staticClass:"file-type-badge"},[t._v(t._s(s.description))]):t._e()])])]),e("div",{staticClass:"file-select-indicator",class:{active:t.selectedProjectForFiles&&t.selectedProjectForFiles.id===s.id}},[e("div",{staticClass:"checkmark-circle"},[t.selectedProjectForFiles&&t.selectedProjectForFiles.id===s.id?e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})]):t._e()])])])])}),0)])]),e("div",{staticClass:"file-dialog-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeProjectSelectDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn-confirm",class:{disabled:!t.selectedProjectForFiles},attrs:{disabled:!t.selectedProjectForFiles},on:{click:t.confirmProjectSelection}},[e("span",[t._v("ç¡®è®¤é€‰æ‹©")])])])])]):t._e(),t.showFileDialog?e("div",{staticClass:"file-dialog-overlay ai-view",on:{click:t.closeFileDialog}},[e("div",{staticClass:"file-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"file-dialog-header"},[e("div",{staticClass:"header-content"},[e("h3",[t._v("é€‰æ‹©æˆæœç›®å½•æ–‡ä»¶")]),t.selectedFiles.length>0?e("p",{staticClass:"header-subtitle"},[t._v("å·²é€‰æ‹© "+t._s(t.selectedFiles.length)+" é¡¹")]):t._e()]),e("button",{staticClass:"close-btn",on:{click:t.closeFileDialog}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"file-dialog-body"},[t.loadingFiles?e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loading-spinner-large"}),e("p",{staticClass:"loading-text"},[t._v("æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...")])]):0===t.files.length?e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[e("svg",{attrs:{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M13 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V9L13 2Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M13 2V9H20",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-text"},[t._v("æˆæœç›®å½•ä¸­æš‚æ— æ–‡ä»¶")])]):e("div",{staticClass:"file-list-container"},[e("div",{staticClass:"file-list"},t._l(t.files,function(s){return e("div",{key:s.id,staticClass:"file-card",class:{selected:t.selectedFiles.includes(s.id)},on:{click:function(e){return t.toggleFileSelection(s.id)}}},[e("div",{staticClass:"file-card-content"},[e("div",{staticClass:"file-card-main"},[e("div",{staticClass:"file-name-wrapper"},[e("div",{staticClass:"file-name"},[t._v(t._s(s.name||s.title||"æœªå‘½åæ–‡ä»¶"))]),e("div",{staticClass:"file-badge-group"},[e("span",{staticClass:"file-type-badge"},[t._v(t._s(s.type||"æœªçŸ¥ç±»å‹"))]),s.fileCount?e("span",{staticClass:"file-count-badge"},[t._v(t._s(s.fileCount)+"ä¸ªæ–‡ä»¶")]):t._e()])])]),e("div",{staticClass:"file-select-indicator",class:{active:t.selectedFiles.includes(s.id)}},[e("div",{staticClass:"checkmark-circle"},[t.selectedFiles.includes(s.id)?e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})]):t._e()])])])])}),0)])]),e("div",{staticClass:"file-dialog-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeFileDialog}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn-confirm",class:{disabled:0===t.selectedFiles.length},attrs:{disabled:0===t.selectedFiles.length},on:{click:t.confirmFileSelection}},[e("span",[t._v("ç¡®è®¤é€‰æ‹©")]),t.selectedFiles.length>0?e("span",{staticClass:"selected-count"},[t._v(t._s(t.selectedFiles.length))]):t._e()])])])]):t._e()],1)},$e=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-content"},[e("h3",[t._v("é€‰æ‹©é¡¹ç›®")]),e("p",{staticClass:"header-subtitle"},[t._v("è¯·é€‰æ‹©è¦æŸ¥çœ‹æˆæœç›®å½•çš„é¡¹ç›®")])])}];const Le={baseUrl:"/zhiyan/api/ai",timeout:12e4},Ee=N().create({baseURL:"",timeout:Le.timeout,withCredentials:!0});function Ue(t,e=null){return Ee.post(`${Le.baseUrl}/chat`,{query:t,conversationId:e})}async function Oe(t,e=null,s,a,i){try{const r=localStorage.getItem("access_token");if(!r)throw console.error("[Dify API] æœªæ‰¾åˆ°access_tokenï¼Œè¯·å…ˆç™»å½•"),new Error("æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•");console.log("[Dify API] ç›´è¿DifyæœåŠ¡(8097)å‘é€è¯·æ±‚:",{url:`${Le.baseUrl}/chatflow/stream`,query:t,conversationId:e});let n=`${Le.baseUrl}/chatflow/stream?query=${encodeURIComponent(t)}`;e&&(n+=`&conversationId=${encodeURIComponent(e)}`),console.log("[Dify API] è¯·æ±‚URL:",n);const l=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({})});if(console.log("[Dify API] å“åº”çŠ¶æ€:",l.status,l.statusText),!l.ok){const t=await l.text();throw console.error("[Dify API] é”™è¯¯å“åº”:",t),new Error(`HTTP error! status: ${l.status}, body: ${t}`)}const c=l.body.getReader(),d=new TextDecoder;let h="",p="",u=0,m=null,g=null,v=[];console.log("[Dify API] å¼€å§‹è¯»å–æµå¼å“åº”...");while(1){const{done:t,value:e}=await c.read();if(t){console.log("[Dify API] æµå¼å“åº”ç»“æŸï¼Œæ€»å…±æ”¶åˆ°",u,"ä¸ªæ•°æ®å—"),a&&a({conversation_id:m});break}u++;const r=d.decode(e,{stream:!0});console.log("[Dify API] æ”¶åˆ°æ•°æ®å— #"+u+":",r),h+=r;const n=h.split("\n");h=n.pop();for(const a of n){const t=a.trim();if(t.startsWith("event:"))g=t.substring(6).trim(),console.log("[Dify API] äº‹ä»¶ç±»å‹:",g),v=[];else{if(t.startsWith("data:")){const e=t.substring(5).trim();if(e.startsWith("{")?v=[e]:v.length>0&&v.push(e),e.endsWith("}")&&v.length>0){const t=v.join("\n").replace(/\n/g,"").replace(/\s+/g," ");try{const e=JSON.parse(t);console.log("[Dify API] è§£æSSEæ¶ˆæ¯:",e),(e.conversation_id||e.conversationId)&&(m=e.conversation_id||e.conversationId);const a=g||e.event||e.eventType,o=e.data||e.answer;if("message"===a||"agent_message"===a){if(o&&s){const t=o;if(t!==p){const a=t.substring(p.length);console.log("[Dify API] å¢é‡å†…å®¹:",a),p=t,s(a,e)}}}else"message_end"===a?console.log("[Dify API] æ¶ˆæ¯ç»“æŸ, conversation_id:",m):"error"===a?(console.error("[Dify API] Difyé”™è¯¯:",e),i&&i(new Error(e.message||e.error_message||e.data||"Unknown error"))):console.log("[Dify API] Difyäº‹ä»¶:",a);v=[]}catch(o){console.error("[Dify API] è§£æJSONå¤±è´¥:",o,"JSONå­—ç¬¦ä¸²:",t),v=[]}}continue}""===t&&(g=null,v.length>0&&(console.warn("[Dify API] é‡åˆ°ç©ºè¡Œä½†JSONæœªå®Œæˆï¼Œé‡ç½®ç¼“å†²åŒº"),v=[]))}}}}catch(r){throw console.error("æµå¼è¯·æ±‚å¤±è´¥:",r),i&&i(r),r}}function ze(t){return Ee.post(`${Le.baseUrl}/chat/stop/${t}`)}Ee.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers["Authorization"]=`Bearer ${e}`),t},t=>(console.error("[Dify API] è¯·æ±‚é”™è¯¯:",t),Promise.reject(t))),Ee.interceptors.response.use(t=>t,t=>(console.error("[Dify API] å“åº”é”™è¯¯:",t),Promise.reject(t)));var Be={sendChatMessage:Ue,sendChatMessageStream:Oe,stopMessageGeneration:ze},Ve={name:"AIAssistant",components:{Sidebar:rt},data(){return{sidebarOpen:!1,activeFilter:"all",searchQuery:"",filterDropdownOpen:!1,userMessage:"",chatMessages:[],showProjectDropdown:!1,syncTimer:null,isSending:!1,showFileMenu:!1,showFileDialog:!1,showProjectSelectDialog:!1,selectedProjectForFiles:null,files:[],selectedFiles:[],loadingFiles:!1,showChatHistoryModal:!1,chatSessions:[],currentChatSessionId:null,difyConversationId:null,currentProject:{id:1,title:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",description:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",lead:"ç‹å¿—å¼ºæ•™æˆ",progress:65},availableProjects:[{id:1,title:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",description:"é‡å­è®¡ç®—ç®—æ³•ä¼˜åŒ–ç ”ç©¶",lead:"ç‹å¿—å¼ºæ•™æˆ",progress:65},{id:2,title:"å¤šæ¨¡æ€åŒ»å­¦å½±åƒæ•°æ®å¹³å°",description:"å¤šæ¨¡æ€åŒ»å­¦å½±åƒæ•°æ®å¹³å°",lead:"ææ•™æˆ",progress:45},{id:3,title:"æ°”å€™å˜åŒ–é¢„æµ‹æ¨¡å‹ç ”ç©¶",description:"æ°”å€™å˜åŒ–é¢„æµ‹æ¨¡å‹ç ”ç©¶",lead:"ç‹æ•™æˆ",progress:80},{id:4,title:"åŸºå› ç»„æ•°æ®åˆ†æå¹³å°",description:"åŸºå› ç»„æ•°æ®åˆ†æå¹³å°",lead:"å¼ æ•™æˆ",progress:30}],tasks:[],projectTasks:{1:[{id:1,title:"é‡å­çº ç¼ æ€åˆ¶å¤‡",description:"ç ”ç©¶é«˜ä¿çœŸåº¦çº ç¼ æ€çš„åˆ¶å¤‡æ–¹æ³•",assignee:"å¼ ä¼Ÿ",status:"in-progress",checked:!1,published:!0},{id:2,title:"é‡å­é—¨æ“ä½œä¼˜åŒ–",description:"ä¼˜åŒ–é‡å­é—¨æ“ä½œçš„ç²¾åº¦å’Œé€Ÿåº¦",assignee:"æå¨œ",status:"completed",checked:!1,published:!0},{id:3,title:"é‡å­çº é”™ç¼–ç ",description:"è®¾è®¡é«˜æ•ˆçš„é‡å­çº é”™ç¼–ç æ–¹æ¡ˆ",assignee:"ç‹å¼º",status:"in-progress",checked:!1,published:!0},{id:4,title:"é‡å­ç®—æ³•éªŒè¯",description:"éªŒè¯é‡å­ç®—æ³•çš„æ­£ç¡®æ€§å’Œæ•ˆç‡",assignee:"é™ˆç¾ç²",status:"paused",checked:!1,published:!0},{id:5,title:"é‡å­é€šä¿¡åè®®",description:"å¼€å‘å®‰å…¨çš„é‡å­é€šä¿¡åè®®",assignee:"èµµç£Š",status:"in-progress",checked:!1,published:!0},{id:6,title:"é‡å­ä¼ æ„Ÿå™¨æ ¡å‡†",description:"æ ¡å‡†é‡å­ä¼ æ„Ÿå™¨çš„ç²¾åº¦å’Œç¨³å®šæ€§",assignee:"å­™èŠ³",status:"completed",checked:!1,published:!0}],2:[{id:7,title:"åŒ»å­¦å½±åƒæ•°æ®é¢„å¤„ç†",description:"å¯¹MRIã€CTã€PETæ‰«ææ•°æ®è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†",assignee:"æåŒ»ç”Ÿ",status:"in-progress",checked:!1,published:!0},{id:8,title:"æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒ",description:"è®­ç»ƒè‚¿ç˜¤æ£€æµ‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹",assignee:"ç‹å·¥ç¨‹å¸ˆ",status:"completed",checked:!1,published:!0},{id:9,title:"æ•°æ®è´¨é‡è¯„ä¼°",description:"è¯„ä¼°åŒ»å­¦å½±åƒæ•°æ®çš„è´¨é‡å’Œå®Œæ•´æ€§",assignee:"å¼ ç ”ç©¶å‘˜",status:"in-progress",checked:!1,published:!0},{id:10,title:"æ¨¡å‹æ€§èƒ½ä¼˜åŒ–",description:"ä¼˜åŒ–æ¨¡å‹åœ¨ä¸´åºŠç¯å¢ƒä¸­çš„æ€§èƒ½",assignee:"åˆ˜ä¸“å®¶",status:"paused",checked:!1,published:!0}],3:[{id:11,title:"æ°”è±¡æ•°æ®æ”¶é›†",description:"æ”¶é›†å…¨çƒæ°”è±¡ç«™çš„å†å²æ•°æ®",assignee:"é™ˆæ°”è±¡å‘˜",status:"completed",checked:!1,published:!0},{id:12,title:"æ°”å€™æ¨¡å‹æ„å»º",description:"æ„å»ºç¥ç»ç½‘ç»œæ°”å€™é¢„æµ‹æ¨¡å‹",assignee:"èµµç ”ç©¶å‘˜",status:"in-progress",checked:!1,published:!0},{id:13,title:"æ¨¡å‹éªŒè¯æµ‹è¯•",description:"éªŒè¯æ¨¡å‹é¢„æµ‹çš„å‡†ç¡®æ€§",assignee:"å­™ç§‘å­¦å®¶",status:"in-progress",checked:!1,published:!0},{id:14,title:"é¢„æµ‹ç»“æœåˆ†æ",description:"åˆ†æé•¿æœŸæ°”å€™è¶‹åŠ¿é¢„æµ‹ç»“æœ",assignee:"æåˆ†æå¸ˆ",status:"completed",checked:!1,published:!0}],4:[{id:15,title:"åŸºå› åºåˆ—æ¯”å¯¹",description:"å¯¹åŸºå› åºåˆ—è¿›è¡Œæ¯”å¯¹å’Œæ³¨é‡Š",assignee:"ç‹ç”Ÿç‰©å­¦å®¶",status:"in-progress",checked:!1,published:!0},{id:16,title:"å˜å¼‚ä½ç‚¹è¯†åˆ«",description:"è¯†åˆ«åŸºå› åºåˆ—ä¸­çš„å˜å¼‚ä½ç‚¹",assignee:"å¼ é—ä¼ å­¦å®¶",status:"paused",checked:!1,published:!0},{id:17,title:"åŠŸèƒ½æ³¨é‡Šåˆ†æ",description:"åˆ†æåŸºå› å˜å¼‚çš„åŠŸèƒ½å½±å“",assignee:"é™ˆç ”ç©¶å‘˜",status:"in-progress",checked:!1,published:!0}]}}},computed:{filteredTasks(){let t=this.tasks;if("published"===this.activeFilter?t=t.filter(t=>this.isTaskPublished(t)):"all"!==this.activeFilter&&(t=t.filter(t=>t.status===this.activeFilter),console.log(`${this.activeFilter} çŠ¶æ€ä»»åŠ¡æ•°é‡:`,t.length)),this.searchQuery.trim()){const e=this.searchQuery.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.assignee.toLowerCase().includes(e)),console.log("æœç´¢åä»»åŠ¡æ•°é‡:",t.length)}return console.log("æœ€ç»ˆè¿‡æ»¤åçš„ä»»åŠ¡åˆ—è¡¨:",t),t}},mounted(){document.addEventListener("click",this.handleClickOutside),this.debugLocalStorage(),this.loadChatSessionsFromStorage();const t=localStorage.getItem("lastChatSessionId");if(t){const e=parseInt(t),s=this.chatSessions.find(t=>t.id===e);s&&(this.currentChatSessionId=e,this.chatMessages=s.messages?[...s.messages]:[],console.log("å·²æ¢å¤ä¸Šæ¬¡çš„èŠå¤©ä¼šè¯:",e),this.$nextTick(()=>{this.scrollToBottom()}))}this.loadUserProjects(),this.$nextTick(()=>{const t=localStorage.getItem("lastSelectedProject");if(t)try{const e=JSON.parse(t);console.log("å°è¯•æ¢å¤ä¸Šæ¬¡é€‰ä¸­çš„é¡¹ç›®:",e.title);const s=this.availableProjects.find(t=>String(t.id)===String(e.id));s?(this.currentProject=s,console.log("å·²æ¢å¤ä¸Šæ¬¡é€‰ä¸­çš„é¡¹ç›®:",s.title),this.loadProjectTasks(this.currentProject.id)):(console.log("æœªæ‰¾åˆ°ä¸Šæ¬¡é€‰ä¸­çš„é¡¹ç›®ï¼Œä½¿ç”¨é»˜è®¤é¡¹ç›®"),this.loadProjectTasks(this.currentProject.id))}catch(e){console.error("æ¢å¤ä¸Šæ¬¡é€‰ä¸­çš„é¡¹ç›®å¤±è´¥:",e),this.loadProjectTasks(this.currentProject.id)}else this.loadProjectTasks(this.currentProject.id)})},beforeDestroy(){this.currentChatSessionId&&this.chatMessages.length>0&&(this.saveCurrentChatSession(),localStorage.setItem("lastChatSessionId",String(this.currentChatSessionId))),document.removeEventListener("click",this.handleClickOutside),document.removeEventListener("visibilitychange",this.syncTaskStatusChanges),window.removeEventListener("focus",this.syncTaskStatusChanges),this.$root.$off("taskStatusChanged"),this.syncTimer&&clearInterval(this.syncTimer)},methods:{toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},toggleProjectDropdown(){this.showProjectDropdown=!this.showProjectDropdown},switchProject(t){this.currentProject={...t},this.showProjectDropdown=!1,localStorage.setItem("lastSelectedProject",JSON.stringify({id:t.id,title:t.title,description:t.description,lead:t.lead,progress:t.progress})),this.loadProjectTasks(t.id)},syncTaskStatusChanges(){console.log("[åŒæ­¥] åŒæ­¥ä»»åŠ¡çŠ¶æ€å˜åŒ–..."),this.loadProjectTasks(this.currentProject.id),console.log("[åŒæ­¥] ä»»åŠ¡çŠ¶æ€åŒæ­¥å®Œæˆï¼Œå½“å‰ä»»åŠ¡æ•°é‡:",this.tasks.length)},loadProjectTasks(t){console.log(`[ä»»åŠ¡åŠ è½½] åŠ è½½é¡¹ç›® ${t} çš„ä»»åŠ¡`);const e=this.loadTasksFromProject(t);e&&e.length>0?(console.log(`[ä»»åŠ¡åŠ è½½] æ‰¾åˆ° ${e.length} ä¸ªä»»åŠ¡`),this.tasks.splice(0,this.tasks.length,...e)):(console.log(`[ä»»åŠ¡åŠ è½½] é¡¹ç›® ${t} æ²¡æœ‰ä»»åŠ¡`),this.tasks.splice(0,this.tasks.length))},async loadUserProjects(){console.log("[é¡¹ç›®åŠ è½½] å¼€å§‹åŠ è½½ç”¨æˆ·å‚åŠ çš„é¡¹ç›®...");const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info"),s=!(!t||!e);if(s)try{const t=await ut.projectAPI.getMyProjects(0,100);console.log("æˆ‘å‚åŠ çš„é¡¹ç›®APIå“åº”:",t);let e=[];if(Array.isArray(t)?e=t:t&&t.data&&(Array.isArray(t.data)?e=t.data:Array.isArray(t.data.content)?e=t.data.content:Array.isArray(t.data.list)?e=t.data.list:Array.isArray(t.data.records)&&(e=t.data.records)),e.length>0){const t=e.map(t=>{const e=t.id||t.projectId||t.project_id;let s=t.progress||0;return!s&&t.status&&(s="COMPLETED"===t.status||"Completed"===t.status||"å·²å®Œæˆ"===t.status?100:"ACTIVE"===t.status||"Paused"===t.status||"è¿›è¡Œä¸­"===t.status?50:0),{id:e,title:t.title||t.name||t.projectName||"æœªå‘½åé¡¹ç›®",description:t.description||t.desc||t.title||"",lead:t.lead||t.creatorName||t.manager||"é¡¹ç›®è´Ÿè´£äºº",progress:s}});if(console.log(`[é¡¹ç›®åŠ è½½] æˆåŠŸåŠ è½½ ${t.length} ä¸ªç”¨æˆ·é¡¹ç›®`),this.availableProjects=t,this.availableProjects.length>0){const t=this.availableProjects.find(t=>String(t.id)===String(this.currentProject.id));t||(this.currentProject={...this.availableProjects[0]},this.loadProjectTasks(this.currentProject.id))}console.log("æœ€ç»ˆå¯ç”¨é¡¹ç›®åˆ—è¡¨:",this.availableProjects)}else console.log("æœªè·å–åˆ°é¡¹ç›®æ•°æ®ï¼Œä¿æŒé»˜è®¤é¡¹ç›®")}catch(a){console.error("åŠ è½½ç”¨æˆ·å‚åŠ çš„é¡¹ç›®å¤±è´¥:",a)}else console.log("[é¡¹ç›®åŠ è½½] ç”¨æˆ·æœªç™»å½•ï¼Œä½¿ç”¨é»˜è®¤é¡¹ç›®æ•°æ®")},loadTasksFromProject(t){const e=this.loadTasksFromProjectSquare(t);return e.length>0?e:this.projectTasks[t]?this.projectTasks[t]:[]},loadTasksFromProjectSquare(t){const e=JSON.parse(localStorage.getItem("projects")||"[]"),s=e.find(e=>String(e.id)===String(t));return s&&s.tasks&&Array.isArray(s.tasks)&&s.tasks.length>0?s.tasks.map(t=>({id:t.id,title:t.title,description:t.description||"",assignee:t.assignee_name||t.created_by_name||"æœªåˆ†é…",status:this.convertTaskStatus(t.status),checked:!1,published:!0,originalTask:t})):[]},convertTaskStatus(t){const e={"å¾…æ¥å–":"pending",PENDING:"pending","è¿›è¡Œä¸­":"in-progress",IN_PROGRESS:"in-progress","å®Œæˆ":"completed",COMPLETED:"completed","æš‚åœ":"paused",PAUSED:"paused","å·²å®Œæˆ":"completed","å·²æš‚åœ":"paused"};return e[t]||"pending"},getPublishedTasksForProject(t){const e=JSON.parse(localStorage.getItem(`project_${t}_tasks`)||"[]");return e.filter(t=>"published"===t.status)},isTaskPublished(t){return!0===t.published||"published"===t.status},updateTaskPublishStatus(t,e){const s=this.tasks.find(e=>e.id===t);s&&(s.published=e,e&&(s.status="published")),this.saveTasksToStorage()},saveTasksToStorage(){console.log("ä¿å­˜ä»»åŠ¡çŠ¶æ€åˆ°localStorage")},debugLocalStorage(){console.log("=== localStorage è°ƒè¯•ä¿¡æ¯ ==="),console.log("projects:",JSON.parse(localStorage.getItem("projects")||"[]")),console.log("tasks:",JSON.parse(localStorage.getItem("tasks")||"[]")),console.log("all_tasks:",JSON.parse(localStorage.getItem("all_tasks")||"[]"));const t=Object.keys(localStorage);console.log("æ‰€æœ‰localStorageé”®:",t);const e=t.filter(t=>t.includes("task")||t.includes("Task"));console.log("ä»»åŠ¡ç›¸å…³é”®:",e),e.forEach(t=>{console.log(`${t}:`,JSON.parse(localStorage.getItem(t)||"[]"))}),this.debugProjectSquareData()},debugProjectSquareData(){console.log("=== é¡¹ç›®å¹¿åœºæ•°æ®è°ƒè¯• ===");const t=JSON.parse(localStorage.getItem("projects")||"[]");console.log("ç”¨æˆ·åˆ›å»ºçš„é¡¹ç›®:",t);const e=t.find(t=>t.title.includes("æ½˜å…´æ—"));e?(console.log("æ‰¾åˆ°æ½˜å…´æ—é¡¹ç›®:",e),console.log("é¡¹ç›®taskså­—æ®µ:",e.tasks),e.tasks&&Array.isArray(e.tasks)?(console.log(`é¡¹ç›®æœ‰ ${e.tasks.length} ä¸ªä»»åŠ¡:`),e.tasks.forEach((t,e)=>{console.log(`ä»»åŠ¡ ${e+1}:`,t)})):console.log("é¡¹ç›®æ²¡æœ‰taskså­—æ®µæˆ–tasksä¸æ˜¯æ•°ç»„")):(console.log("æœªæ‰¾åˆ°æ½˜å…´æ—é¡¹ç›®"),console.log("æ‰€æœ‰é¡¹ç›®åˆ—è¡¨:"),t.forEach((t,e)=>{console.log(`é¡¹ç›® ${e+1}: ${t.title} (ID: ${t.id})`),console.log("  taskså­—æ®µ:",t.tasks)}))},refreshTasks(){console.log("åˆ·æ–°ä»»åŠ¡æ•°æ®..."),this.debugLocalStorage(),this.availableProjects=this.availableProjects.filter(t=>t.id<=4),this.projectTasks={},this.loadUserProjects(),this.loadProjectTasks(this.currentProject.id),console.log("åˆ·æ–°å®Œæˆ")},createSampleTasks(){console.log("åˆ›å»ºç¤ºä¾‹ä»»åŠ¡æ•°æ®...");const t=JSON.parse(localStorage.getItem("projects")||"[]");t.forEach(t=>{const e=t.id,s=[{id:Date.now()+Math.random(),title:`${t.title} - éœ€æ±‚åˆ†æ`,description:"åˆ†æé¡¹ç›®éœ€æ±‚å’ŒåŠŸèƒ½è§„æ ¼",assignee:"é¡¹ç›®è´Ÿè´£äºº",status:"in-progress",projectId:e,published:!0},{id:Date.now()+Math.random()+1,title:`${t.title} - ç³»ç»Ÿè®¾è®¡`,description:"è®¾è®¡ç³»ç»Ÿæ¶æ„å’ŒæŠ€æœ¯æ–¹æ¡ˆ",assignee:"æ¶æ„å¸ˆ",status:"completed",projectId:e,published:!0},{id:Date.now()+Math.random()+2,title:`${t.title} - å¼€å‘å®ç°`,description:"å®ç°æ ¸å¿ƒåŠŸèƒ½æ¨¡å—",assignee:"å¼€å‘å›¢é˜Ÿ",status:"in-progress",projectId:e,published:!0}];localStorage.setItem(`project_${e}_tasks`,JSON.stringify(s)),console.log(`ä¸ºé¡¹ç›® ${t.title} åˆ›å»ºäº† ${s.length} ä¸ªç¤ºä¾‹ä»»åŠ¡`)}),this.refreshTasks()},goToHome(){this.$router.push("/home")},setFilter(t){this.activeFilter=t},toggleFilterDropdown(){this.filterDropdownOpen=!this.filterDropdownOpen},setFilterAndClose(t){this.activeFilter=t,this.filterDropdownOpen=!1},getFilterText(){const t={all:"å…¨éƒ¨çŠ¶æ€",published:"å·²å‘å¸ƒ","in-progress":"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ",paused:"å·²æš‚åœ"};return t[this.activeFilter]||"å…¨éƒ¨çŠ¶æ€"},updateSearchQuery(t){this.searchQuery=t.target.value},toggleTaskCheckbox(t){const e=this.tasks.find(e=>e.id===t);e&&(e.checked=!e.checked)},getStatusText(t){const e={pending:"å¾…æ¥å–","in-progress":"è¿›è¡Œä¸­",completed:"å®Œæˆ",paused:"æš‚åœ"};return e[t]||t},getStatusClass(t){return t},async sendMessage(){if(console.log("sendMessage called, userMessage:",this.userMessage),!this.userMessage.trim()||this.isSending)return void console.log("Message is empty or already sending, not sending");this.currentChatSessionId||(this.currentChatSessionId=Date.now()),console.log("Adding user message to chat");const t=this.userMessage.trim(),e={id:Date.now(),type:"user",content:t,timestamp:new Date};this.chatMessages.push(e),console.log("Chat messages after adding user message:",this.chatMessages),this.saveCurrentChatSession(),this.userMessage="",console.log("Input cleared"),this.isSending=!0;const s={id:Date.now()+1,type:"ai",content:"",timestamp:new Date};this.chatMessages.push(s);const a=this.chatMessages.length-1;this.$nextTick(()=>{this.scrollToBottom()});try{const e=localStorage.getItem("userId")||"default-user";console.log("[AIåŠ©æ‰‹] å¼€å§‹è°ƒç”¨Dify API, user:",e,"conversationId:",this.difyConversationId),await Be.sendChatMessageStream(t,this.difyConversationId,(t,e)=>{console.log("[AIåŠ©æ‰‹] æ”¶åˆ°Difyæ¶ˆæ¯ç‰‡æ®µ:",t,"å½“å‰æ€»é•¿åº¦:",this.chatMessages[a].content.length);const s=this.chatMessages[a].content;this.$set(this.chatMessages[a],"content",s+t),console.log("[AIåŠ©æ‰‹] æ›´æ–°åæ€»é•¿åº¦:",this.chatMessages[a].content.length),this.$nextTick(()=>{this.scrollToBottom()})},t=>{console.log("Difyå“åº”å®Œæˆ"),t&&t.conversation_id&&(this.difyConversationId=t.conversation_id,console.log("ä¿å­˜Difyå¯¹è¯ID:",this.difyConversationId)),this.saveCurrentChatSession(),this.isSending=!1,this.$nextTick(()=>{this.scrollToBottom()})},t=>{console.error("Dify APIé”™è¯¯:",t),this.chatMessages[a].content="æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚",this.isSending=!1,this.saveCurrentChatSession(),this.$nextTick(()=>{this.scrollToBottom()})})}catch(i){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",i),this.chatMessages[a].content="æŠ±æ­‰ï¼Œå‘é€æ¶ˆæ¯æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚",this.isSending=!1,this.saveCurrentChatSession(),this.$nextTick(()=>{this.scrollToBottom()})}},scrollToBottom(){const t=this.$el.querySelector(".chat-container");t&&(t.scrollTop=t.scrollHeight)},handleClickOutside(t){this.$el.contains(t.target)||(this.showProjectDropdown=!1,this.filterDropdownOpen=!1),this.showFileMenu&&!t.target.closest(".file-menu-wrapper")&&(this.showFileMenu=!1)},toggleFileMenu(){this.showFileMenu=!this.showFileMenu},async openFileDialogFromArchive(){this.showFileMenu=!1,this.showProjectSelectDialog=!0,this.selectedProjectForFiles=null,this.files=[]},openFileUpload(){this.showFileMenu=!1,this.$refs.fileInput.click()},handleFileUpload(t){const e=Array.from(t.target.files);if(e.length>0){console.log("é€‰æ‹©äº†æœ¬åœ°æ–‡ä»¶:",e);const t=e.map(t=>t.name).join("ã€"),s=`æˆ‘å·²ä¸Šä¼ ä»¥ä¸‹æ–‡æ¡£ï¼š${t}`;this.userMessage=this.userMessage.trim()?`${this.userMessage}\n\n${s}`:s}this.$refs.fileInput&&(this.$refs.fileInput.value="")},closeProjectSelectDialog(){this.showProjectSelectDialog=!1,this.selectedProjectForFiles=null},selectProjectForFiles(t){this.selectedProjectForFiles=t},async confirmProjectSelection(){if(!this.selectedProjectForFiles)return;console.log("ç¡®è®¤é€‰æ‹©é¡¹ç›®:",this.selectedProjectForFiles);const t=this.selectedProjectForFiles.id;this.closeProjectSelectDialog(),this.showFileDialog=!0,this.selectedFiles=[],t&&await this.loadFiles(t)},closeFileDialog(){this.showFileDialog=!1,this.selectedFiles=[]},async loadFiles(t){if(t){this.loadingFiles=!0;try{const e=await de.getProjectAchievements(t,0,1e3);console.log("è·å–æˆæœåˆ—è¡¨å“åº”:",e),e&&200===e.code&&e.data?(Array.isArray(e.data)?this.files=e.data:e.data.content&&Array.isArray(e.data.content)?this.files=e.data.content:this.files=[],console.log("åŠ è½½æˆæœæ–‡ä»¶åˆ—è¡¨æˆåŠŸï¼Œæ•°é‡:",this.files.length),this.files.length>0&&(console.log("ç¬¬ä¸€ä¸ªæˆæœæ–‡ä»¶:",this.files[0]),console.log("æ–‡ä»¶å­—æ®µ:",Object.keys(this.files[0])))):(this.files=[],console.warn("è·å–æˆæœåˆ—è¡¨å¤±è´¥:",e))}catch(e){console.error("åŠ è½½æˆæœæ–‡ä»¶åˆ—è¡¨å¤±è´¥:",e),this.files=[]}finally{this.loadingFiles=!1}}else console.warn("é¡¹ç›®IDä¸å­˜åœ¨ï¼Œæ— æ³•åŠ è½½æ–‡ä»¶åˆ—è¡¨")},toggleFileSelection(t){const e=this.selectedFiles.indexOf(t);e>-1?this.selectedFiles.splice(e,1):this.selectedFiles.push(t)},confirmFileSelection(){if(0===this.selectedFiles.length)return;const t=this.files.filter(t=>this.selectedFiles.includes(t.id)).map(t=>t.name||t.title||"æœªå‘½åæ–‡ä»¶").join("ã€"),e=`è¯·å‚è€ƒä»¥ä¸‹æˆæœç›®å½•æ–‡ä»¶ï¼š${t}`;this.userMessage=this.userMessage.trim()?`${this.userMessage}\n\n${e}`:e,console.log("é€‰ä¸­çš„æ–‡ä»¶ID:",this.selectedFiles),console.log("é€‰ä¸­çš„æ–‡ä»¶:",this.files.filter(t=>this.selectedFiles.includes(t.id))),this.closeFileDialog()},viewChatHistory(){this.loadChatSessionsFromStorage(),this.showChatHistoryModal=!0},closeChatHistoryModal(){this.showChatHistoryModal=!1},loadChatSessionsFromStorage(){try{const t=localStorage.getItem("aiChatSessions");t?(this.chatSessions=JSON.parse(t),this.chatSessions.sort((t,e)=>new Date(e.updatedAt)-new Date(t.updatedAt))):this.chatSessions=[]}catch(t){console.error("åŠ è½½èŠå¤©ä¼šè¯å¤±è´¥:",t),this.chatSessions=[]}},saveChatSessionsToStorage(){try{localStorage.setItem("aiChatSessions",JSON.stringify(this.chatSessions))}catch(t){console.error("ä¿å­˜èŠå¤©ä¼šè¯å¤±è´¥:",t)}},createNewChatSession(){this.currentChatSessionId&&this.chatMessages.length>0&&this.saveCurrentChatSession();const t=Date.now(),e={id:t,title:"æ–°èŠå¤©",messages:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),messageCount:0};this.chatSessions.unshift(e),this.currentChatSessionId=t,this.chatMessages=[],this.difyConversationId=null,localStorage.setItem("lastChatSessionId",String(t)),this.saveChatSessionsToStorage(),this.closeChatHistoryModal(),console.log("åˆ›å»ºæ–°èŠå¤©ä¼šè¯:",t)},loadChatSession(t){const e=this.chatSessions.find(e=>e.id===t);e?(this.currentChatSessionId&&this.currentChatSessionId!==t&&this.chatMessages.length>0&&this.saveCurrentChatSession(),this.currentChatSessionId=t,this.chatMessages=e.messages?[...e.messages]:[],this.difyConversationId=null,localStorage.setItem("lastChatSessionId",String(t)),this.closeChatHistoryModal(),this.$nextTick(()=>{this.scrollToBottom()}),console.log("åŠ è½½èŠå¤©ä¼šè¯:",t,"æ¶ˆæ¯æ•°é‡:",this.chatMessages.length)):console.warn("æœªæ‰¾åˆ°èŠå¤©ä¼šè¯:",t)},saveCurrentChatSession(){if(!this.currentChatSessionId)return;const t=this.chatSessions.findIndex(t=>t.id===this.currentChatSessionId);if(-1===t){const t={id:this.currentChatSessionId,title:this.generateSessionTitle(),messages:[...this.chatMessages],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),messageCount:this.chatMessages.length};this.chatSessions.unshift(t)}else this.chatSessions[t].messages=[...this.chatMessages],this.chatSessions[t].updatedAt=(new Date).toISOString(),this.chatSessions[t].messageCount=this.chatMessages.length,this.chatSessions[t].title&&"æ–°èŠå¤©"!==this.chatSessions[t].title||(this.chatSessions[t].title=this.generateSessionTitle());this.saveChatSessionsToStorage()},generateSessionTitle(){const t=this.chatMessages.find(t=>"user"===t.type);if(t&&t.content){const e=t.content.trim();return e.length>20?e.substring(0,20)+"...":e}return"æ–°èŠå¤©"},deleteChatSession(t){if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡èŠå¤©è®°å½•å—ï¼Ÿ"))return;const e=this.chatSessions.findIndex(e=>e.id===t);-1!==e&&(this.chatSessions.splice(e,1),this.saveChatSessionsToStorage(),t===this.currentChatSessionId&&(this.currentChatSessionId=null,this.chatMessages=[],localStorage.removeItem("lastChatSessionId")))},formatDate(t){if(!t)return"";const e=new Date(t),s=new Date,a=s-e,i=Math.floor(a/6e4),o=Math.floor(a/36e5),r=Math.floor(a/864e5);return i<1?"åˆšåˆš":i<60?`${i}åˆ†é’Ÿå‰`:o<24?`${o}å°æ—¶å‰`:r<7?`${r}å¤©å‰`:e.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}}},He=Ve,Re=(0,_.A)(He,Ne,$e,!1,null,null,null),We=Re.exports,Je=function(){var t=this,e=t._self._c;return e("div",{staticClass:"profile-container"},[e("Sidebar",{attrs:{isOpen:t.sidebarOpen},on:{close:t.closeSidebar}}),e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"menu-btn",on:{click:t.toggleSidebar}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"back-btn",attrs:{title:"è¿”å›é¦–é¡µ"},on:{click:t.goToHome}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("ä¸ªäººä¿¡æ¯")])])]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"profile-content"},[e("h1",{staticClass:"profile-title"},[t._v("ä¸ªäººä¿¡æ¯")]),e("div",{staticClass:"info-card"},[e("div",{staticClass:"avatar-section"},[e("div",{staticClass:"avatar-container",on:{click:t.triggerAvatarUpload}},[t.userInfo.avatar?e("img",{staticClass:"avatar-image",attrs:{src:t.userInfo.avatar,alt:"ç”¨æˆ·å¤´åƒ"}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("div",{staticClass:"camera-icon"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M23 19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 4H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"13",r:"3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"nickname-section"},[t.editingNickname?e("div",{staticClass:"nickname-edit"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempNickname,expression:"tempNickname"}],ref:"nicknameInput",staticClass:"nickname-input",attrs:{placeholder:"è¯·è¾“å…¥æ˜µç§°"},domProps:{value:t.tempNickname},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveNickname.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"escape",void 0,e.key,void 0)?null:t.cancelEditNickname.apply(null,arguments)}],input:function(e){e.target.composing||(t.tempNickname=e.target.value)}}}),e("div",{staticClass:"nickname-actions"},[e("button",{staticClass:"save-btn-small",on:{click:t.saveNickname}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"cancel-btn-small",on:{click:t.cancelEditNickname}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])]):e("div",{staticClass:"nickname-display-container"},[e("div",{staticClass:"nickname-info"},[e("span",{staticClass:"nickname-display"},[t._v(t._s(t.userInfo.nickname))]),t.userInfo.id?e("span",{staticClass:"user-id-display"},[t._v("ID: "+t._s(t.userInfo.id))]):t._e()]),e("button",{staticClass:"edit-nickname-btn",on:{click:t.editNickname}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])])])]),e("div",{staticClass:"info-card"},[e("div",{staticClass:"info-item"},[e("h3",{staticClass:"info-label"},[t._v("é‚®ç®±åœ°å€")]),e("p",{staticClass:"info-value"},[t._v(t._s(t.userInfo.email))])])]),e("div",{staticClass:"info-card"},[e("div",{staticClass:"info-item"},[e("h3",{staticClass:"info-label"},[t._v("æ‰€å±æœºæ„")]),e("p",{staticClass:"info-value"},[t._v(t._s(t.userInfo.organization))])])]),e("div",{staticClass:"info-card"},[e("div",{staticClass:"info-item"},[e("div",{staticClass:"intro-header"},[e("h3",{staticClass:"info-label"},[t._v("ä¸ªäººç®€ä»‹")]),!t.editingIntro&&t.isLoggedIn?e("button",{staticClass:"edit-btn",on:{click:t.editIntro}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç¼–è¾‘ ")]):t._e()]),t.editingIntro?e("div",{staticClass:"intro-edit"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tempIntro,expression:"tempIntro"}],ref:"introTextarea",staticClass:"intro-textarea",attrs:{placeholder:"è¯·è¾“å…¥ä¸ªäººç®€ä»‹..."},domProps:{value:t.tempIntro},on:{blur:t.saveIntro,input:function(e){e.target.composing||(t.tempIntro=e.target.value)}}}),e("div",{staticClass:"intro-actions"},[e("button",{staticClass:"save-btn",on:{click:t.saveIntro}},[t._v("ä¿å­˜")]),e("button",{staticClass:"cancel-btn",on:{click:t.cancelEditIntro}},[t._v("å–æ¶ˆ")])])]):e("p",{staticClass:"info-value intro-content"},[t._v(t._s(t.userInfo.introduction))])])]),t.isLoggedIn?t._e():e("div",{staticClass:"info-card login-prompt-card"},[e("div",{staticClass:"info-item"},[e("h3",{staticClass:"info-label"},[t._v("ç™»å½•è´¦å·")]),e("p",{staticClass:"info-value"},[t._v("è¯·ç™»å½•æ‚¨çš„è´¦å·ä»¥æŸ¥çœ‹å®Œæ•´ä¸ªäººä¿¡æ¯")]),e("button",{staticClass:"login-btn",on:{click:t.goToLogin}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M15 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("polyline",{attrs:{points:"10,17 15,12 10,7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("line",{attrs:{x1:"15",y1:"12",x2:"3",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç«‹å³ç™»å½• ")])])]),t.showModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("éœ€è¦ç™»å½•")]),e("button",{staticClass:"modal-close",on:{click:t.closeModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("p",[t._v(t._s(t.modalMessage))])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"modal-btn modal-btn-cancel",on:{click:t.closeModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"modal-btn modal-btn-confirm",on:{click:t.goToLogin}},[t._v("å»ç™»å½•")])])])]):t._e()])]),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e(),t.showAvatarCropModal?e("div",{staticClass:"avatar-crop-modal-overlay"},[e("div",{staticClass:"avatar-crop-modal-content",on:{click:function(t){t.stopPropagation()}}},[t._m(0),e("div",{staticClass:"avatar-crop-modal-body"},[e("div",{staticClass:"avatar-crop-container"},[e("canvas",{ref:"avatarCropCanvas",staticClass:"avatar-crop-canvas"}),e("div",{ref:"avatarCropOverlay",staticClass:"avatar-crop-overlay"},[e("div",{ref:"avatarCropSelection",staticClass:"avatar-crop-selection"},[e("div",{staticClass:"avatar-resize-handle avatar-resize-handle-se"})])])])]),e("div",{staticClass:"avatar-crop-modal-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeAvatarCropModal}},[t._v("é‡æ–°é€‰æ‹©å›¾ç‰‡")]),e("button",{staticClass:"btn-confirm",on:{click:t.applyAvatarCrop}},[t._v("å®Œæˆè£åˆ‡")])])])]):t._e(),e("input",{ref:"avatarUpload",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.handleAvatarUpload}})],1)},qe=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"avatar-crop-modal-header"},[e("h3",[t._v("è£åˆ‡å¤´åƒ")]),e("p",{staticClass:"avatar-crop-hint"},[t._v("è¯·æ‹–æ‹½é€‰æ‹©è£åˆ‡åŒºåŸŸï¼Œå¤´åƒå°†æ˜¾ç¤ºä¸ºåœ†å½¢")])])}];const Ge=N().create({baseURL:"",timeout:l.Ay.api.timeout,headers:{Accept:"application/json"},withCredentials:!0});Ge.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers.Authorization=`Bearer ${e}`),console.log("å¤´åƒAPIè¯·æ±‚:",t.method?.toUpperCase(),t.url),t},t=>(console.error("è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:",t),Promise.reject(t))),Ge.interceptors.response.use(t=>(console.log("âœ… å¤´åƒAPIæˆåŠŸå“åº”:",t.status),console.log("å¤´åƒAPIå“åº”æ•°æ®:",t.data),console.log("å¤´åƒAPIå®Œæ•´æ•°æ®:",JSON.stringify(t.data,null,2)),t.data&&t.data.code&&(console.log("âœ… å“åº”code:",t.data.code),console.log("âœ… å“åº”msg:",t.data.msg),console.log("âœ… å“åº”dataå­˜åœ¨:",!!t.data.data),t.data.data&&(console.log("âœ… dataä¸­çš„minio_url:",t.data.data.minio_url),console.log("âœ… dataä¸­çš„cdn_url:",t.data.data.cdn_url))),t.data),t=>{if(console.error("âŒ å¤´åƒAPIé”™è¯¯:",t),t.response){const{status:e,data:s}=t.response;return console.error("æœåŠ¡å™¨é”™è¯¯ status:",e),console.error("æœåŠ¡å™¨é”™è¯¯ data:",s),console.error("æœåŠ¡å™¨é”™è¯¯å®Œæ•´æ•°æ®:",JSON.stringify(s,null,2)),401===e&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user_info"),window.location.href="/login"),Promise.reject(s||t)}return t.request?(console.error("ç½‘ç»œé”™è¯¯:",t.request),Promise.reject(new Error("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"))):(console.error("å…¶ä»–é”™è¯¯:",t.message),Promise.reject(t))});const Ke={uploadAvatar(t){console.log("[avatarAPI.uploadAvatar] ä¸Šä¼ å¤´åƒ, æ–‡ä»¶:",t.name);const e=new FormData;return e.append("file",t),Ge.post("/zhiyan/users/avatar/upload",e,{headers:{"Content-Type":"multipart/form-data"}})},getMyAvatarInfo(){return console.log("[avatarAPI.getMyAvatarInfo] è·å–å½“å‰ç”¨æˆ·å¤´åƒä¿¡æ¯"),Ge.get("/zhiyan/users/avatar/me_avatar")},getAvatarInfoById(t){return console.log("[avatarAPI.getAvatarInfoById] è·å–ç”¨æˆ·å¤´åƒä¿¡æ¯, ç”¨æˆ·ID:",t),Ge.get(`/zhiyan/users/avatar/${t}`)}};var Ze={name:"Profile",components:{Sidebar:rt},data(){return{sidebarOpen:!1,userMenuOpen:!1,userAvatar:null,editingNickname:!1,editingIntro:!1,tempNickname:"",tempIntro:"",isLoggedIn:!1,showModal:!1,modalMessage:"",showToast:!1,toastMessage:"",showAvatarCropModal:!1,originalAvatarData:null,avatarCropData:{x:0,y:0,size:0},userInfo:{id:null,username:"",email:"",nickname:"",avatar:"",organization:"",introduction:"",role:"",status:""}}},mounted(){this.loadUserInfo(),this.loadUserAvatar(),document.addEventListener("click",this.handleClickOutside),this.$root.$on("userInfoUpdated",this.loadUserInfo)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside),this.$root.$off("userInfoUpdated",this.loadUserInfo)},methods:{loadUserInfo(){const t=localStorage.getItem("access_token"),e=localStorage.getItem("user_info");if(this.isLoggedIn=!(!t||!e),this.isLoggedIn&&e)try{const t=JSON.parse(e);this.userInfo={id:t.id||t.userId,username:t.username||t.name||"",email:t.email||"",nickname:t.nickname||t.name||"æœªè®¾ç½®æ˜µç§°",avatar:t.avatar||"",organization:t.organization||t.institution||"æœªè®¾ç½®æœºæ„",introduction:t.introduction||"è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹...",role:t.role||"MEMBER",status:t.status||"ACTIVE"},console.log("åŠ è½½ç”¨æˆ·ä¿¡æ¯:",this.userInfo)}catch(s){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s),this.isLoggedIn=!1}else this.isLoggedIn=!1,this.userInfo={id:null,username:"",email:"",nickname:"æ¸¸å®¢",avatar:"",organization:"",introduction:"æ‚¨è¿˜æœªç™»å½•ï¼Œè¯·ç™»å½•åæŸ¥çœ‹ä¸ªäººä¿¡æ¯",role:"GUEST",status:"GUEST"}},loadUserAvatar(){const t=localStorage.getItem("userAvatar");t&&(this.userAvatar=t)},handleClickOutside(t){t.target.closest(".user-profile")||t.target.closest(".user-menu")||(this.userMenuOpen=!1)},toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},closeSidebar(){this.sidebarOpen=!1},goToHome(){this.$router.push("/home")},goToLogin(){this.$router.push("/login")},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)},closeModal(){this.showModal=!1,this.modalMessage=""},toggleUserMenu(){this.userMenuOpen=!this.userMenuOpen},goToProfile(){this.userMenuOpen=!1},logout(){this.userMenuOpen=!1,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("remember_me_token"),localStorage.removeItem("user_info"),localStorage.removeItem("userAvatar"),localStorage.removeItem("globalUserInfo"),Object.keys(localStorage).forEach(t=>{t.startsWith("userData_")&&localStorage.removeItem(t)}),this.showSuccessToast("é€€å‡ºç™»å½•æˆåŠŸï¼"),setTimeout(()=>{this.$router.push("/login")},1e3)},closeAvatarCropModal(){this.$refs.avatarUpload.value="",this.showAvatarCropModal=!1,this.originalAvatarData=null},initAvatarCropCanvas(){const t=this.$refs.avatarCropCanvas,e=t.getContext("2d"),s=new Image;s.onload=()=>{const a=400;let{width:i,height:o}=s;if(i>a||o>a){const t=Math.min(a/i,a/o);i*=t,o*=t}t.width=i,t.height=o,t.style.width=i+"px",t.style.height=o+"px",e.drawImage(s,0,0,i,o);const r=.6*Math.min(i,o);this.avatarCropData={x:(i-r)/2,y:(o-r)/2,size:r},this.updateAvatarCropSelection(),this.setupAvatarCropInteraction()},s.onerror=t=>{console.error("å›¾ç‰‡åŠ è½½å¤±è´¥:",t),alert("å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©"),this.closeAvatarCropModal()},s.src=this.originalAvatarData},updateAvatarCropSelection(){const t=this.$refs.avatarCropSelection;t&&(t.style.left=this.avatarCropData.x+"px",t.style.top=this.avatarCropData.y+"px",t.style.width=this.avatarCropData.size+"px",t.style.height=this.avatarCropData.size+"px")},setupAvatarCropInteraction(){const t=this.$refs.avatarCropSelection,e=this.$refs.avatarCropCanvas;if(!t||!e)return;let s=!1,a=!1,i=0,o=0,r=0,n=0,l=0;const c=t=>{t.target.classList.contains("avatar-resize-handle")?a=!0:s=!0;const c=e.getBoundingClientRect();i=t.clientX-c.left,o=t.clientY-c.top,r=this.avatarCropData.x,n=this.avatarCropData.y,l=this.avatarCropData.size},d=t=>{if(!s&&!a)return;const c=e.getBoundingClientRect(),d=t.clientX-c.left,h=t.clientY-c.top,p=d-i,u=h-o;if(s){const t=Math.max(0,Math.min(e.width-this.avatarCropData.size,r+p)),s=Math.max(0,Math.min(e.height-this.avatarCropData.size,n+u));this.avatarCropData.x=t,this.avatarCropData.y=s}else if(a){const t=p+u,s=Math.max(50,Math.min(Math.min(e.width,e.height),l+t)),a=Math.max(0,Math.min(e.width-s,r+(l-s)/2)),i=Math.max(0,Math.min(e.height-s,n+(l-s)/2));this.avatarCropData.x=a,this.avatarCropData.y=i,this.avatarCropData.size=s}this.updateAvatarCropSelection()},h=()=>{s=!1,a=!1};t.addEventListener("mousedown",c),document.addEventListener("mousemove",d),document.addEventListener("mouseup",h),this.$once("hook:beforeDestroy",()=>{t.removeEventListener("mousedown",c),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h)})},applyAvatarCrop(){if(!this.originalAvatarData)return;const t=document.createElement("canvas"),e=t.getContext("2d"),s=80;t.width=s,t.height=s,e.beginPath(),e.arc(s/2,s/2,s/2,0,2*Math.PI),e.clip();const a=new Image;a.onload=async()=>{const i=this.$refs.avatarCropCanvas.width,o=this.$refs.avatarCropCanvas.height,r=this.avatarCropData.x/i*a.width,n=this.avatarCropData.y/o*a.height,l=this.avatarCropData.size/i*a.width;e.drawImage(a,r,n,l,l,0,0,s,s),t.toBlob(async e=>{if(!e)return console.error("Canvasè½¬Blobå¤±è´¥"),void alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•");try{this.closeAvatarCropModal();const i=new File([e],"avatar.jpg",{type:"image/jpeg"});console.log("å‡†å¤‡ä¸Šä¼ å¤´åƒåˆ°åç«¯ï¼Œæ–‡ä»¶å¤§å°:",i.size,"bytes");const o=await Ke.uploadAvatar(i);console.log("å¤´åƒä¸Šä¼ æˆåŠŸï¼Œåç«¯å“åº”:",o);let r="";200===o.code&&o.data?(r=o.data.cdnUrl||o.data.minioUrl||"",console.log("åç«¯è¿”å›çš„å¤´åƒURL:",r),console.log("å“åº”æ•°æ®è¯¦æƒ…:",o.data)):console.warn("åç«¯å“åº”å¼‚å¸¸:",o);const n=r||t.toDataURL("image/jpeg",.9);this.userInfo.avatar=n,this.userAvatar=n;try{localStorage.setItem("userAvatar",n)}catch(s){console.error("ä¿å­˜å¤´åƒåˆ°localStorageå¤±è´¥:",s),"QuotaExceededError"===s.name&&console.warn("localStorageç©ºé—´å·²æ»¡")}const l=localStorage.getItem("user_info");let c=this.userInfo.id;if(l)try{const t=JSON.parse(l);t.avatar=n,c=t.id||t.userId||c,localStorage.setItem("user_info",JSON.stringify(t)),console.log("å¤´åƒå·²æ›´æ–°åˆ°user_info")}catch(a){console.error("æ›´æ–°user_infoå¤´åƒå¤±è´¥:",a),"QuotaExceededError"===a.name&&console.warn("localStorageç©ºé—´å·²æ»¡ï¼Œè¯·æ¸…ç†æµè§ˆå™¨ç¼“å­˜")}const d={userId:String(c),avatarUrl:n,timestamp:Date.now()};console.log("ğŸ“¤ å‘é€å¤´åƒæ›´æ–°äº‹ä»¶:",{userId:d.userId,userIdType:typeof d.userId,avatarUrl:d.avatarUrl.substring(0,50)+"...",timestamp:d.timestamp}),this.$eventBus.emit(this.$EventTypes.USER_AVATAR_UPDATED,d),this.$root.$emit("userInfoUpdated"),this.showSuccessToast("å¤´åƒä¸Šä¼ æˆåŠŸï¼")}catch(a){console.error("ä¸Šä¼ å¤´åƒå¤±è´¥:",a);const e=a.msg||a.message||"æœªçŸ¥é”™è¯¯",i=confirm(`å¤´åƒä¸Šä¼ å¤±è´¥: ${e}\n\næ˜¯å¦é‡è¯•ï¼Ÿ`);if(i)return void this.applyAvatarCrop();const o=t.toDataURL("image/jpeg",.9);this.userInfo.avatar=o,this.userAvatar=o;try{localStorage.setItem("userAvatar",o)}catch(s){console.error("ä¿å­˜å¤´åƒåˆ°localStorageå¤±è´¥:",s),"QuotaExceededError"===s.name&&console.warn("localStorageç©ºé—´å·²æ»¡")}const r=localStorage.getItem("user_info");if(r)try{const t=JSON.parse(r);t.avatar=o,localStorage.setItem("user_info",JSON.stringify(t))}catch(s){console.error("æ›´æ–°user_infoå¤±è´¥:",s),"QuotaExceededError"===s.name&&console.warn("localStorageç©ºé—´å·²æ»¡ï¼Œè¯·æ¸…ç†æµè§ˆå™¨ç¼“å­˜")}this.$root.$emit("userInfoUpdated")}},"image/jpeg",.9)},a.onerror=t=>{console.error("è£åˆ‡å›¾ç‰‡åŠ è½½å¤±è´¥:",t),alert("å›¾ç‰‡å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•")},a.src=this.originalAvatarData},triggerAvatarUpload(){if(!this.isLoggedIn)return this.modalMessage="è¯·å…ˆç™»å½•æ‰èƒ½ä¿®æ”¹å¤´åƒ",void(this.showModal=!0);this.$refs.avatarUpload.click()},handleAvatarUpload(t){const e=t.target.files[0];if(e)try{if(!e.type.startsWith("image/"))return alert("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶"),void(this.$refs.avatarUpload.value="");if(e.size>5242880)return alert("å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB"),void(this.$refs.avatarUpload.value="");const t=new FileReader;t.onload=t=>{this.originalAvatarData=t.target.result,this.showAvatarCropModal=!0,this.$nextTick(()=>{this.initAvatarCropCanvas()})},t.onerror=t=>{console.error("æ–‡ä»¶è¯»å–å¤±è´¥:",t),alert("æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©å›¾ç‰‡"),this.$refs.avatarUpload.value=""},t.readAsDataURL(e)}catch(s){console.error("å¤„ç†æ–‡ä»¶å¤±è´¥:",s),alert("å¤„ç†æ–‡ä»¶å¤±è´¥: "+s.message),this.$refs.avatarUpload.value=""}},editNickname(){if(!this.isLoggedIn)return this.modalMessage="è¯·å…ˆç™»å½•æ‰èƒ½ä¿®æ”¹æ˜µç§°",void(this.showModal=!0);this.editingNickname=!0,this.tempNickname=this.userInfo.nickname,this.$nextTick(()=>{this.$refs.nicknameInput.focus(),this.$refs.nicknameInput.select()})},saveNickname(){const t=this.tempNickname.trim();if(t&&t!==this.userInfo.nickname){if(t.length<2)return void alert("æ˜µç§°è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦");if(t.length>20)return void alert("æ˜µç§°ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦");if(confirm(`ç¡®å®šè¦å°†æ˜µç§°ä¿®æ”¹ä¸º"${t}"å—ï¼Ÿ`)){this.userInfo.nickname=t,this.editingNickname=!1;const s=localStorage.getItem("user_info");if(s)try{const e=JSON.parse(s);e.nickname=t,localStorage.setItem("user_info",JSON.stringify(e)),console.log("æ˜µç§°å·²æ›´æ–°åˆ°user_info:",e.nickname)}catch(e){console.error("æ›´æ–°user_infoæ˜µç§°å¤±è´¥:",e)}this.$root.$emit("userInfoUpdated"),console.log("æ˜µç§°å·²æ›´æ–°:",t)}}else t===this.userInfo.nickname?this.editingNickname=!1:alert("æ˜µç§°ä¸èƒ½ä¸ºç©º")},cancelEditNickname(){this.tempNickname=this.userInfo.nickname,this.editingNickname=!1},editIntro(){this.editingIntro=!0,this.tempIntro=this.userInfo.introduction,this.$nextTick(()=>{this.$refs.introTextarea.focus()})},saveIntro(){this.userInfo.introduction=this.tempIntro,this.editingIntro=!1},cancelEditIntro(){this.tempIntro=this.userInfo.introduction,this.editingIntro=!1}}},Ye=Ze,Qe=(0,_.A)(Ye,Je,qe,!1,null,null,null),Xe=Qe.exports,ts=function(){var t=this,e=t._self._c;return e("div",{staticClass:"project-detail-container"},[t.isLoading?e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loading-spinner"}),e("p",{staticClass:"loading-text"},[t._v("æ­£åœ¨åŠ è½½é¡¹ç›®è¯¦æƒ…...")])]):e("div",[e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"back-btn",attrs:{"aria-label":"è¿”å›"},on:{click:t.goBack}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v("é¡¹ç›®è¯¦æƒ…")])])]),e("div",{staticClass:"main-content"},[t.project?t._e():e("div",{staticClass:"loading-container"},[e("div",{staticClass:"loading-spinner"}),e("p",[t._v("æ­£åœ¨åŠ è½½é¡¹ç›®è¯¦æƒ…...")])]),t.project?e("div",[e("div",{staticClass:"project-card"},[e("div",{staticClass:"project-header-top"},[e("h1",{staticClass:"project-title"},[t._v(t._s(t.project.title))]),t.isProjectManager?e("div",{staticClass:"project-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.editProject}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" ç¼–è¾‘é¡¹ç›® ")]),e("button",{staticClass:"btn btn-danger",on:{click:t.deleteProject}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),t._v(" åˆ é™¤é¡¹ç›® ")])]):t._e()]),e("div",{staticClass:"project-body"},[e("div",{staticClass:"project-info"},[e("div",{staticClass:"project-meta-top"},[e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®ç®€ä»‹ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.project.description))])]),e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®å‘¨æœŸï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.project.period))])])]),e("div",{staticClass:"project-meta-bottom"},[e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("å½“å‰çŠ¶æ€ï¼š")]),e("span",{staticClass:"status-badge",class:t.statusClass(t.project.status)},[t._v(t._s(t.getStatusDisplay(t.project.status)))])]),e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("è´Ÿè´£äººï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.project.manager))])]),e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("ä»»åŠ¡æ•°é‡ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.taskCount))])]),e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("å‚ä¸äººæ•°ï¼š")]),e("span",{staticClass:"meta-value"},[t._v(t._s(t.participantCount))])]),t.project.tags&&t.project.tags.length>0?e("div",{staticClass:"meta-item"},[e("span",{staticClass:"meta-label"},[t._v("é¡¹ç›®æ ‡ç­¾ï¼š")]),e("div",{staticClass:"tags-container"},t._l(t.project.tags,function(s,a){return e("span",{key:a,staticClass:"tag"},[t._v(t._s(s))])}),0)]):t._e()]),e("div",{staticClass:"info-actions"},[e("button",{staticClass:"btn primary",on:{click:t.goToProjectKnowledge}},[t._v(" çŸ¥è¯†åº“ ")]),e("button",{staticClass:"btn",on:{click:t.goToAIAssistant}},[t._v(" AIå®éªŒåˆ†æåŠ©æ‰‹ ")])])]),e("div",{staticClass:"project-image-section"},[e("div",{staticClass:"project-image-container"},[t.project.imageUrl||t.project.image?e("img",{staticClass:"project-image",attrs:{src:t.project.imageUrl||t.project.image,alt:"é¡¹ç›®å›¾ç‰‡"},on:{load:t.onImageLoad,error:t.onImageError}}):e("div",{staticClass:"project-image-placeholder"},[e("svg",{attrs:{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M21 19V5C21 3.89543 20.1046 3 19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19Z",stroke:"#d9d9d9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M8 10C9.10457 10 10 9.10457 10 8C10 6.89543 9.10457 6 8 6C6.89543 6 6 6.89543 6 8C6 9.10457 6.89543 10 8 10Z",stroke:"#d9d9d9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M3 18L8 13L14 19M14 12L21 3",stroke:"#d9d9d9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.isProjectManager?e("div",{staticClass:"project-image-overlay",on:{click:t.triggerImageUpload}},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M12 5V19M5 12H19",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("span",[t._v("ä¸Šä¼ å›¾ç‰‡")])]):t._e()]),e("input",{ref:"projectImageUpload",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.handleProjectImageUpload}})])])]),e("div",{staticClass:"section-card"},[e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("ä»»åŠ¡åˆ—è¡¨")]),e("div",{staticClass:"section-actions"},[e("div",{staticClass:"dropdown",on:{click:function(e){return e.stopPropagation(),t.toggleTaskTypeDropdown.apply(null,arguments)}}},[e("button",{staticClass:"btn secondary"},[e("span",[t._v("æ‰€æœ‰ç±»å‹")]),e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t.taskTypeOpen?e("ul",{staticClass:"dropdown-menu"},[e("li",{staticClass:"dropdown-item",class:{active:""===t.selectedTaskType},on:{click:function(e){return t.selectTaskType("")}}},[t._v("æ‰€æœ‰ç±»å‹")]),e("li",{staticClass:"dropdown-item",class:{active:"é«˜"===t.selectedTaskType},on:{click:function(e){return t.selectTaskType("é«˜")}}},[t._v("é«˜ä¼˜å…ˆçº§")]),e("li",{staticClass:"dropdown-item",class:{active:"ä¸­"===t.selectedTaskType},on:{click:function(e){return t.selectTaskType("ä¸­")}}},[t._v("ä¸­ä¼˜å…ˆçº§")]),e("li",{staticClass:"dropdown-item",class:{active:"ä½"===t.selectedTaskType},on:{click:function(e){return t.selectTaskType("ä½")}}},[t._v("ä½ä¼˜å…ˆçº§")])]):t._e()]),t.isProjectManager?e("button",{staticClass:"btn primary",on:{click:t.createTask}},[t._v("æ–°å»ºä»»åŠ¡")]):t._e()])]),0===t.filteredTasks.length?e("div",{staticClass:"task-empty-state"},[e("div",{staticClass:"empty-state-content"},[e("div",{staticClass:"empty-state-icon"},[e("svg",{attrs:{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 11H15M9 15H15M17 21H7C5.89543 21 5 20.1046 5 19V5C5 3.89543 5.89543 3 7 3H17C18.1046 3 19 3.89543 19 5V19C19 20.1046 18.1046 21 17 21Z",stroke:"#6c757d","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("h3",{staticClass:"empty-state-title"},[t._v("æš‚æ— ä»»åŠ¡")]),t._m(0)])]):e("div",{staticClass:"task-grid"},t._l(t.filteredTasks,function(s){return e("div",{key:s.id,staticClass:"task-card",on:{click:function(e){return t.openTaskDetailModal(s)}}},[e("div",{staticClass:"task-header",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"task-priority",class:t.priorityClass(s.priority)},[t._v(t._s(s.priority))]),t.isProjectManager?e("div",{staticClass:"task-actions"},[e("div",{staticClass:"task-status-dropdown"},[e("button",{staticClass:"task-status-btn",class:t.statusClass(s.status),attrs:{title:"æ›´æ”¹çŠ¶æ€"},on:{click:function(e){return t.toggleTaskStatusDropdown(s)}}},[t._v(" "+t._s(s.status)+" "),e("svg",{attrs:{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),s.showStatusMenu?e("div",{staticClass:"task-status-menu"},[e("button",{staticClass:"status-option",class:{active:"è¿›è¡Œä¸­"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"è¿›è¡Œä¸­")}}},[t._v("è¿›è¡Œä¸­")]),e("button",{staticClass:"status-option",class:{active:"é˜»å¡"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"é˜»å¡")}}},[t._v("é˜»å¡")]),e("button",{staticClass:"status-option",class:{active:"å®Œæˆ"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"å®Œæˆ")}}},[t._v("å®Œæˆ")])]):t._e()]),e("button",{staticClass:"task-assign-manager-btn",attrs:{title:"åˆ†é…ä»»åŠ¡"},on:{click:function(e){return t.openAssignTaskModal(s)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"8.5",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M20 8V14M23 11H17",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"task-edit-btn",attrs:{title:"ç¼–è¾‘ä»»åŠ¡"},on:{click:function(e){return t.editTask(s)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"task-delete-btn",attrs:{title:"åˆ é™¤ä»»åŠ¡"},on:{click:function(e){return t.deleteTask(s.id)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()]),e("div",{staticClass:"task-content",on:{click:function(t){t.stopPropagation()}}},[e("h3",{staticClass:"task-title"},[t._v(t._s(s.title))]),e("p",{staticClass:"task-description"},[t._v(t._s(s.description))]),e("div",{staticClass:"task-meta"},[s.date?e("span",{staticClass:"task-date"},[t._v(t._s(s.date))]):t._e(),e("span",{staticClass:"task-creator"},[t._v("åˆ›å»ºäºº: "+t._s(s.created_by_name))]),s.assignee_name?e("span",{staticClass:"task-assignee"},[t._v(" è´Ÿè´£äºº: "+t._s(s.assignee_name)+" ")]):t._e()])]),"å¾…æ¥å–"!==s.status||s.assignee_name&&""!==s.assignee_name?t._e():e("div",{staticClass:"task-assign-section",on:{click:function(t){t.stopPropagation()}}},[e("button",{staticClass:"assign-btn",on:{click:function(e){return t.assignTask(s)}}},[t._v("æ¥å–ä»»åŠ¡")])])])}),0),t.allTasks.length>5?e("div",{staticClass:"more-button-container"},[e("button",{staticClass:"more-button",on:{click:t.openTaskListModal}},[e("span",{staticClass:"more-text"},[t._v("æ›´å¤š")]),e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()]),e("div",{staticClass:"section-card"},[e("div",{staticClass:"section-header"},[e("h2",{staticClass:"section-title"},[t._v("å›¢é˜Ÿæˆå‘˜")]),t.isProjectManager?e("div",{staticClass:"section-actions"},[e("button",{staticClass:"btn secondary",on:{click:t.addTeamMember}},[t._v("æ·»åŠ æˆå‘˜")]),e("button",{staticClass:"btn primary",on:{click:t.inviteMember}},[t._v("é‚€è¯·æˆå‘˜")])]):t._e()]),e("div",{staticClass:"team-grid"},[t._l(t.teamMembers,function(s){return e("div",{key:s.id,staticClass:"member-card"},[e("div",{staticClass:"member-avatar"},[s.avatar?e("img",{attrs:{src:s.avatar,alt:s.name}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"member-info"},[e("h4",{staticClass:"member-name"},[t._v(t._s(s.name))]),e("p",{staticClass:"member-role"},[t._v(t._s(s.role))])]),t.isProjectManager?e("button",{staticClass:"remove-member-btn",attrs:{title:"ç§»é™¤æˆå‘˜"},on:{click:function(e){return t.removeTeamMember(s.id)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e()])}),t._l(t.inviteSlots,function(s){return e("div",{key:s.id,staticClass:"member-card invite-card"},[e("div",{staticClass:"member-avatar"},[e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"member-info"},[e("h4",{staticClass:"member-name"},[t._v(t._s(s.role))]),e("p",{staticClass:"member-role"},[t._v("å¾…é‚€è¯·")])]),t.isProjectManager?e("button",{staticClass:"remove-member-btn",attrs:{title:"å–æ¶ˆé‚€è¯·"},on:{click:function(e){return t.removeInviteSlot(s.id)}}},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e()])})],2)])]):t._e()]),t.taskModalOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeTaskModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("æ–°å»ºä»»åŠ¡")]),e("button",{staticClass:"modal-close",on:{click:t.closeTaskModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä»»åŠ¡æ ‡é¢˜")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newTask.title,expression:"newTask.title"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜",maxlength:"50"},domProps:{value:t.newTask.title},on:{input:function(e){e.target.composing||t.$set(t.newTask,"title",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä»»åŠ¡æè¿°")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.newTask.description,expression:"newTask.description"}],staticClass:"form-textarea",attrs:{placeholder:"è¯·è¾“å…¥ä»»åŠ¡æè¿°",rows:"3",maxlength:"200"},domProps:{value:t.newTask.description},on:{input:function(e){e.target.composing||t.$set(t.newTask,"description",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("æˆªæ­¢æ—¥æœŸ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newTask.dueDate,expression:"newTask.dueDate"}],staticClass:"form-input",attrs:{type:"date",min:t.today},domProps:{value:t.newTask.dueDate},on:{change:t.validateNewTaskDueDate,input:function(e){e.target.composing||t.$set(t.newTask,"dueDate",e.target.value)}}}),t.newTask.dateError?e("div",{staticClass:"error-message"},[t._v(t._s(t.newTask.dateError))]):t._e()]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä¼˜å…ˆçº§")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newTask.priority,expression:"newTask.priority"}],staticClass:"form-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.newTask,"priority",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:"é«˜"}},[t._v("é«˜")]),e("option",{attrs:{value:"ä¸­"}},[t._v("ä¸­")]),e("option",{attrs:{value:"ä½"}},[t._v("ä½")])])])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeTaskModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.newTask.title.trim()||t.isCreatingTask},on:{click:t.saveNewTask}},[t._v(" "+t._s(t.isCreatingTask?"åˆ›å»ºä¸­...":"åˆ›å»ºä»»åŠ¡")+" ")])])])]):t._e(),t.editProjectModalOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeEditProjectModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("ç¼–è¾‘é¡¹ç›®")]),e("button",{staticClass:"modal-close",on:{click:t.closeEditProjectModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®åç§°")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.name,expression:"editProjectData.name"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxlength:"100"},domProps:{value:t.editProjectData.name},on:{input:function(e){e.target.composing||t.$set(t.editProjectData,"name",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®æè¿°")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.description,expression:"editProjectData.description"}],staticClass:"form-textarea",attrs:{placeholder:"è¯·è¾“å…¥é¡¹ç›®æè¿°",rows:"3",maxlength:"500"},domProps:{value:t.editProjectData.description},on:{input:function(e){e.target.composing||t.$set(t.editProjectData,"description",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("å¼€å§‹æ—¥æœŸ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.startDate,expression:"editProjectData.startDate"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.editProjectData.startDate},on:{input:function(e){e.target.composing||t.$set(t.editProjectData,"startDate",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ç»“æŸæ—¥æœŸ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.endDate,expression:"editProjectData.endDate"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.editProjectData.endDate},on:{input:function(e){e.target.composing||t.$set(t.editProjectData,"endDate",e.target.value)}}})])]),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("å¯è§æ€§")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.visibility,expression:"editProjectData.visibility"}],staticClass:"form-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.editProjectData,"visibility",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:"PUBLIC"}},[t._v("å…¬å¼€")]),e("option",{attrs:{value:"PRIVATE"}},[t._v("ç§æœ‰")]),e("option",{attrs:{value:"TEAM"}},[t._v("å›¢é˜Ÿ")])])]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é¡¹ç›®çŠ¶æ€")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.editProjectData.status,expression:"editProjectData.status"}],staticClass:"form-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.editProjectData,"status",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:"PLANNING"}},[t._v("è§„åˆ’ä¸­")]),e("option",{attrs:{value:"ONGOING"}},[t._v("è¿›è¡Œä¸­")]),e("option",{attrs:{value:"COMPLETED"}},[t._v("å·²å®Œæˆ")]),e("option",{attrs:{value:"ARCHIVED"}},[t._v("å·²å½’æ¡£")])])])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeEditProjectModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.editProjectData.name.trim()},on:{click:t.saveProjectUpdate}},[t._v(" ä¿å­˜æ›´æ”¹ ")])])])]):t._e(),t.taskListModalOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeTaskListModal}},[e("div",{staticClass:"modal-content task-list-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("æ‰€æœ‰ä»»åŠ¡")]),e("button",{staticClass:"modal-close",on:{click:t.closeTaskListModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"task-list-container"},t._l(t.allFilteredTasks,function(s){return e("div",{key:s.id,staticClass:"task-list-item",on:{click:function(e){return t.openTaskDetailModal(s)}}},[e("div",{staticClass:"task-item-header",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"task-priority",class:t.priorityClass(s.priority)},[t._v(t._s(s.priority))]),t.isProjectManager?e("div",{staticClass:"task-actions"},[e("div",{staticClass:"task-status-dropdown"},[e("button",{staticClass:"task-status-btn",class:t.statusClass(s.status),attrs:{title:"æ›´æ”¹çŠ¶æ€"},on:{click:function(e){return t.toggleTaskStatusDropdown(s)}}},[t._v(" "+t._s(s.status)+" "),e("svg",{attrs:{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M6 9L12 15L18 9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),s.showStatusMenu?e("div",{staticClass:"task-status-menu"},[e("button",{staticClass:"status-option",class:{active:"è¿›è¡Œä¸­"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"è¿›è¡Œä¸­")}}},[t._v("è¿›è¡Œä¸­")]),e("button",{staticClass:"status-option",class:{active:"é˜»å¡"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"é˜»å¡")}}},[t._v("é˜»å¡")]),e("button",{staticClass:"status-option",class:{active:"å®Œæˆ"===s.status},on:{click:function(e){return t.changeTaskStatus(s,"å®Œæˆ")}}},[t._v("å®Œæˆ")])]):t._e()]),e("button",{staticClass:"task-edit-btn",attrs:{title:"ç¼–è¾‘ä»»åŠ¡"},on:{click:function(e){return t.editTask(s)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("button",{staticClass:"task-delete-btn",attrs:{title:"åˆ é™¤ä»»åŠ¡"},on:{click:function(e){return t.deleteTask(s.id)}}},[e("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]):t._e()]),e("div",{staticClass:"task-item-content",on:{click:function(t){t.stopPropagation()}}},[e("h4",{staticClass:"task-item-title"},[t._v(t._s(s.title))]),e("p",{staticClass:"task-item-description"},[t._v(t._s(s.description))]),e("div",{staticClass:"task-item-meta"},[s.date?e("span",{staticClass:"task-date"},[t._v(t._s(s.date))]):t._e(),e("span",{staticClass:"task-creator"},[t._v("åˆ›å»ºäºº: "+t._s(s.created_by_name))]),s.assignee_name?e("span",{staticClass:"task-assignee"},[t._v(" è´Ÿè´£äºº: "+t._s(s.assignee_name)+" ")]):t._e()])]),"å¾…æ¥å–"!==s.status||s.assignee_name&&""!==s.assignee_name?t._e():e("div",{staticClass:"task-item-assign",on:{click:function(t){t.stopPropagation()}}},[e("button",{staticClass:"assign-btn",on:{click:function(e){return t.assignTask(s)}}},[t._v("æ¥å–ä»»åŠ¡")])])])}),0)])])]):t._e(),t.editTaskModalOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeEditTaskModal}},[e("div",{staticClass:"modal-content task-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("ç¼–è¾‘ä»»åŠ¡")]),e("button",{staticClass:"modal-close",on:{click:t.closeEditTaskModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä»»åŠ¡æ ‡é¢˜")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editTaskData.title,expression:"editTaskData.title"}],staticClass:"form-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜"},domProps:{value:t.editTaskData.title},on:{input:function(e){e.target.composing||t.$set(t.editTaskData,"title",e.target.value)}}})]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä»»åŠ¡æè¿°")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editTaskData.description,expression:"editTaskData.description"}],staticClass:"form-textarea",attrs:{placeholder:"è¯·è¾“å…¥ä»»åŠ¡æè¿°",rows:"3"},domProps:{value:t.editTaskData.description},on:{input:function(e){e.target.composing||t.$set(t.editTaskData,"description",e.target.value)}}})]),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("æˆªæ­¢æ—¥æœŸ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editTaskData.dueDate,expression:"editTaskData.dueDate"}],staticClass:"form-input",attrs:{type:"date",min:t.today},domProps:{value:t.editTaskData.dueDate},on:{change:t.validateEditTaskDueDate,input:function(e){e.target.composing||t.$set(t.editTaskData,"dueDate",e.target.value)}}}),t.editTaskData.dateError?e("div",{staticClass:"error-message"},[t._v(t._s(t.editTaskData.dateError))]):t._e()]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("ä¼˜å…ˆçº§")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.editTaskData.priority,expression:"editTaskData.priority"}],staticClass:"form-select",on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.editTaskData,"priority",e.target.multiple?s:s[0])}}},[e("option",{attrs:{value:"é«˜"}},[t._v("é«˜")]),e("option",{attrs:{value:"ä¸­"}},[t._v("ä¸­")]),e("option",{attrs:{value:"ä½"}},[t._v("ä½")])])])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeEditTaskModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:!t.editTaskData.title.trim()},on:{click:t.saveEditTask}},[t._v(" ä¿å­˜æ›´æ”¹ ")])])])]):t._e(),t.inviteMemberModalOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeInviteMemberModal}},[e("div",{staticClass:"modal-content invite-member-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("é‚€è¯·æˆå‘˜")]),e("button",{staticClass:"modal-close",on:{click:t.closeInviteMemberModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"search-section"},[e("label",{staticClass:"form-label"},[t._v("æœç´¢ç”¨æˆ·")]),e("div",{staticClass:"search-input-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.userSearchKeyword,expression:"userSearchKeyword"}],staticClass:"form-input search-input",attrs:{type:"text",placeholder:"è¯·è¾“å…¥ç”¨æˆ·IDæˆ–å§“åè¿›è¡Œæœç´¢"},domProps:{value:t.userSearchKeyword},on:{input:[function(e){e.target.composing||(t.userSearchKeyword=e.target.value)},t.handleSearchInput]}}),e("button",{staticClass:"search-btn",attrs:{disabled:t.isSearching},on:{click:t.searchUsers}},[t.isSearching?e("span",{staticClass:"loading-spinner-small"}):e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("circle",{attrs:{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M21 21L16.65 16.65",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])])]),t.searchedUsers.length>0?e("div",{staticClass:"search-results"},[e("div",{staticClass:"search-results-header"},[e("span",{staticClass:"results-count"},[t._v("æ‰¾åˆ° "+t._s(t.searchedUsers.length)+" ä¸ªç”¨æˆ·")]),t.selectedUserIds.length>0?e("span",{staticClass:"selected-count"},[t._v("å·²é€‰ "+t._s(t.selectedUserIds.length)+" äºº")]):t._e()]),e("div",{staticClass:"user-list"},t._l(t.searchedUsers,function(s){return e("div",{key:s.id||s.userId,staticClass:"user-item",class:{"user-selected":t.selectedUserIds.includes(s.id||s.userId)},on:{click:function(e){return t.selectUser(s)}}},[e("div",{staticClass:"user-avatar"},[s.avatarUrl||s.avatar?e("img",{attrs:{src:s.avatarUrl||s.avatar,alt:"ç”¨æˆ·å¤´åƒ"}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"user-info"},[e("div",{staticClass:"user-name"},[t._v(t._s(s.name||s.username))]),e("div",{staticClass:"user-email"},[t._v(t._s(s.email||"ID: "+(s.id||s.userId)))])]),t.selectedUserIds.includes(s.id||s.userId)?e("div",{staticClass:"user-select-indicator"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"#4CAF50","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e()])}),0)]):t.hasSearched&&!t.isSearching?e("div",{staticClass:"empty-state"},[e("svg",{attrs:{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("circle",{attrs:{cx:"11",cy:"11",r:"8",stroke:"#d9d9d9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M21 21L16.65 16.65",stroke:"#d9d9d9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("p",[t._v("æœªæ‰¾åˆ°ç›¸å…³ç”¨æˆ·")])]):e("div",{staticClass:"search-hint"},[e("svg",{attrs:{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("circle",{attrs:{cx:"11",cy:"11",r:"8",stroke:"#bbb","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("path",{attrs:{d:"M21 21L16.65 16.65",stroke:"#bbb","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})]),e("p",[t._v("è¯·è¾“å…¥ç”¨æˆ·IDæˆ–å§“åè¿›è¡Œæœç´¢")])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn secondary",on:{click:t.closeInviteMemberModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:0===t.selectedUserIds.length||t.isInviting},on:{click:t.confirmInvite}},[t.isInviting?e("span",[t._v("é‚€è¯·ä¸­...")]):e("span",[t._v("ç¡®å®šé‚€è¯·"+t._s(t.selectedUserIds.length>0?" ("+t.selectedUserIds.length+")":""))])])])])]):t._e(),t.taskDetailModalOpen&&t.selectedTask?e("div",{staticClass:"modal-overlay",on:{click:t.closeTaskDetailModal}},[e("div",{staticClass:"modal-content task-detail-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("ä»»åŠ¡è¯¦æƒ…")]),e("button",{staticClass:"modal-close",on:{click:t.closeTaskDetailModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body task-detail-body"},[e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("ä»»åŠ¡æ ‡é¢˜")]),e("div",{staticClass:"task-detail-value"},[t._v(t._s(t.selectedTask.title))])]),e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("ä»»åŠ¡æè¿°")]),e("div",{staticClass:"task-detail-value task-description-scroll"},[t._v(t._s(t.selectedTask.description||"æš‚æ— æè¿°"))])]),e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("ä¼˜å…ˆçº§")]),e("div",{staticClass:"task-detail-value"},[e("span",{staticClass:"task-priority-badge",class:t.priorityClass(t.selectedTask.priority)},[t._v(t._s(t.selectedTask.priority))])])]),e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("çŠ¶æ€")]),e("div",{staticClass:"task-detail-value"},[e("span",{staticClass:"task-status-badge",class:t.statusClass(t.selectedTask.status)},[t._v(t._s(t.selectedTask.status))])])]),t.selectedTask.date?e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("æˆªæ­¢æ—¥æœŸ")]),e("div",{staticClass:"task-detail-value"},[t._v(t._s(t.selectedTask.date))])]):t._e(),e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("åˆ›å»ºäºº")]),e("div",{staticClass:"task-detail-value"},[t._v(t._s(t.selectedTask.created_by_name||"æœªçŸ¥"))])]),t.selectedTask.assignee_name?e("div",{staticClass:"task-detail-section"},[e("label",{staticClass:"task-detail-label"},[t._v("è´Ÿè´£äºº")]),e("div",{staticClass:"task-detail-value"},[t._v(t._s(t.selectedTask.assignee_name))])]):t._e()]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-primary",on:{click:t.closeTaskDetailModal}},[t._v("å…³é—­")])])])]):t._e()]),t.assignTaskModalOpen&&t.taskToAssign?e("div",{staticClass:"modal-overlay",on:{click:t.closeAssignTaskModal}},[e("div",{staticClass:"modal-content assign-task-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",{staticClass:"modal-title"},[t._v("åˆ†é…ä»»åŠ¡")]),e("button",{staticClass:"modal-close",on:{click:t.closeAssignTaskModal}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"assign-task-info"},[e("h4",{staticClass:"assign-task-title"},[t._v(t._s(t.taskToAssign.title))]),e("p",{staticClass:"assign-task-description"},[t._v(t._s(t.taskToAssign.description||"æš‚æ— æè¿°"))])]),e("div",{staticClass:"form-field"},[e("label",{staticClass:"form-label"},[t._v("é€‰æ‹©è´Ÿè´£äºº")]),e("div",{staticClass:"member-select-list"},t._l(t.teamMembers,function(s){return e("div",{key:s.id,staticClass:"member-select-item",class:{selected:t.selectedAssigneeId===s.id},on:{click:function(e){t.selectedAssigneeId=s.id}}},[e("div",{staticClass:"member-select-avatar"},[s.avatar?e("img",{attrs:{src:s.avatar,alt:s.name}}):e("div",{staticClass:"avatar-placeholder"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"member-select-info"},[e("div",{staticClass:"member-select-name"},[t._v(t._s(s.name))]),e("div",{staticClass:"member-select-role"},[t._v(t._s(s.role))])]),t.selectedAssigneeId===s.id?e("div",{staticClass:"member-select-indicator"},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 6L9 17L4 12",stroke:"#4CAF50","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]):t._e()])}),0),0===t.teamMembers.length?e("div",{staticClass:"empty-members-hint"},[e("p",[t._v("æš‚æ— å›¢é˜Ÿæˆå‘˜ï¼Œè¯·å…ˆé‚€è¯·æˆå‘˜åŠ å…¥é¡¹ç›®")])]):t._e()])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn secondary",on:{click:t.closeAssignTaskModal}},[t._v("å–æ¶ˆ")]),e("button",{staticClass:"btn primary",attrs:{disabled:!t.selectedAssigneeId},on:{click:t.confirmAssignTask}},[t._v("ç¡®è®¤åˆ†é…")])])])]):t._e(),t.showToast?e("div",{staticClass:"success-toast"},[t._v(" "+t._s(t.toastMessage)+" ")]):t._e(),t.showCropModal?e("div",{staticClass:"crop-modal-overlay"},[e("div",{staticClass:"crop-modal-content",on:{click:function(t){t.stopPropagation()}}},[t._m(1),e("div",{staticClass:"crop-modal-body"},[e("div",{staticClass:"crop-container"},[e("canvas",{ref:"cropCanvas",staticClass:"crop-canvas"}),e("div",{ref:"cropOverlay",staticClass:"crop-overlay"},[e("div",{ref:"cropSelection",staticClass:"crop-selection"},[e("div",{staticClass:"resize-handle resize-handle-nw",attrs:{"data-handle":"nw"}}),e("div",{staticClass:"resize-handle resize-handle-ne",attrs:{"data-handle":"ne"}}),e("div",{staticClass:"resize-handle resize-handle-sw",attrs:{"data-handle":"sw"}}),e("div",{staticClass:"resize-handle resize-handle-se",attrs:{"data-handle":"se"}})])])])]),e("div",{staticClass:"crop-modal-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeCropModal}},[t._v("é‡æ–°é€‰æ‹©å›¾ç‰‡")]),e("button",{staticClass:"btn-confirm",on:{click:t.applyCrop}},[t._v("å®Œæˆè£åˆ‡")])])])]):t._e()])},es=[function(){var t=this,e=t._self._c;return e("p",{staticClass:"empty-state-message"},[t._v(" ç‚¹å‡»å³ä¾§"),e("span",{staticClass:"highlight-text"},[t._v('"æ–°å»ºä»»åŠ¡"')]),t._v("æŒ‰é’®æ¥åˆ›å»ºç¬¬ä¸€ä¸ªä»»åŠ¡ ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"crop-modal-header"},[e("h3",[t._v("è£åˆ‡é¡¹ç›®å›¾ç‰‡")]),e("p",{staticClass:"crop-hint"},[t._v("è¯·æ‹–æ‹½é€‰æ‹©è£åˆ‡åŒºåŸŸï¼Œç¡®ä¿æ¯”ä¾‹ä¸é¡¹ç›®å¹¿åœºæ˜¾ç¤ºä¸€è‡´")])])}],ss={name:"ProjectDetail",data(){return{taskTypeOpen:!1,selectedTaskType:"",statusDropdownOpen:!1,taskModalOpen:!1,editProjectModalOpen:!1,showToast:!1,toastMessage:"",newTask:{title:"",description:"",dueDate:"",priority:"ä¸­",status:"å¾…æ¥å–",dateError:""},editProjectData:{name:"",description:"",startDate:"",endDate:"",visibility:"PUBLIC",status:"ONGOING"},project:null,tasks:[],teamMembers:[],inviteSlots:[],isLoading:!0,taskListModalOpen:!1,isCreatingTask:!1,taskDetailModalOpen:!1,selectedTask:null,editTaskModalOpen:!1,editTaskData:{title:"",description:"",dueDate:"",priority:"ä¸­",taskId:null},inviteMemberModalOpen:!1,userSearchKeyword:"",searchedUsers:[],selectedUserIds:[],isSearching:!1,isInviting:!1,hasSearched:!1,searchDebounceTimer:null,showCropModal:!1,originalImage:null,originalImageData:null,cropData:{x:0,y:0,width:0,height:0},assignTaskModalOpen:!1,taskToAssign:null,selectedAssigneeId:null}},computed:{filteredTasks(){let t=this.tasks;return this.selectedTaskType&&(t=t.filter(t=>t.priority===this.selectedTaskType)),t.sort((t,e)=>new Date(e.created_at||e.id)-new Date(t.created_at||t.id)).slice(0,5)},allTasks(){return this.tasks},allFilteredTasks(){let t=this.tasks;return this.selectedTaskType&&(t=t.filter(t=>t.priority===this.selectedTaskType)),t},taskCount(){return Array.isArray(this.tasks)?this.tasks.length:0},participantCount(){return Array.isArray(this.teamMembers)&&this.teamMembers.length>0?this.teamMembers.length:this.project&&"number"===typeof this.project.teamSize?this.project.teamSize:0},isProjectManager(){const t=this.getCurrentUserName();return this.project&&this.project.manager===t},today(){const t=new Date;return t.toISOString().split("T")[0]}},mounted(){this.loadProject(),document.addEventListener("click",this.handleClickOutside),this.$eventBus.on(this.$EventTypes.USER_AVATAR_UPDATED,this.handleAvatarUpdated,{debounce:300})},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside),this.$eventBus.off(this.$EventTypes.USER_AVATAR_UPDATED,this.handleAvatarUpdated)},methods:{openTaskListModal(){this.taskListModalOpen=!0},closeTaskListModal(){this.taskListModalOpen=!1},openTaskDetailModal(t){this.selectedTask=t,this.taskDetailModalOpen=!0},closeTaskDetailModal(){this.taskDetailModalOpen=!1,this.selectedTask=null},goToTaskList(){console.log("æ‰‹åŠ¨è·³è½¬åˆ°ä»»åŠ¡åˆ—è¡¨é¡µé¢ï¼Œé¡¹ç›®ID:",this.$route.params.id),this.$router.push(`/project/${this.$route.params.id}/tasks`)},async loadProjectTasks(){const t=this.$route.params.id;if(t)try{console.log("[loadProjectTasks] å¼€å§‹ä»åç«¯åŠ è½½ä»»åŠ¡æ•°æ®ï¼Œé¡¹ç›®ID:",t);const{taskAPI:e}=await s.e(82).then(s.bind(s,82)),a=await e.getProjectTasks(t,0,100);if(console.log("[loadProjectTasks] APIè¿”å›ç»“æœ:",a),a&&200===a.code&&a.data){const t=a.data;console.log("[loadProjectTasks] ä»»åŠ¡æ•°æ®:",t);let e=[];t.content&&Array.isArray(t.content)?e=t.content:Array.isArray(t)&&(e=t),console.log("[loadProjectTasks] è§£æçš„ä»»åŠ¡åˆ—è¡¨:",e);const s=this.getCurrentUserId(),i=this.getCurrentUserName();this.tasks=e.map(t=>{let e=[],a="";return t.assignees&&Array.isArray(t.assignees)&&t.assignees.length>0&&(e=t.assignees.map(t=>Number(t.userId)),a=t.assignees.map(t=>t.userName).join(", ")),{id:t.id,title:t.title,description:t.description||"",date:t.dueDate||t.due_date||"",due_date:t.dueDate||t.due_date,dueDate:t.dueDate||t.due_date,priority:this.getPriorityDisplay(t.priority||"MEDIUM"),priority_value:t.priority||"MEDIUM",status:this.getStatusDisplay(t.status||"TODO"),status_value:t.status||"TODO",assignee_id:e,assignee_name:a,created_by:t.createdBy||s,created_by_name:"æœªçŸ¥ç”¨æˆ·"===t.creatorName?i:t.creatorName||i,showStatusMenu:!1}}),console.log("[loadProjectTasks] è½¬æ¢åçš„ä»»åŠ¡æ•°æ®:",this.tasks),this.saveProjectData()}else console.warn("[loadProjectTasks] APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸:",a),this.loadTasksFromLocalStorage()}catch(e){console.error("[loadProjectTasks] åŠ è½½ä»»åŠ¡å¤±è´¥:",e),this.loadTasksFromLocalStorage()}else console.warn("é¡¹ç›®IDä¸å­˜åœ¨ï¼Œæ— æ³•åŠ è½½ä»»åŠ¡")},loadTasksFromLocalStorage(){const t=this.$route.params.id,e=localStorage.getItem("projects");if(e){const s=JSON.parse(e),a=s.find(e=>String(e.id)===String(t));a&&a.tasks&&(console.log("[loadTasksFromLocalStorage] ä»localStorageåŠ è½½ä»»åŠ¡:",a.tasks),this.tasks=(a.tasks||[]).map(t=>({id:t.id,title:t.title,description:t.description,date:t.due_date||t.dueDate||t.date||"",due_date:t.due_date||t.dueDate,priority:this.getPriorityDisplay(t.priority||"MEDIUM"),priority_value:t.priority||"MEDIUM",status:this.getStatusDisplay(t.status_value||t.status||"ONGOING"),status_value:t.status_value||t.status||"ONGOING",assignee_id:t.assignee_id||[],created_by:t.created_by||1,created_by_name:this.getUserNameById(t.created_by||1),showStatusMenu:!1})))}},async loadProject(){const t=this.$route.params.id;console.log("æ­£åœ¨åŠ è½½é¡¹ç›®ID:",t,"ç±»å‹:",typeof t);try{const{projectAPI:e}=await Promise.resolve().then(s.bind(s,698)),a=await e.getProjectById(t);if(a&&200===a.code&&a.data){console.log("ä»APIè·å–åˆ°æœ€æ–°é¡¹ç›®æ•°æ®:",a.data);const t=a.data;return this.project={id:t.id,name:t.name,title:t.name,description:t.description||"æš‚æ— æè¿°",startDate:t.startDate||"",endDate:t.endDate||"",period:t.startDate&&t.endDate?`${t.startDate} è‡³ ${t.endDate}`:"2024-01-01 è‡³ 2024-12-31",status:t.status||"PLANNING",visibility:t.visibility||"PRIVATE",imageUrl:c(t.imageUrl)||"https://via.placeholder.com/400x225?text=Project+Image",image:c(t.imageUrl),manager:t.creatorName||"æœªçŸ¥",teamSize:t.teamSize||1,category:t.category||"å…¶ä»–",aiCore:"å¾…å®š",tags:t.tags||[],tasks:[],created_by:t.creatorId||1,creatorName:t.creatorName||"æœªçŸ¥"},console.log("é¡¹ç›®åŠ è½½å®Œæˆï¼Œæœ€æ–°imageUrl:",this.project.imageUrl),console.log("é¡¹ç›®åˆ›å»ºè€…:",t.creatorName,"è´Ÿè´£äººè®¾ç½®ä¸º:",this.project.manager),await this.loadTeamMembers(),this.updateManagerFromTeamMembers(),this.loadProjectTasks(),void(this.isLoading=!1)}}catch(a){console.error("ä»APIåŠ è½½é¡¹ç›®å¤±è´¥ï¼Œå›é€€åˆ°localStorage:",a)}const e=localStorage.getItem("projects");if(console.log("localStorageä¸­çš„é¡¹ç›®æ•°æ®:",e),e){const s=JSON.parse(e);console.log("è§£æåçš„é¡¹ç›®åˆ—è¡¨:",s),console.log("é¡¹ç›®IDåˆ—è¡¨:",s.map(t=>({id:t.id,type:typeof t.id})));const a=s.find(e=>String(e.id)===String(t));a?(console.log("æ‰¾åˆ°çš„é¡¹ç›®æ•°æ®:",a),this.project={id:a.id,name:a.name||a.title,title:a.title||a.name,description:a.description||a.dataAssets||a.direction||"æš‚æ— æè¿°",startDate:a.startDate||a.start_date||"",endDate:a.endDate||a.end_date||"",period:(a.start_date||a.startDate)&&(a.end_date||a.endDate)?`${a.start_date||a.startDate} è‡³ ${a.end_date||a.endDate}`:"2024-01-01 è‡³ 2024-12-31",status:this.getStatusValue(a.status),visibility:a.visibility||"PRIVATE",imageUrl:c(a.imageUrl||a.image)||"https://via.placeholder.com/400x225?text=Project+Image",image:c(a.image||a.imageUrl),manager:a.creatorName||"æœªçŸ¥",teamSize:a.teamSize,category:a.category,aiCore:a.aiCore,tags:a.tags||[],tasks:a.tasks||[],created_by:a.created_by||1,creatorName:a.creatorName||"æœªçŸ¥"},console.log("åŠ è½½çš„é¡¹ç›®æ•°æ® - ID:",this.project.id,"startDate:",this.project.startDate,"endDate:",this.project.endDate),console.log("é¡¹ç›®imageUrl:",this.project.imageUrl),console.log("é¡¹ç›®å‘¨æœŸ:",a.startDate,a.endDate),console.log("é¡¹ç›®ä»»åŠ¡:",a.tasks),this.teamMembers=a.teamMembers||[],this.inviteSlots=a.inviteSlots||[],this.updateManagerFromTeamMembers()):(console.log("æœªæ‰¾åˆ°é¡¹ç›®ï¼ŒID:",t),console.log("æ‰€æœ‰é¡¹ç›®ID:",s.map(t=>t.id)),console.log("IDç±»å‹æ¯”è¾ƒ:",s.map(e=>({id:e.id,type:typeof e.id,matches:String(e.id)===String(t)}))),this.project={id:t,title:"é¡¹ç›®ä¸å­˜åœ¨",description:"æŠ±æ­‰ï¼Œæœªæ‰¾åˆ°æŒ‡å®šçš„é¡¹ç›®",period:"æœªçŸ¥",status:"æœªçŸ¥",manager:"æœªçŸ¥"})}else console.log("localStorageä¸­æ²¡æœ‰é¡¹ç›®æ•°æ®"),this.project={id:t,title:"é¡¹ç›®ä¸å­˜åœ¨",description:"æŠ±æ­‰ï¼Œæœªæ‰¾åˆ°æŒ‡å®šçš„é¡¹ç›®",period:"æœªçŸ¥",status:"æœªçŸ¥",manager:"æœªçŸ¥"};this.isLoading=!1,console.log("é¡¹ç›®åŠ è½½å®Œæˆï¼Œproject:",this.project),this.loadProjectTasks()},loadTeamMembersFromLocalStorage(){const t=this.$route.params.id,e=localStorage.getItem("projects");if(e){const s=JSON.parse(e),a=s.find(e=>String(e.id)===String(t));a&&(this.teamMembers=a.teamMembers||[{id:1,name:this.getCurrentUserName(),role:"é¡¹ç›®è´Ÿè´£äºº",avatar:null}],this.inviteSlots=a.inviteSlots||[])}this.teamMembers&&0!==this.teamMembers.length||(this.teamMembers=[{id:1,name:this.getCurrentUserName(),role:"é¡¹ç›®è´Ÿè´£äºº",avatar:null}])},goBack(){this.$router.go(-1)},goToProjectKnowledge(){const t=this.$route.params.id||this.project?.id;if(console.log("è·³è½¬åˆ°é¡¹ç›®çŸ¥è¯†åº“ï¼Œé¡¹ç›®ID:",t,"è·¯ç”±è·¯å¾„:",`/project-knowledge/${t}`),!t)return console.error("é¡¹ç›®IDä¸ºç©ºï¼Œæ— æ³•è·³è½¬"),void alert("é¡¹ç›®IDæ— æ•ˆï¼Œæ— æ³•è·³è½¬åˆ°çŸ¥è¯†åº“");this.$router.push({name:"ProjectKnowledge",params:{id:String(t)}}).catch(e=>{"NavigationDuplicated"!==e.name&&(console.error("è·¯ç”±è·³è½¬å¤±è´¥:",e),this.$router.push(`/project-knowledge/${t}`).catch(t=>{console.error("è·¯å¾„è·³è½¬ä¹Ÿå¤±è´¥:",t)}))})},goToAIAssistant(){const t=this.project?.id||this.$route.params.id;this.$router.push({path:"/ai-assistant",query:{projectId:t}})},addTeamMember(){const t=prompt("è¯·è¾“å…¥æˆå‘˜å§“å:");if(t&&t.trim()){const e=prompt("è¯·è¾“å…¥æˆå‘˜è§’è‰²:"),s={id:Date.now(),name:t.trim(),role:e?e.trim():"å›¢é˜Ÿæˆå‘˜",avatar:null};this.teamMembers.push(s),this.saveProjectData(),alert("æˆå‘˜æ·»åŠ æˆåŠŸï¼")}},inviteMember(){this.inviteMemberModalOpen=!0,this.userSearchKeyword="",this.searchedUsers=[],this.selectedUserIds=[],this.hasSearched=!1},closeInviteMemberModal(){this.inviteMemberModalOpen=!1,this.userSearchKeyword="",this.searchedUsers=[],this.selectedUserIds=[],this.hasSearched=!1,this.isSearching=!1,this.isInviting=!1,this.searchDebounceTimer&&(clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null)},handleSearchInput(){this.searchDebounceTimer&&clearTimeout(this.searchDebounceTimer),this.userSearchKeyword.trim()?this.searchDebounceTimer=setTimeout(()=>{this.searchUsers()},300):(this.searchedUsers=[],this.hasSearched=!1)},async searchUsers(){if(this.userSearchKeyword.trim()){this.isSearching=!0,this.hasSearched=!1;try{const{projectAPI:t}=await Promise.resolve().then(s.bind(s,698)),e=await t.searchUsers(this.userSearchKeyword.trim(),0,20);console.log("æœç´¢ç”¨æˆ·å“åº”:",e),e&&200===e.code?(e.data&&e.data.content?this.searchedUsers=e.data.content:Array.isArray(e.data)?this.searchedUsers=e.data:this.searchedUsers=[],this.hasSearched=!0,console.log("æœç´¢åˆ°çš„ç”¨æˆ·:",this.searchedUsers)):(this.showSuccessToast(e?.msg||"æœç´¢å¤±è´¥"),this.searchedUsers=[],this.hasSearched=!0)}catch(t){console.error("æœç´¢ç”¨æˆ·å¤±è´¥:",t),this.showSuccessToast("æœç´¢ç”¨æˆ·å¤±è´¥: "+(t.message||"ç½‘ç»œé”™è¯¯")),this.searchedUsers=[],this.hasSearched=!0}finally{this.isSearching=!1}}else this.showSuccessToast("è¯·è¾“å…¥æœç´¢å…³é”®è¯")},selectUser(t){const e=t.id||t.userId,s=this.selectedUserIds.indexOf(e);s>-1?(this.selectedUserIds.splice(s,1),console.log("å–æ¶ˆé€‰ä¸­ç”¨æˆ·:",t.name,"å½“å‰å·²é€‰:",this.selectedUserIds.length)):(this.selectedUserIds.push(e),console.log("é€‰ä¸­ç”¨æˆ·:",t.name,"å½“å‰å·²é€‰:",this.selectedUserIds.length))},async confirmInvite(){if(0!==this.selectedUserIds.length){this.isInviting=!0;try{const{projectAPI:e}=await Promise.resolve().then(s.bind(s,698)),a=this.$route.params.id;let i=0,o=0;for(const s of this.selectedUserIds)try{const t=await e.inviteMember(a,{userId:s,role:"MEMBER"});t&&200===t.code?i++:(o++,console.error("é‚€è¯·ç”¨æˆ·å¤±è´¥:",s,t?.msg))}catch(t){o++,console.error("é‚€è¯·ç”¨æˆ·å¼‚å¸¸:",s,t)}i>0&&0===o?this.showSuccessToast(`æˆåŠŸé‚€è¯· ${i} ä½ç”¨æˆ·ï¼`):i>0&&o>0?this.showSuccessToast(`æˆåŠŸé‚€è¯· ${i} ä½ï¼Œå¤±è´¥ ${o} ä½`):this.showSuccessToast("é‚€è¯·å¤±è´¥ï¼Œè¯·é‡è¯•"),i>0&&(this.closeInviteMemberModal(),this.loadTeamMembers())}catch(t){console.error("é‚€è¯·æˆå‘˜å¤±è´¥:",t),this.showSuccessToast("é‚€è¯·å¤±è´¥: "+(t.message||"ç½‘ç»œé”™è¯¯"))}finally{this.isInviting=!1}}else this.showSuccessToast("è¯·å…ˆé€‰æ‹©è¦é‚€è¯·çš„ç”¨æˆ·")},async loadTeamMembers(){try{const{projectAPI:e}=await Promise.resolve().then(s.bind(s,698)),a=this.$route.params.id,i=await e.getProjectMembers(a,0,50);if(console.log("å›¢é˜Ÿæˆå‘˜å“åº”:",i),i&&200===i.code){i.data&&i.data.content?this.teamMembers=i.data.content.map(t=>({id:String(t.userId),name:t.username||t.name||"æœªçŸ¥ç”¨æˆ·",role:t.roleName||t.role||"æˆå‘˜",avatar:this.parseAvatarUrl(t.avatar)})):Array.isArray(i.data)&&(this.teamMembers=i.data.map(t=>({id:String(t.userId),name:t.username||t.name||"æœªçŸ¥ç”¨æˆ·",role:t.roleName||t.role||"æˆå‘˜",avatar:this.parseAvatarUrl(t.avatar)}))),console.log("âœ… å›¢é˜Ÿæˆå‘˜åŠ è½½å®Œæˆ:",this.teamMembers.length,"äºº"),console.log("æˆå‘˜IDåˆ—è¡¨:",this.teamMembers.map(t=>t.id));try{const t=`project_member_count_${a}`;localStorage.setItem(t,String(this.teamMembers.length))}catch(t){console.warn("å†™å…¥æˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:",t?.message||t)}this.updateManagerFromTeamMembers()}}catch(e){console.error("åŠ è½½å›¢é˜Ÿæˆå‘˜å¤±è´¥:",e)}},handleAvatarUpdated({userId:t,avatarUrl:e}){console.log("ğŸ”” ProjectDetailæ”¶åˆ°å¤´åƒæ›´æ–°äº‹ä»¶:",{userId:t,userIdType:typeof t,avatarUrl:e.substring(0,50)+"...",teamMembersCount:this.teamMembers.length,teamMemberIds:this.teamMembers.map(t=>({id:t.id,type:typeof t.id}))});const s=this.teamMembers.find(e=>e.id===t);s?(console.log("âœ… æ‰¾åˆ°æˆå‘˜:",s.name),console.log("æ›´æ–°å‰çš„å¤´åƒ:",s.avatar?.substring(0,50)),this.$set(s,"avatar",e),console.log(`âœ… å·²æ›´æ–°å›¢é˜Ÿæˆå‘˜ ${s.name}(${t}) çš„å¤´åƒ`),console.log("æ›´æ–°åçš„å¤´åƒ:",s.avatar?.substring(0,50)),this.$forceUpdate()):(console.warn(`âš ï¸ ç”¨æˆ· ${t} ä¸åœ¨å½“å‰é¡¹ç›®æˆå‘˜åˆ—è¡¨ä¸­`),console.warn("å½“å‰æˆå‘˜åˆ—è¡¨:",this.teamMembers.map(t=>({id:t.id,name:t.name}))))},updateManagerFromTeamMembers(){const t=["OWNER","PROJECT_OWNER","é¡¹ç›®è´Ÿè´£äºº","é¡¹ç›®æ‹¥æœ‰è€…","è´Ÿè´£äºº"],e=this.teamMembers.find(e=>{const s=(e.role||"").toUpperCase();return t.some(t=>s===t.toUpperCase()||s.includes(t.toUpperCase()))});e?(this.project.manager=e.name,console.log("ä»å›¢é˜Ÿæˆå‘˜ä¸­æ‰¾åˆ°é¡¹ç›®æ‹¥æœ‰è€…:",e.name,"è§’è‰²:",e.role)):this.project.creatorName&&"æœªçŸ¥"!==this.project.creatorName?(this.project.manager=this.project.creatorName,console.log("ä½¿ç”¨é¡¹ç›®åˆ›å»ºè€…ä½œä¸ºè´Ÿè´£äºº:",this.project.creatorName)):console.log("æœªæ‰¾åˆ°é¡¹ç›®æ‹¥æœ‰è€…ï¼Œè´Ÿè´£äººä¿æŒä¸º:",this.project.manager)},removeTeamMember(t){confirm("ç¡®å®šè¦ç§»é™¤æ­¤æˆå‘˜å—ï¼Ÿ")&&(this.teamMembers=this.teamMembers.filter(e=>e.id!==t),this.saveProjectData())},removeInviteSlot(t){confirm("ç¡®å®šè¦å–æ¶ˆæ­¤é‚€è¯·å—ï¼Ÿ")&&(this.inviteSlots=this.inviteSlots.filter(e=>e.id!==t),this.saveProjectData())},saveProjectData(){const t=JSON.parse(localStorage.getItem("projects")||"[]");console.log("æŸ¥æ‰¾é¡¹ç›®ID:",this.project.id,"ç±»å‹:",typeof this.project.id);const e=t.findIndex(t=>String(t.id)===String(this.project.id));-1!==e?(t[e]={...t[e],id:this.project.id,name:this.project.name,title:this.project.title,description:this.project.description,startDate:this.project.startDate,endDate:this.project.endDate,visibility:this.project.visibility,status:this.project.status,imageUrl:this.project.imageUrl||this.project.image,image:this.project.image||this.project.imageUrl,teamMembers:this.teamMembers,inviteSlots:this.inviteSlots,tasks:this.tasks},localStorage.setItem("projects",JSON.stringify(t)),console.log("é¡¹ç›®æ•°æ®å·²ä¿å­˜åˆ°localStorageï¼Œé¡¹ç›®ID:",this.project.id),console.log("ä¿å­˜çš„ä»»åŠ¡æ•°æ®:",this.tasks.map(t=>({title:t.title,status:t.status,status_value:t.status_value})))):(console.log("æœªæ‰¾åˆ°é¡¹ç›®ï¼Œæ— æ³•ä¿å­˜æ•°æ®ã€‚é¡¹ç›®ID:",this.project.id),console.log("ç°æœ‰é¡¹ç›®IDåˆ—è¡¨:",t.map(t=>({id:t.id,type:typeof t.id}))))},editProject(){const t=this.getStatusValue(this.project.status);this.editProjectData={name:this.project.name||this.project.title,description:this.project.description||"",startDate:this.project.startDate||"",endDate:this.project.endDate||"",visibility:this.project.visibility||"PRIVATE",status:t||"ONGOING",imageUrl:this.project.imageUrl||this.project.image||"https://via.placeholder.com/400x225?text=Project+Image"},console.log("ç¼–è¾‘é¡¹ç›®æ•°æ®åˆå§‹åŒ–:",this.editProjectData),this.editProjectModalOpen=!0},closeEditProjectModal(){this.editProjectModalOpen=!1},async saveProjectUpdate(){if(this.editProjectData.name.trim())try{const{projectAPI:t}=await Promise.resolve().then(s.bind(s,698));console.log("ä½¿ç”¨é¡¹ç›®APIæ¨¡å—æ›´æ–°é¡¹ç›®..."),console.log("é¡¹ç›®ID:",this.project.id,"ç±»å‹:",typeof this.project.id),console.log("æ›´æ–°æ•°æ®:",this.editProjectData);const e=await t.updateProject(this.project.id,this.editProjectData);console.log("æ›´æ–°é¡¹ç›®APIè¿”å›ç»“æœ:",e),console.log("æ›´æ–°åçš„é¡¹ç›®æ•°æ®:",e.data),200===e.code?(e.data?(this.project.id=e.data.id,this.project.name=e.data.name,this.project.title=e.data.name,this.project.description=e.data.description,this.project.startDate=e.data.startDate,this.project.endDate=e.data.endDate,this.project.visibility=e.data.visibility,this.project.status=e.data.status,this.project.imageUrl=e.data.imageUrl,this.project.image=e.data.imageUrl,e.data.startDate&&e.data.endDate&&(this.project.period=`${e.data.startDate} è‡³ ${e.data.endDate}`),console.log("é¡¹ç›®æ›´æ–°æˆåŠŸï¼Œæœ€æ–°é¡¹ç›®ID:",this.project.id),console.log("æ›´æ–°åçš„é¡¹ç›®å®Œæ•´æ•°æ®:",this.project)):(this.project.name=this.editProjectData.name,this.project.title=this.editProjectData.name,this.project.description=this.editProjectData.description,this.project.startDate=this.editProjectData.startDate,this.project.endDate=this.editProjectData.endDate,this.project.visibility=this.editProjectData.visibility,this.project.status=this.editProjectData.status,this.editProjectData.startDate&&this.editProjectData.endDate&&(this.project.period=`${this.editProjectData.startDate} è‡³ ${this.editProjectData.endDate}`)),this.saveProjectData(),this.closeEditProjectModal(),this.showSuccessToast("é¡¹ç›®æ›´æ–°æˆåŠŸï¼")):alert("æ›´æ–°å¤±è´¥ï¼š"+(e.msg||"æœªçŸ¥é”™è¯¯"))}catch(t){console.error("æ›´æ–°é¡¹ç›®å¤±è´¥:",t),alert("æ›´æ–°é¡¹ç›®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}else alert("è¯·è¾“å…¥é¡¹ç›®åç§°")},async changeStatus(t){if(t&&t!==this.project.status)try{const{projectAPI:e}=await Promise.resolve().then(s.bind(s,698));console.log("ä½¿ç”¨é¡¹ç›®APIæ¨¡å—æ›´æ–°é¡¹ç›®çŠ¶æ€...");const a=await e.updateProjectStatus(this.project.id,t);console.log("æ›´æ–°é¡¹ç›®çŠ¶æ€APIè¿”å›ç»“æœ:",a),200===a.code?(this.project.status=t,this.saveProjectData(),this.statusDropdownOpen=!1,this.showSuccessToast("é¡¹ç›®çŠ¶æ€å·²æ›´æ–°ï¼"),console.log("é¡¹ç›®çŠ¶æ€å·²æ›´æ”¹ä¸º:",t)):alert("çŠ¶æ€æ›´æ–°å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(e){console.error("æ›´æ–°é¡¹ç›®çŠ¶æ€å¤±è´¥:",e),alert("æ›´æ–°é¡¹ç›®çŠ¶æ€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},async deleteProject(){if(confirm("ç¡®å®šè¦åˆ é™¤æ­¤é¡¹ç›®å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼é¡¹ç›®åŠå…¶æ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚"))try{const{projectAPI:t}=await Promise.resolve().then(s.bind(s,698));console.log("====== å¼€å§‹åˆ é™¤é¡¹ç›® ======"),console.log("é¡¹ç›®ID:",this.project.id,"ç±»å‹:",typeof this.project.id),console.log("é¡¹ç›®åç§°:",this.project.name||this.project.title);const e=await t.deleteProject(this.project.id);if(console.log("åˆ é™¤é¡¹ç›®APIè¿”å›ç»“æœ:",e),console.log("è¿”å›code:",e?.code),console.log("è¿”å›msg:",e?.msg),e&&200===e.code){console.log("é¡¹ç›®åˆ é™¤æˆåŠŸï¼Œå‡†å¤‡æ¸…ç†æœ¬åœ°æ•°æ®");const t=JSON.parse(localStorage.getItem("projects")||"[]");console.log("åˆ é™¤å‰çš„é¡¹ç›®åˆ—è¡¨:",t.map(t=>({id:t.id,name:t.name||t.title})));const e=t.filter(t=>String(t.id)!==String(this.project.id));console.log("åˆ é™¤åçš„é¡¹ç›®åˆ—è¡¨:",e.map(t=>({id:t.id,name:t.name||t.title}))),localStorage.setItem("projects",JSON.stringify(e)),this.showSuccessToast("é¡¹ç›®åˆ é™¤æˆåŠŸï¼"),console.log("====== é¡¹ç›®åˆ é™¤å®Œæˆï¼Œå³å°†è·³è½¬ ======"),setTimeout(()=>{this.$router.push("/project-square")},1500)}else{const t=e?.msg||"æœªçŸ¥é”™è¯¯";console.error("åˆ é™¤å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯:",t),alert("åˆ é™¤å¤±è´¥ï¼š"+t)}}catch(t){console.error("====== åˆ é™¤é¡¹ç›®å¼‚å¸¸ ======"),console.error("é”™è¯¯ç±»å‹:",t.constructor.name),console.error("é”™è¯¯ä¿¡æ¯:",t.message),console.error("é”™è¯¯è¯¦æƒ…:",t);let e="åˆ é™¤é¡¹ç›®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";t.response?(console.error("æœåŠ¡å™¨é”™è¯¯å“åº”:",t.response.status,t.response.data),e=t.response.data?.msg||`æœåŠ¡å™¨é”™è¯¯ (${t.response.status})`):t.request?(console.error("ç½‘ç»œé”™è¯¯ï¼Œæœªæ”¶åˆ°å“åº”"),e="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"):t.msg&&(e=t.msg),alert(e)}else console.log("ç”¨æˆ·å–æ¶ˆåˆ é™¤é¡¹ç›®")},validateNewTaskDueDate(){return this.newTask.dateError="",!(this.newTask.dueDate&&new Date(this.newTask.dueDate)<new Date(this.today))||(this.newTask.dateError="ä»»åŠ¡æˆªæ­¢æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©",!1)},createTask(){this.taskModalOpen=!0,this.newTask={title:"",description:"",dueDate:"",priority:"ä¸­",status:"å¾…æ¥å–",dateError:""}},closeTaskModal(){this.taskModalOpen=!1},async saveNewTask(){if(this.isCreatingTask)console.log("[saveNewTask] ä»»åŠ¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œå¿½ç•¥é‡å¤ç‚¹å‡»");else if(this.newTask.title.trim())if(this.newTask.dueDate&&new Date(this.newTask.dueDate)<new Date(this.today))alert("ä»»åŠ¡æˆªæ­¢æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©");else{this.isCreatingTask=!0;try{const{taskAPI:t}=await s.e(82).then(s.bind(s,82)),e={projectId:this.project.id,title:this.newTask.title.trim(),description:this.newTask.description.trim(),priority:this.getPriorityValue(this.newTask.priority),dueDate:this.newTask.dueDate||null,assigneeIds:[]};console.log("[saveNewTask] åˆ›å»ºä»»åŠ¡ï¼Œæ•°æ®:",e);const a=await t.createTask(e);console.log("[saveNewTask] APIè¿”å›ç»“æœ:",a),a&&200===a.code?(await this.loadProjectTasks(),this.closeTaskModal(),this.showSuccessToast("ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼")):alert("åˆ›å»ºä»»åŠ¡å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(t){console.error("[saveNewTask] åˆ›å»ºä»»åŠ¡å¤±è´¥:",t),alert("åˆ›å»ºä»»åŠ¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{setTimeout(()=>{this.isCreatingTask=!1},1e3)}}else alert("è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜")},editTask(t){this.editTaskData={title:t.title,description:t.description||"",dueDate:t.date||t.dueDate||"",priority:t.priority,taskId:t.id},this.editTaskModalOpen=!0},closeEditTaskModal(){this.editTaskModalOpen=!1,this.editTaskData={title:"",description:"",dueDate:"",priority:"ä¸­",taskId:null}},async saveEditTask(){if(this.editTaskData.title.trim())if(this.editTaskData.dueDate&&new Date(this.editTaskData.dueDate)<new Date(this.today))alert("ä»»åŠ¡æˆªæ­¢æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©");else try{const{taskAPI:t}=await s.e(82).then(s.bind(s,82)),e={title:this.editTaskData.title.trim(),description:this.editTaskData.description.trim(),priority:this.getPriorityValue(this.editTaskData.priority),dueDate:this.editTaskData.dueDate||null};console.log("[saveEditTask] æ›´æ–°ä»»åŠ¡ï¼ŒID:",this.editTaskData.taskId,"æ•°æ®:",e);const a=await t.updateTask(this.editTaskData.taskId,e);console.log("[saveEditTask] APIè¿”å›ç»“æœ:",a),a&&200===a.code?(await this.loadProjectTasks(),this.closeEditTaskModal(),this.showSuccessToast("ä»»åŠ¡æ›´æ–°æˆåŠŸï¼")):alert("æ›´æ–°ä»»åŠ¡å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(t){console.error("[saveEditTask] æ›´æ–°ä»»åŠ¡å¤±è´¥:",t),alert("æ›´æ–°ä»»åŠ¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}else alert("è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜")},validateEditTaskDueDate(){return this.editTaskData.dateError="",!(this.editTaskData.dueDate&&new Date(this.editTaskData.dueDate)<new Date(this.today))||(this.editTaskData.dateError="ä»»åŠ¡æˆªæ­¢æ—¥æœŸä¸èƒ½æ—©äºä»Šå¤©",!1)},async deleteTask(t){if(confirm("ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿ"))try{const{taskAPI:e}=await s.e(82).then(s.bind(s,82));console.log("[deleteTask] åˆ é™¤ä»»åŠ¡ï¼Œä»»åŠ¡ID:",t);const a=await e.deleteTask(t);console.log("[deleteTask] APIè¿”å›ç»“æœ:",a),a&&200===a.code?(console.log("[deleteTask] âœ… ä»»åŠ¡åˆ é™¤æˆåŠŸï¼Œé‡æ–°ä»åç«¯åŠ è½½ä»»åŠ¡åˆ—è¡¨"),await this.loadProjectTasks(),this.showSuccessToast("ä»»åŠ¡å·²åˆ é™¤ï¼")):alert("åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(e){console.error("[deleteTask] åˆ é™¤ä»»åŠ¡å¤±è´¥:",e),alert("åˆ é™¤ä»»åŠ¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},handleClickOutside(t){t.target.closest(".dropdown")||(this.taskTypeOpen=!1,this.statusDropdownOpen=!1)},getCurrentUserId(){const t=localStorage.getItem("user_info");if(t)try{const e=JSON.parse(t);return e.id||null}catch(e){return console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),null}return null},getCurrentUserName(){const t=localStorage.getItem("user_info");if(t)try{const e=JSON.parse(t);return e.name||e.nickname||"ç”¨æˆ·"}catch(e){return console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),"ç”¨æˆ·"}return"ç”¨æˆ·"},getPriorityDisplay(t){const e={HIGH:"é«˜",MEDIUM:"ä¸­",LOW:"ä½"};return e[t]||"ä¸­"},getPriorityValue(t){const e={"é«˜":"HIGH","ä¸­":"MEDIUM","ä½":"LOW"};return e[t]||"MEDIUM"},getUserNameById(t){return 1===t?this.getCurrentUserName():"ç”¨æˆ·"+t},getStatusDisplay(t){const e={PLANNING:"è§„åˆ’ä¸­",ONGOING:"è¿›è¡Œä¸­",COMPLETED:"å·²å®Œæˆ",ARCHIVED:"å·²å½’æ¡£",TODO:"å¾…æ¥å–",IN_PROGRESS:"è¿›è¡Œä¸­",BLOCKED:"é˜»å¡",DONE:"å®Œæˆ",PENDING:"å¾…æ¥å–",CANCELLED:"å·²å–æ¶ˆ"};return e[t]||t||"æœªçŸ¥"},getStatusValue(t){const e={"è§„åˆ’ä¸­":"PLANNING","è¿›è¡Œä¸­":"IN_PROGRESS","å·²å®Œæˆ":"COMPLETED","å·²å½’æ¡£":"ARCHIVED","å¾…æ¥å–":"TODO","é˜»å¡":"BLOCKED","å®Œæˆ":"DONE","å·²å–æ¶ˆ":"CANCELLED"};if(e[t])return e[t];const s=["TODO","IN_PROGRESS","BLOCKED","DONE","PLANNING","ONGOING","COMPLETED","ARCHIVED","CANCELLED"];return t&&s.includes(t.toUpperCase())?t.toUpperCase():"TODO"},toggleTaskStatusDropdown(t){this.tasks.forEach(e=>{e.id!==t.id&&this.$set(e,"showStatusMenu",!1)}),this.$set(t,"showStatusMenu",!t.showStatusMenu)},async changeTaskStatus(t,e){try{const{taskAPI:a}=await s.e(82).then(s.bind(s,82)),i=this.getStatusValue(e);console.log(`[changeTaskStatus] æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼Œä»»åŠ¡ID: ${t.id}, æ–°çŠ¶æ€: ${e} (${i})`);const o=await a.updateTaskStatus(t.id,i);console.log("[changeTaskStatus] APIè¿”å›ç»“æœ:",o),o&&200===o.code?(console.log("[changeTaskStatus] âœ… ä»»åŠ¡çŠ¶æ€æ›´æ–°æˆåŠŸï¼Œé‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨"),this.$set(t,"showStatusMenu",!1),await this.loadProjectTasks(),this.showSuccessToast("ä»»åŠ¡çŠ¶æ€å·²æ›´æ–°ï¼"),console.log(`ä»»åŠ¡"${t.title}"çŠ¶æ€å·²æ›´æ”¹ä¸º: ${e} (${i})`),this.$root.$emit("taskStatusChanged",{projectId:this.project.id,taskId:t.id,newStatus:e,statusValue:i})):(alert("æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥ï¼š"+(o.msg||"æœªçŸ¥é”™è¯¯")),this.$set(t,"showStatusMenu",!1))}catch(a){console.error("[changeTaskStatus] æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥:",a),alert("æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),this.$set(t,"showStatusMenu",!1)}},async assignTask(t){const e=confirm(`ç¡®è®¤æ¥å–ä»»åŠ¡"${t.title}"å—ï¼Ÿ`);if(e)try{this.getCurrentUserId(),this.getCurrentUserName();console.log("[assignTask] å¼€å§‹æ¥å–ä»»åŠ¡, ID:",t.id,"å½“å‰çŠ¶æ€:",t.status);const{taskAPI:e}=await s.e(82).then(s.bind(s,82)),a=await e.claimTask(t.id);if(console.log("[assignTask] åç«¯è¿”å›:",a),a&&200===a.code){console.log("[assignTask] âœ… ä»»åŠ¡æ¥å–æˆåŠŸ"),await new Promise(t=>setTimeout(t,300)),await this.loadProjectTasks(),this.$nextTick(()=>{this.$forceUpdate()}),this.showSuccessToast(`æˆåŠŸæ¥å–ä»»åŠ¡: ${t.title}`);const e=this.tasks.find(e=>e.id===t.id);console.log("[assignTask] æ›´æ–°åçš„ä»»åŠ¡çŠ¶æ€:",e?.status,"æ‰§è¡Œè€…:",e?.assignee_name),e&&"å¾…æ¥å–"===e.status&&(console.warn("[assignTask] âš ï¸ çŠ¶æ€æœªæ›´æ–°ï¼Œå†æ¬¡å°è¯•åŠ è½½"),await new Promise(t=>setTimeout(t,500)),await this.loadProjectTasks(),this.$forceUpdate())}else alert("æ¥å–ä»»åŠ¡å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(a){console.error("[assignTask] æ¥å–ä»»åŠ¡å¤±è´¥:",a),alert("æ¥å–ä»»åŠ¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},openAssignTaskModal(t){this.taskToAssign=t,this.selectedAssigneeId=null,this.assignTaskModalOpen=!0},closeAssignTaskModal(){this.assignTaskModalOpen=!1,this.taskToAssign=null,this.selectedAssigneeId=null},async confirmAssignTask(){if(!this.selectedAssigneeId||!this.taskToAssign)return;const t=this.teamMembers.find(t=>t.id===this.selectedAssigneeId);if(t)try{console.log("[confirmAssignTask] å¼€å§‹åˆ†é…ä»»åŠ¡, ID:",this.taskToAssign.id,"å½“å‰çŠ¶æ€:",this.taskToAssign.status);const{taskAPI:e}=await s.e(82).then(s.bind(s,82)),a=await e.assignTask(this.taskToAssign.id,[this.selectedAssigneeId]);if(console.log("[confirmAssignTask] åç«¯è¿”å›:",a),a&&200===a.code){console.log("[confirmAssignTask] âœ… ä»»åŠ¡åˆ†é…æˆåŠŸ"),await new Promise(t=>setTimeout(t,300)),await this.loadProjectTasks(),this.$nextTick(()=>{this.$forceUpdate()}),this.showSuccessToast(`æˆåŠŸå°†ä»»åŠ¡"${this.taskToAssign.title}"åˆ†é…ç»™ ${t.name}`);const e=this.taskToAssign.id;this.closeAssignTaskModal();const s=this.tasks.find(t=>t.id===e);console.log("[confirmAssignTask] æ›´æ–°åçš„ä»»åŠ¡çŠ¶æ€:",s?.status,"æ‰§è¡Œè€…:",s?.assignee_name),s&&"å¾…æ¥å–"===s.status&&(console.warn("[confirmAssignTask] âš ï¸ çŠ¶æ€æœªæ›´æ–°ï¼Œå†æ¬¡å°è¯•åŠ è½½"),await new Promise(t=>setTimeout(t,500)),await this.loadProjectTasks(),this.$forceUpdate())}else alert("åˆ†é…ä»»åŠ¡å¤±è´¥ï¼š"+(a.msg||"æœªçŸ¥é”™è¯¯"))}catch(e){console.error("[confirmAssignTask] åˆ†é…ä»»åŠ¡å¤±è´¥:",e),alert("åˆ†é…ä»»åŠ¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}else alert("æœªæ‰¾åˆ°é€‰ä¸­çš„æˆå‘˜")},statusClass(t){return"PLANNING"===t||"è§„åˆ’ä¸­"===t?"planning":"IN_PROGRESS"===t||"è¿›è¡Œä¸­"===t?"ongoing":"PAUSED"===t||"æš‚åœ"===t?"paused":"COMPLETED"===t||"å®Œæˆ"===t?"completed":"CANCELLED"===t||"å·²å–æ¶ˆ"===t?"cancelled":"ongoing"},priorityClass(t){return"é«˜"===t?"é«˜":"ä¸­"===t?"ä¸­":"ä½"},toggleTaskTypeDropdown(){this.taskTypeOpen=!this.taskTypeOpen},toggleStatusDropdown(){this.statusDropdownOpen=!this.statusDropdownOpen},selectTaskType(t){this.selectedTaskType=t,this.taskTypeOpen=!1},triggerImageUpload(){this.$refs.projectImageUpload.click()},async handleProjectImageUpload(t){const e=t.target.files[0];if(!e)return;const s=["image/jpeg","image/png","image/gif","image/webp","image/bmp"];if(!s.includes(e.type))return alert("åªæ”¯æŒä»¥ä¸‹å›¾ç‰‡æ ¼å¼: jpg, png, gif, webp, bmp"),void(this.$refs.projectImageUpload.value="");if(e.size>5242880)return alert("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB"),void(this.$refs.projectImageUpload.value="");const a=new FileReader;a.onload=t=>{this.originalImageData=t.target.result,this.showCropModal=!0,this.$nextTick(()=>{this.initCropCanvas()})},a.readAsDataURL(e)},async uploadCroppedImage(t){try{const e=await this.dataURLToBlob(t),{projectAPI:a}=await Promise.resolve().then(s.bind(s,698));console.log("[uploadCroppedImage] å¼€å§‹ä¸Šä¼ è£åˆ‡åçš„é¡¹ç›®å›¾ç‰‡");const i=await a.uploadProjectImage(e,this.project.id);if(console.log("[uploadCroppedImage] APIè¿”å›ç»“æœ:",i),console.log("[uploadCroppedImage] è¿”å›ç»“æœç±»å‹:",typeof i),console.log("[uploadCroppedImage] è¿”å›ç»“æœå®Œæ•´ä¿¡æ¯:",JSON.stringify(i,null,2)),i&&(console.log("[uploadCroppedImage] response.code:",i.code),console.log("[uploadCroppedImage] response.msg:",i.msg),console.log("[uploadCroppedImage] response.data:",i.data),i.data&&(console.log("[uploadCroppedImage] response.data.imageUrl:",i.data.imageUrl),console.log("[uploadCroppedImage] response.dataæ‰€æœ‰å­—æ®µ:",Object.keys(i.data)))),i&&200===i.code&&i.data){const t=i.data.imageUrl;if(console.log("[uploadCroppedImage] æå–åˆ°çš„imageUrl:",t),!t)return console.warn("[uploadCroppedImage] âš ï¸ è­¦å‘Šï¼šimageUrl ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼"),console.warn("[uploadCroppedImage] response.data çš„æ‰€æœ‰å­—æ®µ:",i.data),void alert("ä¸Šä¼ æˆåŠŸä½†æœªè·å–åˆ°å›¾ç‰‡URL");this.$set(this.project,"imageUrl",t),this.$set(this.project,"image",t),console.log("[uploadCroppedImage] é¡¹ç›®å¯¹è±¡å·²æ›´æ–°:",{imageUrl:this.project.imageUrl,image:this.project.image}),this.saveProjectData(),this.$forceUpdate(),console.log("[uploadCroppedImage] âœ… å¼ºåˆ¶æ›´æ–°Vueè§†å›¾"),console.log("[uploadCroppedImage] âœ… å›¾ç‰‡URLå·²è®¾ç½®:",t),this.showSuccessToast("é¡¹ç›®å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼"),console.log("[uploadCroppedImage] é¡¹ç›®å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒURL:",t)}else console.error("[uploadCroppedImage] âŒ å“åº”ä¸ç¬¦åˆé¢„æœŸ"),console.error("[uploadCroppedImage] response:",i),alert("ä¸Šä¼ å¤±è´¥: "+(i?.msg||"æœªçŸ¥é”™è¯¯"))}catch(e){if(console.error("[uploadCroppedImage] ä¸Šä¼ é¡¹ç›®å›¾ç‰‡å¤±è´¥:",e),e&&403===e.status){console.error("[uploadCroppedImage] âŒ 403 Forbidden - è®¤è¯å¤±è´¥"),console.error("[uploadCroppedImage] å¯èƒ½åŸå› : JWT token è¿‡æœŸæˆ–æ— æ•ˆ");const t=localStorage.getItem("access_token");t?alert("è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•"):(console.error("[uploadCroppedImage] ğŸ”´ Token ä¸ºç©º"),alert("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"))}else alert("ä¸Šä¼ é¡¹ç›®å›¾ç‰‡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},closeCropModal(){this.$refs.projectImageUpload.value="",this.showCropModal=!1,this.originalImage=null,this.originalImageData=null},initCropCanvas(){const t=this.$refs.cropCanvas,e=t.getContext("2d"),s=new Image;s.onload=()=>{const a=600,i=400;let{width:o,height:r}=s;if(o>a||r>i){const t=Math.min(a/o,i/r);o*=t,r*=t}t.width=o,t.height=r,t.style.width=o+"px",t.style.height=r+"px",e.drawImage(s,0,0,o,r),this.originalImage=s;const n=16/9,l=Math.min(.8*o,r*n*.8),c=l/n;this.cropData={x:(o-l)/2,y:(r-c)/2,width:l,height:c},this.updateCropSelection(),this.setupCropInteraction()},s.src=this.originalImageData},updateCropSelection(){const t=this.$refs.cropSelection;t&&(t.style.left=this.cropData.x+"px",t.style.top=this.cropData.y+"px",t.style.width=this.cropData.width+"px",t.style.height=this.cropData.height+"px")},setupCropInteraction(){const t=this.$refs.cropSelection,e=this.$refs.cropOverlay,s=this.$refs.cropCanvas;if(!t||!e||!s)return;let a=!1,i=!1,o=null,r=0,n=0,l=0,c=0,d=0,h=0;const p=16/9,u=t=>{t.target.classList.contains("resize-handle")?(i=!0,o=t.target.dataset.handle):a=!0;const e=s.getBoundingClientRect();r=t.clientX-e.left,n=t.clientY-e.top,l=this.cropData.x,c=this.cropData.y,d=this.cropData.width,h=this.cropData.height},m=t=>{if(!a&&!i)return;const e=s.getBoundingClientRect(),u=t.clientX-e.left,m=t.clientY-e.top,g=u-r,v=m-n;if(a){const t=Math.max(0,Math.min(s.width-this.cropData.width,l+g)),e=Math.max(0,Math.min(s.height-this.cropData.height,c+v));this.cropData.x=t,this.cropData.y=e}else if(i){let t=d,e=h,a=l,i=c;"se"===o?(t=Math.max(50,Math.min(s.width-l,d+g)),e=t/p,c+e>s.height&&(e=s.height-c,t=e*p)):"sw"===o?(t=Math.max(50,Math.min(l+d,d-g)),e=t/p,a=l+d-t,a<0&&(a=0,t=l+d,e=t/p)):"ne"===o?(t=Math.max(50,Math.min(s.width-l,d+g)),e=t/p,i=c+h-e,i<0&&(i=0,e=c+h,t=e*p)):"nw"===o&&(t=Math.max(50,Math.min(l+d,d-g)),e=t/p,a=l+d-t,i=c+h-e,a<0&&(a=0,t=l+d,e=t/p,i=c+h-e),i<0&&(i=0,e=c+h,t=e*p,a=l+d-t)),this.cropData.x=a,this.cropData.y=i,this.cropData.width=t,this.cropData.height=e}this.updateCropSelection()},g=()=>{a=!1,i=!1,o=null};t.addEventListener("mousedown",u),document.addEventListener("mousemove",m),document.addEventListener("mouseup",g),this.$once("hook:beforeDestroy",()=>{t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",g)})},applyCrop(){if(!this.originalImage)return;const t=document.createElement("canvas"),e=t.getContext("2d"),s=16/9,a=400,i=a/s;t.width=a,t.height=i;const o=this.cropData.x/this.$refs.cropCanvas.width*this.originalImage.width,r=this.cropData.y/this.$refs.cropCanvas.height*this.originalImage.height,n=this.cropData.width/this.$refs.cropCanvas.width*this.originalImage.width,l=this.cropData.height/this.$refs.cropCanvas.height*this.originalImage.height;e.drawImage(this.originalImage,o,r,n,l,0,0,a,i);const c=t.toDataURL("image/jpeg",.9);this.closeCropModal(),this.uploadCroppedImage(c)},dataURLToBlob(t){return new Promise((e,s)=>{try{const s=t.split(","),a=s[0].match(/:(.*?);/)[1],i=atob(s[1]);let o=i.length;const r=new Uint8Array(o);while(o--)r[o]=i.charCodeAt(o);const n=new Blob([r],{type:a});e(n)}catch(a){s(a)}})},showSuccessToast(t){this.toastMessage=t,this.showToast=!0,setTimeout(()=>{this.showToast=!1,this.toastMessage=""},1e3)},onImageLoad(){console.log("âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:",this.project.imageUrl||this.project.image)},onImageError(t){const e=this.project.imageUrl||this.project.image;console.error("âŒ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼ŒURL:",e),console.error("âŒ é”™è¯¯è¯¦æƒ…:",t),console.warn("âš ï¸ å¯èƒ½çš„åŸå› ï¼š"),console.warn("  1. CORS è·¨åŸŸé—®é¢˜ - MinIO æ²¡æœ‰æ­£ç¡®é…ç½® CORS"),console.warn("  2. å›¾ç‰‡ URL ä¸æ­£ç¡®"),console.warn("  3. MinIO æœåŠ¡ä¸å¯ç”¨æˆ–æ¡¶ç­–ç•¥æœªè®¾ç½®ä¸ºpublic"),console.warn("  4. ç½‘ç»œè¿æ¥é—®é¢˜"),e&&(console.log("ğŸ“ æµ‹è¯• URL å¯è®¿é—®æ€§ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®ï¼š",e),console.log("ğŸ“ æˆ–è¿è¡Œä»¥ä¸‹PowerShellå‘½ä»¤æµ‹è¯•ï¼š"),console.log(`   Invoke-WebRequest -Uri "${e}" -Method GET -UseBasicParsing`),fetch(e,{method:"HEAD"}).then(t=>{console.log("âœ… HEADè¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç :",t.status),console.log("âœ… Content-Type:",t.headers.get("Content-Type")),console.log("âœ… Access-Control-Allow-Origin:",t.headers.get("Access-Control-Allow-Origin"))}).catch(t=>{console.error("âŒ HEADè¯·æ±‚å¤±è´¥:",t),console.error("âŒ è¿™é€šå¸¸è¡¨ç¤ºCORSæˆ–ç½‘ç»œé—®é¢˜")}))},parseAvatarUrl(t){if(!t)return null;if("string"===typeof t&&(t.startsWith("http://")||t.startsWith("https://")))return t;if("string"===typeof t)try{const e=JSON.parse(t);return e.sizes&&(e.sizes.original||e.sizes["256"]||e.sizes["512"])||null}catch(e){return console.warn("è§£æå¤´åƒURLå¤±è´¥:",e,"åŸå§‹æ•°æ®:",t),null}return"object"===typeof t&&t.sizes&&(t.sizes.original||t.sizes["256"]||t.sizes["512"])||null}}},as=ss,is=(0,_.A)(as,ts,es,!1,null,null,null),os=is.exports,rs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"knowledge-base-container"},[e("div",{staticClass:"top-header"},[e("div",{staticClass:"header-left"},[e("button",{staticClass:"back-btn",attrs:{"aria-label":"è¿”å›"},on:{click:t.goBack}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M19 12H5M12 19L5 12L12 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("span",{staticClass:"page-title"},[t._v(t._s(t.projectName)+" çŸ¥è¯†åº“")])]),t._m(0)]),e("div",{staticClass:"main-content"},[e("div",{staticClass:"content-layout leftbar"},[e("aside",{staticClass:"left-options"},[e("div",{staticClass:"options-card"},[e("div",{staticClass:"options-title"},[t._v("é€‰é¡¹")]),e("div",{staticClass:"option-item",class:{active:"home"===t.activeTab},on:{click:function(e){return t.goTab("home")}}},[e("span",[t._v("ä¸»é¡µ")])]),e("div",{staticClass:"option-item",class:{active:"catalog"===t.activeTab},on:{click:function(e){return t.goTab("catalog")}}},[e("span",[t._v("æˆæœç›®å½•")])]),e("div",{staticClass:"option-item",class:{active:"cabinet"===t.activeTab},on:{click:function(e){return t.goTab("cabinet")}}},[e("span",[t._v("é¡¹ç›®wikiæ–‡æ¡£")])]),e("div",{staticClass:"option-item",class:{active:"ai"===t.activeTab},on:{click:function(e){return t.goTab("ai")}}},[e("span",[t._v("AI èµ‹èƒ½")])])])]),e("div",{staticClass:"content-right"},["home"===t.activeTab?e("div",{staticClass:"kb-header"},[e("div",{staticClass:"kb-title"},[t._v(t._s(t.projectName))]),e("div",{staticClass:"kb-subtitle"},[t._v("æ¬¢è¿æ¥åˆ°é¡¹ç›®çŸ¥è¯†åº“ï¼Œè¿™æ˜¯å›´ç»•AIæ•™è‚²ä¸çŸ¥è¯†ç®¡ç†çš„æ ¸å¿ƒå¹³å°ï¼Œé€šè¿‡ç›®å½•ç³»ç»Ÿç»Ÿä¸€ç®¡ç†å„ç±»æˆæœï¼Œåˆ©ç”¨çŸ¥è¯†åº“æ²‰æ·€å›¢é˜Ÿæ™ºæ…§ï¼Œå¹¶å€ŸåŠ©AIåŠ©ç†èµ‹èƒ½æå‡å·¥ä½œæ•ˆç‡ã€‚")])]):t._e(),"home"===t.activeTab?e("div",{staticClass:"home-content"},[e("div",{staticClass:"stats-grid"},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-card-header"},[e("div",{staticClass:"stat-card-title"},[t._v("æˆæœæ€»æ•°")]),e("div",{staticClass:"stat-icon blue"},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"stat-value"},[t._v(t._s(t.achievementsCount))]),e("div",{staticClass:"stat-desc"},[t._v("è¾ƒä¸Šæœˆå¢é•¿ 12%")])]),e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-card-header"},[e("div",{staticClass:"stat-card-title"},[t._v("çŸ¥è¯†æ–‡æ¡£")]),e("div",{staticClass:"stat-icon green"},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M4 19H20M4 5H20M7 5V19M17 5V19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"stat-value"},[t._v(t._s(t.totalDocuments))]),e("div",{staticClass:"stat-desc"},[t._v("åä½œç¼–è¾‘ä¸­ "+t._s(t.editingDocuments)+" ç¯‡")])]),e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-card-header"},[e("div",{staticClass:"stat-card-title"},[t._v("å›¢é˜Ÿæˆå‘˜")]),e("div",{staticClass:"stat-icon purple"},[e("svg",{attrs:{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}}),e("circle",{attrs:{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e("div",{staticClass:"stat-value"},[t._v(t._s(t.teamMembersCount))]),e("div",{staticClass:"stat-desc"},[t._v("åœ¨çº¿ "+t._s(t.onlineMembersCount)+" äºº")])])]),"home"===t.activeTab?e("div",{staticClass:"card"},[t._m(1),e("div",{staticClass:"activity-list"},t._l(t.activities,function(s){return e("div",{key:s.id,staticClass:"activity-item"},[e("div",{staticClass:"activity-bullet",class:s.type}),e("div",{staticClass:"activity-main"},[e("div",{staticClass:"activity-text"},[t._v(t._s(s.text))]),e("div",{staticClass:"activity-meta"},[t._v(t._s(s.time))])])])}),0)]):t._e()]):"catalog"===t.activeTab?e("KnowledgeBaseCatalog",{attrs:{archiveRows:t.archiveRows,projectId:t.projectId},on:{"file-uploaded":t.handleFileUploaded,"file-deleted":t.handleFileDeleted,"file-edited":t.handleFileEdited}}):"cabinet"===t.activeTab?e("KnowledgeBaseCabinet",{attrs:{projectId:t.projectId},on:{"document-created":t.handleDocumentCreated}}):e("KnowledgeBaseAI",{attrs:{projectId:t.projectId}})],1)])])])},ns=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-right"},[e("div",{staticClass:"translate-icon"},[t._v("è¯‘")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-header"},[e("div",{staticClass:"card-title"},[t._v("æœ€è¿‘æ´»åŠ¨")])])}],ls={name:"ProjectKnowledge",components:{KnowledgeBaseCatalog:we,KnowledgeBaseCabinet:Ie,KnowledgeBaseAI:Ae},data(){return{activeTab:"home",projectId:null,projectName:"åŠ è½½ä¸­...",achievementsCount:0,documentsCount:0,teamMembersCount:0,onlineMembersCount:0,activities:[{id:1,type:"doc",text:"å¼ ä¼Ÿä¸Šä¼ äº†è®ºæ–‡ã€ŠåŸºäºAIçš„æ•™è‚²ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿç ”ç©¶ã€‹",time:"2å°æ—¶å‰"},{id:2,type:"update",text:"ææ¢¦æ›´æ–°äº†çŸ¥è¯†æ–‡æ¡£ã€Šé¡¹ç›®ç®¡ç†è§„èŒƒV2.1ã€‹",time:"3å°æ—¶å‰"},{id:3,type:"ai",text:"AIåŠ©æ‰‹ä¸ºã€Šæ·±åº¦å­¦ä¹ åœ¨æ•™è‚²ä¸­çš„åº”ç”¨ã€‹ç”Ÿæˆäº†æ‘˜è¦å’Œæ ‡ç­¾",time:"1å¤©å‰"},{id:4,type:"edit",text:"ç¼–è¾‘äº†è®ºæ–‡çš„è¯¦ç»†æè¿°ï¼šåŸºäºAIçš„æ•™è‚²ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿç ”ç©¶",time:"2å¤©å‰"},{id:5,type:"delete",text:"åˆ é™¤äº†æ•°æ®é›†ï¼šæ—§ç‰ˆæœ¬å­¦ç”Ÿè¡Œä¸ºæ•°æ®",time:"3å¤©å‰"}],archiveRows:[{id:1,name:"åŸºäºAIçš„æ•™è‚²ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿç ”ç©¶.pdf",type:"è®ºæ–‡",uploader:"å¼ ä¼Ÿ",time:"2023-11-15 14:30",typeCls:"doc"},{id:2,name:"æ™ºèƒ½æ•™å­¦ç³»ç»Ÿäº¤äº’æ–¹æ³•ä¸“åˆ©.docx",type:"ä¸“åˆ©",uploader:"ææƒ³",time:"2023-11-10 09:15",typeCls:"patent"},{id:3,name:"å­¦ç”Ÿè¡Œä¸ºæ•°æ®é›†æ ·ä¾‹.csv",type:"æ•°æ®é›†",uploader:"ç‹å¼º",time:"2023-11-05 16:45",typeCls:"dataset"},{id:4,name:"ä¸ªæ€§åŒ–æ¨èæ¨¡å‹_v2.pkl",type:"æ¨¡å‹æ–‡ä»¶",uploader:"èµµæ•",time:"2023-10-28 11:20",typeCls:"model"},{id:5,name:"æ·±åº¦å­¦ä¹ è¯¾å ‚å®éªŒæŠ¥å‘Š.pdf",type:"å®éªŒæŠ¥å‘Š",uploader:"é™ˆç¾ç²",time:"2023-10-22 13:40",typeCls:"report"}]}},computed:{totalDocuments(){return this.documentsCount>0?this.documentsCount:this.getDocumentsCount()},editingDocuments(){return this.getEditingDocumentsCount()}},mounted(){if(this.projectId=this.$route.params.id,console.log("ProjectKnowledge mounted, projectId:",this.projectId),this.loadProjectName(),this.loadFromLocalStorage(),this.initializeProjectData(),this.projectId)try{const t=localStorage.getItem(`project_member_count_${this.projectId}`),e=t?parseInt(t,10):NaN;!isNaN(e)&&e>0&&(this.teamMembersCount=e,this.onlineMembersCount=Math.floor(.67*this.teamMembersCount),console.log("ä»ç¼“å­˜è¯»å–å›¢é˜Ÿæˆå‘˜æ•°é‡:",this.teamMembersCount));const s=`knowledgeBaseDocs_${this.projectId}`,a=localStorage.getItem(s);if(a){const t=JSON.parse(a);t.docs&&Array.isArray(t.docs)&&(this.documentsCount=t.docs.length,console.log("ä»ç¼“å­˜è¯»å–çŸ¥è¯†æ–‡æ¡£æ•°é‡:",this.documentsCount))}}catch(t){console.warn("è¯»å–ç¼“å­˜å¤±è´¥:",t)}this.$nextTick(()=>{this.loadStats()})},beforeDestroy(){this.saveToLocalStorage()},methods:{goBack(){this.$router.go(-1)},goTab(t){this.activeTab!==t&&(this.activeTab=t)},async loadProjectName(){if(!this.projectId)return void(this.projectName="åŠ è½½ä¸­...");try{const t=await ut.projectAPI.getProjectById(this.projectId);if(t&&200===t.code&&t.data)return this.projectName=t.data.name||"æœªçŸ¥é¡¹ç›®",void console.log("ä»APIè·å–åˆ°é¡¹ç›®åç§°:",this.projectName)}catch(e){console.error("ä»APIåŠ è½½é¡¹ç›®å¤±è´¥ï¼Œå›é€€åˆ°localStorage:",e)}const t=localStorage.getItem("projects");if(console.log("é¡¹ç›®çŸ¥è¯†åº“ - æ­£åœ¨åŠ è½½é¡¹ç›®ID:",this.projectId,"ç±»å‹:",typeof this.projectId),console.log("localStorageä¸­çš„é¡¹ç›®æ•°æ®:",t),t)try{const e=JSON.parse(t);console.log("è§£æåçš„é¡¹ç›®åˆ—è¡¨:",e),console.log("é¡¹ç›®IDåˆ—è¡¨:",e.map(t=>({id:t.id,type:typeof t.id})));const s=e.find(t=>String(t.id)===String(this.projectId));s?(this.projectName=s.name||s.title||"æœªçŸ¥é¡¹ç›®",console.log("æ‰¾åˆ°é¡¹ç›®:",this.projectName,"é¡¹ç›®æ•°æ®:",s)):(this.projectName="æœªçŸ¥é¡¹ç›®",console.log("æœªæ‰¾åˆ°é¡¹ç›®ï¼ŒID:",this.projectId,"å¯ç”¨é¡¹ç›®ID:",e.map(t=>t.id)))}catch(e){console.error("è§£æé¡¹ç›®æ•°æ®å¤±è´¥:",e),this.projectName="æœªçŸ¥é¡¹ç›®"}else this.projectName="æœªçŸ¥é¡¹ç›®",console.log("localStorageä¸­æ²¡æœ‰é¡¹ç›®æ•°æ®")},handleFileUploaded(t){const e={id:Date.now(),type:"doc",text:`ä¸Šä¼ äº†${t.type}ï¼š${t.name}`,time:"åˆšåˆš"};this.activities.unshift(e),this.saveToLocalStorage(),this.loadAchievementsCount()},handleDocumentCreated(t){const e={id:Date.now(),type:"update",text:`åˆ›å»ºäº†æ–°æ–‡æ¡£ï¼š${t.title}`,time:"åˆšåˆš"};this.activities.unshift(e),this.saveToLocalStorage(),this.loadDocumentsCount(),this.updateStats()},handleFileDeleted(t){const e={id:Date.now(),type:"delete",text:`åˆ é™¤äº†${t.type}ï¼š${t.name}`,time:"åˆšåˆš"};this.activities.unshift(e),this.saveToLocalStorage(),this.loadAchievementsCount()},handleFileEdited(t){const e={id:Date.now(),type:"edit",text:`ç¼–è¾‘äº†${t.type}çš„è¯¦ç»†æè¿°ï¼š${t.name}`,time:"åˆšåˆš"};this.activities.unshift(e),this.saveToLocalStorage()},async loadStats(){await Promise.all([this.loadAchievementsCount(),this.loadDocumentsCount(),this.loadTeamMembersCount()])},async loadAchievementsCount(){if(this.projectId)try{console.log("åŠ è½½æˆæœæ€»æ•°, projectId:",this.projectId);const t=await de.getProjectAchievements(this.projectId,0,1);console.log("æˆæœæ€»æ•°å“åº”:",t),t&&200===t.code&&t.data?(this.achievementsCount=t.data.totalElements||t.data.total||0,console.log("æˆæœæ€»æ•°:",this.achievementsCount)):(console.warn("æˆæœæ€»æ•°å“åº”æ ¼å¼å¼‚å¸¸:",t),this.achievementsCount=0)}catch(t){console.error("åŠ è½½æˆæœæ€»æ•°å¤±è´¥:",t),this.achievementsCount=0}else console.warn("projectIdä¸ºç©ºï¼Œæ— æ³•åŠ è½½æˆæœæ€»æ•°")},loadDocumentsCount(){if(!this.projectId)return console.warn("projectIdä¸ºç©ºï¼Œæ— æ³•åŠ è½½æ–‡æ¡£æ•°é‡"),void(this.documentsCount=0);try{const t=`knowledgeBaseDocs_${this.projectId}`,e=localStorage.getItem(t);if(e){const t=JSON.parse(e),s=t.docs&&Array.isArray(t.docs)?t.docs.length:0;this.documentsCount=s,console.log("âœ… çŸ¥è¯†æ–‡æ¡£æ•°é‡åŠ è½½å®Œæˆ:",this.documentsCount,"ç¯‡")}else this.documentsCount=0,console.log("çŸ¥è¯†æŸœæš‚æ— æ–‡æ¡£æ•°æ®")}catch(t){console.error("åŠ è½½æ–‡æ¡£æ•°é‡å¤±è´¥:",t),this.documentsCount=0}},async getTeamSize(t){if(!t)return 1;try{const e=localStorage.getItem(`project_member_count_${t}`),s=e?parseInt(e,10):NaN;if(!isNaN(s)&&s>0)return console.log(`ä»ç¼“å­˜è¯»å–é¡¹ç›® ${t} çš„å›¢é˜Ÿæˆå‘˜æ•°é‡:`,s),s}catch(e){console.warn("è¯»å–å›¢é˜Ÿæˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:",e)}try{console.log("ä»APIè·å–é¡¹ç›®",t,"çš„å›¢é˜Ÿæˆå‘˜æ•°é‡");const s=await ut.projectAPI.getProjectMembers(t,0,1e3);if(s&&200===s.code){let a=0;if(s.data&&s.data.content?a=s.data.content.length:Array.isArray(s.data)&&(a=s.data.length),a>0)try{localStorage.setItem(`project_member_count_${t}`,String(a)),console.log(`âœ… å·²ç¼“å­˜é¡¹ç›® ${t} çš„å›¢é˜Ÿæˆå‘˜æ•°é‡:`,a)}catch(e){console.warn("å†™å…¥æˆå‘˜æ•°é‡ç¼“å­˜å¤±è´¥:",e?.message||e)}return a>0?a:1}}catch(s){console.warn(`è·å–é¡¹ç›® ${t} æˆå‘˜æ•°é‡å¤±è´¥:`,s)}return 1},async loadTeamMembersCount(){const t=this.projectId||this.$route.params.id;if(!t)return console.warn("projectIdä¸ºç©ºï¼Œæ— æ³•åŠ è½½å›¢é˜Ÿæˆå‘˜æ•°é‡"),this.teamMembersCount=1,void(this.onlineMembersCount=0);this.teamMembersCount=await this.getTeamSize(t);try{const e=await ut.projectAPI.getProjectMembers(t,0,1e3);if(e&&200===e.code){let t=[];e.data&&e.data.content?t=e.data.content:Array.isArray(e.data)&&(t=e.data);const s=t.filter(t=>!0===t.isOnline||!0===t.is_online||!0===t.online||("ONLINE"===t.onlineStatus||"online"===t.onlineStatus||("ONLINE"===t.status||"online"===t.status||"active"===t.status))).length;t.length>0&&(t[0].hasOwnProperty("isOnline")||t[0].hasOwnProperty("is_online")||t[0].hasOwnProperty("online")||t[0].hasOwnProperty("onlineStatus")||t[0].hasOwnProperty("status"))?(this.onlineMembersCount=s,console.log("âœ… ä½¿ç”¨çœŸå®çš„åœ¨çº¿äººæ•°:",this.onlineMembersCount,"äººï¼ˆæ€»äººæ•°:",this.teamMembersCount,"äººï¼‰")):(this.onlineMembersCount=Math.floor(.67*this.teamMembersCount),console.log("âš ï¸ åç«¯æœªæä¾›åœ¨çº¿çŠ¶æ€ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",this.onlineMembersCount,"äººï¼ˆæ€»äººæ•°:",this.teamMembersCount,"äººï¼‰"))}else this.onlineMembersCount=Math.floor(.67*this.teamMembersCount),console.log("âš ï¸ APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿåœ¨çº¿äººæ•°:",this.onlineMembersCount,"äºº")}catch(e){console.warn("è·å–å›¢é˜Ÿæˆå‘˜è¯¦æƒ…å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿåœ¨çº¿äººæ•°:",e),this.onlineMembersCount=Math.floor(.67*this.teamMembersCount)}console.log("âœ… å›¢é˜Ÿæˆå‘˜æ•°é‡åŠ è½½å®Œæˆ:",this.teamMembersCount,"äºº, åœ¨çº¿:",this.onlineMembersCount,"äºº")},updateStats(){this.loadStats()},saveToLocalStorage(){try{const t={activities:this.activities,projectId:this.projectId};localStorage.setItem(`projectKnowledge_${this.projectId}`,JSON.stringify(t)),console.log("é¡¹ç›®çŸ¥è¯†åº“æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨")}catch(t){console.error("ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:",t)}},loadFromLocalStorage(){try{const t=localStorage.getItem(`projectKnowledge_${this.projectId}`);if(t){const e=JSON.parse(t);e.activities&&Array.isArray(e.activities)&&(this.activities=e.activities,console.log("é¡¹ç›®çŸ¥è¯†åº“æ•°æ®å·²ä»æœ¬åœ°å­˜å‚¨åŠ è½½"))}}catch(t){console.error("ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¤±è´¥:",t)}},getUploadedFilesCount(){try{const t=this.projectId?`knowledgeBaseCatalog_${this.projectId}`:"knowledgeBaseCatalog",e=localStorage.getItem(t);if(e){const t=JSON.parse(e);return t.uploadedFiles?t.uploadedFiles.length:0}}catch(t){console.error("è·å–ä¸Šä¼ æ–‡ä»¶æ•°é‡å¤±è´¥:",t)}return 0},getDocumentsCount(){try{const t=this.projectId?`knowledgeBaseDocs_${this.projectId}`:"knowledgeBaseDocs",e=localStorage.getItem(t);if(e){const t=JSON.parse(e);return t.docs?t.docs.length:0}}catch(t){console.error("è·å–æ–‡æ¡£æ•°é‡å¤±è´¥:",t)}return 0},getEditingDocumentsCount(){return Math.min(5,Math.floor(.1*this.getDocumentsCount()))},initializeProjectData(){if(!this.projectId)return;const t=this.getProjectSpecificData(this.projectId);this.initializeCatalogData(t.catalog),this.initializeCabinetData(t.cabinet)},getProjectSpecificData(t){const e={1:{catalog:[{id:1,name:"åŒ»å­¦å½±åƒæ•°æ®é›†_v1.0.zip",type:"æ•°æ®é›†",uploader:"å¼ åŒ»ç”Ÿ",time:"2023-11-15 14:30",typeCls:"dataset"},{id:2,name:"CTå½±åƒåˆ†æç®—æ³•.pdf",type:"è®ºæ–‡",uploader:"æç ”ç©¶å‘˜",time:"2023-11-10 09:15",typeCls:"doc"},{id:3,name:"MRIå›¾åƒé¢„å¤„ç†æ¨¡å‹.pkl",type:"æ¨¡å‹æ–‡ä»¶",uploader:"ç‹å·¥ç¨‹å¸ˆ",time:"2023-11-05 16:45",typeCls:"model"}],cabinet:[{id:1,title:"åŒ»å­¦å½±åƒæ•°æ®é¢„å¤„ç†è§„èŒƒ",updated:"2023å¹´11æœˆ15æ—¥",content:"åŒ»å­¦å½±åƒæ•°æ®é¢„å¤„ç†è§„èŒƒ\n\n1. æ•°æ®æ¸…æ´—...\n2. æ ¼å¼è½¬æ¢...\n3. è´¨é‡æ§åˆ¶..."},{id:2,title:"æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒæŒ‡å—",updated:"2023å¹´11æœˆ10æ—¥",content:"æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒæŒ‡å—\n\n1. æ•°æ®å‡†å¤‡...\n2. æ¨¡å‹é€‰æ‹©...\n3. è®­ç»ƒå‚æ•°..."}]},2:{catalog:[{id:1,name:"æ°”è±¡æ•°æ®æ”¶é›†æŠ¥å‘Š.pdf",type:"å®éªŒæŠ¥å‘Š",uploader:"é™ˆæ°”è±¡å­¦å®¶",time:"2023-11-12 10:20",typeCls:"report"},{id:2,name:"æ°”å€™æ¨¡å‹è®­ç»ƒæ•°æ®.csv",type:"æ•°æ®é›†",uploader:"åˆ˜æ•°æ®å‘˜",time:"2023-11-08 15:30",typeCls:"dataset"},{id:3,name:"é¢„æµ‹ç®—æ³•ä¼˜åŒ–æ–¹æ¡ˆ.docx",type:"ä¸“åˆ©",uploader:"èµµç ”ç©¶å‘˜",time:"2023-11-03 11:45",typeCls:"patent"}],cabinet:[{id:1,title:"æ°”å€™æ•°æ®æ”¶é›†æ ‡å‡†",updated:"2023å¹´11æœˆ12æ—¥",content:"æ°”å€™æ•°æ®æ”¶é›†æ ‡å‡†\n\n1. æ•°æ®æ¥æº...\n2. é‡‡é›†é¢‘ç‡...\n3. è´¨é‡æ§åˆ¶..."},{id:2,title:"é¢„æµ‹æ¨¡å‹è¯„ä¼°æ–¹æ³•",updated:"2023å¹´11æœˆ08æ—¥",content:"é¢„æµ‹æ¨¡å‹è¯„ä¼°æ–¹æ³•\n\n1. è¯„ä¼°æŒ‡æ ‡...\n2. æµ‹è¯•æ–¹æ³•...\n3. ç»“æœåˆ†æ..."}]},3:{catalog:[{id:1,name:"åŸºå› åºåˆ—åˆ†æå·¥å…·.py",type:"æ¨¡å‹æ–‡ä»¶",uploader:"å­™ç”Ÿç‰©å­¦å®¶",time:"2023-11-14 13:25",typeCls:"model"},{id:2,name:"åŸºå› ç»„å˜å¼‚æ£€æµ‹ç®—æ³•.pdf",type:"è®ºæ–‡",uploader:"å‘¨ç ”ç©¶å‘˜",time:"2023-11-09 16:10",typeCls:"doc"},{id:3,name:"åŸºå› è¡¨è¾¾æ•°æ®é›†.xlsx",type:"æ•°æ®é›†",uploader:"å´æ•°æ®å‘˜",time:"2023-11-06 09:40",typeCls:"dataset"}],cabinet:[{id:1,title:"åŸºå› ç»„æ•°æ®åˆ†ææµç¨‹",updated:"2023å¹´11æœˆ14æ—¥",content:"åŸºå› ç»„æ•°æ®åˆ†ææµç¨‹\n\n1. æ•°æ®é¢„å¤„ç†...\n2. åºåˆ—æ¯”å¯¹...\n3. å˜å¼‚æ£€æµ‹..."},{id:2,title:"ç”Ÿç‰©ä¿¡æ¯å­¦å·¥å…·ä½¿ç”¨æŒ‡å—",updated:"2023å¹´11æœˆ09æ—¥",content:"ç”Ÿç‰©ä¿¡æ¯å­¦å·¥å…·ä½¿ç”¨æŒ‡å—\n\n1. å·¥å…·é€‰æ‹©...\n2. å‚æ•°è®¾ç½®...\n3. ç»“æœè§£è¯»..."}]}};return e[t]||{catalog:[],cabinet:[]}},initializeCatalogData(t){if(!t||0===t.length)return;const e=`knowledgeBaseCatalog_${this.projectId}`,s=localStorage.getItem(e);if(!s){const s={uploadedFiles:t,currentPage:1};localStorage.setItem(e,JSON.stringify(s)),console.log(`å·²åˆå§‹åŒ–é¡¹ç›® ${this.projectId} çš„æˆæœç›®å½•æ•°æ®`)}},initializeCabinetData(t){if(!t||0===t.length)return;const e=`knowledgeBaseDocs_${this.projectId}`,s=localStorage.getItem(e);if(!s){const s={docs:t,activeId:t[0]?.id||1,hasUnsavedChanges:!1};localStorage.setItem(e,JSON.stringify(s)),console.log(`å·²åˆå§‹åŒ–é¡¹ç›® ${this.projectId} çš„çŸ¥è¯†æŸœæ•°æ®`)}}}},cs=ls,ds=(0,_.A)(cs,rs,ns,!1,null,null,null),hs=ds.exports;a.Ay.use(P.Ay);const ps=[{path:"/",redirect:"/home"},{path:"/login",name:"Login",component:z},{path:"/register",name:"Register",component:J},{path:"/forgot-password",name:"ForgotPassword",component:Q},{path:"/home",name:"Home",component:Ct},{path:"/project-square",name:"ProjectSquare",component:_t},{path:"/project-create",name:"ProjectCreate",component:Tt},{path:"/project-detail/:id",name:"ProjectDetail",component:os},{path:"/project-knowledge/:id",name:"ProjectKnowledge",component:hs},{path:"/knowledge-base",name:"KnowledgeBase",component:$t,children:[{path:"home",component:{render:t=>t("div")}},{path:"catalog",component:we},{path:"cabinet",component:Ie},{path:"ai",component:Ae}]},{path:"/ai-assistant",name:"AIAssistant",component:We},{path:"/profile",name:"Profile",component:Xe}],us=new P.Ay({mode:"history",base:"/",routes:ps});us.beforeEach((t,e,s)=>{const a=localStorage.getItem("access_token"),i=localStorage.getItem("user_info"),o=!(!a||!i);if(console.log("è·¯ç”±å®ˆå«æ£€æŸ¥:",{to:t.path,from:e.path,isAuthenticated:o,token:!!a,userInfo:!!i}),t.path===e.path)return console.log("ç›¸åŒè·¯å¾„ï¼Œè·³è¿‡é‡å®šå‘"),void s();if("/login"===t.path)return void(o?(console.log("å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µï¼Œé‡å®šå‘åˆ°é¦–é¡µ"),s({path:"/home",replace:!0})):(console.log("æ¸¸å®¢è®¿é—®ç™»å½•é¡µï¼Œå…è®¸è®¿é—®"),s()));if("/register"===t.path||"/forgot-password"===t.path)return console.log("æ³¨å†Œ/å¿˜è®°å¯†ç é¡µé¢ï¼Œå…è®¸è®¿é—®"),void s();const r=["/home","/project-square","/profile"];if(r.includes(t.path))return console.log("æ¸¸å®¢å¯è®¿é—®é¡µé¢ï¼Œå…è®¸è®¿é—®"),void s();const n=["/project-create","/ai-assistant","/knowledge-base","/project-detail","/project-knowledge","/project"],l=n.some(e=>t.path.startsWith(e));l?o?(console.log("å·²è®¤è¯ï¼Œå…è®¸è®¿é—®"),s()):(console.log("éœ€è¦è®¤è¯çš„é¡µé¢ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ"),s({path:"/login",replace:!0})):(console.log("å…¶ä»–é¡µé¢ï¼Œå…è®¸è®¿é—®"),s())});var ms=us,gs=function(){var t=this,e=t._self._c;return e("button",{class:t.buttonClasses,attrs:{disabled:t.disabled||t.loading,type:t.type},on:{click:t.handleClick}},[t.loading?e("svg",{staticClass:"animate-spin -ml-1 mr-2 h-4 w-4",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"}},[e("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}}),e("path",{staticClass:"opacity-75",attrs:{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}})]):t._e(),t.loading?t._e():t._t("default",function(){return[t._v(t._s(t.text))]}),t.loading?e("span",{staticClass:"ml-2"},[t._v(t._s(t.loadingText))]):t._e()],2)},vs=[],Cs={name:"Button",props:{variant:{type:String,default:"primary",validator:t=>["primary","secondary","success","warning","error","ghost"].includes(t)},size:{type:String,default:"md",validator:t=>["sm","md","lg","xl"].includes(t)},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"åŠ è½½ä¸­..."},text:{type:String,default:""},type:{type:String,default:"button"},fullWidth:{type:Boolean,default:!1}},computed:{buttonClasses(){const t=["btn",`btn-${this.variant}`,`btn-${this.size}`,this.fullWidth?"btn-full":"",this.loading?"btn-loading":""].filter(Boolean);return t.join(" ")}},methods:{handleClick(t){this.disabled||this.loading||this.$emit("click",t)}}},ws=Cs,fs=(0,_.A)(ws,gs,vs,!1,null,"522651d6",null),ks=fs.exports,ys=function(){var t=this,e=t._self._c;return e("div",{class:t.cardClasses,on:{click:t.handleClick}},[t.$slots.header?e("div",{staticClass:"card-header"},[t._t("header")],2):t._e(),t.$slots.media?e("div",{staticClass:"card-media"},[t._t("media")],2):t._e(),e("div",{staticClass:"card-body"},[t._t("default")],2),t.$slots.footer?e("div",{staticClass:"card-footer"},[t._t("footer")],2):t._e()])},bs=[],_s={name:"Card",props:{variant:{type:String,default:"default",validator:t=>["default","elevated","outlined","filled"].includes(t)},hover:{type:Boolean,default:!0},clickable:{type:Boolean,default:!1},padding:{type:String,default:"md",validator:t=>["none","sm","md","lg","xl"].includes(t)}},computed:{cardClasses(){const t=["card",`card-${this.variant}`,`card-padding-${this.padding}`,this.hover?"card-hover":"",this.clickable?"card-clickable":""].filter(Boolean);return t.join(" ")}},methods:{handleClick(t){this.clickable&&this.$emit("click",t)}}},Is=_s,Fs=(0,_.A)(Is,ys,bs,!1,null,"29787730",null),Ss=Fs.exports,Ds=function(){var t=this,e=t._self._c;return e("div",{staticClass:"input-group"},[t.label?e("label",{staticClass:"input-label",attrs:{for:t.inputId}},[t._v(" "+t._s(t.label)+" "),t.required?e("span",{staticClass:"text-red-500 ml-1"},[t._v("*")]):t._e()]):t._e(),e("div",{staticClass:"input-wrapper",class:{"input-error":t.hasError,"input-disabled":t.disabled}},[t.$slots.prefix?e("div",{staticClass:"input-prefix"},[t._t("prefix")],2):t._e(),e("input",{staticClass:"input-field",attrs:{id:t.inputId,type:t.type,placeholder:t.placeholder,disabled:t.disabled,readonly:t.readonly,required:t.required,min:t.min,max:t.max,step:t.step,minlength:t.minlength,maxlength:t.maxlength,pattern:t.pattern,autocomplete:t.autocomplete},domProps:{value:t.modelValue},on:{input:t.handleInput,focus:t.handleFocus,blur:t.handleBlur,keydown:t.handleKeydown}}),t.$slots.suffix?e("div",{staticClass:"input-suffix"},[t._t("suffix")],2):t._e(),t.clearable&&t.modelValue&&!t.disabled?e("div",{staticClass:"input-clear",on:{click:t.handleClear}},[e("svg",{staticClass:"w-4 h-4",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"}},[e("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}})])]):t._e()]),t.helpText||t.hasError?e("div",{staticClass:"input-help"},[t.hasError?e("span",{staticClass:"text-red-600"},[t._v(t._s(t.errorMessage))]):t.helpText?e("span",{staticClass:"text-gray-500"},[t._v(t._s(t.helpText))]):t._e()]):t._e()])},js=[],Ts={name:"Input",props:{modelValue:{type:[String,Number],default:""},type:{type:String,default:"text"},label:{type:String,default:""},placeholder:{type:String,default:""},helpText:{type:String,default:""},errorMessage:{type:String,default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)},min:{type:[String,Number],default:void 0},max:{type:[String,Number],default:void 0},step:{type:[String,Number],default:void 0},minlength:{type:[String,Number],default:void 0},maxlength:{type:[String,Number],default:void 0},pattern:{type:String,default:void 0},autocomplete:{type:String,default:void 0}},emits:["update:modelValue","focus","blur","keydown","clear"],computed:{inputId(){return`input-${this._uid}`},hasError(){return!!this.errorMessage}},methods:{handleInput(t){this.$emit("update:modelValue",t.target.value)},handleFocus(t){this.$emit("focus",t)},handleBlur(t){this.$emit("blur",t)},handleKeydown(t){this.$emit("keydown",t)},handleClear(){this.$emit("update:modelValue",""),this.$emit("clear")}}},Ps=Ts,Ms=(0,_.A)(Ps,Ds,js,!1,null,"fe0570ce",null),xs=Ms.exports;const As={user:null,isAuthenticated:!1,loading:!1},Ns={SET_USER(t,e){t.user=e,t.isAuthenticated=!!e},SET_LOADING(t,e){t.loading=e},CLEAR_AUTH(t){t.user=null,t.isAuthenticated=!1}},$s={initAuth({commit:t}){const e=m();e&&v()&&t("SET_USER",e)},async login({commit:t},e){t("SET_LOADING",!0);try{const s=await L.login(e);return 200===s.code&&s.data?(u(s.data),t("SET_USER",s.data.userInfo),{success:!0,data:s.data}):{success:!1,message:s.msg||"ç™»å½•å¤±è´¥"}}catch(s){return{success:!1,message:s.message||"ç™»å½•å¤±è´¥"}}finally{t("SET_LOADING",!1)}},async register({commit:t},e){t("SET_LOADING",!0);try{const t=await L.register(e);return 200===t.code?{success:!0,message:"æ³¨å†ŒæˆåŠŸ"}:{success:!1,message:t.msg||"æ³¨å†Œå¤±è´¥"}}catch(s){return{success:!1,message:s.message||"æ³¨å†Œå¤±è´¥"}}finally{t("SET_LOADING",!1)}},async logout({commit:t}){try{const t=localStorage.getItem("access_token");t&&await L.logout(t)}catch(e){console.error("ç™»å‡ºå¤±è´¥:",e)}finally{C(),t("CLEAR_AUTH")}},async checkAutoLogin({commit:t}){try{const s=await L.autoLoginCheck();if(200===s.code&&s.data&&s.data.valid){const s=localStorage.getItem("refresh_token");if(s)try{const e=await L.refreshToken(s);if(200===e.code&&e.data)return u({accessToken:e.data.accessToken,refreshToken:e.data.refreshToken,userInfo:e.data.user}),t("SET_USER",e.data.user),console.log("âœ… é€šè¿‡RefreshTokenè‡ªåŠ¨ç™»å½•æˆåŠŸ"),!0}catch(e){console.warn("RefreshTokenå·²è¿‡æœŸï¼Œå°è¯•å…¶ä»–æ–¹æ³•:",e)}return console.warn("âš ï¸ RememberMe tokenæœ‰æ•ˆï¼Œä½†RefreshTokenå·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•"),!1}return!1}catch(s){return console.error("è‡ªåŠ¨ç™»å½•æ£€æŸ¥å¤±è´¥:",s),!1}}},Ls={isAuthenticated:t=>t.isAuthenticated,currentUser:t=>t.user,isLoading:t=>t.loading};var Es={namespaced:!0,state:As,mutations:Ns,actions:$s,getters:Ls};class Us{constructor(){this.refreshTimer=null,this.refreshThreshold=3e5}initialize(){console.log("ğŸ”§ TokenManager: åˆå§‹åŒ–");const t=this.getAccessToken();t&&this.scheduleTokenRefresh()}getAccessToken(){return localStorage.getItem("access_token")}getRefreshToken(){return localStorage.getItem("refresh_token")}setAccessToken(t){localStorage.setItem("access_token",t)}setRefreshToken(t){localStorage.setItem("refresh_token",t)}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("remember_me_token"),this.cancelTokenRefresh()}getTokenExpirationTime(t){try{const e=JSON.parse(atob(t.split(".")[1]));return e.exp?1e3*e.exp:null}catch(e){return console.error("è§£æTokenå¤±è´¥:",e),null}}isTokenExpiringSoon(t){const e=this.getTokenExpirationTime(t);if(!e)return!1;const s=Date.now(),a=e-s;return a<this.refreshThreshold}scheduleTokenRefresh(){const t=this.getAccessToken();if(!t)return;const e=this.getTokenExpirationTime(t);if(!e)return;const s=Date.now(),a=e-s-this.refreshThreshold;a<=0?this.refreshAccessToken():(this.cancelTokenRefresh(),this.refreshTimer=setTimeout(()=>{this.refreshAccessToken()},a),console.log(`â° Tokenå°†åœ¨ ${Math.round(a/1e3)} ç§’ååˆ·æ–°`))}cancelTokenRefresh(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}async refreshAccessToken(){const t=this.getRefreshToken();if(!t)return console.warn("æ²¡æœ‰åˆ·æ–°ä»¤ç‰Œï¼Œæ— æ³•åˆ·æ–°è®¿é—®ä»¤ç‰Œ"),!1;try{console.log("ğŸ”„ æ­£åœ¨åˆ·æ–°è®¿é—®ä»¤ç‰Œ...");const e=await L.refreshToken(t);if(200===e.code&&e.data){const{accessToken:t,refreshToken:s}=e.data;return t&&(this.setAccessToken(t),console.log("âœ… è®¿é—®ä»¤ç‰Œå·²åˆ·æ–°")),s&&this.setRefreshToken(s),this.scheduleTokenRefresh(),!0}return console.error("åˆ·æ–°ä»¤ç‰Œå¤±è´¥:",e.msg),this.handleRefreshFailure(),!1}catch(e){return console.error("åˆ·æ–°ä»¤ç‰Œå¼‚å¸¸:",e),this.handleRefreshFailure(),!1}}async refreshToken(){return this.refreshAccessToken()}handleRefreshFailure(){console.warn("âš ï¸ Tokenåˆ·æ–°å¤±è´¥ï¼Œæ¸…é™¤è®¤è¯ä¿¡æ¯"),this.clearTokens(),"/login"!==window.location.pathname&&(alert("ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"),window.location.href="/login")}async checkAndRefreshToken(){const t=this.getAccessToken();return!!t&&(!this.isTokenExpiringSoon(t)||await this.refreshAccessToken())}}var Os=new Us;a.Ay.config.productionTip=!1,a.Ay.use(Bt),a.Ay.component("GlobalUserProfile",F),a.Ay.component("Button",ks),a.Ay.component("Card",Ss),a.Ay.component("Input",xs);const zs={...Es.state},Bs={state:zs,dispatch(t,e){if(Es.actions[t]){const s={state:zs,commit:(t,e)=>{Es.mutations[t]&&Es.mutations[t](zs,e)}};return Es.actions[t](s,e)}},getters:Es.getters};a.Ay.prototype.$auth=Bs,new a.Ay({router:ms,render:t=>t(T),async created(){console.log("ğŸš€ åº”ç”¨å¯åŠ¨"),Os.initialize(),this.$auth.dispatch("initAuth");const t=!!localStorage.getItem("access_token")&&!!localStorage.getItem("user_info");if(t)console.log("âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œè·³è¿‡è‡ªåŠ¨ç™»å½•æ£€æŸ¥");else{console.log("ğŸ” å½“å‰æœªç™»å½•ï¼Œæ£€æŸ¥RememberMeè‡ªåŠ¨ç™»å½•...");try{const t=await this.$auth.dispatch("checkAutoLogin");t?(console.log("âœ… è‡ªåŠ¨ç™»å½•æˆåŠŸ"),await Os.refreshAccessToken()):console.log("â„¹ï¸ æ²¡æœ‰æœ‰æ•ˆçš„RememberMe tokenï¼Œéœ€è¦æ‰‹åŠ¨ç™»å½•")}catch(e){console.error("âŒ è‡ªåŠ¨ç™»å½•æ£€æŸ¥å¤±è´¥:",e)}}}}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,s),o.exports}s.m=t,function(){var t=[];s.O=function(e,a,i,o){if(!a){var r=1/0;for(d=0;d<t.length;d++){a=t[d][0],i=t[d][1],o=t[d][2];for(var n=!0,l=0;l<a.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every(function(t){return s.O[t](a[l])})?a.splice(l--,1):(n=!1,o<r&&(r=o));if(n){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[a,i,o]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.f={},s.e=function(t){return Promise.all(Object.keys(s.f).reduce(function(e,a){return s.f[a](t,e),e},[]))}}(),function(){s.u=function(t){return"js/"+t+".90628a8d.js"}}(),function(){s.miniCssF=function(t){}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="zhiyan-front:";s.l=function(a,i,o,r){if(t[a])t[a].push(i);else{var n,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var h=c[d];if(h.getAttribute("src")==a||h.getAttribute("data-webpack")==e+o){n=h;break}}n||(l=!0,n=document.createElement("script"),n.charset="utf-8",s.nc&&n.setAttribute("nonce",s.nc),n.setAttribute("data-webpack",e+o),n.src=a),t[a]=[i];var p=function(e,s){n.onerror=n.onload=null,clearTimeout(u);var i=t[a];if(delete t[a],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach(function(t){return t(s)}),e)return e(s)},u=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),l&&document.head.appendChild(n)}}}(),function(){s.p="/"}(),function(){var t={524:0};s.f.j=function(e,a){var i=s.o(t,e)?t[e]:void 0;if(0!==i)if(i)a.push(i[2]);else{var o=new Promise(function(s,a){i=t[e]=[s,a]});a.push(i[2]=o);var r=s.p+s.u(e),n=new Error,l=function(a){if(s.o(t,e)&&(i=t[e],0!==i&&(t[e]=void 0),i)){var o=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;n.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",n.name="ChunkLoadError",n.type=o,n.request=r,i[1](n)}};s.l(r,l,"chunk-"+e,e)}},s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,o,r=a[0],n=a[1],l=a[2],c=0;if(r.some(function(e){return 0!==t[e]})){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var d=l(s)}for(e&&e(a);c<r.length;c++)o=r[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(d)},a=self["webpackChunkzhiyan_front"]=self["webpackChunkzhiyan_front"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(718)});a=s.O(a)})();
//# sourceMappingURL=app.e668b0c5.js.map